import{a as y,k as b,O as T}from"./@babylonjscore_Misc.329df4d9.js";import{E as K}from"./@babylonjscore_Events.9219334a.js";var s;(function(e){e[e.Generic=0]="Generic",e[e.Keyboard=1]="Keyboard",e[e.Mouse=2]="Mouse",e[e.Touch=3]="Touch",e[e.DualShock=4]="DualShock",e[e.Xbox=5]="Xbox",e[e.Switch=6]="Switch",e[e.DualSense=7]="DualSense"})(s||(s={}));var d;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.Move=12]="Move"})(d||(d={}));var M;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.DeltaHorizontal=10]="DeltaHorizontal",e[e.DeltaVertical=11]="DeltaVertical"})(M||(M={}));var E;(function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Share=8]="Share",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"})(E||(E={}));var L;(function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Create=8]="Create",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"})(L||(L={}));var p;(function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LB=4]="LB",e[e.RB=5]="RB",e[e.LT=6]="LT",e[e.RT=7]="RT",e[e.Back=8]="Back",e[e.Start=9]="Start",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.LStickXAxis=17]="LStickXAxis",e[e.LStickYAxis=18]="LStickYAxis",e[e.RStickXAxis=19]="RStickXAxis",e[e.RStickYAxis=20]="RStickYAxis"})(p||(p={}));var D;(function(e){e[e.B=0]="B",e[e.A=1]="A",e[e.Y=2]="Y",e[e.X=3]="X",e[e.L=4]="L",e[e.R=5]="R",e[e.ZL=6]="ZL",e[e.ZR=7]="ZR",e[e.Minus=8]="Minus",e[e.Plus=9]="Plus",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.Capture=17]="Capture",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"})(D||(D={}));var m=function(){function e(){}return e.CreateDeviceEvent=function(t,i,r,a,h,o){switch(t){case s.Keyboard:return this._CreateKeyboardEvent(r,a,h,o);case s.Mouse:if(r===d.MouseWheelX||r===d.MouseWheelY||r===d.MouseWheelZ)return this._CreateWheelEvent(t,i,r,a,h,o);case s.Touch:return this._CreatePointerEvent(t,i,r,a,h,o);default:throw"Unable to generate event for device ".concat(s[t])}},e._CreatePointerEvent=function(t,i,r,a,h,o){var n=this._CreateMouseEvent(t,i,r,a,h,o);return t===s.Mouse?(n.deviceType=s.Mouse,n.pointerId=1,n.pointerType="mouse"):(n.deviceType=s.Touch,n.pointerId=i,n.pointerType="touch"),r===d.Move?n.type="pointermove":r>=d.LeftClick&&r<=d.RightClick&&(n.type=a===1?"pointerdown":"pointerup",n.button=r-2),n},e._CreateWheelEvent=function(t,i,r,a,h,o){var n=this._CreateMouseEvent(t,i,r,a,h,o);switch(n.type="wheel",n.deltaMode=K.DOM_DELTA_PIXEL,n.deltaX=0,n.deltaY=0,n.deltaZ=0,r){case d.MouseWheelX:n.deltaX=a;break;case d.MouseWheelY:n.deltaY=a;break;case d.MouseWheelZ:n.deltaZ=a;break}return n},e._CreateMouseEvent=function(t,i,r,a,h,o){var n=this._CreateEvent(o),c=h.pollInput(t,i,d.Horizontal),_=h.pollInput(t,i,d.Vertical);return o?(n.movementX=0,n.movementY=0,n.offsetX=n.movementX-o.getBoundingClientRect().x,n.offsetY=n.movementY-o.getBoundingClientRect().y):(n.movementX=h.pollInput(t,i,M.DeltaHorizontal),n.movementY=h.pollInput(t,i,M.DeltaVertical),n.offsetX=0,n.offsetY=0),this._CheckNonCharacterKeys(n,h),n.clientX=c,n.clientY=_,n.x=c,n.y=_,n.deviceType=t,n.deviceSlot=i,n.inputIndex=r,n},e._CreateKeyboardEvent=function(t,i,r,a){var h=this._CreateEvent(a);return this._CheckNonCharacterKeys(h,r),h.deviceType=s.Keyboard,h.deviceSlot=0,h.inputIndex=t,h.type=i===1?"keydown":"keyup",h.key=String.fromCharCode(t),h.keyCode=t,h},e._CheckNonCharacterKeys=function(t,i){var r=i.isDeviceAvailable(s.Keyboard),a=r&&i.pollInput(s.Keyboard,0,18)===1,h=r&&i.pollInput(s.Keyboard,0,17)===1,o=r&&(i.pollInput(s.Keyboard,0,91)===1||i.pollInput(s.Keyboard,0,92)===1||i.pollInput(s.Keyboard,0,93)===1),n=r&&i.pollInput(s.Keyboard,0,16)===1;t.altKey=a,t.ctrlKey=h,t.metaKey=o,t.shiftKey=n},e._CreateEvent=function(t){var i={};return i.preventDefault=function(){},i.target=t,i},e}(),Y=function(){function e(t,i,r){var a=this;this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(t,i,function(h,o,n,c){var _=m.CreateDeviceEvent(h,o,n,c,a);r(h,o,_)}):this._createDummyNativeInput()}return e.prototype.pollInput=function(t,i,r){return this._nativeInput.pollInput(t,i,r)},e.prototype.isDeviceAvailable=function(t){return t===s.Mouse||t===s.Touch},e.prototype.dispose=function(){this._nativeInput.dispose()},e.prototype._createDummyNativeInput=function(){var t={pollInput:function(){return 0},isDeviceAvailable:function(){return!1},dispose:function(){}};return t},e}(),k=255,O=Object.keys(d).length/2,w=function(){function e(t,i,r,a){var h=this;this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=y.IsSafari(),this._usingMacOS=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=function(o){},this._keyboardUpEvent=function(o){},this._keyboardBlurEvent=function(o){},this._pointerMoveEvent=function(o){},this._pointerDownEvent=function(o){},this._pointerUpEvent=function(o){},this._pointerCancelEvent=function(o){},this._pointerWheelEvent=function(o){},this._pointerBlurEvent=function(o){},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=b.IsNavigatorAvailable()&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!==-1,this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=function(o){},this._gamepadDisconnectedEvent=function(o){},this._eventPrefix=y.GetPointerPrefix(t),this._engine=t,this._onDeviceConnected=i,this._onDeviceDisconnected=r,this._onInputChanged=a,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=function(){h._enableEvents()})}return e.prototype.pollInput=function(t,i,r){var a=this._inputs[t][i];if(!a)throw"Unable to find device ".concat(s[t]);t>=s.DualShock&&t<=s.DualSense&&this._updateDevice(t,i,r);var h=a[r];if(h===void 0)throw"Unable to find input ".concat(r," for device ").concat(s[t]," in slot ").concat(i);return r===d.Move&&y.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),h},e.prototype.isDeviceAvailable=function(t){return this._inputs[t]!==void 0},e.prototype.dispose=function(){this._onDeviceConnected=function(){},this._onDeviceDisconnected=function(){},this._onInputChanged=function(){},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()},e.prototype._enableEvents=function(){var t=this===null||this===void 0?void 0:this._engine.getInputElement();if(t&&(!this._eventsAttached||this._elementToAttachTo!==t)){if(this._disableEvents(),this._inputs)for(var i=0,r=this._inputs;i<r.length;i++){var a=r[i];if(a)for(var h in a){var o=+h,n=a[o];if(n)for(var c=0;c<n.length;c++)n[c]=0}}this._elementToAttachTo=t,this._elementToAttachTo.tabIndex=this._elementToAttachTo.tabIndex!==-1?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}},e.prototype._disableEvents=function(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1},e.prototype._checkForConnectedDevices=function(){if(navigator.getGamepads)for(var t=navigator.getGamepads(),i=0,r=t;i<r.length;i++){var a=r[i];a&&this._addGamePad(a)}typeof matchMedia=="function"&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(s.Mouse,0,0,0)},e.prototype._addGamePad=function(t){var i=this._getGamepadDeviceType(t.id),r=t.index;this._gamepads=this._gamepads||new Array(t.index+1),this._registerDevice(i,r,t.buttons.length+t.axes.length),this._gamepads[r]=i},e.prototype._addPointerDevice=function(t,i,r,a){this._pointerActive||(this._pointerActive=!0),this._registerDevice(t,i,O);var h=this._inputs[t][i];h[0]=r,h[1]=a},e.prototype._registerDevice=function(t,i,r){if(i===void 0)throw"Unable to register device ".concat(s[t]," to undefined slot.");if(this._inputs[t]||(this._inputs[t]={}),!this._inputs[t][i]){var a=new Array(r);a.fill(0),this._inputs[t][i]=a,this._onDeviceConnected(t,i)}},e.prototype._unregisterDevice=function(t,i){this._inputs[t][i]&&(delete this._inputs[t][i],this._onDeviceDisconnected(t,i))},e.prototype._handleKeyActions=function(){var t=this;this._keyboardDownEvent=function(i){t._keyboardActive||(t._keyboardActive=!0,t._registerDevice(s.Keyboard,0,k));var r=t._inputs[s.Keyboard][0];if(r){r[i.keyCode]=1;var a=i;a.inputIndex=i.keyCode,t._usingMacOS&&i.metaKey&&i.key!=="Meta"&&(t._metaKeys.includes(i.keyCode)||t._metaKeys.push(i.keyCode)),t._onInputChanged(s.Keyboard,0,a)}},this._keyboardUpEvent=function(i){t._keyboardActive||(t._keyboardActive=!0,t._registerDevice(s.Keyboard,0,k));var r=t._inputs[s.Keyboard][0];if(r){r[i.keyCode]=0;var a=i;if(a.inputIndex=i.keyCode,t._usingMacOS&&i.key==="Meta"&&t._metaKeys.length>0){for(var h=0,o=t._metaKeys;h<o.length;h++){var n=o[h],c=m.CreateDeviceEvent(s.Keyboard,0,n,0,t,t._elementToAttachTo);r[n]=0,t._onInputChanged(s.Keyboard,0,c)}t._metaKeys.splice(0,t._metaKeys.length)}t._onInputChanged(s.Keyboard,0,a)}},this._keyboardBlurEvent=function(){if(t._keyboardActive){for(var i=t._inputs[s.Keyboard][0],r=0;r<i.length;r++)if(i[r]!==0){i[r]=0;var a=m.CreateDeviceEvent(s.Keyboard,0,r,0,t,t._elementToAttachTo);t._onInputChanged(s.Keyboard,0,a)}t._usingMacOS&&t._metaKeys.splice(0,t._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)},e.prototype._handlePointerActions=function(){var t=this;this._maxTouchPoints=b.IsNavigatorAvailable()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(var i=0;i<this._maxTouchPoints;i++)this._activeTouchIds[i]=-1;this._pointerMoveEvent=function(o){var n=t._getPointerType(o),c=n===s.Mouse?0:t._activeTouchIds.indexOf(o.pointerId);t._inputs[n]||(t._inputs[n]={}),t._inputs[n][c]||t._addPointerDevice(n,c,o.clientX,o.clientY);var _=t._inputs[n][c];if(_){_[d.Horizontal]=o.clientX,_[d.Vertical]=o.clientY;var v=o;v.inputIndex=d.Move,t._onInputChanged(n,c,v),!t._usingSafari&&o.button!==-1&&(v.inputIndex=o.button+2,_[o.button+2]=_[o.button+2]?0:1,t._onInputChanged(n,c,v))}},this._pointerDownEvent=function(o){var n=t._getPointerType(o),c=n===s.Mouse?0:o.pointerId;if(n===s.Touch){var _=t._activeTouchIds.indexOf(-1);if(_>=0)c=_,t._activeTouchIds[_]=o.pointerId;else{y.Warn("Max number of touches exceeded.  Ignoring touches in excess of ".concat(t._maxTouchPoints));return}}t._inputs[n]||(t._inputs[n]={}),t._inputs[n][c]?n===s.Touch&&t._onDeviceConnected(n,c):t._addPointerDevice(n,c,o.clientX,o.clientY);var v=t._inputs[n][c];if(v){var g=v[d.Horizontal],f=v[d.Vertical];if(n===s.Mouse){if(t._mouseId===-1&&(o.pointerId===void 0?t._mouseId=t._isUsingFirefox?0:1:t._mouseId=o.pointerId),!document.pointerLockElement)try{t._elementToAttachTo.setPointerCapture(t._mouseId)}catch{}}else if(o.pointerId&&!document.pointerLockElement)try{t._elementToAttachTo.setPointerCapture(o.pointerId)}catch{}v[d.Horizontal]=o.clientX,v[d.Vertical]=o.clientY,v[o.button+2]=1;var u=o;u.inputIndex=o.button+2,t._onInputChanged(n,c,u),(g!==o.clientX||f!==o.clientY)&&(u.inputIndex=d.Move,t._onInputChanged(n,c,u))}},this._pointerUpEvent=function(o){var n,c,_,v,g,f=t._getPointerType(o),u=f===s.Mouse?0:t._activeTouchIds.indexOf(o.pointerId);if(f===s.Touch){if(u===-1)return;t._activeTouchIds[u]=-1}var l=(n=t._inputs[f])===null||n===void 0?void 0:n[u];if(l&&l[o.button+2]!==0){var C=l[d.Horizontal],P=l[d.Vertical];l[d.Horizontal]=o.clientX,l[d.Vertical]=o.clientY,l[o.button+2]=0;var A=o;(C!==o.clientX||P!==o.clientY)&&(A.inputIndex=d.Move,t._onInputChanged(f,u,A)),A.inputIndex=o.button+2,f===s.Mouse&&t._mouseId>=0&&((_=(c=t._elementToAttachTo).hasPointerCapture)===null||_===void 0?void 0:_.call(c,t._mouseId))?t._elementToAttachTo.releasePointerCapture(t._mouseId):o.pointerId&&((g=(v=t._elementToAttachTo).hasPointerCapture)===null||g===void 0?void 0:g.call(v,o.pointerId))&&t._elementToAttachTo.releasePointerCapture(o.pointerId),t._onInputChanged(f,u,A),f===s.Touch&&t._onDeviceDisconnected(f,u)}},this._pointerCancelEvent=function(o){var n,c,_,v;if(o.pointerType==="mouse"){var g=t._inputs[s.Mouse][0];t._mouseId>=0&&((c=(n=t._elementToAttachTo).hasPointerCapture)===null||c===void 0?void 0:c.call(n,t._mouseId))&&t._elementToAttachTo.releasePointerCapture(t._mouseId);for(var f=d.LeftClick;f<=d.BrowserForward;f++)if(g[f]===1){g[f]=0;var u=m.CreateDeviceEvent(s.Mouse,0,f,0,t,t._elementToAttachTo);t._onInputChanged(s.Mouse,0,u)}}else{var l=t._activeTouchIds.indexOf(o.pointerId);!((v=(_=t._elementToAttachTo).hasPointerCapture)===null||v===void 0)&&v.call(_,o.pointerId)&&t._elementToAttachTo.releasePointerCapture(o.pointerId),t._inputs[s.Touch][l][d.LeftClick]=0;var u=m.CreateDeviceEvent(s.Touch,l,d.LeftClick,0,t,t._elementToAttachTo);t._onInputChanged(s.Touch,l,u),t._activeTouchIds[l]=-1,t._onDeviceDisconnected(s.Touch,l)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";var r=!1,a=function(){};try{var h=Object.defineProperty({},"passive",{get:function(){r=!0}});this._elementToAttachTo.addEventListener("test",a,h),this._elementToAttachTo.removeEventListener("test",a,h)}catch{}this._pointerBlurEvent=function(){var o,n,c,_,v;if(t.isDeviceAvailable(s.Mouse)){var g=t._inputs[s.Mouse][0];t._mouseId>=0&&((n=(o=t._elementToAttachTo).hasPointerCapture)===null||n===void 0?void 0:n.call(o,t._mouseId))&&t._elementToAttachTo.releasePointerCapture(t._mouseId);for(var f=d.LeftClick;f<=d.BrowserForward;f++)if(g[f]===1){g[f]=0;var u=m.CreateDeviceEvent(s.Mouse,0,f,0,t,t._elementToAttachTo);t._onInputChanged(s.Mouse,0,u)}}if(t.isDeviceAvailable(s.Touch))for(var g=t._inputs[s.Touch],l=0;l<t._activeTouchIds.length;l++){var C=t._activeTouchIds[l];if(!((_=(c=t._elementToAttachTo).hasPointerCapture)===null||_===void 0)&&_.call(c,C)&&t._elementToAttachTo.releasePointerCapture(C),C!==-1&&((v=g[l])===null||v===void 0?void 0:v[d.LeftClick])===1){g[l][d.LeftClick]=0;var u=m.CreateDeviceEvent(s.Touch,l,d.LeftClick,0,t,t._elementToAttachTo);t._onInputChanged(s.Touch,l,u),t._activeTouchIds[l]=-1,t._onDeviceDisconnected(s.Touch,l)}}},this._pointerWheelEvent=function(o){var n=s.Mouse,c=0;t._inputs[n]||(t._inputs[n]=[]),t._inputs[n][c]||(t._pointerActive=!0,t._registerDevice(n,c,O));var _=t._inputs[n][c];if(_){_[d.MouseWheelX]=o.deltaX||0,_[d.MouseWheelY]=o.deltaY||o.wheelDelta||0,_[d.MouseWheelZ]=o.deltaZ||0;var v=o;_[d.MouseWheelX]!==0&&(v.inputIndex=d.MouseWheelX,t._onInputChanged(n,c,v)),_[d.MouseWheelY]!==0&&(v.inputIndex=d.MouseWheelY,t._onInputChanged(n,c,v)),_[d.MouseWheelZ]!==0&&(v.inputIndex=d.MouseWheelZ,t._onInputChanged(n,c,v))}},this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,r?{passive:!1}:!1),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add(function(){if(t.isDeviceAvailable(s.Mouse)){var o=t._inputs[s.Mouse][0];o[d.MouseWheelX]=0,o[d.MouseWheelY]=0,o[d.MouseWheelZ]=0}})},e.prototype._handleGamepadActions=function(){var t=this;this._gamepadConnectedEvent=function(i){t._addGamePad(i.gamepad)},this._gamepadDisconnectedEvent=function(i){if(t._gamepads){var r=t._getGamepadDeviceType(i.gamepad.id),a=i.gamepad.index;t._unregisterDevice(r,a),delete t._gamepads[a]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},e.prototype._updateDevice=function(t,i,r){var a=navigator.getGamepads()[i];if(a&&t===this._gamepads[i]){var h=this._inputs[t][i];r>=a.buttons.length?h[r]=a.axes[r-a.buttons.length].valueOf():h[r]=a.buttons[r].value}},e.prototype._getGamepadDeviceType=function(t){return t.indexOf("054c")!==-1?t.indexOf("0ce6")!==-1?s.DualSense:s.DualShock:t.indexOf("Xbox One")!==-1||t.search("Xbox 360")!==-1||t.search("xinput")!==-1?s.Xbox:t.indexOf("057e")!==-1?s.Switch:s.Generic},e.prototype._getPointerType=function(t){var i=s.Mouse;return(t.pointerType==="touch"||t.pointerType==="pen"||t.touches)&&(i=s.Touch),i},e}(),R=function(){function e(t,i,r){r===void 0&&(r=0),this.deviceType=i,this.deviceSlot=r,this.onInputChangedObservable=new T,this._deviceInputSystem=t}return e.prototype.getInput=function(t){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,t)},e}(),W=function(){function e(t){var i=this;this._registeredManagers=new Array,this._refCount=0,this.registerManager=function(n){for(var c=0;c<i._devices.length;c++){var _=i._devices[c];for(var v in _){var g=+v;n._addDevice(new R(i._deviceInputSystem,c,g))}}i._registeredManagers.push(n)},this.unregisterManager=function(n){var c=i._registeredManagers.indexOf(n);c>-1&&i._registeredManagers.splice(c,1)};var r=Object.keys(s).length/2;this._devices=new Array(r);var a=function(n,c){i._devices[n]||(i._devices[n]=new Array),i._devices[n][c]||(i._devices[n][c]=c);for(var _=0,v=i._registeredManagers;_<v.length;_++){var g=v[_],f=new R(i._deviceInputSystem,n,c);g._addDevice(f)}},h=function(n,c){var _;!((_=i._devices[n])===null||_===void 0)&&_[c]&&delete i._devices[n][c];for(var v=0,g=i._registeredManagers;v<g.length;v++){var f=g[v];f._removeDevice(n,c)}},o=function(n,c,_){if(_)for(var v=0,g=i._registeredManagers;v<g.length;v++){var f=g[v];f._onInputChanged(n,c,_)}};typeof _native!="undefined"?this._deviceInputSystem=new Y(a,h,o):this._deviceInputSystem=new w(t,a,h,o)}return e.prototype.dispose=function(){this._deviceInputSystem.dispose()},e}(),U=function(){function e(t){var i=this,r=Object.keys(s).length/2;this._devices=new Array(r),this._firstDevice=new Array(r),this._engine=t,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new W(t)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new T(function(a){for(var h=0,o=i._devices;h<o.length;h++){var n=o[h];if(n)for(var c=0,_=n;c<_.length;c++){var v=_[c];v&&i.onDeviceConnectedObservable.notifyObserver(a,v)}}}),this.onDeviceDisconnectedObservable=new T,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=t.onDisposeObservable.add(function(){i.dispose()})}return e.prototype.getDeviceSource=function(t,i){if(i===void 0){if(this._firstDevice[t]===void 0)return null;i=this._firstDevice[t]}return!this._devices[t]||this._devices[t][i]===void 0?null:this._devices[t][i]},e.prototype.getDeviceSources=function(t){return this._devices[t]?this._devices[t].filter(function(i){return!!i}):[]},e.prototype.dispose=function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)},e.prototype._addDevice=function(t){this._devices[t.deviceType]||(this._devices[t.deviceType]=new Array),this._devices[t.deviceType][t.deviceSlot]||(this._devices[t.deviceType][t.deviceSlot]=t,this._updateFirstDevices(t.deviceType)),this.onDeviceConnectedObservable.notifyObservers(t)},e.prototype._removeDevice=function(t,i){var r,a,h=(r=this._devices[t])===null||r===void 0?void 0:r[i];this.onDeviceDisconnectedObservable.notifyObservers(h),!((a=this._devices[t])===null||a===void 0)&&a[i]&&delete this._devices[t][i],this._updateFirstDevices(t)},e.prototype._onInputChanged=function(t,i,r){var a,h;(h=(a=this._devices[t])===null||a===void 0?void 0:a[i])===null||h===void 0||h.onInputChangedObservable.notifyObservers(r)},e.prototype._updateFirstDevices=function(t){switch(t){case s.Keyboard:case s.Mouse:this._firstDevice[t]=0;break;case s.Touch:case s.DualSense:case s.DualShock:case s.Xbox:case s.Switch:case s.Generic:{delete this._firstDevice[t];var i=this._devices[t];if(i){for(var r=0;r<i.length;r++)if(i[r]){this._firstDevice[t]=r;break}}break}}},e}();export{U as D,d as P,s as a};
