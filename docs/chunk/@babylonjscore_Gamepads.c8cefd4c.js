import{_ as p}from"./tslibtslib.b6e59fa7.js";import{O as h,a as Q,I as V,L as l}from"./@babylonjscore_Misc.5aaba58d.js";import{S as O}from"./@babylonjscore_Loading.2301728b.js";import{T,a as u,Q as _,M as U}from"./@babylonjscore_Maths.4b8bfdd1.js";import{R as k}from"./@babylonjscore_Culling.bdb6ff26.js";import{E as y,a as H}from"./@babylonjscore_Engines.77a493e8.js";import{M as j}from"./@babylonjscore_Meshes.9ddea1c8.js";import{S as W}from"./@babylonjscore_scene.c0faa314.js";import{S as A}from"./@babylonjscore_sceneComponent.5f0854c6.js";import{F as Y,a as X,A as z,b as q}from"./@babylonjscore_Cameras.05e2a1ea.js";var g=function(){function i(e,t,n,o,r,a,s){o===void 0&&(o=0),r===void 0&&(r=1),a===void 0&&(a=2),s===void 0&&(s=3),this.id=e,this.index=t,this.browserGamepad=n,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=i.GAMEPAD,this._leftStickAxisX=o,this._leftStickAxisY=r,this._rightStickAxisX=a,this._rightStickAxisY=s,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(i.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!1,configurable:!0}),i.prototype.onleftstickchanged=function(e){this._onleftstickchanged=e},i.prototype.onrightstickchanged=function(e){this._onrightstickchanged=e},Object.defineProperty(i.prototype,"leftStick",{get:function(){return this._leftStick},set:function(e){this._onleftstickchanged&&(this._leftStick.x!==e.x||this._leftStick.y!==e.y)&&this._onleftstickchanged(e),this._leftStick=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightStick",{get:function(){return this._rightStick},set:function(e){this._onrightstickchanged&&(this._rightStick.x!==e.x||this._rightStick.y!==e.y)&&this._onrightstickchanged(e),this._rightStick=e},enumerable:!1,configurable:!0}),i.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},i.prototype.dispose=function(){},i.GAMEPAD=0,i.GENERIC=1,i.XBOX=2,i.POSE_ENABLED=3,i.DUALSHOCK=4,i}(),K=function(i){p(e,i);function e(t,n,o){var r=i.call(this,t,n,o)||this;return r.onButtonDownObservable=new h,r.onButtonUpObservable=new h,r.type=g.GENERIC,r._buttons=new Array(o.buttons.length),r}return e.prototype.onbuttondown=function(t){this._onbuttondown=t},e.prototype.onbuttonup=function(t){this._onbuttonup=t},e.prototype._setButtonValue=function(t,n,o){return t!==n&&(t===1&&(this._onbuttondown&&this._onbuttondown(o),this.onButtonDownObservable.notifyObservers(o)),t===0&&(this._onbuttonup&&this._onbuttonup(o),this.onButtonUpObservable.notifyObservers(o))),t},e.prototype.update=function(){i.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.browserGamepad.buttons[t].value,this._buttons[t],t)},e.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},e}(g),v;(function(i){i[i.VIVE=0]="VIVE",i[i.OCULUS=1]="OCULUS",i[i.WINDOWS=2]="WINDOWS",i[i.GEAR_VR=3]="GEAR_VR",i[i.DAYDREAM=4]="DAYDREAM",i[i.GENERIC=5]="GENERIC"})(v||(v={}));var C=function(){function i(){}return i.InitiateController=function(e){for(var t=0,n=this._ControllerFactories;t<n.length;t++){var o=n[t];if(o.canCreate(e))return o.create(e)}if(this._DefaultControllerFactory)return this._DefaultControllerFactory(e);throw"The type of gamepad you are trying to load needs to be imported first or is not supported."},i._ControllerFactories=[],i._DefaultControllerFactory=null,i}(),I=function(i){p(e,i);function e(t){var n=i.call(this,t.id,t.index,t)||this;return n.isXR=!1,n._deviceRoomPosition=u.Zero(),n._deviceRoomRotationQuaternion=new _,n.devicePosition=u.Zero(),n.deviceRotationQuaternion=new _,n.deviceScaleFactor=1,n._trackPosition=!0,n._maxRotationDistFromHeadset=Math.PI/5,n._draggedRoomRotation=0,n._leftHandSystemQuaternion=new _,n._deviceToWorld=U.Identity(),n._pointingPoseNode=null,n._workingMatrix=U.Identity(),n._meshAttachedObservable=new h,n.type=g.POSE_ENABLED,n.controllerType=v.GENERIC,n.position=u.Zero(),n.rotationQuaternion=new _,n._calculatedPosition=u.Zero(),n._calculatedRotation=new _,_.RotationYawPitchRollToRef(Math.PI,0,0,n._leftHandSystemQuaternion),n}return e.prototype._disableTrackPosition=function(t){this._trackPosition&&(this._calculatedPosition.copyFrom(t),this._trackPosition=!1)},e.prototype.update=function(){i.prototype.update.call(this),this._updatePoseAndMesh()},e.prototype._updatePoseAndMesh=function(){if(!this.isXR){var t=this.browserGamepad.pose;if(this.updateFromDevice(t),!this._trackPosition&&y.LastCreatedScene&&y.LastCreatedScene.activeCamera&&y.LastCreatedScene.activeCamera.devicePosition){var n=y.LastCreatedScene.activeCamera;if(n._computeDevicePosition(),this._deviceToWorld.setTranslation(n.devicePosition),n.deviceRotationQuaternion){n._deviceRoomRotationQuaternion.toEulerAnglesToRef(T.Vector3[0]);var o=Math.atan2(Math.sin(T.Vector3[0].y-this._draggedRoomRotation),Math.cos(T.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(o)>this._maxRotationDistFromHeadset){var r=o-(o<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=r;var a=Math.sin(-r),s=Math.cos(-r);this._calculatedPosition.x=this._calculatedPosition.x*s-this._calculatedPosition.z*a,this._calculatedPosition.z=this._calculatedPosition.x*a+this._calculatedPosition.z*s}}}u.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),_.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))}},e.prototype.updateFromDevice=function(t){if(!this.isXR&&t){this.rawPose=t,t.position&&(this._deviceRoomPosition.copyFromFloats(t.position[0],t.position[1],-t.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var n=this.rawPose;t.orientation&&n.orientation&&n.orientation.length===4&&(this._deviceRoomRotationQuaternion.copyFromFloats(n.orientation[0],n.orientation[1],-n.orientation[2],-n.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},e.prototype.attachToMesh=function(t){if(this._mesh&&(this._mesh.parent=null),this._mesh=t,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new _),!this.isXR&&(this._updatePoseAndMesh(),this._pointingPoseNode)){for(var n=[],o=this._pointingPoseNode;o.parent;)n.push(o.parent),o=o.parent;n.reverse().forEach(function(r){r.computeWorldMatrix(!0)})}this._meshAttachedObservable.notifyObservers(t)},e.prototype.attachToPoseControlledCamera=function(t){this._poseControlledCamera=t,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},e.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,i.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),e.prototype.getForwardRay=function(t){if(t===void 0&&(t=100),!this.mesh)return new k(u.Zero(),new u(0,0,1),t);var n=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),o=n.getTranslation(),r=new u(0,0,-1),a=u.TransformNormal(r,n),s=u.Normalize(a);return new k(o,s,t)},e.POINTING_POSE="POINTING_POSE",e}(g),c;(function(i){i[i.A=0]="A",i[i.B=1]="B",i[i.X=2]="X",i[i.Y=3]="Y",i[i.LB=4]="LB",i[i.RB=5]="RB",i[i.Back=8]="Back",i[i.Start=9]="Start",i[i.LeftStick=10]="LeftStick",i[i.RightStick=11]="RightStick"})(c||(c={}));var S;(function(i){i[i.Up=12]="Up",i[i.Down=13]="Down",i[i.Left=14]="Left",i[i.Right=15]="Right"})(S||(S={}));var Z=function(i){p(e,i);function e(t,n,o,r){r===void 0&&(r=!1);var a=i.call(this,t,n,o,0,1,2,3)||this;return a._leftTrigger=0,a._rightTrigger=0,a.onButtonDownObservable=new h,a.onButtonUpObservable=new h,a.onPadDownObservable=new h,a.onPadUpObservable=new h,a._buttonA=0,a._buttonB=0,a._buttonX=0,a._buttonY=0,a._buttonBack=0,a._buttonStart=0,a._buttonLB=0,a._buttonRB=0,a._buttonLeftStick=0,a._buttonRightStick=0,a._dPadUp=0,a._dPadDown=0,a._dPadLeft=0,a._dPadRight=0,a._isXboxOnePad=!1,a.type=g.XBOX,a._isXboxOnePad=r,a}return e.prototype.onlefttriggerchanged=function(t){this._onlefttriggerchanged=t},e.prototype.onrighttriggerchanged=function(t){this._onrighttriggerchanged=t},Object.defineProperty(e.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(t){this._onlefttriggerchanged&&this._leftTrigger!==t&&this._onlefttriggerchanged(t),this._leftTrigger=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(t){this._onrighttriggerchanged&&this._rightTrigger!==t&&this._onrighttriggerchanged(t),this._rightTrigger=t},enumerable:!1,configurable:!0}),e.prototype.onbuttondown=function(t){this._onbuttondown=t},e.prototype.onbuttonup=function(t){this._onbuttonup=t},e.prototype.ondpaddown=function(t){this._ondpaddown=t},e.prototype.ondpadup=function(t){this._ondpadup=t},e.prototype._setButtonValue=function(t,n,o){return t!==n&&(t===1&&(this._onbuttondown&&this._onbuttondown(o),this.onButtonDownObservable.notifyObservers(o)),t===0&&(this._onbuttonup&&this._onbuttonup(o),this.onButtonUpObservable.notifyObservers(o))),t},e.prototype._setDPadValue=function(t,n,o){return t!==n&&(t===1&&(this._ondpaddown&&this._ondpaddown(o),this.onPadDownObservable.notifyObservers(o)),t===0&&(this._ondpadup&&this._ondpadup(o),this.onPadUpObservable.notifyObservers(o))),t},Object.defineProperty(e.prototype,"buttonA",{get:function(){return this._buttonA},set:function(t){this._buttonA=this._setButtonValue(t,this._buttonA,c.A)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonB",{get:function(){return this._buttonB},set:function(t){this._buttonB=this._setButtonValue(t,this._buttonB,c.B)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonX",{get:function(){return this._buttonX},set:function(t){this._buttonX=this._setButtonValue(t,this._buttonX,c.X)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonY",{get:function(){return this._buttonY},set:function(t){this._buttonY=this._setButtonValue(t,this._buttonY,c.Y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(t){this._buttonStart=this._setButtonValue(t,this._buttonStart,c.Start)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(t){this._buttonBack=this._setButtonValue(t,this._buttonBack,c.Back)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(t){this._buttonLB=this._setButtonValue(t,this._buttonLB,c.LB)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(t){this._buttonRB=this._setButtonValue(t,this._buttonRB,c.RB)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(t){this._buttonLeftStick=this._setButtonValue(t,this._buttonLeftStick,c.LeftStick)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(t){this._buttonRightStick=this._setButtonValue(t,this._buttonRightStick,c.RightStick)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(t){this._dPadUp=this._setDPadValue(t,this._dPadUp,S.Up)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(t){this._dPadDown=this._setDPadValue(t,this._dPadDown,S.Down)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(t){this._dPadLeft=this._setDPadValue(t,this._dPadLeft,S.Left)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(t){this._dPadRight=this._setDPadValue(t,this._dPadRight,S.Right)},enumerable:!1,configurable:!0}),e.prototype.update=function(){i.prototype.update.call(this),this._isXboxOnePad?(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value):(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value)},e.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},e}(g),b;(function(i){i[i.Cross=0]="Cross",i[i.Circle=1]="Circle",i[i.Square=2]="Square",i[i.Triangle=3]="Triangle",i[i.L1=4]="L1",i[i.R1=5]="R1",i[i.Share=8]="Share",i[i.Options=9]="Options",i[i.LeftStick=10]="LeftStick",i[i.RightStick=11]="RightStick"})(b||(b={}));var M;(function(i){i[i.Up=12]="Up",i[i.Down=13]="Down",i[i.Left=14]="Left",i[i.Right=15]="Right"})(M||(M={}));var $=function(i){p(e,i);function e(t,n,o){var r=i.call(this,t.replace("STANDARD GAMEPAD","SONY PLAYSTATION DUALSHOCK"),n,o,0,1,2,3)||this;return r._leftTrigger=0,r._rightTrigger=0,r.onButtonDownObservable=new h,r.onButtonUpObservable=new h,r.onPadDownObservable=new h,r.onPadUpObservable=new h,r._buttonCross=0,r._buttonCircle=0,r._buttonSquare=0,r._buttonTriangle=0,r._buttonShare=0,r._buttonOptions=0,r._buttonL1=0,r._buttonR1=0,r._buttonLeftStick=0,r._buttonRightStick=0,r._dPadUp=0,r._dPadDown=0,r._dPadLeft=0,r._dPadRight=0,r.type=g.DUALSHOCK,r}return e.prototype.onlefttriggerchanged=function(t){this._onlefttriggerchanged=t},e.prototype.onrighttriggerchanged=function(t){this._onrighttriggerchanged=t},Object.defineProperty(e.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(t){this._onlefttriggerchanged&&this._leftTrigger!==t&&this._onlefttriggerchanged(t),this._leftTrigger=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(t){this._onrighttriggerchanged&&this._rightTrigger!==t&&this._onrighttriggerchanged(t),this._rightTrigger=t},enumerable:!1,configurable:!0}),e.prototype.onbuttondown=function(t){this._onbuttondown=t},e.prototype.onbuttonup=function(t){this._onbuttonup=t},e.prototype.ondpaddown=function(t){this._ondpaddown=t},e.prototype.ondpadup=function(t){this._ondpadup=t},e.prototype._setButtonValue=function(t,n,o){return t!==n&&(t===1&&(this._onbuttondown&&this._onbuttondown(o),this.onButtonDownObservable.notifyObservers(o)),t===0&&(this._onbuttonup&&this._onbuttonup(o),this.onButtonUpObservable.notifyObservers(o))),t},e.prototype._setDPadValue=function(t,n,o){return t!==n&&(t===1&&(this._ondpaddown&&this._ondpaddown(o),this.onPadDownObservable.notifyObservers(o)),t===0&&(this._ondpadup&&this._ondpadup(o),this.onPadUpObservable.notifyObservers(o))),t},Object.defineProperty(e.prototype,"buttonCross",{get:function(){return this._buttonCross},set:function(t){this._buttonCross=this._setButtonValue(t,this._buttonCross,b.Cross)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonCircle",{get:function(){return this._buttonCircle},set:function(t){this._buttonCircle=this._setButtonValue(t,this._buttonCircle,b.Circle)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonSquare",{get:function(){return this._buttonSquare},set:function(t){this._buttonSquare=this._setButtonValue(t,this._buttonSquare,b.Square)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonTriangle",{get:function(){return this._buttonTriangle},set:function(t){this._buttonTriangle=this._setButtonValue(t,this._buttonTriangle,b.Triangle)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonOptions",{get:function(){return this._buttonOptions},set:function(t){this._buttonOptions=this._setButtonValue(t,this._buttonOptions,b.Options)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonShare",{get:function(){return this._buttonShare},set:function(t){this._buttonShare=this._setButtonValue(t,this._buttonShare,b.Share)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonL1",{get:function(){return this._buttonL1},set:function(t){this._buttonL1=this._setButtonValue(t,this._buttonL1,b.L1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonR1",{get:function(){return this._buttonR1},set:function(t){this._buttonR1=this._setButtonValue(t,this._buttonR1,b.R1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(t){this._buttonLeftStick=this._setButtonValue(t,this._buttonLeftStick,b.LeftStick)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(t){this._buttonRightStick=this._setButtonValue(t,this._buttonRightStick,b.RightStick)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(t){this._dPadUp=this._setDPadValue(t,this._dPadUp,M.Up)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(t){this._dPadDown=this._setDPadValue(t,this._dPadDown,M.Down)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(t){this._dPadLeft=this._setDPadValue(t,this._dPadLeft,M.Left)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(t){this._dPadRight=this._setDPadValue(t,this._dPadRight,M.Right)},enumerable:!1,configurable:!0}),e.prototype.update=function(){i.prototype.update.call(this),this.buttonCross=this.browserGamepad.buttons[0].value,this.buttonCircle=this.browserGamepad.buttons[1].value,this.buttonSquare=this.browserGamepad.buttons[2].value,this.buttonTriangle=this.browserGamepad.buttons[3].value,this.buttonL1=this.browserGamepad.buttons[4].value,this.buttonR1=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonShare=this.browserGamepad.buttons[8].value,this.buttonOptions=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},e.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},e}(g),J=function(){function i(e){var t=this;if(this._scene=e,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new h,V()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator&&(navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads)):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new h(function(o){for(var r in t._babylonGamepads){var a=t._babylonGamepads[r];a&&a._isConnected&&t.onGamepadConnectedObservable.notifyObserver(o,a)}}),this._onGamepadConnectedEvent=function(o){var r=o.gamepad;if(!(r.index in t._babylonGamepads&&t._babylonGamepads[r.index].isConnected)){var a;t._babylonGamepads[r.index]?(a=t._babylonGamepads[r.index],a.browserGamepad=r,a._isConnected=!0):a=t._addNewGamepad(r),t.onGamepadConnectedObservable.notifyObservers(a),t._startMonitoringGamepads()}},this._onGamepadDisconnectedEvent=function(o){var r=o.gamepad;for(var a in t._babylonGamepads)if(t._babylonGamepads[a].index===r.index){var s=t._babylonGamepads[a];s._isConnected=!1,t.onGamepadDisconnectedObservable.notifyObservers(s),s.dispose&&s.dispose();break}},this._gamepadSupport)if(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported){var n=this._scene?this._scene.getEngine().getHostWindow():window;n&&(n.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),n.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1))}else this._startMonitoringGamepads()}return Object.defineProperty(i.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!1,configurable:!0}),i.prototype.getGamepadByType=function(e){e===void 0&&(e=g.XBOX);for(var t=0,n=this._babylonGamepads;t<n.length;t++){var o=n[t];if(o&&o.type===e)return o}return null},i.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(function(e){e.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},i.prototype._addNewGamepad=function(e){this._oneGamepadConnected||(this._oneGamepadConnected=!0);var t,n=e.id.search("054c")!==-1&&e.id.search("0ce6")===-1,o=e.id.search("Xbox One")!==-1;return o||e.id.search("Xbox 360")!==-1||e.id.search("xinput")!==-1||e.id.search("045e")!==-1&&e.id.search("Surface Dock")===-1?t=new Z(e.id,e.index,e,o):n?t=new $(e.id,e.index,e):e.pose?t=C.InitiateController(e):t=new K(e.id,e.index,e),this._babylonGamepads[t.index]=t,t},i.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},i.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},i.prototype._checkGamepadsStatus=function(){var e=this;this._updateGamepadObjects();for(var t in this._babylonGamepads){var n=this._babylonGamepads[t];if(!(!n||!n.isConnected))try{n.update()}catch{this._loggedErrors.indexOf(n.index)===-1&&(Q.Warn("Error updating gamepad ".concat(n.id)),this._loggedErrors.push(n.index))}}this._isMonitoring&&!this._scene&&H.QueueNewFrame(function(){e._checkGamepadsStatus()})},i.prototype._updateGamepadObjects=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++){var n=e[t];if(n)if(this._babylonGamepads[n.index])this._babylonGamepads[t].browserGamepad=n,this._babylonGamepads[t].isConnected||(this._babylonGamepads[t]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[t]));else{var o=this._addNewGamepad(n);this.onGamepadConnectedObservable.notifyObservers(o)}}},i}();Object.defineProperty(W.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new J(this);var i=this._getComponent(A.NAME_GAMEPAD);i||(i=new tt(this),this._addComponent(i))}return this._gamepadManager},enumerable:!0,configurable:!0});Y.prototype.addGamepad=function(){return this.add(new X),this};z.prototype.addGamepad=function(){return this.add(new q),this};var tt=function(){function i(e){this.name=A.NAME_GAMEPAD,this.scene=e}return i.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(A.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){var e=this.scene._gamepadManager;e&&(e.dispose(),this.scene._gamepadManager=null)},i.prototype._beforeCameraUpdate=function(){var e=this.scene._gamepadManager;e&&e._isMonitoring&&e._checkGamepadsStatus()},i}(),E=function(i){p(e,i);function e(t){var n=i.call(this,t)||this;return n.onTriggerStateChangedObservable=new h,n.onMainButtonStateChangedObservable=new h,n.onSecondaryButtonStateChangedObservable=new h,n.onPadStateChangedObservable=new h,n.onPadValuesChangedObservable=new h,n.pad={x:0,y:0},n._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},n._buttons=new Array(t.buttons.length),n.hand=t.hand,n}return e.prototype.onButtonStateChange=function(t){this._onButtonStateChange=t},Object.defineProperty(e.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!1,configurable:!0}),e.prototype.update=function(){i.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._setButtonValue(this.browserGamepad.buttons[t],this._buttons[t],t);(this.leftStick.x!==this.pad.x||this.leftStick.y!==this.pad.y)&&(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},e.prototype._setButtonValue=function(t,n,o){if(t||(t={pressed:!1,touched:!1,value:0}),!n){this._buttons[o]={pressed:t.pressed,touched:t.touched,value:t.value};return}this._checkChanges(t,n),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,o,t),this._handleButtonChange(o,t,this._changes)),this._buttons[o].pressed=t.pressed,this._buttons[o].touched=t.touched,this._buttons[o].value=t.value<1e-8?0:t.value},e.prototype._checkChanges=function(t,n){return this._changes.pressChanged=t.pressed!==n.pressed,this._changes.touchChanged=t.touched!==n.touched,this._changes.valueChanged=t.value!==n.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},e.prototype.dispose=function(){i.prototype.dispose.call(this),this._defaultModel=null,this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},e}(I),N=function(i){p(e,i);function e(t){var n=i.call(this,t)||this;return n.controllerType=v.DAYDREAM,n}return e.prototype.initControllerMesh=function(t,n){var o=this;O.ImportMesh("",e.MODEL_BASE_URL,e.MODEL_FILENAME,t,function(r){o._defaultModel=r[1],o.attachToMesh(o._defaultModel),n&&n(o._defaultModel)})},e.prototype._handleButtonChange=function(t,n){if(t===0){var o=this.onTriggerStateChangedObservable;o&&o.notifyObservers(n)}else l.Warn("Unrecognized Daydream button index: ".concat(t))},e.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",e.MODEL_FILENAME="generic.babylon",e.GAMEPAD_ID_PREFIX="Daydream",e}(E);C._ControllerFactories.push({canCreate:function(i){return i.id.indexOf(N.GAMEPAD_ID_PREFIX)===0},create:function(i){return new N(i)}});var x=function(i){p(e,i);function e(t){var n=i.call(this,t)||this;return n._buttonIndexToObservableNameMap=["onPadStateChangedObservable","onTriggerStateChangedObservable"],n.controllerType=v.GEAR_VR,n._calculatedPosition=new u(n.hand=="left"?-.15:.15,-.5,.25),n._disableTrackPosition(n._calculatedPosition),n}return e.prototype.initControllerMesh=function(t,n){var o=this;O.ImportMesh("",e.MODEL_BASE_URL,e.MODEL_FILENAME,t,function(r){var a=new j("",t);r[1].parent=a,r[1].position.z=-.15,o._defaultModel=a,o.attachToMesh(o._defaultModel),n&&n(o._defaultModel)})},e.prototype._handleButtonChange=function(t,n){if(t<this._buttonIndexToObservableNameMap.length){var o=this._buttonIndexToObservableNameMap[t],r=this[o];r&&r.notifyObservers(n)}},e.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",e.MODEL_FILENAME="generic.babylon",e.GAMEPAD_ID_PREFIX="Gear VR",e}(E);C._ControllerFactories.push({canCreate:function(i){return i.id.indexOf(x.GAMEPAD_ID_PREFIX)===0||i.id.indexOf("Oculus Go")!==-1||i.id.indexOf("Vive Focus")!==-1},create:function(i){return new x(i)}});var B=function(i){p(e,i);function e(t){return i.call(this,t)||this}return e.prototype.initControllerMesh=function(t,n){var o=this;O.ImportMesh("",e.MODEL_BASE_URL,e.MODEL_FILENAME,t,function(r){o._defaultModel=r[1],o.attachToMesh(o._defaultModel),n&&n(o._defaultModel)})},e.prototype._handleButtonChange=function(t,n){console.log("Button id: "+t+"state: "),console.dir(n)},e.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",e.MODEL_FILENAME="generic.babylon",e}(E);C._DefaultControllerFactory=function(i){return new B(i)};var F=function(i){p(e,i);function e(t){var n=i.call(this,t)||this;return n.onSecondaryTriggerStateChangedObservable=new h,n.onThumbRestChangedObservable=new h,n.controllerType=v.OCULUS,n}return e.prototype.initControllerMesh=function(t,n){var o=this,r;this.hand==="left"?r=e.MODEL_LEFT_FILENAME:r=e.MODEL_RIGHT_FILENAME,O.ImportMesh("",e._IsQuest?e.QUEST_MODEL_BASE_URL:e.MODEL_BASE_URL,r,t,function(a){o._defaultModel=e._IsQuest?a[0]:a[1],o.attachToMesh(o._defaultModel),n&&n(o._defaultModel)})},Object.defineProperty(e.prototype,"onAButtonStateChangedObservable",{get:function(){if(this.hand==="right")return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBButtonStateChangedObservable",{get:function(){if(this.hand==="right")return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onXButtonStateChangedObservable",{get:function(){if(this.hand==="left")return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onYButtonStateChangedObservable",{get:function(){if(this.hand==="left")return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!1,configurable:!0}),e.prototype._handleButtonChange=function(t,n){var o=n,r=this.hand==="right"?-1:1;switch(t){case 0:this.onPadStateChangedObservable.notifyObservers(o);return;case 1:!e._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=-o.value*.2,this._defaultModel.getChildren()[3].position.y=-o.value*.005,this._defaultModel.getChildren()[3].position.z=-o.value*.005),this.onTriggerStateChangedObservable.notifyObservers(o);return;case 2:!e._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=r*o.value*.0035),this.onSecondaryTriggerStateChangedObservable.notifyObservers(o);return;case 3:!e._IsQuest&&this._defaultModel&&(o.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=0),this.onMainButtonStateChangedObservable.notifyObservers(o);return;case 4:!e._IsQuest&&this._defaultModel&&(o.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),this.onSecondaryButtonStateChangedObservable.notifyObservers(o);return;case 5:this.onThumbRestChangedObservable.notifyObservers(o);return}},e.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",e.MODEL_LEFT_FILENAME="left.babylon",e.MODEL_RIGHT_FILENAME="right.babylon",e.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",e._IsQuest=!1,e}(E);C._ControllerFactories.push({canCreate:function(i){return y.LastCreatedEngine&&y.LastCreatedEngine._vrDisplay&&y.LastCreatedEngine._vrDisplay.displayName==="Oculus Quest"&&(F._IsQuest=!0),i.id.indexOf("Oculus Touch")!==-1},create:function(i){return new F(i)}});var et=function(i){p(e,i);function e(t){var n=i.call(this,t)||this;return n.controllerType=v.VIVE,n._invertLeftStickY=!0,n}return e.prototype.initControllerMesh=function(t,n){var o=this;O.ImportMesh("",e.MODEL_BASE_URL,e.MODEL_FILENAME,t,function(r){o._defaultModel=r[1],o.attachToMesh(o._defaultModel),n&&n(o._defaultModel)})},Object.defineProperty(e.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!1,configurable:!0}),e.prototype._handleButtonChange=function(t,n){var o=n;switch(t){case 0:this.onPadStateChangedObservable.notifyObservers(o);return;case 1:this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=-o.value*.15),this.onTriggerStateChangedObservable.notifyObservers(o);return;case 2:this.onMainButtonStateChangedObservable.notifyObservers(o);return;case 3:this._defaultModel&&(o.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),this.onSecondaryButtonStateChangedObservable.notifyObservers(o);return}},e.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",e.MODEL_FILENAME="wand.babylon",e}(E);C._ControllerFactories.push({canCreate:function(i){return i.id.toLowerCase().indexOf("openvr")!==-1},create:function(i){return new et(i)}});var nt=function(){function i(){this.buttonMeshes={},this.axisMeshes={}}return i}(),D=function(i){p(e,i);function e(t){var n=i.call(this,t)||this;return n._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:I.POINTING_POSE},n.onTrackpadChangedObservable=new h,n.onTrackpadValuesChangedObservable=new h,n.trackpad={x:0,y:0},n.controllerType=v.WINDOWS,n._loadedMeshInfo=null,n}return Object.defineProperty(e.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!1,configurable:!0}),e.prototype._updateTrackpad=function(){this.browserGamepad.axes&&(this.browserGamepad.axes[2]!=this.trackpad.x||this.browserGamepad.axes[3]!=this.trackpad.y)&&(this.trackpad.x=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_X")],this.trackpad.y=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_Y")],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))},e.prototype.update=function(){if(i.prototype.update.call(this),this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var t=0;t<this._mapping.axisMeshNames.length;t++)this._lerpAxisTransform(t,this.browserGamepad.axes[t])},e.prototype._handleButtonChange=function(t,n){var o=this._mapping.buttons[t];if(!!o){this._updateTrackpad();var r=this[this._mapping.buttonObservableNames[o]];r&&r.notifyObservers(n),this._lerpButtonTransform(o,n.value)}},e.prototype._lerpButtonTransform=function(t,n){if(!!this._loadedMeshInfo){var o=this._loadedMeshInfo.buttonMeshes[t];!o||!o.unpressed.rotationQuaternion||!o.pressed.rotationQuaternion||!o.value.rotationQuaternion||(_.SlerpToRef(o.unpressed.rotationQuaternion,o.pressed.rotationQuaternion,n,o.value.rotationQuaternion),u.LerpToRef(o.unpressed.position,o.pressed.position,n,o.value.position))}},e.prototype._lerpAxisTransform=function(t,n){if(!!this._loadedMeshInfo){var o=this._loadedMeshInfo.axisMeshes[t];if(!!o&&!(!o.min.rotationQuaternion||!o.max.rotationQuaternion||!o.value.rotationQuaternion)){var r=n*.5+.5;_.SlerpToRef(o.min.rotationQuaternion,o.max.rotationQuaternion,r,o.value.rotationQuaternion),u.LerpToRef(o.min.position,o.max.position,r,o.value.position)}}},e.prototype.initControllerMesh=function(t,n,o){var r=this;o===void 0&&(o=!1);var a,s;if(O.IsPluginForExtensionAvailable(".glb")){var d="default";if(this.id&&!o){var m=this.id.match(e.GAMEPAD_ID_PATTERN);d=m&&m[0]||d}this.hand==="left"?s=e.MODEL_LEFT_FILENAME:s=e.MODEL_RIGHT_FILENAME,a=e.MODEL_BASE_URL+d+"/"}else l.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),a=B.MODEL_BASE_URL,s=B.MODEL_FILENAME;O.ImportMesh("",a,s,t,function(f){r._loadedMeshInfo=r._processModel(t,f),r._loadedMeshInfo&&(r._defaultModel=r._loadedMeshInfo.rootNode,r.attachToMesh(r._defaultModel),n&&n(r._defaultModel))},null,function(f,G){l.Log(G),l.Warn("Failed to retrieve controller model from the remote server: "+a+s),o||r.initControllerMesh(f,n,!0)})},e.prototype._processModel=function(t,n){for(var o=null,r=new j(this.id+" "+this.hand,t),a=null,s=0;s<n.length;s++){var d=n[s];if(!d.parent){d.isPickable=!1,a=d;break}}return a?(a.setParent(r),o=this._createMeshInfo(r)):l.Warn("Could not find root node in model file."),o},e.prototype._createMeshInfo=function(t){var n=new nt,o;for(n.rootNode=t,n.buttonMeshes={},n.axisMeshes={},o=0;o<this._mapping.buttons.length;o++){var r=this._mapping.buttonMeshNames[this._mapping.buttons[o]];if(!r){l.Log("Skipping unknown button at index: "+o+" with mapped name: "+this._mapping.buttons[o]);continue}var a=G(t,r);if(!a){l.Warn("Missing button mesh with name: "+r);continue}var s={index:o,value:P(a,"VALUE"),pressed:P(a,"PRESSED"),unpressed:P(a,"UNPRESSED")};s.value&&s.pressed&&s.unpressed?n.buttonMeshes[this._mapping.buttons[o]]=s:l.Warn("Missing button submesh under mesh with name: "+r+"(VALUE: "+!!s.value+", PRESSED: "+!!s.pressed+", UNPRESSED:"+!!s.unpressed+")")}for(o=0;o<this._mapping.axisMeshNames.length;o++){var d=this._mapping.axisMeshNames[o];if(!d){l.Log("Skipping unknown axis at index: "+o);continue}var m=G(t,d);if(!m){l.Warn("Missing axis mesh with name: "+d);continue}var f={index:o,value:P(m,"VALUE"),min:P(m,"MIN"),max:P(m,"MAX")};f.value&&f.min&&f.max?n.axisMeshes[o]=f:l.Warn("Missing axis submesh under mesh with name: "+d+"(VALUE: "+!!f.value+", MIN: "+!!f.min+", MAX:"+!!f.max+")")}return n.pointingPoseNode=G(t,this._mapping.pointingPoseMeshName),n.pointingPoseNode?this._pointingPoseNode=n.pointingPoseNode:l.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),n;function G(w,R){return w.getChildren(function(L){return L.name===R},!1)[0]}function P(w,R){return w.getChildren(function(L){return L.name==R},!0)[0]}},e.prototype.getForwardRay=function(t){if(t===void 0&&(t=100),!(this._loadedMeshInfo&&this._loadedMeshInfo.pointingPoseNode))return i.prototype.getForwardRay.call(this,t);var n=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),o=n.getTranslation(),r=new u(0,0,-1),a=u.TransformNormal(r,n),s=u.Normalize(a);return new k(o,s,t)},e.prototype.dispose=function(){i.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear(),this.onTrackpadValuesChangedObservable.clear()},e.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",e.MODEL_LEFT_FILENAME="left.glb",e.MODEL_RIGHT_FILENAME="right.glb",e.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",e.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,e}(E);(function(i){p(e,i);function e(t){var n=i.call(this,t)||this;return n._mapping={buttons:["trigger","grip","trackpad","thumbstick","menu"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onThumbstickStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y","THUMBSTICK_X","THUMBSTICK_Y"],pointingPoseMeshName:I.POINTING_POSE},n.thumbstickValues={x:0,y:0},n.onThumbstickStateChangedObservable=new h,n.onThumbstickValuesChangedObservable=new h,n.onTrackpadChangedObservable=n.onPadStateChangedObservable,n.onTrackpadValuesChangedObservable=n.onPadValuesChangedObservable,n}return Object.defineProperty(e.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onThumbstickStateChangedObservable},enumerable:!1,configurable:!0}),e.prototype._updateTrackpad=function(){this.browserGamepad.axes&&(this.browserGamepad.axes[2]!=this.thumbstickValues.x||this.browserGamepad.axes[3]!=this.thumbstickValues.y)&&(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onThumbstickValuesChangedObservable.notifyObservers(this.trackpad))},e.prototype.dispose=function(){i.prototype.dispose.call(this),this.onThumbstickStateChangedObservable.clear(),this.onThumbstickValuesChangedObservable.clear()},e})(D);C._ControllerFactories.push({canCreate:function(i){return i.id.indexOf(D.GAMEPAD_ID_PREFIX)===0},create:function(i){return new D(i)}});export{g as G,v as P,E as W,c as X,I as a};
