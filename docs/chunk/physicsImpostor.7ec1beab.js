import{V as y,L as u,Q as c,A as g}from"./test1.990751a6.js";import{A as d}from"./abstractMesh.8bf71ac2.js";import{M as _}from"./mesh.7b1ddb4e.js";import{P}from"./physicsJoint.16ce030f.js";import{S as l}from"./math.axis.aa7ca8fa.js";_._PhysicsImpostorParser=function(i,t,s){return new m(t,s.physicsImpostor,{mass:s.physicsMass,friction:s.physicsFriction,restitution:s.physicsRestitution},i)};var m=function(){function i(t,s,n,r){n===void 0&&(n={mass:0});var e=this;if(this.object=t,this.type=s,this._options=n,this._scene=r,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=y.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new c,this._tmpQuat2=new c,this.beforeStep=function(){!e._physicsEngine||(e.object.translate(e._deltaPosition,-1),e._deltaRotationConjugated&&e.object.rotationQuaternion&&e.object.rotationQuaternion.multiplyToRef(e._deltaRotationConjugated,e.object.rotationQuaternion),e.object.computeWorldMatrix(!1),e.object.parent&&e.object.rotationQuaternion?(e.getParentsRotation(),e._tmpQuat.multiplyToRef(e.object.rotationQuaternion,e._tmpQuat)):e._tmpQuat.copyFrom(e.object.rotationQuaternion||new c),e._options.disableBidirectionalTransformation||e.object.rotationQuaternion&&e._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(e,e.object.getAbsolutePosition(),e._tmpQuat),e._onBeforePhysicsStepCallbacks.forEach(function(o){o(e)}))},this.afterStep=function(){!e._physicsEngine||(e._onAfterPhysicsStepCallbacks.forEach(function(o){o(e)}),e._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(e),e.object.parent&&e.object.rotationQuaternion&&(e.getParentsRotation(),e._tmpQuat.conjugateInPlace(),e._tmpQuat.multiplyToRef(e.object.rotationQuaternion,e.object.rotationQuaternion)),e.object.setAbsolutePosition(e.object.position),e._deltaRotation&&e.object.rotationQuaternion&&e.object.rotationQuaternion.multiplyToRef(e._deltaRotation,e.object.rotationQuaternion),e.object.translate(e._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(o){if(!(!e._onPhysicsCollideCallbacks.length&&!e.onCollideEvent)&&!!e._physicsEngine){var h=e._physicsEngine.getImpostorWithPhysicsBody(o.body);h&&(e.onCollideEvent&&e.onCollideEvent(e,h),e._onPhysicsCollideCallbacks.filter(function(a){return a.otherImpostors.indexOf(h)!==-1}).forEach(function(a){a.callback(e,h,o.point)}))}},!this.object){u.Error("No object was provided. A physics object is obligatory");return}this.object.parent&&n.mass!==0&&u.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&t.getScene&&(this._scene=t.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=c.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new c),this._options.mass=n.mass===void 0?0:n.mass,this._options.friction=n.friction===void 0?.2:n.friction,this._options.restitution=n.restitution===void 0?.2:n.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=n.pressure===void 0?200:n.pressure,this._options.stiffness=n.stiffness===void 0?1:n.stiffness,this._options.velocityIterations=n.velocityIterations===void 0?20:n.velocityIterations,this._options.positionIterations=n.positionIterations===void 0?20:n.positionIterations,this._options.fixedPoints=n.fixedPoints===void 0?0:n.fixedPoints,this._options.margin=n.margin===void 0?0:n.margin,this._options.damping=n.damping===void 0?0:n.damping,this._options.path=n.path===void 0?null:n.path,this._options.shape=n.shape===void 0?null:n.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&u.Warn("You must affect impostors to children before affecting impostor to parent.")):u.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))}return Object.defineProperty(i.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(t){this.setMass(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(t){!this._physicsEngine||this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(t){!this._physicsEngine||this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var t=this._physicsEngine.getPhysicsPlugin();return t.setBodyPressure?t.getBodyPressure(this):0},set:function(t){if(!!this._physicsEngine){var s=this._physicsEngine.getPhysicsPlugin();!s.setBodyPressure||s.setBodyPressure(this,t)}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var t=this._physicsEngine.getPhysicsPlugin();return t.getBodyStiffness?t.getBodyStiffness(this):0},set:function(t){if(!!this._physicsEngine){var s=this._physicsEngine.getPhysicsPlugin();!s.setBodyStiffness||s.setBodyStiffness(this,t)}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var t=this._physicsEngine.getPhysicsPlugin();return t.getBodyVelocityIterations?t.getBodyVelocityIterations(this):0},set:function(t){if(!!this._physicsEngine){var s=this._physicsEngine.getPhysicsPlugin();!s.setBodyVelocityIterations||s.setBodyVelocityIterations(this,t)}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var t=this._physicsEngine.getPhysicsPlugin();return t.getBodyPositionIterations?t.getBodyPositionIterations(this):0},set:function(t){if(!!this._physicsEngine){var s=this._physicsEngine.getPhysicsPlugin();!s.setBodyPositionIterations||s.setBodyPositionIterations(this,t)}},enumerable:!1,configurable:!0}),i.prototype._init=function(){!this._physicsEngine||(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),!this._isDisposed&&(!this.parent||this._options.ignoreParent)&&this._physicsEngine.addImpostor(this))},i.prototype._getPhysicsParent=function(){if(this.object.parent instanceof d){var t=this.object.parent;return t.physicsImpostor}return null},i.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&(!this._parent||!!this._options.ignoreParent)},i.prototype.setScalingUpdated=function(){this.forceUpdate()},i.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(i.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(t){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=t,this.resetUpdateFlags()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(t){this._parent=t},enumerable:!1,configurable:!0}),i.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},i.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var t=this.object.rotationQuaternion,s=this.object.scaling.clone();this.object.rotationQuaternion=i.IDENTITY_QUATERNION;var n=this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);n&&n.decompose(s,void 0,void 0);var r=this.object.getBoundingInfo(),e=r.boundingBox.extendSize.scale(2).multiplyInPlace(s);return e.x=Math.abs(e.x),e.y=Math.abs(e.y),e.z=Math.abs(e.z),this.object.rotationQuaternion=t,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),e}else return i.DEFAULT_OBJECT_SIZE},i.prototype.getObjectCenter=function(){if(this.object.getBoundingInfo){var t=this.object.getBoundingInfo();return t.boundingBox.centerWorld}else return this.object.position},i.prototype.getParam=function(t){return this._options[t]},i.prototype.setParam=function(t,s){this._options[t]=s,this._bodyUpdateRequired=!0},i.prototype.setMass=function(t){this.getParam("mass")!==t&&this.setParam("mass",t),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,t)},i.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):y.Zero()},i.prototype.setLinearVelocity=function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,t)},i.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):y.Zero()},i.prototype.setAngularVelocity=function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,t)},i.prototype.executeNativeFunction=function(t){this._physicsEngine&&t(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},i.prototype.registerBeforePhysicsStep=function(t){this._onBeforePhysicsStepCallbacks.push(t)},i.prototype.unregisterBeforePhysicsStep=function(t){var s=this._onBeforePhysicsStepCallbacks.indexOf(t);s>-1?this._onBeforePhysicsStepCallbacks.splice(s,1):u.Warn("Function to remove was not found")},i.prototype.registerAfterPhysicsStep=function(t){this._onAfterPhysicsStepCallbacks.push(t)},i.prototype.unregisterAfterPhysicsStep=function(t){var s=this._onAfterPhysicsStepCallbacks.indexOf(t);s>-1?this._onAfterPhysicsStepCallbacks.splice(s,1):u.Warn("Function to remove was not found")},i.prototype.registerOnPhysicsCollide=function(t,s){var n=t instanceof Array?t:[t];this._onPhysicsCollideCallbacks.push({callback:s,otherImpostors:n})},i.prototype.unregisterOnPhysicsCollide=function(t,s){var n=t instanceof Array?t:[t],r=-1,e=this._onPhysicsCollideCallbacks.some(function(o,h){if(o.callback===s&&o.otherImpostors.length===n.length){var a=o.otherImpostors.every(function(p){return n.indexOf(p)>-1});return a&&(r=h),a}return!1});e?this._onPhysicsCollideCallbacks.splice(r,1):u.Warn("Function to remove was not found")},i.prototype.getParentsRotation=function(){var t=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);t;)t.rotationQuaternion?this._tmpQuat2.copyFrom(t.rotationQuaternion):c.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,t.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),t=t.parent;return this._tmpQuat},i.prototype.applyForce=function(t,s){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,t,s),this},i.prototype.applyImpulse=function(t,s){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,t,s),this},i.prototype.createJoint=function(t,s,n){var r=new P(s,n);return this.addJoint(t,r),this},i.prototype.addJoint=function(t,s){return this._joints.push({otherImpostor:t,joint:s}),this._physicsEngine&&this._physicsEngine.addJoint(this,t,s),this},i.prototype.addAnchor=function(t,s,n,r,e){if(!this._physicsEngine)return this;var o=this._physicsEngine.getPhysicsPlugin();return o.appendAnchor?(this._physicsEngine&&o.appendAnchor(this,t,s,n,r,e),this):this},i.prototype.addHook=function(t,s,n,r){if(!this._physicsEngine)return this;var e=this._physicsEngine.getPhysicsPlugin();return e.appendAnchor?(this._physicsEngine&&e.appendHook(this,t,s,n,r),this):this},i.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},i.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},i.prototype.clone=function(t){return t?new i(t,this.type,this._options,this._scene):null},i.prototype.dispose=function(){var t=this;!this._physicsEngine||(this._joints.forEach(function(s){t._physicsEngine&&t._physicsEngine.removeJoint(t,s.otherImpostor,s.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},i.prototype.setDeltaPosition=function(t){this._deltaPosition.copyFrom(t)},i.prototype.setDeltaRotation=function(t){this._deltaRotation||(this._deltaRotation=new c),this._deltaRotation.copyFrom(t),this._deltaRotationConjugated=this._deltaRotation.conjugate()},i.prototype.getBoxSizeToRef=function(t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,t),this},i.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},i.prototype.syncBoneWithImpostor=function(t,s,n,r,e){var o=i._TmpVecs[0],h=this.object;if(h.rotationQuaternion)if(e){var a=i._TmpQuat;h.rotationQuaternion.multiplyToRef(e,a),t.setRotationQuaternion(a,l.WORLD,s)}else t.setRotationQuaternion(h.rotationQuaternion,l.WORLD,s);o.x=0,o.y=0,o.z=0,n&&(o.x=n.x,o.y=n.y,o.z=n.z,t.getDirectionToRef(o,s,o),r==null&&(r=n.length()),o.x*=r,o.y*=r,o.z*=r),t.getParent()?(o.addInPlace(h.getAbsolutePosition()),t.setAbsolutePosition(o,s)):(s.setAbsolutePosition(h.getAbsolutePosition()),s.position.x-=o.x,s.position.y-=o.y,s.position.z-=o.z)},i.prototype.syncImpostorWithBone=function(t,s,n,r,e,o){var h=this.object;if(h.rotationQuaternion)if(e){var a=i._TmpQuat;t.getRotationQuaternionToRef(l.WORLD,s,a),a.multiplyToRef(e,h.rotationQuaternion)}else t.getRotationQuaternionToRef(l.WORLD,s,h.rotationQuaternion);var p=i._TmpVecs[0],f=i._TmpVecs[1];o||(o=i._TmpVecs[2],o.x=0,o.y=1,o.z=0),t.getDirectionToRef(o,s,f),t.getAbsolutePositionToRef(s,p),r==null&&n&&(r=n.length()),r!=null&&(p.x+=f.x*r,p.y+=f.y*r,p.z+=f.z*r),h.setAbsolutePosition(p)},i.DEFAULT_OBJECT_SIZE=new y(1,1,1),i.IDENTITY_QUATERNION=c.Identity(),i._TmpVecs=g.BuildArray(3,y.Zero),i._TmpQuat=c.Identity(),i.NoImpostor=0,i.SphereImpostor=1,i.BoxImpostor=2,i.PlaneImpostor=3,i.MeshImpostor=4,i.CapsuleImpostor=6,i.CylinderImpostor=7,i.ParticleImpostor=8,i.HeightmapImpostor=9,i.ConvexHullImpostor=10,i.CustomImpostor=100,i.RopeImpostor=101,i.ClothImpostor=102,i.SoftbodyImpostor=103,i}();export{m as P};
