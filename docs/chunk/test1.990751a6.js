import{_ as te}from"../entry/index.a3769e15.js";const Er=-9.81,De=.25*Math.PI,Be=20,Ie=20,Rr=5;var Ar="./assets/png/sideBlue1.17798b99.png",Pr="./assets/png/sideBlue2.50a28214.png",Cr="./assets/png/sideBlue3.95dcf770.png",Sr="./assets/png/sideBlue4.5d3718f0.png",Mr="./assets/png/sideBlue5.82996cfe.png",Or="./assets/png/sideBlue6.69ee6118.png",Fr="./assets/png/sideOrange1.70a2764f.png",wr="./assets/png/sideOrange2.2e63a6e4.png",xr="./assets/png/sideOrange3.b7de6a98.png",Dr="./assets/png/sideOrange4.3ca086e8.png",Br="./assets/png/sideOrange5.1a718c6f.png",Ir="./assets/png/sideOrange6.4d19e8c1.png",dt=function(r,e){return dt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},dt(r,e)};function Q(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");dt(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var st=function(){return st=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},st.apply(this,arguments)};function N(r,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s}function Qt(r,e,t,i){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(f){try{h(i.next(f))}catch(l){o(l)}}function u(f){try{h(i.throw(f))}catch(l){o(l)}}function h(f){f.done?s(f.value):n(f.value).then(a,u)}h((i=i.apply(r,e||[])).next())})}function Jt(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(h){return function(f){return u([h,f])}}function u(h){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(s=h[0]&2?n.return:h[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,h[1])).done)return s;switch(n=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,n=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){t.label=h[1];break}if(h[0]===6&&t.label<s[1]){t.label=s[1],s=h;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(h);break}s[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(r,t)}catch(f){h=[6,f],n=0}finally{i=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}var Lr=function(){function r(e,t,i,n){t===void 0&&(t=!1),this.initialize(e,t,i,n)}return r.prototype.initialize=function(e,t,i,n){return t===void 0&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=n,this},r}(),Ur=function(){function r(e,t,i){i===void 0&&(i=null),this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1}return r}(),E=function(){function r(e){this._observers=new Array,this._eventState=new Lr(0),e&&(this._onObserverAdded=e)}return r.FromPromise=function(e,t){var i=new r;return e.then(function(n){i.notifyObservers(n)}).catch(function(n){if(t)t.notifyObservers(n);else throw n}),i},Object.defineProperty(r.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),r.prototype.add=function(e,t,i,n,s){if(t===void 0&&(t=-1),i===void 0&&(i=!1),n===void 0&&(n=null),s===void 0&&(s=!1),!e)return null;var o=new Ur(e,t,n);return o.unregisterOnNextCall=s,i?this._observers.unshift(o):this._observers.push(o),this._onObserverAdded&&this._onObserverAdded(o),o},r.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},r.prototype.remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return t!==-1?(this._deferUnregister(e),!0):!1},r.prototype.removeCallback=function(e,t){for(var i=0;i<this._observers.length;i++){var n=this._observers[i];if(!n._willBeUnregistered&&n.callback===e&&(!t||t===n.scope))return this._deferUnregister(n),!0}return!1},r.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(function(){t._remove(e)},0)},r.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return t!==-1?(this._observers.splice(t,1),!0):!1},r.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},r.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},r.prototype.notifyObservers=function(e,t,i,n,s){if(t===void 0&&(t=-1),!this._observers.length)return!0;var o=this._eventState;o.mask=t,o.target=i,o.currentTarget=n,o.skipNextObservers=!1,o.lastReturnValue=e,o.userInfo=s;for(var a=0,u=this._observers;a<u.length;a++){var h=u[a];if(!h._willBeUnregistered&&(h.mask&t&&(h.scope?o.lastReturnValue=h.callback.apply(h.scope,[e,o]):o.lastReturnValue=h.callback(e,o),h.unregisterOnNextCall&&this._deferUnregister(h)),o.skipNextObservers))return!1}return!0},r.prototype.notifyObserversWithPromise=function(e,t,i,n,s){var o=this;t===void 0&&(t=-1);var a=Promise.resolve(e);if(!this._observers.length)return a;var u=this._eventState;return u.mask=t,u.target=i,u.currentTarget=n,u.skipNextObservers=!1,u.userInfo=s,this._observers.forEach(function(h){u.skipNextObservers||h._willBeUnregistered||h.mask&t&&(h.scope?a=a.then(function(f){return u.lastReturnValue=f,h.callback.apply(h.scope,[e,u])}):a=a.then(function(f){return u.lastReturnValue=f,h.callback(e,u)}),h.unregisterOnNextCall&&o._deferUnregister(h))}),a.then(function(){return e})},r.prototype.notifyObserver=function(e,t,i){if(i===void 0&&(i=-1),!e._willBeUnregistered){var n=this._eventState;n.mask=i,n.skipNextObservers=!1,e.callback(t,n),e.unregisterOnNextCall&&this._deferUnregister(e)}},r.prototype.hasObservers=function(){return this._observers.length>0},r.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},r.prototype.clone=function(){var e=new r;return e._observers=this._observers.slice(0),e},r.prototype.hasSpecificMask=function(e){e===void 0&&(e=-1);for(var t=0,i=this._observers;t<i.length;t++){var n=i[t];if(n.mask&e||n.mask===e)return!0}return!1},r}();function X(){return typeof window!="undefined"}function $t(){return typeof navigator!="undefined"}function ot(){return typeof document!="undefined"}function mt(r){for(var e="",t=r.firstChild;t;)t.nodeType===3&&(e+=t.textContent),t=t.nextSibling;return e}var pt={IsWindowObjectExist:X,IsNavigatorAvailable:$t,IsDocumentAvailable:ot,GetDOMTextContent:mt},D=function(){function r(){}return r._CheckLimit=function(e,t){var i=r._LogLimitOutputs[e];return i?i.current++:(i={limit:t,current:1},r._LogLimitOutputs[e]=i),i.current<=i.limit},r._GenerateLimitMessage=function(e,t){var i=r._LogLimitOutputs[e];if(!(!i||!r.MessageLimitReached)&&i.current===i.limit)switch(t){case 0:r.Log(r.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,"log"));break;case 1:r.Warn(r.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,"warning"));break;case 2:r.Error(r.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,"error"));break}},r._AddLogEntry=function(e){r._LogCache=e+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(e)},r._FormatMessage=function(e){var t=function(n){return n<10?"0"+n:""+n},i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e},r._LogDisabled=function(e,t){},r._LogEnabled=function(e,t){if(!(t!==void 0&&!r._CheckLimit(e,t))){var i=r._FormatMessage(e);console.log("BJS - "+i);var n="<div style='color:white'>"+i+"</div><br>";r._AddLogEntry(n),r._GenerateLimitMessage(e,0)}},r._WarnDisabled=function(e,t){},r._WarnEnabled=function(e,t){if(!(t!==void 0&&!r._CheckLimit(e,t))){var i=r._FormatMessage(e);console.warn("BJS - "+i);var n="<div style='color:orange'>"+e+"</div><br>";r._AddLogEntry(n),r._GenerateLimitMessage(e,1)}},r._ErrorDisabled=function(e,t){},r._ErrorEnabled=function(e,t){if(!(t!==void 0&&!r._CheckLimit(e,t))){var i=r._FormatMessage(e);r.errorsCount++,console.error("BJS - "+i);var n="<div style='color:red'>"+i+"</div><br>";r._AddLogEntry(n),r._GenerateLimitMessage(e,2)}},Object.defineProperty(r,"LogCache",{get:function(){return r._LogCache},enumerable:!1,configurable:!0}),r.ClearLogCache=function(){r._LogCache="",r._LogLimitOutputs={},r.errorsCount=0},Object.defineProperty(r,"LogLevels",{set:function(e){(e&r.MessageLogLevel)===r.MessageLogLevel?r.Log=r._LogEnabled:r.Log=r._LogDisabled,(e&r.WarningLogLevel)===r.WarningLogLevel?r.Warn=r._WarnEnabled:r.Warn=r._WarnDisabled,(e&r.ErrorLogLevel)===r.ErrorLogLevel?r.Error=r._ErrorEnabled:r.Error=r._ErrorDisabled},enumerable:!1,configurable:!0}),r.NoneLogLevel=0,r.MessageLogLevel=1,r.WarningLogLevel=2,r.ErrorLogLevel=4,r.AllLogLevel=7,r.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",r._LogCache="",r._LogLimitOutputs={},r.errorsCount=0,r.Log=r._LogEnabled,r.Warn=r._WarnEnabled,r.Error=r._ErrorEnabled,r}(),Ot=function(r,e){return!r||r.getClassName&&r.getClassName()==="Mesh"?null:r.getClassName&&r.getClassName()==="SubMesh"?r.clone(e):r.clone?r.clone():null};function Nr(r){var e=[];do Object.getOwnPropertyNames(r).forEach(function(t){e.indexOf(t)===-1&&e.push(t)});while(r=Object.getPrototypeOf(r));return e}var kr=function(){function r(){}return r.DeepCopy=function(e,t,i,n){for(var s=Nr(e),o=0,a=s;o<a.length;o++){var u=a[o];if(!(u[0]==="_"&&(!n||n.indexOf(u)===-1))&&!u.endsWith("Observable")&&!(i&&i.indexOf(u)!==-1)){var h=e[u],f=typeof h;if(f!=="function")try{if(f==="object")if(h instanceof Array){if(t[u]=[],h.length>0)if(typeof h[0]=="object")for(var l=0;l<h.length;l++){var c=Ot(h[l],t);t[u].indexOf(c)===-1&&t[u].push(c)}else t[u]=h.slice(0)}else t[u]=Ot(h,t);else t[u]=h}catch(_){D.Warn(_.message)}}}},r}(),we=function(){function r(){}return Object.defineProperty(r,"Now",{get:function(){return pt.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),r}();function V(r){return"".concat(r," needs to be imported before as it contains a side-effect required by your code.")}function Gr(){return typeof _native!="undefined"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}var at=function(){function r(){this._xhr=Gr(),this._requestURL=""}return r.prototype._injectCustomRequestHeaders=function(){if(!this._shouldSkipRequestModifications(this._requestURL))for(var e in r.CustomRequestHeaders){var t=r.CustomRequestHeaders[e];t&&this._xhr.setRequestHeader(e,t)}},r.prototype._shouldSkipRequestModifications=function(e){return r.SkipRequestModificationForBabylonCDN&&(e.includes("preview.babylonjs.com")||e.includes("cdn.babylonjs.com"))},Object.defineProperty(r.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(e){this._xhr.onprogress=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(e){this._xhr.responseType=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"timeout",{get:function(){return this._xhr.timeout},set:function(e){this._xhr.timeout=e},enumerable:!1,configurable:!0}),r.prototype.addEventListener=function(e,t,i){this._xhr.addEventListener(e,t,i)},r.prototype.removeEventListener=function(e,t,i){this._xhr.removeEventListener(e,t,i)},r.prototype.abort=function(){this._xhr.abort()},r.prototype.send=function(e){r.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(e)},r.prototype.open=function(e,t){for(var i=0,n=r.CustomRequestModifiers;i<n.length;i++){var s=n[i];if(this._shouldSkipRequestModifications(t))return;s(this._xhr,t)}return t=t.replace("file:http:","http:"),t=t.replace("file:https:","https:"),this._requestURL=t,this._xhr.open(e,t,!0)},r.prototype.setRequestHeader=function(e,t){this._xhr.setRequestHeader(e,t)},r.prototype.getResponseHeader=function(e){return this._xhr.getResponseHeader(e)},r.CustomRequestHeaders={},r.CustomRequestModifiers=new Array,r.SkipRequestModificationForBabylonCDN=!0,r}(),Z=function(){function r(){}return Object.defineProperty(r,"LastCreatedEngine",{get:function(){return this.Instances.length===0?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(r,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),r.Instances=new Array,r._LastCreatedScene=null,r.UseFallbackTexture=!0,r.FallbackTexture="",r}(),et=function(){function r(){}return r.FilesToLoad={},r}(),zr=function(){function r(){}return r.ExponentialBackoff=function(e,t){return e===void 0&&(e=3),t===void 0&&(t=500),function(i,n,s){return n.status!==0||s>=e||i.indexOf("file:")!==-1?-1:Math.pow(2,s)*t}},r}(),Xe=function(r){Q(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e._setPrototypeOf=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t},e}(Error),bt={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002},Tt=function(r){Q(e,r);function e(t,i,n){var s=r.call(this,t)||this;return s.errorCode=i,s.innerError=n,s.name="RuntimeError",Xe._setPrototypeOf(s,e.prototype),s}return e}(Xe),Vr=function(r){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t="",i,n,s,o,a,u,h,f=0,l=ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);f<l.length;)i=l[f++],n=f<l.length?l[f++]:Number.NaN,s=f<l.length?l[f++]:Number.NaN,o=i>>2,a=(i&3)<<4|n>>4,u=(n&15)<<2|s>>6,h=s&63,isNaN(n)?u=h=64:isNaN(s)&&(h=64),t+=e.charAt(o)+e.charAt(a)+e.charAt(u)+e.charAt(h);return t},er=function(r){return atob(r)},Wr=function(r){for(var e=er(r),t=e.length,i=new Uint8Array(new ArrayBuffer(t)),n=0;n<t;n++)i[n]=e.charCodeAt(n);return i.buffer},je=function(){function r(){this.children=[]}return r.prototype.isValid=function(e){return!0},r.prototype.process=function(e,t){var i="";if(this.line){var n=this.line,s=t.processor;if(s){if(s.lineProcessor&&(n=s.lineProcessor(n,t.isFragment,t.processingContext)),s.attributeProcessor&&this.line.startsWith("attribute"))n=s.attributeProcessor(this.line,e,t.processingContext);else if(s.varyingProcessor&&this.line.startsWith("varying"))n=s.varyingProcessor(this.line,t.isFragment,e,t.processingContext);else if(s.uniformProcessor&&s.uniformRegexp&&s.uniformRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(n=s.uniformProcessor(this.line,t.isFragment,e,t.processingContext));else if(s.uniformBufferProcessor&&s.uniformBufferRegexp&&s.uniformBufferRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(n=s.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0);else if(s.textureProcessor&&s.textureRegexp&&s.textureRegexp.test(this.line))n=s.textureProcessor(this.line,t.isFragment,e,t.processingContext);else if((s.uniformProcessor||s.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer){var o=/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/;o.test(this.line)?s.uniformProcessor&&(n=s.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):s.uniformBufferProcessor&&(n=s.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)}t.lookForClosingBracketForUniformBuffer&&this.line.indexOf("}")!==-1&&(t.lookForClosingBracketForUniformBuffer=!1,s.endOfUniformBufferProcessor&&(n=s.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}i+=n+`\r
`}return this.children.forEach(function(a){i+=a.process(e,t)}),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),i},r}(),Hr=function(){function r(){}return Object.defineProperty(r.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,i=e;t<i.length;t++){var n=i[t];if(n[0]==="#"){this._lines.push(n);continue}if(n.trim().startsWith("//")){this._lines.push(n);continue}for(var s=n.split(";"),o=0;o<s.length;o++){var a=s[o];a=a.trim(),a&&this._lines.push(a+(o!==s.length-1?";":""))}}},enumerable:!1,configurable:!0}),r}(),lt=function(r){Q(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.process=function(t,i){for(var n=0;n<this.children.length;n++){var s=this.children[n];if(s.isValid(t))return s.process(t,i)}return""},e}(je),Kr=function(r){Q(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.isValid=function(t){return this.testExpression.isTrue(t)},e}(je),Ze=function(){function r(){}return r.prototype.isTrue=function(e){return!0},r.postfixToInfix=function(e){for(var t=[],i=0,n=e;i<n.length;i++){var s=n[i];if(r._OperatorPriority[s]===void 0)t.push(s);else{var o=t[t.length-1],a=t[t.length-2];t.length-=2,t.push("(".concat(a).concat(s).concat(o,")"))}}return t[t.length-1]},r.infixToPostfix=function(e){for(var t=[],i=-1,n=function(){h=h.trim(),h!==""&&(t.push(h),h="")},s=function(c){i<r._Stack.length-1&&(r._Stack[++i]=c)},o=function(){return r._Stack[i]},a=function(){return i===-1?"!!INVALID EXPRESSION!!":r._Stack[i--]},u=0,h="";u<e.length;){var f=e.charAt(u),l=u<e.length-1?e.substr(u,2):"";if(f==="(")h="",s(f);else if(f===")"){for(n();i!==-1&&o()!=="(";)t.push(a());a()}else if(r._OperatorPriority[l]>1){for(n();i!==-1&&r._OperatorPriority[o()]>=r._OperatorPriority[l];)t.push(a());s(l),u++}else h+=f;u++}for(n();i!==-1;)o()==="("?a():t.push(a());return t},r._OperatorPriority={")":0,"(":1,"||":2,"&&":3},r._Stack=["","","","","","","","","","","","","","","","","","","",""],r}(),Je=function(r){Q(e,r);function e(t,i){i===void 0&&(i=!1);var n=r.call(this)||this;return n.define=t,n.not=i,n}return e.prototype.isTrue=function(t){var i=t[this.define]!==void 0;return this.not&&(i=!i),i},e}(Ze),jr=function(r){Q(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.isTrue=function(t){return this.leftOperand.isTrue(t)||this.rightOperand.isTrue(t)},e}(Ze),Xr=function(r){Q(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.isTrue=function(t){return this.leftOperand.isTrue(t)&&this.rightOperand.isTrue(t)},e}(Ze),Yr=function(r){Q(e,r);function e(t,i,n){var s=r.call(this)||this;return s.define=t,s.operand=i,s.testValue=n,s}return e.prototype.isTrue=function(t){var i=t[this.define];i===void 0&&(i=this.define);var n=!1,s=parseInt(i),o=parseInt(this.testValue);switch(this.operand){case">":n=s>o;break;case"<":n=s<o;break;case"<=":n=s<=o;break;case">=":n=s>=o;break;case"==":n=s===o;break}return n},e}(Ze),re;(function(r){r[r.GLSL=0]="GLSL",r[r.WGSL=1]="WGSL"})(re||(re={}));var qr=/defined\s*?\((.+?)\)/g,ct=/defined\s*?\[(.+?)\]/g,Ft=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,He=function(){function r(){}return r.Initialize=function(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)},r.Process=function(e,t,i,n){var s=this,o;!((o=t.processor)===null||o===void 0)&&o.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,function(a){t.processCodeAfterIncludes&&(a=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",a));var u=s._ProcessShaderConversion(a,t,n);i(u)})},r.PreProcess=function(e,t,i,n){var s=this,o;!((o=t.processor)===null||o===void 0)&&o.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,function(a){t.processCodeAfterIncludes&&(a=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",a));var u=s._ApplyPreProcessing(a,t,n);i(u)})},r.Finalize=function(e,t,i){return!i.processor||!i.processor.finalizeShaders?{vertexCode:e,fragmentCode:t}:i.processor.finalizeShaders(e,t,i.processingContext)},r._ProcessPrecision=function(e,t){var i;if(!((i=t.processor)===null||i===void 0)&&i.noPrecision)return e;var n=t.shouldUseHighPrecisionShader;return e.indexOf("precision highp float")===-1?n?e=`precision highp float;
`+e:e=`precision mediump float;
`+e:n||(e=e.replace("precision highp float","precision mediump float")),e},r._ExtractOperation=function(e){var t=/defined\((.+)\)/,i=t.exec(e);if(i&&i.length)return new Je(i[1].trim(),e[0]==="!");for(var n=["==",">=","<=","<",">"],s="",o=0,a=0,u=n;a<u.length&&(s=u[a],o=e.indexOf(s),!(o>-1));a++);if(o===-1)return new Je(e);var h=e.substring(0,o).trim(),f=e.substring(o+s.length).trim();return new Yr(h,s,f)},r._BuildSubExpression=function(e){e=e.replace(qr,"defined[$1]");for(var t=Ze.infixToPostfix(e),i=[],n=0,s=t;n<s.length;n++){var o=s[n];if(o!=="||"&&o!=="&&")i.push(o);else if(i.length>=2){var a=i[i.length-1],u=i[i.length-2];i.length-=2;var h=o=="&&"?new Xr:new jr;typeof a=="string"&&(a=a.replace(ct,"defined($1)")),typeof u=="string"&&(u=u.replace(ct,"defined($1)")),h.leftOperand=typeof u=="string"?this._ExtractOperation(u):u,h.rightOperand=typeof a=="string"?this._ExtractOperation(a):a,i.push(h)}}var f=i[i.length-1];return typeof f=="string"&&(f=f.replace(ct,"defined($1)")),typeof f=="string"?this._ExtractOperation(f):f},r._BuildExpression=function(e,t){var i=new Kr,n=e.substring(0,t),s=e.substring(t);return s=s.substring(0,(s.indexOf("//")+1||s.length+1)-1).trim(),n==="#ifdef"?i.testExpression=new Je(s):n==="#ifndef"?i.testExpression=new Je(s,!0):i.testExpression=this._BuildSubExpression(s),i},r._MoveCursorWithinIf=function(e,t,i){for(var n=e.currentLine;this._MoveCursor(e,i);){n=e.currentLine;var s=n.substring(0,5).toLowerCase();if(s==="#else"){var o=new je;t.children.push(o),this._MoveCursor(e,o);return}else if(s==="#elif"){var a=this._BuildExpression(n,5);t.children.push(a),i=a}}},r._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var i=e.currentLine,n=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/,s=n.exec(i);if(s&&s.length){var o=s[0];switch(o){case"#ifdef":{var a=new lt;t.children.push(a);var u=this._BuildExpression(i,6);a.children.push(u),this._MoveCursorWithinIf(e,a,u);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{var a=new lt;t.children.push(a);var u=this._BuildExpression(i,7);a.children.push(u),this._MoveCursorWithinIf(e,a,u);break}case"#if":{var a=new lt,u=this._BuildExpression(i,3);t.children.push(a),a.children.push(u),this._MoveCursorWithinIf(e,a,u);break}}}else{var h=new je;if(h.line=i,t.children.push(h),i[0]==="#"&&i[1]==="d"){var f=i.replace(";","").split(" ");h.additionalDefineKey=f[1],f.length===3&&(h.additionalDefineValue=f[2])}}}return!1},r._EvaluatePreProcessors=function(e,t,i){var n=new je,s=new Hr;return s.lineIndex=-1,s.lines=e.split(`
`),this._MoveCursor(s,n),n.process(t,i)},r._PreparePreProcessors=function(e,t){for(var i,n=e.defines,s={},o=0,a=n;o<a.length;o++){var u=a[o],h=u.replace("#define","").replace(";","").trim(),f=h.split(" ");s[f[0]]=f.length>1?f[1]:""}return((i=e.processor)===null||i===void 0?void 0:i.shaderLanguage)===re.GLSL&&(s.GL_ES="true"),s.__VERSION__=e.version,s[e.platformName]="true",t._getGlobalDefines(s),s},r._ProcessShaderConversion=function(e,t,i){var n=this._ProcessPrecision(e,t);if(!t.processor)return n;if(t.processor.shaderLanguage===re.GLSL&&n.indexOf("#version 3")!==-1)return n.replace("#version 300 es","");var s=t.defines,o=this._PreparePreProcessors(t,i);return t.processor.preProcessor&&(n=t.processor.preProcessor(n,s,t.isFragment,t.processingContext)),n=this._EvaluatePreProcessors(n,o,t),t.processor.postProcessor&&(n=t.processor.postProcessor(n,s,t.isFragment,t.processingContext,i)),i._features.needShaderCodeInlining&&(n=i.inlineShaderCode(n)),n},r._ApplyPreProcessing=function(e,t,i){var n,s,o=e,a=t.defines,u=this._PreparePreProcessors(t,i);return!((n=t.processor)===null||n===void 0)&&n.preProcessor&&(o=t.processor.preProcessor(o,a,t.isFragment,t.processingContext)),o=this._EvaluatePreProcessors(o,u,t),!((s=t.processor)===null||s===void 0)&&s.postProcessor&&(o=t.processor.postProcessor(o,a,t.isFragment,t.processingContext,i)),i._features.needShaderCodeInlining&&(o=i.inlineShaderCode(o)),o},r._ProcessIncludes=function(e,t,i){for(var n=this,s=Ft.exec(e),o=new String(e),a=!1,u=function(){var f=s[1];if(f.indexOf("__decl__")!==-1&&(f=f.replace(/__decl__/,""),t.supportsUniformBuffers&&(f=f.replace(/Vertex/,"Ubo"),f=f.replace(/Fragment/,"Ubo")),f=f+"Declaration"),t.includesShadersStore[f]){var l=t.includesShadersStore[f];if(s[2])for(var c=s[3].split(","),_=0;_<c.length;_+=2){var d=new RegExp(c[_],"g"),g=c[_+1];l=l.replace(d,g)}if(s[4]){var p=s[5];if(p.indexOf("..")!==-1){var y=p.split(".."),v=parseInt(y[0]),b=parseInt(y[1]),C=l.slice(0);l="",isNaN(b)&&(b=t.indexParameters[y[1]]);for(var m=v;m<b;m++)t.supportsUniformBuffers||(C=C.replace(/light\{X\}.(\w*)/g,function(M,w){return w+"{X}"})),l+=C.replace(/\{X\}/g,m.toString())+`
`}else t.supportsUniformBuffers||(l=l.replace(/light\{X\}.(\w*)/g,function(M,w){return w+"{X}"})),l=l.replace(/\{X\}/g,p)}o=o.replace(s[0],l),a=a||l.indexOf("#include<")>=0||l.indexOf("#include <")>=0}else{var S=t.shadersRepository+"ShadersInclude/"+f+".fx";return r._FileToolsLoadFile(S,function(M){t.includesShadersStore[f]=M,n._ProcessIncludes(o,t,i)}),{value:void 0}}s=Ft.exec(e)};s!=null;){var h=u();if(typeof h=="object")return h.value}a?this._ProcessIncludes(o.toString(),t,i):i(o)},r._FileToolsLoadFile=function(e,t,i,n,s,o){throw V("FileTools")},r}(),ve=function(){function r(){}return r.GetShadersRepository=function(e){return e===void 0&&(e=re.GLSL),e===re.GLSL?r.ShadersRepository:r.ShadersRepositoryWGSL},r.GetShadersStore=function(e){return e===void 0&&(e=re.GLSL),e===re.GLSL?r.ShadersStore:r.ShadersStoreWGSL},r.GetIncludesShadersStore=function(e){return e===void 0&&(e=re.GLSL),e===re.GLSL?r.IncludesShadersStore:r.IncludesShadersStoreWGSL},r.ShadersRepository="src/Shaders/",r.ShadersStore={},r.IncludesShadersStore={},r.ShadersRepositoryWGSL="src/ShadersWGSL/",r.ShadersStoreWGSL={},r.IncludesShadersStoreWGSL={},r}(),Ge=function(){function r(e,t,i,n,s,o,a,u,h,f,l,c){n===void 0&&(n=null),o===void 0&&(o=null),a===void 0&&(a=null),u===void 0&&(u=null),h===void 0&&(h=null),l===void 0&&(l=""),c===void 0&&(c=re.GLSL);var _=this,d,g,p;this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new E,this.onErrorObservable=new E,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._wasPreviouslyUsingInstances=null,this._isDisposed=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this.name=e,this._key=l;var y=void 0,v=null;if(t.attributes){var b=t;if(this._engine=i,this._attributesNames=b.attributes,this._uniformsNames=b.uniformsNames.concat(b.samplers),this._samplerList=b.samplers.slice(),this.defines=b.defines,this.onError=b.onError,this.onCompiled=b.onCompiled,this._fallbacks=b.fallbacks,this._indexParameters=b.indexParameters,this._transformFeedbackVaryings=b.transformFeedbackVaryings||null,this._multiTarget=!!b.multiTarget,this._shaderLanguage=(d=b.shaderLanguage)!==null&&d!==void 0?d:re.GLSL,b.uniformBuffersNames){this._uniformBuffersNamesList=b.uniformBuffersNames.slice();for(var C=0;C<b.uniformBuffersNames.length;C++)this._uniformBuffersNames[b.uniformBuffersNames[C]]=C}v=(g=b.processFinalCode)!==null&&g!==void 0?g:null,y=(p=b.processCodeAfterIncludes)!==null&&p!==void 0?p:void 0}else this._engine=s,this.defines=o==null?"":o,this._uniformsNames=i.concat(n),this._samplerList=n?n.slice():[],this._attributesNames=t,this._uniformBuffersNamesList=[],this._shaderLanguage=c,this.onError=h,this.onCompiled=u,this._indexParameters=f,this._fallbacks=a;this._attributeLocationByName={},this.uniqueId=r._UniqueIdSeed++;var m,S,M=X()?this._engine.getHostDocument():null;e.vertexSource?m="source:"+e.vertexSource:e.vertexElement?(m=M?M.getElementById(e.vertexElement):null,m||(m=e.vertexElement)):m=e.vertex||e,e.fragmentSource?S="source:"+e.fragmentSource:e.fragmentElement?(S=M?M.getElementById(e.fragmentElement):null,S||(S=e.fragmentElement)):S=e.fragment||e,this._processingContext=this._engine._getShaderProcessingContext(this._shaderLanguage);var w={defines:this.defines.split(`
`),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:ve.GetShadersRepository(this._shaderLanguage),includesShadersStore:ve.GetIncludesShadersStore(this._shaderLanguage),version:(this._engine.version*100).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:y},x=[void 0,void 0],z=function(){if(x[0]&&x[1]){w.isFragment=!0;var U=x[0],I=x[1];He.Process(I,w,function(H){v&&(H=v("fragment",H));var R=He.Finalize(U,H,w);_._useFinalCode(R.vertexCode,R.fragmentCode,e)},_._engine)}};this._loadShader(m,"Vertex","",function(U){He.Initialize(w),He.Process(U,w,function(I){_._rawVertexSourceCode=U,v&&(I=v("vertex",I)),x[0]=I,z()},_._engine)}),this._loadShader(S,"Fragment","Pixel",function(U){_._rawFragmentSourceCode=U,x[1]=U,z()})}return Object.defineProperty(r,"ShadersRepository",{get:function(){return ve.ShadersRepository},set:function(e){ve.ShadersRepository=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new E),this._onBindObservable},enumerable:!1,configurable:!0}),r.prototype._useFinalCode=function(e,t,i){if(i){var n=i.vertexElement||i.vertex||i.spectorName||i,s=i.fragmentElement||i.fragment||i.spectorName||i;this._vertexSourceCode=(this._shaderLanguage===re.WGSL?"//":"")+"#define SHADER_NAME vertex:"+n+`
`+e,this._fragmentSourceCode=(this._shaderLanguage===re.WGSL?"//":"")+"#define SHADER_NAME fragment:"+s+`
`+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()},Object.defineProperty(r.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),r.prototype.isReady=function(){try{return this._isReadyInternal()}catch{return!1}},r.prototype._isReadyInternal=function(){return this._isReady?!0:this._pipelineContext?this._pipelineContext.isReady:!1},r.prototype.getEngine=function(){return this._engine},r.prototype.getPipelineContext=function(){return this._pipelineContext},r.prototype.getAttributesNames=function(){return this._attributesNames},r.prototype.getAttributeLocation=function(e){return this._attributes[e]},r.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},r.prototype.getAttributesCount=function(){return this._attributes.length},r.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},r.prototype.getUniform=function(e){return this._uniforms[e]},r.prototype.getSamplers=function(){return this._samplerList},r.prototype.getUniformNames=function(){return this._uniformsNames},r.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},r.prototype.getIndexParameters=function(){return this._indexParameters},r.prototype.getCompilationError=function(){return this._compilationError},r.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},r.prototype.executeWhenCompiled=function(e){var t=this;if(this.isReady()){e(this);return}this.onCompileObservable.add(function(i){e(i)}),(!this._pipelineContext||this._pipelineContext.isAsync)&&setTimeout(function(){t._checkIsReady(null)},16)},r.prototype._checkIsReady=function(e){var t=this;try{if(this._isReadyInternal())return}catch(i){this._processCompilationErrors(i,e);return}this._isDisposed||setTimeout(function(){t._checkIsReady(e)},16)},r.prototype._loadShader=function(e,t,i,n){if(typeof HTMLElement!="undefined"&&e instanceof HTMLElement){var s=mt(e);n(s);return}if(e.substr(0,7)==="source:"){n(e.substr(7));return}if(e.substr(0,7)==="base64:"){var o=window.atob(e.substr(7));n(o);return}var a=ve.GetShadersStore(this._shaderLanguage);if(a[e+t+"Shader"]){n(a[e+t+"Shader"]);return}if(i&&a[e+i+"Shader"]){n(a[e+i+"Shader"]);return}var u;e[0]==="."||e[0]==="/"||e.indexOf("http")>-1?u=e:u=ve.GetShadersRepository(this._shaderLanguage)+e,this._engine._loadFile(u+"."+t.toLowerCase()+".fx",n)},Object.defineProperty(r.prototype,"vertexSourceCode",{get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(t=(e=this._pipelineContext)===null||e===void 0?void 0:e._getVertexShaderCode())!==null&&t!==void 0?t:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fragmentSourceCode",{get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(t=(e=this._pipelineContext)===null||e===void 0?void 0:e._getFragmentShaderCode())!==null&&t!==void 0?t:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),r.prototype._rebuildProgram=function(e,t,i,n){var s=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(o,a){n&&n(a)},this.onCompiled=function(){var o=s.getEngine().scenes;if(o)for(var a=0;a<o.length;a++)o[a].markAllMaterialsAsDirty(63);s._pipelineContext._handlesSpectorRebuildCallback(i)},this._fallbacks=null,this._prepareEffect()},r.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,i=this.defines,n=this._pipelineContext;this._isReady=!1;try{var s=this._engine;this._pipelineContext=s.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key;var o=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?s._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,o,null,this._transformFeedbackVaryings,this._key):s._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,o,i,this._transformFeedbackVaryings,this._key),s._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(e._attributes=[],e._pipelineContext._fillEffectInformation(e,e._uniformBuffersNames,e._uniformsNames,e._uniforms,e._samplerList,e._samplers,t,e._attributes),t)for(var a=0;a<t.length;a++){var u=t[a];e._attributeLocationByName[u]=e._attributes[a]}s.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),n&&e.getEngine()._deletePipelineContext(n)}),this._pipelineContext.isAsync&&this._checkIsReady(n)}catch(a){this._processCompilationErrors(a,n)}},r.prototype._getShaderCodeAndErrorLine=function(e,t,i){var n=i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,s=null;if(t&&e){var o=t.match(n);if(o&&o.length===2){var a=parseInt(o[1]),u=e.split(`
`,-1);u.length>=a&&(s="Offending line [".concat(a,"] in ").concat(i?"fragment":"vertex"," code: ").concat(u[a-1]))}}return[e,s]},r.prototype._processCompilationErrors=function(e,t){var i,n,s,o,a;t===void 0&&(t=null),this._compilationError=e.message;var u=this._attributesNames,h=this._fallbacks;if(D.Error("Unable to compile effect:"),D.Error("Uniforms: "+this._uniformsNames.map(function(_){return" "+_})),D.Error("Attributes: "+u.map(function(_){return" "+_})),D.Error(`Defines:\r
`+this.defines),r.LogShaderCodeOnCompilationError){var f=null,l=null,c=null;!((s=this._pipelineContext)===null||s===void 0)&&s._getVertexShaderCode()&&(i=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),c=i[0],f=i[1],c&&(D.Error("Vertex code:"),D.Error(c))),!((o=this._pipelineContext)===null||o===void 0)&&o._getFragmentShaderCode()&&(n=this._getShaderCodeAndErrorLine((a=this._pipelineContext)===null||a===void 0?void 0:a._getFragmentShaderCode(),this._compilationError,!0),c=n[0],l=n[1],c&&(D.Error("Fragment code:"),D.Error(c))),f&&D.Error(f),l&&D.Error(l)}D.Error("Error: "+this._compilationError),t&&(this._pipelineContext=t,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),h?(this._pipelineContext=null,h.hasMoreFallbacks?(this._allFallbacksProcessed=!1,D.Error("Trying next fallback."),this.defines=h.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(r.prototype,"isSupported",{get:function(){return this._compilationError===""},enumerable:!1,configurable:!0}),r.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t,e)},r.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)},r.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)},r.prototype.setTextureArray=function(e,t){var i=e+"Ex";if(this._samplerList.indexOf(i+"0")===-1){for(var n=this._samplerList.indexOf(e),s=1;s<t.length;s++){var o=i+(s-1).toString();this._samplerList.splice(n+s,0,o)}for(var a=0,u=0,h=this._samplerList;u<h.length;u++){var f=h[u];this._samplers[f]=a,a+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)},r.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)},r.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)},r.prototype.bindUniformBuffer=function(e,t){var i=this._uniformBuffersNames[t];i===void 0||r._BaseCache[i]===e&&this._engine._features.useUBOBindingCache||(r._BaseCache[i]=e,this._engine.bindUniformBufferBase(e,i,t))},r.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},r.prototype.setInt=function(e,t){return this._pipelineContext.setInt(e,t),this},r.prototype.setInt2=function(e,t,i){return this._pipelineContext.setInt2(e,t,i),this},r.prototype.setInt3=function(e,t,i,n){return this._pipelineContext.setInt3(e,t,i,n),this},r.prototype.setInt4=function(e,t,i,n,s){return this._pipelineContext.setInt4(e,t,i,n,s),this},r.prototype.setIntArray=function(e,t){return this._pipelineContext.setIntArray(e,t),this},r.prototype.setIntArray2=function(e,t){return this._pipelineContext.setIntArray2(e,t),this},r.prototype.setIntArray3=function(e,t){return this._pipelineContext.setIntArray3(e,t),this},r.prototype.setIntArray4=function(e,t){return this._pipelineContext.setIntArray4(e,t),this},r.prototype.setFloatArray=function(e,t){return this._pipelineContext.setArray(e,t),this},r.prototype.setFloatArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},r.prototype.setFloatArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},r.prototype.setFloatArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},r.prototype.setArray=function(e,t){return this._pipelineContext.setArray(e,t),this},r.prototype.setArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},r.prototype.setArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},r.prototype.setArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},r.prototype.setMatrices=function(e,t){return this._pipelineContext.setMatrices(e,t),this},r.prototype.setMatrix=function(e,t){return this._pipelineContext.setMatrix(e,t),this},r.prototype.setMatrix3x3=function(e,t){return this._pipelineContext.setMatrix3x3(e,t),this},r.prototype.setMatrix2x2=function(e,t){return this._pipelineContext.setMatrix2x2(e,t),this},r.prototype.setFloat=function(e,t){return this._pipelineContext.setFloat(e,t),this},r.prototype.setBool=function(e,t){return this._pipelineContext.setInt(e,t?1:0),this},r.prototype.setVector2=function(e,t){return this._pipelineContext.setVector2(e,t),this},r.prototype.setFloat2=function(e,t,i){return this._pipelineContext.setFloat2(e,t,i),this},r.prototype.setVector3=function(e,t){return this._pipelineContext.setVector3(e,t),this},r.prototype.setFloat3=function(e,t,i,n){return this._pipelineContext.setFloat3(e,t,i,n),this},r.prototype.setVector4=function(e,t){return this._pipelineContext.setVector4(e,t),this},r.prototype.setQuaternion=function(e,t){return this._pipelineContext.setQuaternion(e,t),this},r.prototype.setFloat4=function(e,t,i,n,s){return this._pipelineContext.setFloat4(e,t,i,n,s),this},r.prototype.setColor3=function(e,t){return this._pipelineContext.setColor3(e,t),this},r.prototype.setColor4=function(e,t,i){return this._pipelineContext.setColor4(e,t,i),this},r.prototype.setDirectColor4=function(e,t){return this._pipelineContext.setDirectColor4(e,t),this},r.prototype.dispose=function(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseEffect(this),this._isDisposed=!0},r.RegisterShader=function(e,t,i,n){n===void 0&&(n=re.GLSL),t&&(ve.GetShadersStore(n)["".concat(e,"PixelShader")]=t),i&&(ve.GetShadersStore(n)["".concat(e,"VertexShader")]=i)},r.ResetCache=function(){r._BaseCache={}},r.LogShaderCodeOnCompilationError=!0,r._UniqueIdSeed=0,r._BaseCache={},r.ShadersStore=ve.ShadersStore,r.IncludesShadersStore=ve.IncludesShadersStore,r}(),Zr=function(){function r(e){e===void 0&&(e=!0),this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"zOffsetUnits",{get:function(){return this._zOffsetUnits},set:function(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1},r.prototype.apply=function(e){!this.isDirty||(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},r}(),Qr=function(){function r(){this.reset()}return r.prototype.reset=function(){this.enabled=!1,this.mask=255,this.func=r.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=r.KEEP,this.opDepthFail=r.KEEP,this.opStencilDepthPass=r.REPLACE},Object.defineProperty(r.prototype,"stencilFunc",{get:function(){return this.func},set:function(e){this.func=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilFuncRef",{get:function(){return this.funcRef},set:function(e){this.funcRef=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilFuncMask",{get:function(){return this.funcMask},set:function(e){this.funcMask=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilOpStencilFail",{get:function(){return this.opStencilFail},set:function(e){this.opStencilFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilOpDepthFail",{get:function(){return this.opDepthFail},set:function(e){this.opDepthFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilOpStencilDepthPass",{get:function(){return this.opStencilDepthPass},set:function(e){this.opStencilDepthPass=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilMask",{get:function(){return this.mask},set:function(e){this.mask=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilTest",{get:function(){return this.enabled},set:function(e){this.enabled=e},enumerable:!1,configurable:!0}),r.ALWAYS=519,r.KEEP=7680,r.REPLACE=7681,r}(),Jr=function(){function r(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),r.prototype.setAlphaBlendConstants=function(e,t,i,n){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===i&&this._blendConstants[3]===n||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=n,this._isBlendConstantsDirty=!0)},r.prototype.setAlphaBlendFunctionParameters=function(e,t,i,n){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===n||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=n,this._isBlendFunctionParametersDirty=!0)},r.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},r.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},r.prototype.apply=function(e){!this.isDirty||(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},r}(),$r=function(){function r(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}return Object.defineProperty(r.prototype,"wrapU",{get:function(){return this._cachedWrapU},set:function(e){this._cachedWrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"wrapV",{get:function(){return this._cachedWrapV},set:function(e){this._cachedWrapV=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"wrapR",{get:function(){return this._cachedWrapR},set:function(e){this._cachedWrapR=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"anisotropicFilteringLevel",{get:function(){return this._cachedAnisotropicFilteringLevel},set:function(e){this._cachedAnisotropicFilteringLevel=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"comparisonFunction",{get:function(){return this._comparisonFunction},set:function(e){this._comparisonFunction=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"useMipMaps",{get:function(){return this._useMipMaps},set:function(e){this._useMipMaps=e},enumerable:!1,configurable:!0}),r.prototype.setParameters=function(e,t,i,n,s,o){return e===void 0&&(e=1),t===void 0&&(t=1),i===void 0&&(i=1),n===void 0&&(n=1),s===void 0&&(s=2),o===void 0&&(o=0),this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=i,this._cachedAnisotropicFilteringLevel=n,this.samplingMode=s,this._comparisonFunction=o,this},r.prototype.compareSampler=function(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps},r}(),ie;(function(r){r[r.Unknown=0]="Unknown",r[r.Url=1]="Url",r[r.Temp=2]="Temp",r[r.Raw=3]="Raw",r[r.Dynamic=4]="Dynamic",r[r.RenderTarget=5]="RenderTarget",r[r.MultiRenderTarget=6]="MultiRenderTarget",r[r.Cube=7]="Cube",r[r.CubeRaw=8]="CubeRaw",r[r.CubePrefiltered=9]="CubePrefiltered",r[r.Raw3D=10]="Raw3D",r[r.Raw2DArray=11]="Raw2DArray",r[r.DepthStencil=12]="DepthStencil",r[r.CubeRawRGBD=13]="CubeRawRGBD",r[r.Depth=14]="Depth"})(ie||(ie={}));var tt=function(r){Q(e,r);function e(t,i,n){n===void 0&&(n=!1);var s=r.call(this)||this;return s.isReady=!1,s.isCube=!1,s.is3D=!1,s.is2DArray=!1,s.isMultiview=!1,s.url="",s.generateMipMaps=!1,s.samples=0,s.type=-1,s.format=-1,s.onLoadedObservable=new E,s.onErrorObservable=new E,s.onRebuildCallback=null,s.width=0,s.height=0,s.depth=0,s.baseWidth=0,s.baseHeight=0,s.baseDepth=0,s.invertY=!1,s._invertVScale=!1,s._associatedChannel=-1,s._source=ie.Unknown,s._buffer=null,s._bufferView=null,s._bufferViewArray=null,s._bufferViewArrayArray=null,s._size=0,s._extension="",s._files=null,s._workingCanvas=null,s._workingContext=null,s._cachedCoordinatesMode=null,s._isDisabled=!1,s._compression=null,s._sphericalPolynomial=null,s._sphericalPolynomialPromise=null,s._sphericalPolynomialComputed=!1,s._lodGenerationScale=0,s._lodGenerationOffset=0,s._useSRGBBuffer=!1,s._lodTextureHigh=null,s._lodTextureMid=null,s._lodTextureLow=null,s._isRGBD=!1,s._linearSpecularLOD=!1,s._irradianceTexture=null,s._hardwareTexture=null,s._maxLodLevel=null,s._references=1,s._gammaSpace=null,s._engine=t,s._source=i,s._uniqueId=e._Counter++,n||(s._hardwareTexture=t._createHardwareTexture()),s}return Object.defineProperty(e.prototype,"useMipMaps",{get:function(){return this.generateMipMaps},set:function(t){this.generateMipMaps=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),e.prototype.getEngine=function(){return this._engine},Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),e.prototype.incrementReferences=function(){this._references++},e.prototype.updateSize=function(t,i,n){n===void 0&&(n=1),this._engine.updateTextureDimensions(this,t,i,n),this.width=t,this.height=i,this.depth=n,this.baseWidth=t,this.baseHeight=i,this.baseDepth=n,this._size=t*i*n},e.prototype._rebuild=function(){var t=this,i;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){var n=this.onRebuildCallback(this),s=function(a){a._swapAndDie(t,!1),t.isReady=n.isReady};n.isAsync?n.proxy.then(s):s(n.proxy);return}var o;switch(this.source){case ie.Temp:break;case ie.Url:o=this._engine.createTexture((i=this._originalUrl)!==null&&i!==void 0?i:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){o._swapAndDie(t,!1),t.isReady=!0},null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer);return;case ie.Raw:o=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,void 0,this._useSRGBBuffer),o._swapAndDie(this,!1),this.isReady=!0;break;case ie.Raw3D:o=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),o._swapAndDie(this,!1),this.isReady=!0;break;case ie.Raw2DArray:o=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),o._swapAndDie(this,!1),this.isReady=!0;break;case ie.Dynamic:o=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),o._swapAndDie(this,!1),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);break;case ie.Cube:o=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){o._swapAndDie(t,!1),t.isReady=!0},null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer);return;case ie.CubeRaw:o=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),o._swapAndDie(this,!1),this.isReady=!0;break;case ie.CubeRawRGBD:return;case ie.CubePrefiltered:o=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(a){a&&a._swapAndDie(t,!1),t.isReady=!0},null,this.format,this._extension),o._sphericalPolynomial=this._sphericalPolynomial;return}},e.prototype._swapAndDie=function(t,i){var n;i===void 0&&(i=!0),(n=this._hardwareTexture)===null||n===void 0||n.setUsage(t._source,this.generateMipMaps,this.isCube,this.width,this.height),t._hardwareTexture=this._hardwareTexture,i&&(t._isRGBD=this._isRGBD),this._lodTextureHigh&&(t._lodTextureHigh&&t._lodTextureHigh.dispose(),t._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(t._lodTextureMid&&t._lodTextureMid.dispose(),t._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(t._lodTextureLow&&t._lodTextureLow.dispose(),t._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(t._irradianceTexture&&t._irradianceTexture.dispose(),t._irradianceTexture=this._irradianceTexture);var s=this._engine.getLoadedTexturesCache(),o=s.indexOf(this);o!==-1&&s.splice(o,1),o=s.indexOf(t),o===-1&&s.push(t)},e.prototype.dispose=function(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._references===0&&(this._engine._releaseTexture(this),this._hardwareTexture=null)},e._Counter=0,e}($r),ei=function(){function r(){this.shaderLanguage=re.GLSL}return r.prototype.postProcessor=function(e,t,i,n,s){if(!s.getCaps().drawBuffersExtension){var o=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;e=e.replace(o,"")}return e},r}(),ti=function(){function r(){this.shaderLanguage=re.GLSL}return r.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},r.prototype.varyingProcessor=function(e,t){return e.replace("varying",t?"in":"out")},r.prototype.postProcessor=function(e,t,i){var n=e.search(/#extension.+GL_EXT_draw_buffers.+require/)!==-1,s=/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g;if(e=e.replace(s,""),e=e.replace(/texture2D\s*\(/g,"texture("),i)e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod("),e=e.replace(/textureCubeLodEXT\s*\(/g,"textureLod("),e=e.replace(/textureCube\s*\(/g,"texture("),e=e.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),e=e.replace(/gl_FragColor/g,"glFragColor"),e=e.replace(/gl_FragData/g,"glFragData"),e=e.replace(/void\s+?main\s*\(/g,(n?"":`out vec4 glFragColor;
`)+"void main(");else{var o=t.indexOf("#define MULTIVIEW")!==-1;if(o)return`#extension GL_OVR_multiview2 : require
layout (num_views = 2) in;
`+e}return e},r}(),tr=function(){function r(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=r._Counter++}return Object.defineProperty(r.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),r._Counter=0,r}(),Ye=function(r){Q(e,r);function e(t){var i=r.call(this)||this;return i._buffer=t,i}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),e}(tr),ri=function(){function r(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(r.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isReady",{get:function(){return this.program?this.isParallelCompiled?this.engine._isRenderingStateCompiled(this):!0:!1},enumerable:!1,configurable:!0}),r.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},r.prototype._fillEffectInformation=function(e,t,i,n,s,o,a,u){var h=this.engine;if(h.supportsUniformBuffers)for(var f in t)e.bindUniformBlock(f,t[f]);var l=this.engine.getUniforms(this,i);l.forEach(function(y,v){n[i[v]]=y}),this._uniforms=n;var c;for(c=0;c<s.length;c++){var _=e.getUniform(s[c]);_==null&&(s.splice(c,1),c--)}s.forEach(function(y,v){o[y]=v});for(var d=0,g=h.getAttributes(this,a);d<g.length;d++){var p=g[d];u.push(p)}},r.prototype.dispose=function(){this._uniforms={}},r.prototype._cacheMatrix=function(e,t){var i=this._valueCache[e],n=t.updateFlag;return i!==void 0&&i===n?!1:(this._valueCache[e]=n,!0)},r.prototype._cacheFloat2=function(e,t,i){var n=this._valueCache[e];if(!n||n.length!==2)return n=[t,i],this._valueCache[e]=n,!0;var s=!1;return n[0]!==t&&(n[0]=t,s=!0),n[1]!==i&&(n[1]=i,s=!0),s},r.prototype._cacheFloat3=function(e,t,i,n){var s=this._valueCache[e];if(!s||s.length!==3)return s=[t,i,n],this._valueCache[e]=s,!0;var o=!1;return s[0]!==t&&(s[0]=t,o=!0),s[1]!==i&&(s[1]=i,o=!0),s[2]!==n&&(s[2]=n,o=!0),o},r.prototype._cacheFloat4=function(e,t,i,n,s){var o=this._valueCache[e];if(!o||o.length!==4)return o=[t,i,n,s],this._valueCache[e]=o,!0;var a=!1;return o[0]!==t&&(o[0]=t,a=!0),o[1]!==i&&(o[1]=i,a=!0),o[2]!==n&&(o[2]=n,a=!0),o[3]!==s&&(o[3]=s,a=!0),a},r.prototype.setInt=function(e,t){var i=this._valueCache[e];i!==void 0&&i===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)},r.prototype.setInt2=function(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))},r.prototype.setInt3=function(e,t,i,n){this._cacheFloat3(e,t,i,n)&&(this.engine.setInt3(this._uniforms[e],t,i,n)||(this._valueCache[e]=null))},r.prototype.setInt4=function(e,t,i,n,s){this._cacheFloat4(e,t,i,n,s)&&(this.engine.setInt4(this._uniforms[e],t,i,n,s)||(this._valueCache[e]=null))},r.prototype.setIntArray=function(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)},r.prototype.setIntArray2=function(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)},r.prototype.setIntArray3=function(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)},r.prototype.setIntArray4=function(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)},r.prototype.setArray=function(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)},r.prototype.setArray2=function(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)},r.prototype.setArray3=function(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)},r.prototype.setArray4=function(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)},r.prototype.setMatrices=function(e,t){!t||(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))},r.prototype.setMatrix=function(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.toArray())||(this._valueCache[e]=null))},r.prototype.setMatrix3x3=function(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)},r.prototype.setMatrix2x2=function(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)},r.prototype.setFloat=function(e,t){var i=this._valueCache[e];i!==void 0&&i===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)},r.prototype.setVector2=function(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))},r.prototype.setFloat2=function(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setFloat2(this._uniforms[e],t,i)||(this._valueCache[e]=null))},r.prototype.setVector3=function(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))},r.prototype.setFloat3=function(e,t,i,n){this._cacheFloat3(e,t,i,n)&&(this.engine.setFloat3(this._uniforms[e],t,i,n)||(this._valueCache[e]=null))},r.prototype.setVector4=function(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))},r.prototype.setQuaternion=function(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))},r.prototype.setFloat4=function(e,t,i,n,s){this._cacheFloat4(e,t,i,n,s)&&(this.engine.setFloat4(this._uniforms[e],t,i,n,s)||(this._valueCache[e]=null))},r.prototype.setColor3=function(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))},r.prototype.setColor4=function(e,t,i){this._cacheFloat4(e,t.r,t.g,t.b,i)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,i)||(this._valueCache[e]=null))},r.prototype.setDirectColor4=function(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))},r.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},r.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},r}(),Me=function(){function r(){}return r.SetMatrixPrecision=function(e){if(r.MatrixTrackPrecisionChange=!1,e&&!r.MatrixUse64Bits&&r.MatrixTrackedMatrices)for(var t=0;t<r.MatrixTrackedMatrices.length;++t){var i=r.MatrixTrackedMatrices[t],n=i._m;i._m=new Array(16);for(var s=0;s<16;++s)i._m[s]=n[s]}r.MatrixUse64Bits=e,r.MatrixCurrentType=r.MatrixUse64Bits?Array:Float32Array,r.MatrixTrackedMatrices=null},r.MatrixUse64Bits=!1,r.MatrixTrackPrecisionChange=!0,r.MatrixCurrentType=Float32Array,r.MatrixTrackedMatrices=[],r}(),rr=function(){function r(e,t){if(e===void 0&&(e=null),this._MSAARenderBuffer=null,this._context=t,!e&&(e=t.createTexture(),!e))throw new Error("Unable to create webGL texture");this.set(e)}return Object.defineProperty(r.prototype,"underlyingResource",{get:function(){return this._webGLTexture},enumerable:!1,configurable:!0}),r.prototype.setUsage=function(){},r.prototype.set=function(e){this._webGLTexture=e},r.prototype.reset=function(){this._webGLTexture=null,this._MSAARenderBuffer=null},r.prototype.release=function(){this._MSAARenderBuffer&&(this._context.deleteRenderbuffer(this._MSAARenderBuffer),this._MSAARenderBuffer=null),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()},r}(),ii=function(){function r(e,t){t===void 0&&(t=!0),this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}return r.IsWrapper=function(e){return e.getPipelineContext===void 0},r.GetEffect=function(e){return e.getPipelineContext===void 0?e.effect:e},r.prototype.setEffect=function(e,t,i){var n;i===void 0&&(i=!0),this.effect=e,t!==void 0&&(this.defines=t),i&&((n=this.drawContext)===null||n===void 0||n.reset())},r.prototype.dispose=function(){var e;(e=this.drawContext)===null||e===void 0||e.dispose()},r}(),ni=function(){function r(e){e===void 0&&(e=!0),this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"func",{get:function(){return this._func},set:function(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"funcRef",{get:function(){return this._funcRef},set:function(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"funcMask",{get:function(){return this._funcMask},set:function(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),r.prototype.reset=function(){var e;this.stencilMaterial=void 0,(e=this.stencilGlobal)===null||e===void 0||e.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},r.prototype.apply=function(e){var t;if(!!e){var i=!this.useStencilGlobalOnly&&!!(!((t=this.stencilMaterial)===null||t===void 0)&&t.enabled);this.enabled=i?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=i?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=i?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=i?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=i?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=i?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=i?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=i?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}},r}(),si=function(){function r(){}return r}(),$=function(){function r(e,t,i,n){var s=this;this._name="WebGL",this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=null,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this.disableUniformBuffers=!1,this.onDisposeObservable=new E,this._frameId=0,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new E,this.onContextRestoredObservable=new E,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new Zr,this._stencilStateComposer=new ni,this._stencilState=new Qr,this._alphaState=new Jr,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._renderTargetWrapperCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._activeRequests=new Array,this._adaptToDeviceRatio=!1,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new E,this._isWebGPU=!1,this._snapshotRenderingMode=0,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={};var o=null;if(i=i||{},this._creationOptions=i,this._adaptToDeviceRatio=n!=null?n:!1,this._stencilStateComposer.stencilGlobal=this._stencilState,Me.SetMatrixPrecision(!!i.useHighPrecisionMatrix),!!e){if(n=n||i.adaptToDeviceRatio||!1,e.getContext){if(o=e,this._renderingCanvas=o,t!==void 0&&(i.antialias=t),i.deterministicLockstep===void 0&&(i.deterministicLockstep=!1),i.lockstepMaxSteps===void 0&&(i.lockstepMaxSteps=4),i.timeStep===void 0&&(i.timeStep=1/60),i.preserveDrawingBuffer===void 0&&(i.preserveDrawingBuffer=!1),i.audioEngine===void 0&&(i.audioEngine=!0),i.audioEngineOptions!==void 0&&i.audioEngineOptions.audioContext!==void 0&&(this._audioContext=i.audioEngineOptions.audioContext),i.audioEngineOptions!==void 0&&i.audioEngineOptions.audioDestination!==void 0&&(this._audioDestination=i.audioEngineOptions.audioDestination),i.stencil===void 0&&(i.stencil=!0),i.premultipliedAlpha===!1&&(this.premultipliedAlpha=!1),i.xrCompatible===void 0&&(i.xrCompatible=!0),this._doNotHandleContextLost=!!i.doNotHandleContextLost,navigator&&navigator.userAgent){this._checkForMobile=function(){var U=navigator.userAgent;s.hostInformation.isMobile=U.indexOf("Mobile")!==-1||U.indexOf("Mac")!==-1&&ot()&&"ontouchend"in document},this._checkForMobile(),X()&&window.addEventListener("resize",this._checkForMobile);for(var a=navigator.userAgent,u=0,h=r.ExceptionList;u<h.length;u++){var f=h[u],l=f.key,c=f.targets,_=new RegExp(l);if(_.test(a)){if(f.capture&&f.captureConstraint){var d=f.capture,g=f.captureConstraint,p=new RegExp(d),y=p.exec(a);if(y&&y.length>0){var v=parseInt(y[y.length-1]);if(v>=g)continue}}for(var b=0,C=c;b<C.length;b++){var m=C[b];switch(m){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":i.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1;break}}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(U){U.preventDefault(),s._contextWasLost=!0,D.Warn("WebGL context lost."),s.onContextLostObservable.notifyObservers(s)},this._onContextRestored=function(){s._restoreEngineAfterContextLost(s._initGLContext.bind(s))},o.addEventListener("webglcontextlost",this._onContextLost,!1),o.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference="high-performance"),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._badDesktopOS&&(i.xrCompatible=!1),!i.disableWebGL2Support)try{this._gl=o.getContext("webgl2",i)||o.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch{}if(!this._gl){if(!o)throw new Error("The provided canvas is null or undefined.");try{this._gl=o.getContext("webgl",i)||o.getContext("experimental-webgl",i)}catch{throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=e,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";var S=this._gl.getContextAttributes();S&&(i.stencil=S.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),i.useHighPrecisionFloats!==void 0&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats);var M=X()&&window.devicePixelRatio||1,w=i.limitDeviceRatio||M;this._hardwareScalingLevel=n?1/Math.min(w,M):1,this.resize(),this._isStencilEnable=!!i.stencil,this._initGLContext(),this._initFeatures();for(var x=0;x<this._caps.maxVertexAttribs;x++)this._currentBufferPointers[x]=new si;this._shaderProcessor=this.webGLVersion>1?new ti:new ei,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent);var z="Babylon.js v".concat(r.Version);console.log(z+" - ".concat(this.description)),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",z)}}return Object.defineProperty(r,"NpmPackage",{get:function(){return"babylonjs@5.13.2"},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Version",{get:function(){return"5.13.2"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"description",{get:function(){var e=this.name+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"version",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ShadersRepository",{get:function(){return Ge.ShadersRepository},set:function(e){Ge.ShadersRepository=e},enumerable:!1,configurable:!0}),r.prototype._getShaderProcessor=function(e){return this._shaderProcessor},Object.defineProperty(r.prototype,"useReverseDepthBuffer",{get:function(){return this._useReverseDepthBuffer},set:function(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,e?this._depthCullingState.depthFunc=518:this._depthCullingState.depthFunc=515)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"frameId",{get:function(){return this._frameId},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),r.prototype.getCreationOptions=function(){return this._creationOptions},Object.defineProperty(r.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!!(this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"activeRenderLoops",{get:function(){return this._activeRenderLoops},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"framebufferDimensionsObject",{set:function(e){this._framebufferDimensionsObject=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isWebGPU",{get:function(){return this._isWebGPU},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shaderPlatformName",{get:function(){return this._shaderPlatformName},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"snapshotRendering",{get:function(){return!1},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"snapshotRenderingMode",{get:function(){return this._snapshotRenderingMode},set:function(e){this._snapshotRenderingMode=e},enumerable:!1,configurable:!0}),r.prototype.snapshotRenderingReset=function(){this.snapshotRendering=!1},r._CreateCanvas=function(e,t){if(typeof document=="undefined")return new OffscreenCanvas(e,t);var i=document.createElement("canvas");return i.width=e,i.height=t,i},r.prototype.createCanvas=function(e,t){return r._CreateCanvas(e,t)},r.prototype.createCanvasImage=function(){return document.createElement("img")},r.prototype._restoreEngineAfterContextLost=function(e){var t=this;setTimeout(function(){return Qt(t,void 0,void 0,function(){var i,n,s,o,a;return Jt(this,function(u){switch(u.label){case 0:return this._dummyFramebuffer=null,i=this._depthCullingState.depthTest,n=this._depthCullingState.depthFunc,s=this._depthCullingState.depthMask,o=this._stencilState.stencilTest,[4,e()];case 1:return u.sent(),this._rebuildEffects(),(a=this._rebuildComputeEffects)===null||a===void 0||a.call(this),this._rebuildInternalTextures(),this._rebuildRenderTargetWrappers(),this._rebuildBuffers(),this.wipeCaches(!0),this._depthCullingState.depthTest=i,this._depthCullingState.depthFunc=n,this._depthCullingState.depthMask=s,this._stencilState.stencilTest=o,D.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1,[2]}})})},0)},r.prototype._sharedInit=function(e,t,i){this._renderingCanvas=e},r.prototype._getShaderProcessingContext=function(e){return null},r.prototype._rebuildInternalTextures=function(){for(var e=this._internalTexturesCache.slice(),t=0,i=e;t<i.length;t++){var n=i[t];n._rebuild()}},r.prototype._rebuildRenderTargetWrappers=function(){for(var e=this._renderTargetWrapperCache.slice(),t=0,i=e;t<i.length;t++){var n=i[t];n._rebuild()}},r.prototype._rebuildEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e];t._pipelineContext=null,t._wasPreviouslyReady=!1,t._prepareEffect()}Ge.ResetCache()},r.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e];if(!t.isReady())return!1}return!0},r.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++){var i=t[e];i._rebuild()}for(var n=0,s=this._storageBuffers;n<s.length;n++){var o=s[n];o._rebuild()}},r.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||this._gl.getExtension("OES_standard_derivatives")!==null,maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||this._gl.getExtension("OES_element_index_uint")!==null,fragmentDepthSupported:this._webGLVersion>1||this._gl.getExtension("EXT_frag_depth")!==null,highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?256:128},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(e!=null&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),this._gl.HALF_FLOAT_OES!==36193&&(this._gl.HALF_FLOAT_OES=36193),this._gl.RGBA16F!==34842&&(this._gl.RGBA16F=34842),this._gl.RGBA32F!==34836&&(this._gl.RGBA32F=34836),this._gl.DEPTH24_STENCIL8!==35056&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(this._webGLVersion===1&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!!(this._caps.textureFloat&&this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!!(this._caps.textureFloat&&this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&this._gl.HALF_FLOAT_OES!==5131&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._maxMSAASamplesOverride!==null?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(t!==null){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var i=0;i<16;i++)this._gl["COLOR_ATTACHMENT"+i+"_WEBGL"]=t["COLOR_ATTACHMENT"+i+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var n=this._gl.getExtension("WEBGL_depth_texture");n!=null&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=n.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var s=this._gl.getExtension("OES_vertex_array_object");s!=null&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=s.createVertexArrayOES.bind(s),this._gl.bindVertexArray=s.bindVertexArrayOES.bind(s),this._gl.deleteVertexArray=s.deleteVertexArrayOES.bind(s))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var o=this._gl.getExtension("ANGLE_instanced_arrays");o!=null?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=o.drawArraysInstancedANGLE.bind(o),this._gl.drawElementsInstanced=o.drawElementsInstancedANGLE.bind(o),this._gl.vertexAttribDivisor=o.vertexAttribDivisorANGLE.bind(o)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var a=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),u=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);a&&u&&(this._caps.highPrecisionShaderSupported=a.precision!==0&&u.precision!==0)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var h=this._gl.getExtension("EXT_blend_minmax");h!=null&&(this._caps.blendMinMax=!0,this._gl.MAX=h.MAX_EXT,this._gl.MIN=h.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0;else{var f=this._gl.getExtension("EXT_sRGB");f!=null&&(this._caps.supportSRGBBuffers=!0,this._gl.SRGB=f.SRGB_EXT,this._gl.SRGB8=f.SRGB_ALPHA_EXT,this._gl.SRGB8_ALPHA8=f.SRGB_ALPHA_EXT)}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!!(this._creationOptions&&this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var l=0;l<this._maxSimultaneousTextures;l++)this._nextFreeTextureSlots.push(l)},r.prototype._initFeatures=function(){this._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:this._webGLVersion!==1,supportDepthStencilTexture:this._webGLVersion!==1,supportShadowSamplers:this._webGLVersion!==1,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:this._webGLVersion!==1,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:this._webGLVersion!==1,basisNeedsPOT:this._webGLVersion===1,support3DTextures:this._webGLVersion!==1,needTypeSuffixInShaderConstants:this._webGLVersion!==1,supportMSAA:this._webGLVersion!==1,supportSSAO2:this._webGLVersion!==1,supportExtendedTextureFormats:this._webGLVersion!==1,supportSwitchCaseInShader:this._webGLVersion!==1,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,_collectUbosUpdatedInFrame:!1}},Object.defineProperty(r.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),r.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(r.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),r.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=this.createCanvas(1,1);var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},r.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)!Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)||(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},r.prototype.getInfo=function(){return this.getGlInfo()},r.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},r.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},r.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},r.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},r.prototype.getCaps=function(){return this._caps},r.prototype.stopRenderLoop=function(e){if(!e){this._activeRenderLoops=[];return}var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)},r.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++){var i=this._activeRenderLoops[t];i()}this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},r.prototype.getRenderingCanvas=function(){return this._renderingCanvas},r.prototype.getAudioContext=function(){return this._audioContext},r.prototype.getAudioDestination=function(){return this._audioDestination},r.prototype.getHostWindow=function(){return X()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},r.prototype.getRenderWidth=function(e){return e===void 0&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},r.prototype.getRenderHeight=function(e){return e===void 0&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},r.prototype._queueNewFrame=function(e,t){return r.QueueNewFrame(e,t)},r.prototype.runRenderLoop=function(e){this._activeRenderLoops.indexOf(e)===-1&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},r.prototype.clear=function(e,t,i,n){n===void 0&&(n=!1);var s=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=s;var o=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,e.a!==void 0?e.a:1),o|=this._gl.COLOR_BUFFER_BIT),i&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),o|=this._gl.DEPTH_BUFFER_BIT),n&&(this._gl.clearStencil(0),o|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(o)},r.prototype._viewport=function(e,t,i,n){(e!==this._viewportCached.x||t!==this._viewportCached.y||i!==this._viewportCached.z||n!==this._viewportCached.w)&&(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=n,this._gl.viewport(e,t,i,n))},r.prototype.setViewport=function(e,t,i){var n=t||this.getRenderWidth(),s=i||this.getRenderHeight(),o=e.x||0,a=e.y||0;this._cachedViewport=e,this._viewport(o*n,a*s,n*e.width,s*e.height)},r.prototype.beginFrame=function(){},r.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._frameId++},r.prototype.resize=function(e){e===void 0&&(e=!1);var t,i;if(this._adaptToDeviceRatio){var n=X()&&window.devicePixelRatio||1,s=this._creationOptions.limitDeviceRatio||n;this._hardwareScalingLevel=this._adaptToDeviceRatio?1/Math.min(s,n):1}X()?(t=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,i=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(t=this._renderingCanvas?this._renderingCanvas.width:100,i=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(t/this._hardwareScalingLevel,i/this._hardwareScalingLevel,e)},r.prototype.setSize=function(e,t,i){return i===void 0&&(i=!1),!this._renderingCanvas||(e=e|0,t=t|0,!i&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t)?!1:(this._renderingCanvas.width=e,this._renderingCanvas.height=t,!0)},r.prototype.bindFramebuffer=function(e,t,i,n,s,o,a){var u,h,f,l,c;t===void 0&&(t=0),o===void 0&&(o=0),a===void 0&&(a=0);var _=e;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(_._MSAAFramebuffer?_._MSAAFramebuffer:_._framebuffer);var d=this._gl;e.is2DArray?d.framebufferTextureLayer(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,(u=e.texture._hardwareTexture)===null||u===void 0?void 0:u.underlyingResource,o,a):e.isCube&&d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+t,(h=e.texture._hardwareTexture)===null||h===void 0?void 0:h.underlyingResource,o);var g=e._depthStencilTexture;if(g){var p=e._depthStencilTextureWithStencil?d.DEPTH_STENCIL_ATTACHMENT:d.DEPTH_ATTACHMENT;e.is2DArray?d.framebufferTextureLayer(d.FRAMEBUFFER,p,(f=g._hardwareTexture)===null||f===void 0?void 0:f.underlyingResource,o,a):e.isCube?d.framebufferTexture2D(d.FRAMEBUFFER,p,d.TEXTURE_CUBE_MAP_POSITIVE_X+t,(l=g._hardwareTexture)===null||l===void 0?void 0:l.underlyingResource,o):d.framebufferTexture2D(d.FRAMEBUFFER,p,d.TEXTURE_2D,(c=g._hardwareTexture)===null||c===void 0?void 0:c.underlyingResource,o)}this._cachedViewport&&!s?this.setViewport(this._cachedViewport,i,n):(i||(i=e.width,o&&(i=i/Math.pow(2,o))),n||(n=e.height,o&&(n=n/Math.pow(2,o))),this._viewport(0,0,i,n)),this.wipeCaches()},r.prototype.setState=function(e,t,i,n,s,o,a){var u,h;t===void 0&&(t=0),n===void 0&&(n=!1),a===void 0&&(a=0),(this._depthCullingState.cull!==e||i)&&(this._depthCullingState.cull=e);var f=!((h=(u=this.cullBackFaces)!==null&&u!==void 0?u:s)!==null&&h!==void 0)||h?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==f||i)&&(this._depthCullingState.cullFace=f),this.setZOffset(t),this.setZOffsetUnits(a);var l=n?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==l||i)&&(this._depthCullingState.frontFace=l),this._stencilStateComposer.stencilMaterial=o},r.prototype.setZOffset=function(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e},r.prototype.getZOffset=function(){var e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e},r.prototype.setZOffsetUnits=function(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e},r.prototype.getZOffsetUnits=function(){var e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e},r.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},r.prototype._currentFrameBufferIsDefaultFrameBuffer=function(){return this._currentFramebuffer===null},r.prototype.generateMipmaps=function(e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)},r.prototype.unBindFramebuffer=function(e,t,i){var n;t===void 0&&(t=!1);var s=e;this._currentRenderTarget=null;var o=this._gl;if(s._MSAAFramebuffer){if(e.isMulti){this.unBindMultiColorAttachmentFramebuffer(e,t,i);return}o.bindFramebuffer(o.READ_FRAMEBUFFER,s._MSAAFramebuffer),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,s._framebuffer),o.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,o.COLOR_BUFFER_BIT,o.NEAREST)}((n=e.texture)===null||n===void 0?void 0:n.generateMipMaps)&&!t&&!e.isCube&&this.generateMipmaps(e.texture),i&&(s._MSAAFramebuffer&&this._bindUnboundFramebuffer(s._framebuffer),i()),this._bindUnboundFramebuffer(null)},r.prototype.flushFramebuffer=function(){this._gl.flush()},r.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},r.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},r.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},r.prototype._createVertexBuffer=function(e,t){var i=this._gl.createBuffer();if(!i)throw new Error("Unable to create vertex buffer");var n=new Ye(i);return this.bindArrayBuffer(n),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),this._resetVertexBufferBinding(),n.references=1,n},r.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},r.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},r.prototype.createIndexBuffer=function(e,t){var i=this._gl.createBuffer(),n=new Ye(i);if(!i)throw new Error("Unable to create index buffer");this.bindIndexBuffer(n);var s=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,s,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),n.references=1,n.is32Bits=s.BYTES_PER_ELEMENT===4,n},r.prototype._normalizeIndexData=function(e){var t=e.BYTES_PER_ELEMENT;if(t===2)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var i=0;i<e.length;i++)if(e[i]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},r.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)},r.prototype.bindUniformBlock=function(e,t,i){var n=e.program,s=this._gl.getUniformBlockIndex(n,t);this._gl.uniformBlockBinding(n,s,i)},r.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},r.prototype._bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},r.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},r.prototype._vertexAttribPointer=function(e,t,i,n,s,o,a){var u=this._currentBufferPointers[t];if(!!u){var h=!1;u.active?(u.buffer!==e&&(u.buffer=e,h=!0),u.size!==i&&(u.size=i,h=!0),u.type!==n&&(u.type=n,h=!0),u.normalized!==s&&(u.normalized=s,h=!0),u.stride!==o&&(u.stride=o,h=!0),u.offset!==a&&(u.offset=a,h=!0)):(h=!0,u.active=!0,u.index=t,u.size=i,u.type=n,u.normalized=s,u.stride=o,u.offset=a,u.buffer=e),(h||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,i,n,s,o,a))}},r.prototype._bindIndexBufferWithCache=function(e){e!=null&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},r.prototype._bindVertexBuffersAttributes=function(e,t,i){var n=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var s=0;s<n.length;s++){var o=t.getAttributeLocation(s);if(o>=0){var a=n[s],u=null;if(i&&(u=i[a]),u||(u=e[a]),!u)continue;this._gl.enableVertexAttribArray(o),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[o]=!0);var h=u.getBuffer();h&&(this._vertexAttribPointer(h,o,u.getSize(),u.type,u.normalized,u.byteStride,u.byteOffset),u.getIsInstanced()&&(this._gl.vertexAttribDivisor(o,u.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(o),this._currentInstanceBuffers.push(h))))}}},r.prototype.recordVertexArrayObject=function(e,t,i,n){var s=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(s),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i,n),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),s},r.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=t!=null&&t.is32Bits,this._mustWipeVertexAttributes=!0)},r.prototype.bindBuffersDirectly=function(e,t,i,n,s){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==s){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=s;var o=s.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var a=0,u=0;u<o;u++)if(u<i.length){var h=s.getAttributeLocation(u);h>=0&&(this._gl.enableVertexAttribArray(h),this._vertexAttribArraysEnabled[h]=!0,this._vertexAttribPointer(e,h,i[u],this._gl.FLOAT,!1,n,a)),a+=i[u]*4}}this._bindIndexBufferWithCache(t)},r.prototype._unbindVertexArrayObject=function(){!this._cachedVertexArrayObject||(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},r.prototype.bindBuffers=function(e,t,i,n){(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i)&&(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i,n)),this._bindIndexBufferWithCache(t)},r.prototype.unbindInstanceAttributes=function(){for(var e,t=0,i=this._currentInstanceLocations.length;t<i;t++){var n=this._currentInstanceBuffers[t];e!=n&&n.references&&(e=n,this.bindArrayBuffer(n));var s=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(s,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},r.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},r.prototype._releaseBuffer=function(e){return e.references--,e.references===0?(this._deleteBuffer(e),!0):!1},r.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},r.prototype.updateAndBindInstancesBuffer=function(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),i[0].index!==void 0)this.bindInstancesBuffer(e,i,!0);else for(var n=0;n<4;n++){var s=i[n];this._vertexAttribArraysEnabled[s]||(this._gl.enableVertexAttribArray(s),this._vertexAttribArraysEnabled[s]=!0),this._vertexAttribPointer(e,s,4,this._gl.FLOAT,!1,64,n*16),this._gl.vertexAttribDivisor(s,1),this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(e)}},r.prototype.bindInstancesBuffer=function(e,t,i){i===void 0&&(i=!0),this.bindArrayBuffer(e);var n=0;if(i)for(var s=0;s<t.length;s++){var o=t[s];n+=o.attributeSize*4}for(var s=0;s<t.length;s++){var o=t[s];o.index===void 0&&(o.index=this._currentEffect.getAttributeLocationByName(o.attributeName)),!(o.index<0)&&(this._vertexAttribArraysEnabled[o.index]||(this._gl.enableVertexAttribArray(o.index),this._vertexAttribArraysEnabled[o.index]=!0),this._vertexAttribPointer(e,o.index,o.attributeSize,o.attributeType||this._gl.FLOAT,o.normalized||!1,n,o.offset),this._gl.vertexAttribDivisor(o.index,o.divisor===void 0?1:o.divisor),this._currentInstanceLocations.push(o.index),this._currentInstanceBuffers.push(e))}},r.prototype.disableInstanceAttributeByName=function(e){if(!!this._currentEffect){var t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}},r.prototype.disableInstanceAttribute=function(e){for(var t=!1,i;(i=this._currentInstanceLocations.indexOf(e))!==-1;)this._currentInstanceLocations.splice(i,1),this._currentInstanceBuffers.splice(i,1),t=!0,i=this._currentInstanceLocations.indexOf(e);t&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},r.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},r.prototype.draw=function(e,t,i,n){this.drawElementsType(e?0:1,t,i,n)},r.prototype.drawPointClouds=function(e,t,i){this.drawArraysType(2,e,t,i)},r.prototype.drawUnIndexed=function(e,t,i,n){this.drawArraysType(e?0:1,t,i,n)},r.prototype.drawElementsType=function(e,t,i,n){this.applyStates(),this._reportDrawCall();var s=this._drawMode(e),o=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,a=this._uintIndicesCurrentlySet?4:2;n?this._gl.drawElementsInstanced(s,i,o,t*a,n):this._gl.drawElements(s,i,o,t*a)},r.prototype.drawArraysType=function(e,t,i,n){this.applyStates(),this._reportDrawCall();var s=this._drawMode(e);n?this._gl.drawArraysInstanced(s,t,i,n):this._gl.drawArrays(s,t,i)},r.prototype._drawMode=function(e){switch(e){case 0:return this._gl.TRIANGLES;case 2:return this._gl.POINTS;case 1:return this._gl.LINES;case 3:return this._gl.POINTS;case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},r.prototype._reportDrawCall=function(){},r.prototype._releaseEffect=function(e){if(this._compiledEffects[e._key]){delete this._compiledEffects[e._key];var t=e.getPipelineContext();t&&this._deletePipelineContext(t)}},r.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},r.prototype._getGlobalDefines=function(e){if(e){this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER;return}else{var t="";return this.isNDCHalfZRange&&(t+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(t&&(t+=`
`),t+="#define USE_REVERSE_DEPTHBUFFER"),t}},r.prototype.createEffect=function(e,t,i,n,s,o,a,u,h,f){var l;f===void 0&&(f=re.GLSL);var c=e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e,_=e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e,d=this._getGlobalDefines(),g=(l=s!=null?s:t.defines)!==null&&l!==void 0?l:"";d&&(g+=d);var p=c+"+"+_+"@"+g;if(this._compiledEffects[p]){var y=this._compiledEffects[p];return a&&y.isReady()&&a(y),y}var v=new Ge(e,t,i,n,this,s,o,a,u,h,p,f);return this._compiledEffects[p]=v,v},r._ConcatenateShader=function(e,t,i){return i===void 0&&(i=""),i+(t?t+`
`:"")+e},r.prototype._compileShader=function(e,t,i,n){return this._compileRawShader(r._ConcatenateShader(e,i,n),t)},r.prototype._compileRawShader=function(e,t){var i=this._gl,n=i.createShader(t==="vertex"?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!n){for(var s=i.NO_ERROR,o=i.NO_ERROR;(o=i.getError())!==i.NO_ERROR;)s=o;throw new Error("Something went wrong while creating a gl ".concat(t," shader object. gl error=").concat(s,", gl isContextLost=").concat(i.isContextLost(),", _contextWasLost=").concat(this._contextWasLost))}return i.shaderSource(n,e),i.compileShader(n),n},r.prototype._getShaderSource=function(e){return this._gl.getShaderSource(e)},r.prototype.createRawShaderProgram=function(e,t,i,n,s){s===void 0&&(s=null),n=n||this._gl;var o=this._compileRawShader(t,"vertex"),a=this._compileRawShader(i,"fragment");return this._createShaderProgram(e,o,a,n,s)},r.prototype.createShaderProgram=function(e,t,i,n,s,o){o===void 0&&(o=null),s=s||this._gl;var a=this._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",u=this._compileShader(t,"vertex",n,a),h=this._compileShader(i,"fragment",n,a);return this._createShaderProgram(e,u,h,s,o)},r.prototype.inlineShaderCode=function(e){return e},r.prototype.createPipelineContext=function(e){var t=new ri;return t.engine=this,this._caps.parallelShaderCompile&&(t.isParallelCompiled=!0),t},r.prototype.createMaterialContext=function(){},r.prototype.createDrawContext=function(){},r.prototype._createShaderProgram=function(e,t,i,n,s){var o=n.createProgram();if(e.program=o,!o)throw new Error("Unable to create program");return n.attachShader(o,t),n.attachShader(o,i),n.linkProgram(o),e.context=n,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),o},r.prototype._finalizePipelineContext=function(e){var t=e.context,i=e.vertexShader,n=e.fragmentShader,s=e.program,o=t.getProgramParameter(s,t.LINK_STATUS);if(!o){if(!this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)){var a=this._gl.getShaderInfoLog(i);if(a)throw e.vertexCompilationError=a,new Error("VERTEX SHADER "+a)}if(!this._gl.getShaderParameter(n,this._gl.COMPILE_STATUS)){var a=this._gl.getShaderInfoLog(n);if(a)throw e.fragmentCompilationError=a,new Error("FRAGMENT SHADER "+a)}var u=t.getProgramInfoLog(s);if(u)throw e.programLinkError=u,new Error(u)}if(this.validateShaderPrograms){t.validateProgram(s);var h=t.getProgramParameter(s,t.VALIDATE_STATUS);if(!h){var u=t.getProgramInfoLog(s);if(u)throw e.programValidationError=u,new Error(u)}}t.deleteShader(i),t.deleteShader(n),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},r.prototype._preparePipelineContext=function(e,t,i,n,s,o,a,u,h,f){var l=e;n?l.program=this.createRawShaderProgram(l,t,i,void 0,h):l.program=this.createShaderProgram(l,t,i,u,void 0,h),l.program.__SPECTOR_rebuildProgram=a},r.prototype._isRenderingStateCompiled=function(e){var t=e;return this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)?(this._finalizePipelineContext(t),!0):!1},r.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var i=e;if(!i.isParallelCompiled){t();return}var n=i.onCompiled;n?i.onCompiled=function(){n(),t()}:i.onCompiled=t},r.prototype.getUniforms=function(e,t){for(var i=new Array,n=e,s=0;s<t.length;s++)i.push(this._gl.getUniformLocation(n.program,t[s]));return i},r.prototype.getAttributes=function(e,t){for(var i=[],n=e,s=0;s<t.length;s++)try{i.push(this._gl.getAttribLocation(n.program,t[s]))}catch{i.push(-1)}return i},r.prototype.enableEffect=function(e){e=e!==null&&ii.IsWrapper(e)?e.effect:e,!(!e||e===this._currentEffect)&&(this._stencilStateComposer.stencilMaterial=void 0,e=e,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},r.prototype.setInt=function(e,t){return e?(this._gl.uniform1i(e,t),!0):!1},r.prototype.setInt2=function(e,t,i){return e?(this._gl.uniform2i(e,t,i),!0):!1},r.prototype.setInt3=function(e,t,i,n){return e?(this._gl.uniform3i(e,t,i,n),!0):!1},r.prototype.setInt4=function(e,t,i,n,s){return e?(this._gl.uniform4i(e,t,i,n,s),!0):!1},r.prototype.setIntArray=function(e,t){return e?(this._gl.uniform1iv(e,t),!0):!1},r.prototype.setIntArray2=function(e,t){return!e||t.length%2!==0?!1:(this._gl.uniform2iv(e,t),!0)},r.prototype.setIntArray3=function(e,t){return!e||t.length%3!==0?!1:(this._gl.uniform3iv(e,t),!0)},r.prototype.setIntArray4=function(e,t){return!e||t.length%4!==0?!1:(this._gl.uniform4iv(e,t),!0)},r.prototype.setArray=function(e,t){return!e||t.length<1?!1:(this._gl.uniform1fv(e,t),!0)},r.prototype.setArray2=function(e,t){return!e||t.length%2!==0?!1:(this._gl.uniform2fv(e,t),!0)},r.prototype.setArray3=function(e,t){return!e||t.length%3!==0?!1:(this._gl.uniform3fv(e,t),!0)},r.prototype.setArray4=function(e,t){return!e||t.length%4!==0?!1:(this._gl.uniform4fv(e,t),!0)},r.prototype.setMatrices=function(e,t){return e?(this._gl.uniformMatrix4fv(e,!1,t),!0):!1},r.prototype.setMatrix3x3=function(e,t){return e?(this._gl.uniformMatrix3fv(e,!1,t),!0):!1},r.prototype.setMatrix2x2=function(e,t){return e?(this._gl.uniformMatrix2fv(e,!1,t),!0):!1},r.prototype.setFloat=function(e,t){return e?(this._gl.uniform1f(e,t),!0):!1},r.prototype.setFloat2=function(e,t,i){return e?(this._gl.uniform2f(e,t,i),!0):!1},r.prototype.setFloat3=function(e,t,i,n){return e?(this._gl.uniform3f(e,t,i,n),!0):!1},r.prototype.setFloat4=function(e,t,i,n,s){return e?(this._gl.uniform4f(e,t,i,n,s),!0):!1},r.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var e=this._colorWrite;this._gl.colorMask(e,e,e,e)}},r.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},r.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(r.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilStateComposer",{get:function(){return this._stencilStateComposer},enumerable:!1,configurable:!0}),r.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},r.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},r.prototype._getSamplingParameters=function(e,t){var i=this._gl,n=i.NEAREST,s=i.NEAREST;switch(e){case 11:n=i.LINEAR,t?s=i.LINEAR_MIPMAP_NEAREST:s=i.LINEAR;break;case 3:n=i.LINEAR,t?s=i.LINEAR_MIPMAP_LINEAR:s=i.LINEAR;break;case 8:n=i.NEAREST,t?s=i.NEAREST_MIPMAP_LINEAR:s=i.NEAREST;break;case 4:n=i.NEAREST,t?s=i.NEAREST_MIPMAP_NEAREST:s=i.NEAREST;break;case 5:n=i.NEAREST,t?s=i.LINEAR_MIPMAP_NEAREST:s=i.LINEAR;break;case 6:n=i.NEAREST,t?s=i.LINEAR_MIPMAP_LINEAR:s=i.LINEAR;break;case 7:n=i.NEAREST,s=i.LINEAR;break;case 1:n=i.NEAREST,s=i.NEAREST;break;case 9:n=i.LINEAR,t?s=i.NEAREST_MIPMAP_NEAREST:s=i.NEAREST;break;case 10:n=i.LINEAR,t?s=i.NEAREST_MIPMAP_LINEAR:s=i.NEAREST;break;case 2:n=i.LINEAR,s=i.LINEAR;break;case 12:n=i.LINEAR,s=i.NEAREST;break}return{min:s,mag:n}},r.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},r.prototype._createHardwareTexture=function(){return new rr(this._createTexture(),this._gl)},r.prototype._createInternalTexture=function(e,t,i,n){n===void 0&&(n=ie.Unknown);var s={};t!==void 0&&typeof t=="object"?(s.generateMipMaps=t.generateMipMaps,s.type=t.type===void 0?0:t.type,s.samplingMode=t.samplingMode===void 0?3:t.samplingMode,s.format=t.format===void 0?5:t.format,s.useSRGBBuffer=t.useSRGBBuffer===void 0?!1:t.useSRGBBuffer):(s.generateMipMaps=t,s.type=0,s.samplingMode=3,s.format=5,s.useSRGBBuffer=!1),s.useSRGBBuffer=s.useSRGBBuffer&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU),(s.type===1&&!this._caps.textureFloatLinearFiltering||s.type===2&&!this._caps.textureHalfFloatLinearFiltering)&&(s.samplingMode=1),s.type===1&&!this._caps.textureFloat&&(s.type=0,D.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));var o=this._gl,a=new tt(this,n);a._useSRGBBuffer=!!s.useSRGBBuffer;var u=e.width||e,h=e.height||e,f=e.layers||0,l=this._getSamplingParameters(s.samplingMode,!!s.generateMipMaps),c=f!==0?o.TEXTURE_2D_ARRAY:o.TEXTURE_2D,_=this._getRGBABufferInternalSizedFormat(s.type,s.format,s.useSRGBBuffer),d=this._getInternalFormat(s.format),g=this._getWebGLTextureType(s.type);return this._bindTextureDirectly(c,a),f!==0?(a.is2DArray=!0,o.texImage3D(c,0,_,u,h,f,0,d,g,null)):o.texImage2D(c,0,_,u,h,0,d,g,null),o.texParameteri(c,o.TEXTURE_MAG_FILTER,l.mag),o.texParameteri(c,o.TEXTURE_MIN_FILTER,l.min),o.texParameteri(c,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(c,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),s.generateMipMaps&&this._gl.generateMipmap(c),this._bindTextureDirectly(c,null),a.baseWidth=u,a.baseHeight=h,a.width=u,a.height=h,a.depth=f,a.isReady=!0,a.samples=1,a.generateMipMaps=!!s.generateMipMaps,a.samplingMode=s.samplingMode,a.type=s.type,a.format=s.format,this._internalTexturesCache.push(a),a},r.prototype._getUseSRGBBuffer=function(e,t){return e&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||t)},r.prototype._createTextureBase=function(e,t,i,n,s,o,a,u,h,f,l,c,_,d,g,p){var y=this;s===void 0&&(s=3),o===void 0&&(o=null),a===void 0&&(a=null),f===void 0&&(f=null),l===void 0&&(l=null),c===void 0&&(c=null),_===void 0&&(_=null),e=e||"";var v=e.substr(0,5)==="data:",b=e.substr(0,5)==="blob:",C=v&&e.indexOf(";base64,")!==-1,m=l||new tt(this,ie.Url),S=e;this._transformTextureUrl&&!C&&!l&&!f&&(e=this._transformTextureUrl(e)),S!==e&&(m._originalUrl=S);var M=e.lastIndexOf("."),w=_||(M>-1?e.substring(M).toLowerCase():""),x=null,z=w.indexOf("?");z>-1&&(w=w.split("?")[0]);for(var U=0,I=r._TextureLoaders;U<I.length;U++){var H=I[U];if(H.canLoad(w,d)){x=H;break}}n&&n._addPendingData(m),m.url=e,m.generateMipMaps=!t,m.samplingMode=s,m.invertY=i,m._useSRGBBuffer=this._getUseSRGBBuffer(!!p,t),this._doNotHandleContextLost||(m._buffer=f);var R=null;o&&!l&&(R=m.onLoadedObservable.add(o)),l||this._internalTexturesCache.push(m);var j=function(L,Y){n&&n._removePendingData(m),e===S?(R&&m.onLoadedObservable.remove(R),Z.UseFallbackTexture&&y._createTextureBase(Z.FallbackTexture,t,m.invertY,n,s,null,a,u,h,f,m),L=(L||"Unknown error")+(Z.UseFallbackTexture?" - Fallback texture was used":""),m.onErrorObservable.notifyObservers({message:L,exception:Y}),a&&a(L,Y)):(D.Warn("Failed to load ".concat(e,", falling back to ").concat(S)),y._createTextureBase(S,t,m.invertY,n,s,o,a,u,h,f,m,c,_,d,g,p))};if(x){var K=function(L){x.loadData(L,m,function(Y,ne,pe,ge,Pe,Qe){Qe?j("TextureLoader failed to load data"):u(m,w,n,{width:Y,height:ne},m.invertY,!pe,ge,function(){return Pe(),!1},s)},g)};f?f instanceof ArrayBuffer?K(new Uint8Array(f)):ArrayBuffer.isView(f)?K(f):a&&a("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(e,function(L){return K(new Uint8Array(L))},void 0,n?n.offlineProvider:void 0,!0,function(L,Y){j("Unable to load "+(L&&L.responseURL,Y))})}else{var J=function(L){b&&!y._doNotHandleContextLost&&(m._buffer=L),u(m,w,n,L,m.invertY,t,!1,h,s)};!v||C?f&&(typeof f.decoding=="string"||f.close)?J(f):r._FileToolsLoadImage(e,J,j,n?n.offlineProvider:null,d,m.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):typeof f=="string"||f instanceof ArrayBuffer||ArrayBuffer.isView(f)||f instanceof Blob?r._FileToolsLoadImage(f,J,j,n?n.offlineProvider:null,d,m.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):f&&J(f)}return m},r.prototype.createTexture=function(e,t,i,n,s,o,a,u,h,f,l,c,_,d,g){var p=this;return s===void 0&&(s=3),o===void 0&&(o=null),a===void 0&&(a=null),u===void 0&&(u=null),h===void 0&&(h=null),f===void 0&&(f=null),l===void 0&&(l=null),this._createTextureBase(e,t,i,n,s,o,a,this._prepareWebGLTexture.bind(this),function(y,v,b,C,m,S){var M=p._gl,w=b.width===y&&b.height===v,x=f?p._getInternalFormat(f,m._useSRGBBuffer):C===".jpg"&&!m._useSRGBBuffer?M.RGB:m._useSRGBBuffer?M.SRGB8_ALPHA8:M.RGBA,z=f?p._getInternalFormat(f):C===".jpg"&&!m._useSRGBBuffer?M.RGB:M.RGBA;if(m._useSRGBBuffer&&p.webGLVersion===1&&(z=x),w)return M.texImage2D(M.TEXTURE_2D,0,x,z,M.UNSIGNED_BYTE,b),!1;var U=p._caps.maxTextureSize;if(b.width>U||b.height>U||!p._supportsHardwareTextureRescaling)return p._prepareWorkingCanvas(),!p._workingCanvas||!p._workingContext||(p._workingCanvas.width=y,p._workingCanvas.height=v,p._workingContext.drawImage(b,0,0,b.width,b.height,0,0,y,v),M.texImage2D(M.TEXTURE_2D,0,x,z,M.UNSIGNED_BYTE,p._workingCanvas),m.width=y,m.height=v),!1;var I=new tt(p,ie.Temp);return p._bindTextureDirectly(M.TEXTURE_2D,I,!0),M.texImage2D(M.TEXTURE_2D,0,x,z,M.UNSIGNED_BYTE,b),p._rescaleTexture(I,m,n,x,function(){p._releaseTexture(I),p._bindTextureDirectly(M.TEXTURE_2D,m,!0),S()}),!0},u,h,f,l,c,_,g)},r._FileToolsLoadImage=function(e,t,i,n,s,o){throw V("FileTools")},r.prototype._rescaleTexture=function(e,t,i,n,s){},r.prototype.createRawTexture=function(e,t,i,n,s,o,a,u,h,f,l){throw V("Engine.RawTexture")},r.prototype.createRawCubeTexture=function(e,t,i,n,s,o,a,u){throw V("Engine.RawTexture")},r.prototype.createRawTexture3D=function(e,t,i,n,s,o,a,u,h,f){throw V("Engine.RawTexture")},r.prototype.createRawTexture2DArray=function(e,t,i,n,s,o,a,u,h,f){throw V("Engine.RawTexture")},r.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},r.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},r.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},r.prototype.updateTextureSamplingMode=function(e,t,i){i===void 0&&(i=!1);var n=this._getTextureTarget(t),s=this._getSamplingParameters(e,t.generateMipMaps||i);this._setTextureParameterInteger(n,this._gl.TEXTURE_MAG_FILTER,s.mag,t),this._setTextureParameterInteger(n,this._gl.TEXTURE_MIN_FILTER,s.min),i&&(t.generateMipMaps=!0,this._gl.generateMipmap(n)),this._bindTextureDirectly(n,null),t.samplingMode=e},r.prototype.updateTextureDimensions=function(e,t,i,n){},r.prototype.updateTextureWrappingMode=function(e,t,i,n){i===void 0&&(i=null),n===void 0&&(n=null);var s=this._getTextureTarget(e);t!==null&&(this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),i!==null&&(this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i),e),e._cachedWrapV=i),(e.is2DArray||e.is3D)&&n!==null&&(this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(n),e),e._cachedWrapR=n),this._bindTextureDirectly(s,null)},r.prototype._setupDepthStencilTexture=function(e,t,i,n,s,o){o===void 0&&(o=1);var a=t.width||t,u=t.height||t,h=t.layers||0;e.baseWidth=a,e.baseHeight=u,e.width=a,e.height=u,e.is2DArray=h>0,e.depth=h,e.isReady=!0,e.samples=o,e.generateMipMaps=!1,e.samplingMode=n?2:1,e.type=0,e._comparisonFunction=s;var f=this._gl,l=this._getTextureTarget(e),c=this._getSamplingParameters(e.samplingMode,!1);f.texParameteri(l,f.TEXTURE_MAG_FILTER,c.mag),f.texParameteri(l,f.TEXTURE_MIN_FILTER,c.min),f.texParameteri(l,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(l,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),this.webGLVersion>1&&(s===0?(f.texParameteri(l,f.TEXTURE_COMPARE_FUNC,515),f.texParameteri(l,f.TEXTURE_COMPARE_MODE,f.NONE)):(f.texParameteri(l,f.TEXTURE_COMPARE_FUNC,s),f.texParameteri(l,f.TEXTURE_COMPARE_MODE,f.COMPARE_REF_TO_TEXTURE)))},r.prototype._uploadCompressedDataToTextureDirectly=function(e,t,i,n,s,o,a){o===void 0&&(o=0),a===void 0&&(a=0);var u=this._gl,h=u.TEXTURE_2D;if(e.isCube&&(h=u.TEXTURE_CUBE_MAP_POSITIVE_X+o),e._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=u.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=u.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case 36492:t=u.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=u.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=u.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=u.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=u.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1;break}this._gl.compressedTexImage2D(h,a,t,i,n,0,s)},r.prototype._uploadDataToTextureDirectly=function(e,t,i,n,s,o){i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=!1);var a=this._gl,u=this._getWebGLTextureType(e.type),h=this._getInternalFormat(e.format),f=s===void 0?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(s,e._useSRGBBuffer);this._unpackFlipY(e.invertY);var l=a.TEXTURE_2D;e.isCube&&(l=a.TEXTURE_CUBE_MAP_POSITIVE_X+i);var c=Math.round(Math.log(e.width)*Math.LOG2E),_=Math.round(Math.log(e.height)*Math.LOG2E),d=o?e.width:Math.pow(2,Math.max(c-n,0)),g=o?e.height:Math.pow(2,Math.max(_-n,0));a.texImage2D(l,n,f,d,g,0,h,u,t)},r.prototype.updateTextureData=function(e,t,i,n,s,o,a,u,h){a===void 0&&(a=0),u===void 0&&(u=0),h===void 0&&(h=!1);var f=this._gl,l=this._getWebGLTextureType(e.type),c=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var _=f.TEXTURE_2D;e.isCube&&(_=f.TEXTURE_CUBE_MAP_POSITIVE_X+a),this._bindTextureDirectly(_,e,!0),f.texSubImage2D(_,u,i,n,s,o,c,l,t),h&&this._gl.generateMipmap(_),this._bindTextureDirectly(_,null)},r.prototype._uploadArrayBufferViewToTexture=function(e,t,i,n){i===void 0&&(i=0),n===void 0&&(n=0);var s=this._gl,o=e.isCube?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D;this._bindTextureDirectly(o,e,!0),this._uploadDataToTextureDirectly(e,t,i,n),this._bindTextureDirectly(o,null,!0)},r.prototype._prepareWebGLTextureContinuation=function(e,t,i,n,s){var o=this._gl;if(!!o){var a=this._getSamplingParameters(s,!i);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,a.mag),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,a.min),!i&&!n&&o.generateMipmap(o.TEXTURE_2D),this._bindTextureDirectly(o.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},r.prototype._prepareWebGLTexture=function(e,t,i,n,s,o,a,u,h){var f=this;h===void 0&&(h=3);var l=this.getCaps().maxTextureSize,c=Math.min(l,this.needPOTTextures?r.GetExponentOfTwo(n.width,l):n.width),_=Math.min(l,this.needPOTTextures?r.GetExponentOfTwo(n.height,l):n.height),d=this._gl;if(!!d){if(!e._hardwareTexture){i&&i._removePendingData(e);return}this._bindTextureDirectly(d.TEXTURE_2D,e,!0),this._unpackFlipY(s===void 0?!0:!!s),e.baseWidth=n.width,e.baseHeight=n.height,e.width=c,e.height=_,e.isReady=!0,!u(c,_,n,t,e,function(){f._prepareWebGLTextureContinuation(e,i,o,a,h)})&&this._prepareWebGLTextureContinuation(e,i,o,a,h)}},r.prototype._setupFramebufferDepthAttachments=function(e,t,i,n,s){s===void 0&&(s=1);var o=this._gl;if(e&&t)return this._createRenderBuffer(i,n,s,o.DEPTH_STENCIL,o.DEPTH24_STENCIL8,o.DEPTH_STENCIL_ATTACHMENT);if(t){var a=o.DEPTH_COMPONENT16;return this._webGLVersion>1&&(a=o.DEPTH_COMPONENT32F),this._createRenderBuffer(i,n,s,a,a,o.DEPTH_ATTACHMENT)}return e?this._createRenderBuffer(i,n,s,o.STENCIL_INDEX8,o.STENCIL_INDEX8,o.STENCIL_ATTACHMENT):null},r.prototype._createRenderBuffer=function(e,t,i,n,s,o,a){a===void 0&&(a=!0);var u=this._gl,h=u.createRenderbuffer();return u.bindRenderbuffer(u.RENDERBUFFER,h),i>1&&u.renderbufferStorageMultisample?u.renderbufferStorageMultisample(u.RENDERBUFFER,i,s,e,t):u.renderbufferStorage(u.RENDERBUFFER,n,e,t),u.framebufferRenderbuffer(u.FRAMEBUFFER,o,u.RENDERBUFFER,h),a&&u.bindRenderbuffer(u.RENDERBUFFER,null),h},r.prototype._releaseTexture=function(e){var t;this._deleteTexture((t=e._hardwareTexture)===null||t===void 0?void 0:t.underlyingResource),this.unbindAllTextures();var i=this._internalTexturesCache.indexOf(e);i!==-1&&this._internalTexturesCache.splice(i,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},r.prototype._releaseRenderTargetWrapper=function(e){var t=this._renderTargetWrapperCache.indexOf(e);t!==-1&&this._renderTargetWrapperCache.splice(t,1)},r.prototype._deleteTexture=function(e){e&&this._gl.deleteTexture(e)},r.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},r.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var i=e.getSamplers(),n=0;n<i.length;n++){var s=e.getUniform(i[n]);s&&(this._boundUniforms[n]=s)}this._currentEffect=null},r.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},r.prototype._bindTextureDirectly=function(e,t,i,n){var s,o;i===void 0&&(i=!1),n===void 0&&(n=!1);var a=!1,u=t&&t._associatedChannel>-1;i&&u&&(this._activeChannel=t._associatedChannel);var h=this._boundTexturesCache[this._activeChannel];if(h!==t||n){if(this._activateCurrentTexture(),t&&t.isMultiview)throw console.error(e,t),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,(o=(s=t==null?void 0:t._hardwareTexture)===null||s===void 0?void 0:s.underlyingResource)!==null&&o!==void 0?o:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else i&&(a=!0,this._activateCurrentTexture());return u&&!i&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),a},r.prototype._bindTexture=function(e,t,i){if(e!==void 0){t&&(t._associatedChannel=e),this._activeChannel=e;var n=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(n,t)}},r.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},r.prototype.setTexture=function(e,t,i,n){e!==void 0&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,i))},r.prototype._bindSamplerUniformToChannel=function(e,t){var i=this._boundUniforms[e];!i||i._currentState===t||(this._gl.uniform1i(i,t),i._currentState=t)},r.prototype._getTextureWrapMode=function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},r.prototype._setTexture=function(e,t,i,n,s){if(i===void 0&&(i=!1),n===void 0&&(n=!1),!t)return this._boundTexturesCache[e]!=null&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(t.delayLoadState===4)return t.delayLoad(),!1;var o;n?o=t.depthStencilTexture:t.isReady()?o=t.getInternalTexture():t.isCube?o=this.emptyCubeTexture:t.is3D?o=this.emptyTexture3D:t.is2DArray?o=this.emptyTexture2DArray:o=this.emptyTexture,!i&&o&&(o._associatedChannel=e);var a=!0;this._boundTexturesCache[e]===o&&(i||this._bindSamplerUniformToChannel(o._associatedChannel,e),a=!1),this._activeChannel=e;var u=this._getTextureTarget(o);if(a&&this._bindTextureDirectly(u,o,i),o&&!o.isMultiview){if(o.isCube&&o._cachedCoordinatesMode!==t.coordinatesMode){o._cachedCoordinatesMode=t.coordinatesMode;var h=t.coordinatesMode!==3&&t.coordinatesMode!==5?1:0;t.wrapU=h,t.wrapV=h}o._cachedWrapU!==t.wrapU&&(o._cachedWrapU=t.wrapU,this._setTextureParameterInteger(u,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),o)),o._cachedWrapV!==t.wrapV&&(o._cachedWrapV=t.wrapV,this._setTextureParameterInteger(u,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),o)),o.is3D&&o._cachedWrapR!==t.wrapR&&(o._cachedWrapR=t.wrapR,this._setTextureParameterInteger(u,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),o)),this._setAnisotropicLevel(u,o,t.anisotropicFilteringLevel)}return!0},r.prototype.setTextureArray=function(e,t,i,n){if(!(e===void 0||!t)){(!this._textureUnits||this._textureUnits.length!==i.length)&&(this._textureUnits=new Int32Array(i.length));for(var s=0;s<i.length;s++){var o=i[s].getInternalTexture();o?(this._textureUnits[s]=e+s,o._associatedChannel=e+s):this._textureUnits[s]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var a=0;a<i.length;a++)this._setTexture(this._textureUnits[a],i[a],!0)}},r.prototype._setAnisotropicLevel=function(e,t,i){var n=this._caps.textureAnisotropicFilterExtension;t.samplingMode!==11&&t.samplingMode!==3&&t.samplingMode!==2&&(i=1),n&&t._cachedAnisotropicFilteringLevel!==i&&(this._setTextureParameterFloat(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=i)},r.prototype._setTextureParameterFloat=function(e,t,i,n){this._bindTextureDirectly(e,n,!0,!0),this._gl.texParameterf(e,t,i)},r.prototype._setTextureParameterInteger=function(e,t,i,n){n&&this._bindTextureDirectly(e,n,!0,!0),this._gl.texParameteri(e,t,i)},r.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e);return}for(var e=0,t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)},r.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},r.prototype.dispose=function(){var e;this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),(e=this.releaseComputeEffects)===null||e===void 0||e.call(this),this.unbindAllAttributes(),this._boundUniforms=[],X()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),window.removeEventListener("resize",this._checkForMobile)),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,Ge.ResetCache();for(var t=0,i=this._activeRequests;t<i.length;t++){var n=i[t];n.abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},r.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},r.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},r.prototype.getError=function(){return this._gl.getError()},r.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},r.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},r.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var i=!0,n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i=i&&o===t.FRAMEBUFFER_COMPLETE,i=i&&t.getError()===t.NO_ERROR,i&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i){t.bindFramebuffer(t.FRAMEBUFFER,null);var a=t.RGBA,u=t.UNSIGNED_BYTE,h=new Uint8Array(4);t.readPixels(0,0,1,1,a,u,h),i=i&&t.getError()===t.NO_ERROR}for(t.deleteTexture(n),t.deleteFramebuffer(s),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i},r.prototype._getWebGLTextureType=function(e){if(this._webGLVersion===1){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},r.prototype._getInternalFormat=function(e,t){t===void 0&&(t=!1);var i=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:i=this._gl.ALPHA;break;case 1:i=this._gl.LUMINANCE;break;case 2:i=this._gl.LUMINANCE_ALPHA;break;case 6:i=this._gl.RED;break;case 7:i=this._gl.RG;break;case 4:i=t?this._gl.SRGB:this._gl.RGB;break;case 5:i=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA;break}if(this._webGLVersion>1)switch(e){case 8:i=this._gl.RED_INTEGER;break;case 9:i=this._gl.RG_INTEGER;break;case 10:i=this._gl.RGB_INTEGER;break;case 11:i=this._gl.RGBA_INTEGER;break}return i},r.prototype._getRGBABufferInternalSizedFormat=function(e,t,i){if(i===void 0&&(i=!1),this._webGLVersion===1){if(t!==void 0)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return i?this._gl.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return i?this._gl.SRGB8:this._gl.RGB8;case 5:return i?this._gl.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;case 11:return this._gl.RGBA16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;case 11:return this._gl.RGBA16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;case 11:return this._gl.RGBA32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;case 11:return this._gl.RGBA32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;case 5:return this._gl.RGBA32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;case 5:return this._gl.RGBA16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return i?this._gl.SRGB8_ALPHA8:this._gl.RGBA8},r.prototype._getRGBAMultiSampleBufferFormat=function(e){return e===1?this._gl.RGBA32F:e===2?this._gl.RGBA16F:this._gl.RGBA8},r.prototype._loadFile=function(e,t,i,n,s,o){var a=this,u=r._FileToolsLoadFile(e,t,i,n,s,o);return this._activeRequests.push(u),u.onCompleteObservable.add(function(h){a._activeRequests.splice(a._activeRequests.indexOf(h),1)}),u},r._FileToolsLoadFile=function(e,t,i,n,s,o){throw V("FileTools")},r.prototype.readPixels=function(e,t,i,n,s,o){s===void 0&&(s=!0),o===void 0&&(o=!0);var a=s?4:3,u=s?this._gl.RGBA:this._gl.RGB,h=new Uint8Array(n*i*a);return o&&this.flushFramebuffer(),this._gl.readPixels(e,t,i,n,u,this._gl.UNSIGNED_BYTE,h),Promise.resolve(h)},Object.defineProperty(r,"IsSupportedAsync",{get:function(){return Promise.resolve(this.isSupported())},enumerable:!1,configurable:!0}),Object.defineProperty(r,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),r.isSupported=function(){if(this._HasMajorPerformanceCaveat!==null)return!this._HasMajorPerformanceCaveat;if(this._IsSupported===null)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=t!=null&&!!window.WebGLRenderingContext}catch{this._IsSupported=!1}return this._IsSupported},Object.defineProperty(r,"HasMajorPerformanceCaveat",{get:function(){if(this._HasMajorPerformanceCaveat===null)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch{this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),r.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e},r.FloorPOT=function(e){return e=e|e>>1,e=e|e>>2,e=e|e>>4,e=e|e>>8,e=e|e>>16,e-(e>>1)},r.NearestPOT=function(e){var t=r.CeilingPOT(e),i=r.FloorPOT(e);return t-e>e-i?i:t},r.GetExponentOfTwo=function(e,t,i){i===void 0&&(i=2);var n;switch(i){case 1:n=r.FloorPOT(e);break;case 2:n=r.NearestPOT(e);break;case 3:default:n=r.CeilingPOT(e);break}return Math.min(n,t)},r.QueueNewFrame=function(e,t){return X()?(t||(t=window),t.requestPostAnimationFrame?t.requestPostAnimationFrame(e):t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):typeof requestAnimationFrame!="undefined"?requestAnimationFrame(e):setTimeout(e,16)},r.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:ot()?document:null},r.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],r._TextureLoaders=[],r.CollisionsEpsilon=.001,r._IsSupported=null,r._HasMajorPerformanceCaveat=null,r}(),ir=function(){function r(){}return r.SetImmediate=function(e){X()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)},r}(),oi=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),wt=function(r){Q(e,r);function e(t,i){var n=r.call(this,t,bt.LoadFileError)||this;return n.name="LoadFileError",Xe._setPrototypeOf(n,e.prototype),i instanceof at?n.request=i:n.file=i,n}return e}(Tt),xt=function(r){Q(e,r);function e(t,i){var n=r.call(this,t,bt.RequestFileError)||this;return n.request=i,n.name="RequestFileError",Xe._setPrototypeOf(n,e.prototype),n}return e}(Tt),ai=function(r){Q(e,r);function e(t,i){var n=r.call(this,t,bt.ReadFileError)||this;return n.file=i,n.name="ReadFileError",Xe._setPrototypeOf(n,e.prototype),n}return e}(Tt),ee={DefaultRetryStrategy:zr.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:function(r){return r}},nr=function(r){return r=r.replace(/#/gm,"%23"),r},Et=function(r,e){if(!(r&&r.indexOf("data:")===0)&&ee.CorsBehavior)if(typeof ee.CorsBehavior=="string"||ee.CorsBehavior instanceof String)e.crossOrigin=ee.CorsBehavior;else{var t=ee.CorsBehavior(r);t&&(e.crossOrigin=t)}},Rt=function(r,e,t,i,n,s){var o;n===void 0&&(n="");var a,u=!1;r instanceof ArrayBuffer||ArrayBuffer.isView(r)?typeof Blob!="undefined"?(a=URL.createObjectURL(new Blob([r],{type:n})),u=!0):a="data:".concat(n,";base64,")+Vr(r):r instanceof Blob?(a=URL.createObjectURL(r),u=!0):(a=nr(r),a=ee.PreprocessUrl(r));var h=Z.LastCreatedEngine,f=function(v){if(t){var b=a||r.toString();t("Error while trying to load image: ".concat(b.indexOf("http")===0||b.length<=128?b:b.slice(0,128)+"..."),v)}};if(typeof Image=="undefined"||((o=h==null?void 0:h._features.forceBitmapOverHTMLImageElement)!==null&&o!==void 0?o:!1))return xe(a,function(v){h.createImageBitmap(new Blob([v],{type:n}),st({premultiplyAlpha:"none"},s)).then(function(b){e(b),u&&URL.revokeObjectURL(a)}).catch(function(b){t&&t("Error while trying to load image: "+r,b)})},void 0,i||void 0,!0,function(v,b){f(b)}),null;var l=new Image;Et(a,l);var c=function(){l.removeEventListener("load",c),l.removeEventListener("error",_),e(l),u&&l.src&&URL.revokeObjectURL(l.src)},_=function(v){l.removeEventListener("load",c),l.removeEventListener("error",_),f(v),u&&l.src&&URL.revokeObjectURL(l.src)};l.addEventListener("load",c),l.addEventListener("error",_);var d=function(){l.src=a},g=function(){i&&i.loadImage(a,l)};if(a.substr(0,5)!=="blob:"&&a.substr(0,5)!=="data:"&&i&&i.enableTexturesOffline)i.open(g,d);else{if(a.indexOf("file:")!==-1){var p=decodeURIComponent(a.substring(5).toLowerCase());if(et.FilesToLoad[p]){try{var y=void 0;try{y=URL.createObjectURL(et.FilesToLoad[p])}catch{y=URL.createObjectURL(et.FilesToLoad[p])}l.src=y,u=!0}catch{l.src=""}return l}}d()}return l},qe=function(r,e,t,i,n){var s=new FileReader,o={onCompleteObservable:new E,abort:function(){return s.abort()}};return s.onloadend=function(){return o.onCompleteObservable.notifyObservers(o)},n&&(s.onerror=function(){n(new ai("Unable to read ".concat(r.name),r))}),s.onload=function(a){e(a.target.result)},t&&(s.onprogress=t),i?s.readAsArrayBuffer(r):s.readAsText(r),o},xe=function(r,e,t,i,n,s,o){if(r.name)return qe(r,e,t,n,s?function(l){s(void 0,l)}:void 0);var a=r;if(a.indexOf("file:")!==-1){var u=decodeURIComponent(a.substring(5).toLowerCase());u.indexOf("./")===0&&(u=u.substring(2));var h=et.FilesToLoad[u];if(h)return qe(h,e,t,n,s?function(l){return s(void 0,new wt(l.message,l.file))}:void 0)}if(Pt(a)){var f={onCompleteObservable:new E,abort:function(){return function(){}}};try{e(n?Ct(a):or(a))}catch(l){s?s(void 0,l):D.Error(l.message||"Failed to parse the Data URL")}return ir.SetImmediate(function(){f.onCompleteObservable.notifyObservers(f)}),f}return At(a,function(l,c){e(l,c?c.responseURL:void 0)},t,i,n,s?function(l){s(l.request,new wt(l.message,l.request))}:void 0,o)},At=function(r,e,t,i,n,s,o){r=nr(r),r=ee.PreprocessUrl(r);var a=ee.BaseUrl+r,u=!1,h={onCompleteObservable:new E,abort:function(){return u=!0}},f=function(){var _=new at,d=null,g,p=function(){!_||(t&&_.removeEventListener("progress",t),g&&_.removeEventListener("readystatechange",g),_.removeEventListener("loadend",y))},y=function(){p(),h.onCompleteObservable.notifyObservers(h),h.onCompleteObservable.clear(),t=void 0,g=null,y=null,s=void 0,o=void 0,e=void 0};h.abort=function(){u=!0,y&&y(),_&&_.readyState!==(XMLHttpRequest.DONE||4)&&_.abort(),d!==null&&(clearTimeout(d),d=null),_=null};var v=function(C){var m=C.message||"Unknown error";s&&_?s(new xt(m,_)):D.Error(m)},b=function(C){if(!!_){if(_.open("GET",a),o)try{o(_)}catch(m){v(m);return}n&&(_.responseType="arraybuffer"),t&&_.addEventListener("progress",t),y&&_.addEventListener("loadend",y),g=function(){if(!(u||!_)&&_.readyState===(XMLHttpRequest.DONE||4)){if(g&&_.removeEventListener("readystatechange",g),_.status>=200&&_.status<300||_.status===0&&(!X()||sr())){try{e&&e(n?_.response:_.responseText,_)}catch(w){v(w)}return}var m=ee.DefaultRetryStrategy;if(m){var S=m(a,_,C);if(S!==-1){p(),_=new at,d=setTimeout(function(){return b(C+1)},S);return}}var M=new xt("Error status: "+_.status+" "+_.statusText+" - Unable to load "+a,_);s&&s(M)}},_.addEventListener("readystatechange",g),_.send()}};b(0)};if(i&&i.enableSceneOffline){var l=function(_){_&&_.status>400?s&&s(_):f()},c=function(){i&&i.loadFile(ee.BaseUrl+r,function(_){!u&&e&&e(_),h.onCompleteObservable.notifyObservers(h)},t?function(_){!u&&t&&t(_)}:void 0,l,n)};i.open(c,l)}else f();return h},sr=function(){return typeof location!="undefined"&&location.protocol==="file:"},Pt=function(r){return oi.test(r)};function Ct(r){return Wr(r.split(",")[1])}var or=function(r){return er(r.split(",")[1])},ui=function(){$._FileToolsLoadImage=Rt,$._FileToolsLoadFile=xe,He._FileToolsLoadFile=xe};ui();var ze,hi=function(r,e,t,i,n,s,o,a,u,h){ze={DecodeBase64UrlToBinary:r,DecodeBase64UrlToString:e,DefaultRetryStrategy:t.DefaultRetryStrategy,BaseUrl:t.BaseUrl,CorsBehavior:t.CorsBehavior,PreprocessUrl:t.PreprocessUrl,IsBase64DataUrl:i,IsFileURL:n,LoadFile:s,LoadImage:o,ReadFile:a,RequestFile:u,SetCorsBehavior:h},Object.defineProperty(ze,"DefaultRetryStrategy",{get:function(){return t.DefaultRetryStrategy},set:function(f){t.DefaultRetryStrategy=f}}),Object.defineProperty(ze,"BaseUrl",{get:function(){return t.BaseUrl},set:function(f){t.BaseUrl=f}}),Object.defineProperty(ze,"PreprocessUrl",{get:function(){return t.PreprocessUrl},set:function(f){t.PreprocessUrl=f}}),Object.defineProperty(ze,"CorsBehavior",{get:function(){return t.CorsBehavior},set:function(f){t.CorsBehavior=f}})};hi(Ct,or,ee,Pt,sr,xe,Rt,qe,At,Et);var ar={};function ke(r,e){ar[r]=e}function fi(r){return ar[r]}var _t=function(){function r(){}return r.Instantiate=function(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];var t=fi(e);if(t)return t;D.Warn(e+" not found, you may have missed an import.");for(var i=e.split("."),n=window||this,s=0,o=i.length;s<o;s++)n=n[i[s]];return typeof n!="function"?null:n},r.RegisteredExternalClasses={},r}();function li(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var e=Math.random()*16|0,t=r==="x"?e:e&3|8;return t.toString(16)})}var le=function(){function r(){}return Object.defineProperty(r,"BaseUrl",{get:function(){return ee.BaseUrl},set:function(e){ee.BaseUrl=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"DefaultRetryStrategy",{get:function(){return ee.DefaultRetryStrategy},set:function(e){ee.DefaultRetryStrategy=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"CorsBehavior",{get:function(){return ee.CorsBehavior},set:function(e){ee.CorsBehavior=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"UseFallbackTexture",{get:function(){return Z.UseFallbackTexture},set:function(e){Z.UseFallbackTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"RegisteredExternalClasses",{get:function(){return _t.RegisteredExternalClasses},set:function(e){_t.RegisteredExternalClasses=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"fallbackTexture",{get:function(){return Z.FallbackTexture},set:function(e){Z.FallbackTexture=e},enumerable:!1,configurable:!0}),r.FetchToRef=function(e,t,i,n,s,o){var a=Math.abs(e)*i%i|0,u=Math.abs(t)*n%n|0,h=(a+u*i)*4;o.r=s[h]/255,o.g=s[h+1]/255,o.b=s[h+2]/255,o.a=s[h+3]/255},r.Mix=function(e,t,i){return e*(1-i)+t*i},r.Instantiate=function(e){return _t.Instantiate(e)},r.SetImmediate=function(e){ir.SetImmediate(e)},r.IsExponentOfTwo=function(e){var t=1;do t*=2;while(t<e);return t===e},r.FloatRound=function(e){return Math.fround?Math.fround(e):(r._TmpFloatArray[0]=e,r._TmpFloatArray[0])},r.GetFilename=function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},r.GetFolderPath=function(e,t){t===void 0&&(t=!1);var i=e.lastIndexOf("/");return i<0?t?e:"":e.substring(0,i+1)},r.ToDegrees=function(e){return e*180/Math.PI},r.ToRadians=function(e){return e*Math.PI/180},r.MakeArray=function(e,t){return t!==!0&&(e===void 0||e==null)?null:Array.isArray(e)?e:[e]},r.GetPointerPrefix=function(e){var t="pointer";return X()&&!window.PointerEvent&&(t="mouse"),e._badDesktopOS&&!e._badOS&&!(document&&"ontouchend"in document)&&(t="mouse"),t},r.SetCorsBehavior=function(e,t){Et(e,t)},r.SetReferrerPolicyBehavior=function(e,t){t.referrerPolicy=e},r.CleanUrl=function(e){return e=e.replace(/#/gm,"%23"),e},Object.defineProperty(r,"PreprocessUrl",{get:function(){return ee.PreprocessUrl},set:function(e){ee.PreprocessUrl=e},enumerable:!1,configurable:!0}),r.LoadImage=function(e,t,i,n,s,o){return Rt(e,t,i,n,s,o)},r.LoadFile=function(e,t,i,n,s,o){return xe(e,t,i,n,s,o)},r.LoadFileAsync=function(e,t){return t===void 0&&(t=!0),new Promise(function(i,n){xe(e,function(s){i(s)},void 0,void 0,t,function(s,o){n(o)})})},r.LoadScript=function(e,t,i,n){if(!!X()){var s=document.getElementsByTagName("head")[0],o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",e),n&&(o.id=n),o.onload=function(){t&&t()},o.onerror=function(a){i&&i("Unable to load script '".concat(e,"'"),a)},s.appendChild(o)}},r.LoadScriptAsync=function(e){var t=this;return new Promise(function(i,n){t.LoadScript(e,function(){i()},function(s,o){n(o)})})},r.ReadFileAsDataURL=function(e,t,i){var n=new FileReader,s={onCompleteObservable:new E,abort:function(){return n.abort()}};return n.onloadend=function(){s.onCompleteObservable.notifyObservers(s)},n.onload=function(o){t(o.target.result)},n.onprogress=i,n.readAsDataURL(e),s},r.ReadFile=function(e,t,i,n,s){return qe(e,t,i,n,s)},r.FileAsURL=function(e){var t=new Blob([e]),i=window.URL||window.webkitURL,n=i.createObjectURL(t);return n},r.Format=function(e,t){return t===void 0&&(t=2),e.toFixed(t)},r.DeepCopy=function(e,t,i,n){kr.DeepCopy(e,t,i,n)},r.IsEmpty=function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},r.RegisterTopRootEvents=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];e.addEventListener(n.name,n.handler,!1);try{window.parent&&window.parent.addEventListener(n.name,n.handler,!1)}catch{}}},r.UnregisterTopRootEvents=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];e.removeEventListener(n.name,n.handler);try{e.parent&&e.parent.removeEventListener(n.name,n.handler)}catch{}}},r.DumpFramebuffer=function(e,t,i,n,s,o){return s===void 0&&(s="image/png"),Qt(this,void 0,void 0,function(){var a,u;return Jt(this,function(h){switch(h.label){case 0:return[4,i.readPixels(0,0,e,t)];case 1:return a=h.sent(),u=new Uint8Array(a.buffer),r.DumpData(e,t,u,n,s,o,!0),[2]}})})},r.DumpData=function(e,t,i,n,s,o,a,u,h){s===void 0&&(s="image/png"),a===void 0&&(a=!1),u===void 0&&(u=!1),r._ScreenshotCanvas||(r._ScreenshotCanvas=document.createElement("canvas")),r._ScreenshotCanvas.width=e,r._ScreenshotCanvas.height=t;var f=r._ScreenshotCanvas.getContext("2d");if(f){if(i instanceof Float32Array){for(var l=new Uint8Array(i.length),c=i.length;c--;){var _=i[c];l[c]=_<0?0:_>1?1:Math.round(_*255)}i=l}var d=f.createImageData(e,t),g=d.data;g.set(i),f.putImageData(d,0,0);var p=r._ScreenshotCanvas;if(a){var y=document.createElement("canvas");y.width=e,y.height=t;var v=y.getContext("2d");if(!v)return;v.translate(0,t),v.scale(1,-1),v.drawImage(r._ScreenshotCanvas,0,0),p=y}u?r.ToBlob(p,function(b){var C=new FileReader;C.onload=function(m){var S=m.target.result;n&&n(S)},C.readAsArrayBuffer(b)},s,h):r.EncodeScreenshotCanvasData(n,s,o,p,h)}},r.DumpDataAsync=function(e,t,i,n,s,o,a,u){return n===void 0&&(n="image/png"),o===void 0&&(o=!1),a===void 0&&(a=!1),new Promise(function(h){r.DumpData(e,t,i,function(f){return h(f)},n,s,o,a,u)})},r.ToBlob=function(e,t,i,n){i===void 0&&(i="image/png"),e.toBlob||(e.toBlob=function(s,o,a){var u=this;setTimeout(function(){for(var h=atob(u.toDataURL(o,a).split(",")[1]),f=h.length,l=new Uint8Array(f),c=0;c<f;c++)l[c]=h.charCodeAt(c);s(new Blob([l]))})}),e.toBlob(function(s){t(s)},i,n)},r.DownloadBlob=function(e,t){if("download"in document.createElement("a")){if(!t){var i=new Date,n=(i.getFullYear()+"-"+(i.getMonth()+1)).slice(2)+"-"+i.getDate()+"_"+i.getHours()+"-"+("0"+i.getMinutes()).slice(-2);t="screenshot_"+n+".png"}r.Download(e,t)}else if(e){var s=URL.createObjectURL(e),o=window.open("");if(!o)return;var a=o.document.createElement("img");a.onload=function(){URL.revokeObjectURL(s)},a.src=s,o.document.body.appendChild(a)}},r.EncodeScreenshotCanvasData=function(e,t,i,n,s){if(t===void 0&&(t="image/png"),e){var o=(n!=null?n:r._ScreenshotCanvas).toDataURL(t,s);e(o)}else this.ToBlob(n!=null?n:r._ScreenshotCanvas,function(a){a&&r.DownloadBlob(a,i)},t,s)},r.Download=function(e,t){if(navigator&&navigator.msSaveBlob){navigator.msSaveBlob(e,t);return}var i=window.URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=i,n.download=t,n.addEventListener("click",function(){n.parentElement&&n.parentElement.removeChild(n)}),n.click(),window.URL.revokeObjectURL(i)},r.BackCompatCameraNoPreventDefault=function(e){return typeof e[0]=="boolean"?e[0]:typeof e[1]=="boolean"?e[1]:!1},r.CreateScreenshot=function(e,t,i,n,s){throw V("ScreenshotTools")},r.CreateScreenshotAsync=function(e,t,i,n){throw V("ScreenshotTools")},r.CreateScreenshotUsingRenderTarget=function(e,t,i,n,s,o,a,u){throw V("ScreenshotTools")},r.CreateScreenshotUsingRenderTargetAsync=function(e,t,i,n,s,o,a){throw V("ScreenshotTools")},r.RandomId=function(){return li()},r.IsBase64=function(e){return Pt(e)},r.DecodeBase64=function(e){return Ct(e)},Object.defineProperty(r,"errorsCount",{get:function(){return D.errorsCount},enumerable:!1,configurable:!0}),r.Log=function(e){D.Log(e)},r.Warn=function(e){D.Warn(e)},r.Error=function(e){D.Error(e)},Object.defineProperty(r,"LogCache",{get:function(){return D.LogCache},enumerable:!1,configurable:!0}),r.ClearLogCache=function(){D.ClearLogCache()},Object.defineProperty(r,"LogLevels",{set:function(e){D.LogLevels=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"PerformanceLogLevel",{set:function(e){if((e&r.PerformanceUserMarkLogLevel)===r.PerformanceUserMarkLogLevel){r.StartPerformanceCounter=r._StartUserMark,r.EndPerformanceCounter=r._EndUserMark;return}if((e&r.PerformanceConsoleLogLevel)===r.PerformanceConsoleLogLevel){r.StartPerformanceCounter=r._StartPerformanceConsole,r.EndPerformanceCounter=r._EndPerformanceConsole;return}r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,r.EndPerformanceCounter=r._EndPerformanceCounterDisabled},enumerable:!1,configurable:!0}),r._StartPerformanceCounterDisabled=function(e,t){},r._EndPerformanceCounterDisabled=function(e,t){},r._StartUserMark=function(e,t){if(t===void 0&&(t=!0),!r._Performance){if(!X())return;r._Performance=window.performance}!t||!r._Performance.mark||r._Performance.mark(e+"-Begin")},r._EndUserMark=function(e,t){t===void 0&&(t=!0),!(!t||!r._Performance.mark)&&(r._Performance.mark(e+"-End"),r._Performance.measure(e,e+"-Begin",e+"-End"))},r._StartPerformanceConsole=function(e,t){t===void 0&&(t=!0),t&&(r._StartUserMark(e,t),console.time&&console.time(e))},r._EndPerformanceConsole=function(e,t){t===void 0&&(t=!0),t&&(r._EndUserMark(e,t),console.timeEnd(e))},Object.defineProperty(r,"Now",{get:function(){return we.Now},enumerable:!1,configurable:!0}),r.GetClassName=function(e,t){t===void 0&&(t=!1);var i=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){var n=t?e:Object.getPrototypeOf(e);i=n.constructor.__bjsclassName__}i||(i=typeof e)}return i},r.First=function(e,t){for(var i=0,n=e;i<n.length;i++){var s=n[i];if(t(s))return s}return null},r.getFullClassName=function(e,t){t===void 0&&(t=!1);var i=null,n=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){var s=t?e:Object.getPrototypeOf(e);i=s.constructor.__bjsclassName__,n=s.constructor.__bjsmoduleName__}i||(i=typeof e)}return i?(n!=null?n+".":"")+i:null},r.DelayAsync=function(e){return new Promise(function(t){setTimeout(function(){t()},e)})},r.IsSafari=function(){return $t()?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1},r.UseCustomRequestHeaders=!1,r.CustomRequestHeaders=at.CustomRequestHeaders,r._TmpFloatArray=new Float32Array(1),r.GetDOMTextContent=mt,r.GetAbsoluteUrl=typeof document=="object"?function(e){var t=document.createElement("a");return t.href=e,t.href}:typeof URL=="function"&&typeof location=="object"?function(e){return new URL(e,location.origin).href}:function(){throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},r.NoneLogLevel=D.NoneLogLevel,r.MessageLogLevel=D.MessageLogLevel,r.WarningLogLevel=D.WarningLogLevel,r.ErrorLogLevel=D.ErrorLogLevel,r.AllLogLevel=D.AllLogLevel,r.IsWindowObjectExist=X,r.PerformanceNoneLogLevel=0,r.PerformanceUserMarkLogLevel=1,r.PerformanceConsoleLogLevel=2,r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,r.EndPerformanceCounter=r._EndPerformanceCounterDisabled,r}(),Ki=function(){function r(e,t,i,n){n===void 0&&(n=0),this.iterations=e,this.index=n-1,this._done=!1,this._fn=t,this._successCallback=i}return r.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},r.prototype.breakLoop=function(){this._done=!0,this._successCallback()},r.Run=function(e,t,i,n){n===void 0&&(n=0);var s=new r(e,t,i,n);return s.executeNext(),s},r.SyncAsyncForLoop=function(e,t,i,n,s,o){return o===void 0&&(o=0),r.Run(Math.ceil(e/t),function(a){s&&s()?a.breakLoop():setTimeout(function(){for(var u=0;u<t;++u){var h=a.index*t+u;if(h>=e)break;if(i(h),s&&s()){a.breakLoop();break}}a.executeNext()},o)},n)},r}();Z.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z";var B=function(){function r(){}return r.WithinEpsilon=function(e,t,i){return i===void 0&&(i=1401298e-51),Math.abs(e-t)<=i},r.ToHex=function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()},r.Sign=function(e){return e=+e,e===0||isNaN(e)?e:e>0?1:-1},r.Clamp=function(e,t,i){return t===void 0&&(t=0),i===void 0&&(i=1),Math.min(i,Math.max(t,e))},r.Log2=function(e){return Math.log(e)*Math.LOG2E},r.ILog2=function(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(e===0)return-1/0;var t=0;if(e<1){for(;e<1;)t++,e=e*2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t},r.Repeat=function(e,t){return e-Math.floor(e/t)*t},r.Normalize=function(e,t,i){return(e-t)/(i-t)},r.Denormalize=function(e,t,i){return e*(i-t)+t},r.DeltaAngle=function(e,t){var i=r.Repeat(t-e,360);return i>180&&(i-=360),i},r.PingPong=function(e,t){var i=r.Repeat(e,t*2);return t-Math.abs(i-t)},r.SmoothStep=function(e,t,i){var n=r.Clamp(i);return n=-2*n*n*n+3*n*n,t*n+e*(1-n)},r.MoveTowards=function(e,t,i){var n=0;return Math.abs(t-e)<=i?n=t:n=e+r.Sign(t-e)*i,n},r.MoveTowardsAngle=function(e,t,i){var n=r.DeltaAngle(e,t),s=0;return-i<n&&n<i?s=t:(t=e+n,s=r.MoveTowards(e,t,i)),s},r.Lerp=function(e,t,i){return e+(t-e)*i},r.LerpAngle=function(e,t,i){var n=r.Repeat(t-e,360);return n>180&&(n-=360),e+n*r.Clamp(i)},r.InverseLerp=function(e,t,i){var n=0;return e!=t?n=r.Clamp((i-e)/(t-e)):n=0,n},r.Hermite=function(e,t,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,f=a-2*o+s,l=a-o;return e*u+i*h+t*f+n*l},r.Hermite1stDerivative=function(e,t,i,n,s){var o=s*s;return(o-s)*6*e+(3*o-4*s+1)*t+(-o+s)*6*i+(3*o-2*s)*n},r.RandomRange=function(e,t){return e===t?e:Math.random()*(t-e)+e},r.RangeToPercent=function(e,t,i){return(e-t)/(i-t)},r.PercentToRange=function(e,t,i){return(i-t)*e+t},r.NormalizeRadians=function(e){return e-=r.TwoPi*Math.floor((e+Math.PI)/r.TwoPi),e},r.HCF=function(e,t){var i=e%t;return i===0?t:r.HCF(t,i)},r.TwoPi=Math.PI*2,r}(),Le=1/2.2,Ue=2.2,se=.001,me=function(){function r(){}return r.BuildArray=function(e,t){for(var i=[],n=0;n<e;++n)i.push(t());return i},r.BuildTuple=function(e,t){return r.BuildArray(e,t)},r}(),he=function(r){return parseInt(r.toString().replace(/\W/g,""))},de=function(){function r(e,t){e===void 0&&(e=0),t===void 0&&(t=0),this.x=e,this.y=t}return r.prototype.toString=function(){return"{X: ".concat(this.x," Y: ").concat(this.y,"}")},r.prototype.getClassName=function(){return"Vector2"},r.prototype.getHashCode=function(){var e=he(this.x),t=he(this.y),i=e;return i=i*397^t,i},r.prototype.toArray=function(e,t){return t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,this},r.prototype.fromArray=function(e,t){return t===void 0&&(t=0),r.FromArrayToRef(e,t,this),this},r.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},r.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},r.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},r.prototype.set=function(e,t){return this.copyFromFloats(e,t)},r.prototype.add=function(e){return new r(this.x+e.x,this.y+e.y)},r.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,this},r.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this},r.prototype.addVector3=function(e){return new r(this.x+e.x,this.y+e.y)},r.prototype.subtract=function(e){return new r(this.x-e.x,this.y-e.y)},r.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,this},r.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},r.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},r.prototype.multiply=function(e){return new r(this.x*e.x,this.y*e.y)},r.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},r.prototype.multiplyByFloats=function(e,t){return new r(this.x*e,this.y*t)},r.prototype.divide=function(e){return new r(this.x/e.x,this.y/e.y)},r.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},r.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},r.prototype.negate=function(){return new r(-this.x,-this.y)},r.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},r.prototype.negateToRef=function(e){return e.copyFromFloats(this.x*-1,this.y*-1)},r.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},r.prototype.scale=function(e){var t=new r(0,0);return this.scaleToRef(e,t),t},r.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,this},r.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,this},r.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},r.prototype.equalsWithEpsilon=function(e,t){return t===void 0&&(t=se),e&&B.WithinEpsilon(this.x,e.x,t)&&B.WithinEpsilon(this.y,e.y,t)},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r.prototype.fract=function(){return new r(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},r.prototype.rotateToRef=function(e,t){var i=Math.cos(e),n=Math.sin(e);return t.x=i*this.x-n*this.y,t.y=n*this.x+i*this.y,this},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},r.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},r.prototype.normalize=function(){return r.NormalizeToRef(this,this),this},r.prototype.clone=function(){return new r(this.x,this.y)},r.Zero=function(){return new r(0,0)},r.One=function(){return new r(1,1)},r.FromArray=function(e,t){return t===void 0&&(t=0),new r(e[t],e[t+1])},r.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1]},r.CatmullRom=function(e,t,i,n,s){var o=s*s,a=s*o,u=.5*(2*t.x+(-e.x+i.x)*s+(2*e.x-5*t.x+4*i.x-n.x)*o+(-e.x+3*t.x-3*i.x+n.x)*a),h=.5*(2*t.y+(-e.y+i.y)*s+(2*e.y-5*t.y+4*i.y-n.y)*o+(-e.y+3*t.y-3*i.y+n.y)*a);return new r(u,h)},r.Clamp=function(e,t,i){var n=e.x;n=n>i.x?i.x:n,n=n<t.x?t.x:n;var s=e.y;return s=s>i.y?i.y:s,s=s<t.y?t.y:s,new r(n,s)},r.Hermite=function(e,t,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,f=a-2*o+s,l=a-o,c=e.x*u+i.x*h+t.x*f+n.x*l,_=e.y*u+i.y*h+t.y*f+n.y*l;return new r(c,_)},r.Hermite1stDerivative=function(e,t,i,n,s){var o=r.Zero();return this.Hermite1stDerivativeToRef(e,t,i,n,s,o),o},r.Hermite1stDerivativeToRef=function(e,t,i,n,s,o){var a=s*s;o.x=(a-s)*6*e.x+(3*a-4*s+1)*t.x+(-a+s)*6*i.x+(3*a-2*s)*n.x,o.y=(a-s)*6*e.y+(3*a-4*s+1)*t.y+(-a+s)*6*i.y+(3*a-2*s)*n.y},r.Lerp=function(e,t,i){var n=e.x+(t.x-e.x)*i,s=e.y+(t.y-e.y)*i;return new r(n,s)},r.Dot=function(e,t){return e.x*t.x+e.y*t.y},r.Normalize=function(e){var t=r.Zero();return this.NormalizeToRef(e,t),t},r.NormalizeToRef=function(e,t){var i=e.length();i!==0&&(t.x=e.x/i,t.y=e.y/i)},r.Minimize=function(e,t){var i=e.x<t.x?e.x:t.x,n=e.y<t.y?e.y:t.y;return new r(i,n)},r.Maximize=function(e,t){var i=e.x>t.x?e.x:t.x,n=e.y>t.y?e.y:t.y;return new r(i,n)},r.Transform=function(e,t){var i=r.Zero();return r.TransformToRef(e,t,i),i},r.TransformToRef=function(e,t,i){var n=t.m,s=e.x*n[0]+e.y*n[4]+n[12],o=e.x*n[1]+e.y*n[5]+n[13];i.x=s,i.y=o},r.PointInTriangle=function(e,t,i,n){var s=.5*(-i.y*n.x+t.y*(-i.x+n.x)+t.x*(i.y-n.y)+i.x*n.y),o=s<0?-1:1,a=(t.y*n.x-t.x*n.y+(n.y-t.y)*e.x+(t.x-n.x)*e.y)*o,u=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*o;return a>0&&u>0&&a+u<2*s*o},r.Distance=function(e,t){return Math.sqrt(r.DistanceSquared(e,t))},r.DistanceSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},r.Center=function(e,t){return r.CenterToRef(e,t,r.Zero())},r.CenterToRef=function(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2)},r.DistanceOfPointFromSegment=function(e,t,i){var n=r.DistanceSquared(t,i);if(n===0)return r.Distance(e,t);var s=i.subtract(t),o=Math.max(0,Math.min(1,r.Dot(e.subtract(t),s)/n)),a=t.add(s.multiplyByFloats(o,o));return r.Distance(e,a)},r}(),F=function(){function r(e,t,i){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),this._isDirty=!0,this._x=e,this._y=t,this._z=i}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this._isDirty=!0},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z,"}")},r.prototype.getClassName=function(){return"Vector3"},r.prototype.getHashCode=function(){var e=he(this._x),t=he(this._y),i=he(this._z),n=e;return n=n*397^t,n=n*397^i,n},r.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},r.prototype.toArray=function(e,t){return t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,this},r.prototype.fromArray=function(e,t){return t===void 0&&(t=0),r.FromArrayToRef(e,t,this),this},r.prototype.toQuaternion=function(){return be.RotationYawPitchRoll(this._y,this._x,this._z)},r.prototype.addInPlace=function(e){return this.addInPlaceFromFloats(e._x,e._y,e._z)},r.prototype.addInPlaceFromFloats=function(e,t,i){return this.x+=e,this.y+=t,this.z+=i,this},r.prototype.add=function(e){return new r(this._x+e._x,this._y+e._y,this._z+e._z)},r.prototype.addToRef=function(e,t){return t.copyFromFloats(this._x+e._x,this._y+e._y,this._z+e._z)},r.prototype.subtractInPlace=function(e){return this.x-=e._x,this.y-=e._y,this.z-=e._z,this},r.prototype.subtract=function(e){return new r(this._x-e._x,this._y-e._y,this._z-e._z)},r.prototype.subtractToRef=function(e,t){return this.subtractFromFloatsToRef(e._x,e._y,e._z,t)},r.prototype.subtractFromFloats=function(e,t,i){return new r(this._x-e,this._y-t,this._z-i)},r.prototype.subtractFromFloatsToRef=function(e,t,i,n){return n.copyFromFloats(this._x-e,this._y-t,this._z-i)},r.prototype.negate=function(){return new r(-this._x,-this._y,-this._z)},r.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},r.prototype.negateToRef=function(e){return e.copyFromFloats(this._x*-1,this._y*-1,this._z*-1)},r.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},r.prototype.scale=function(e){return new r(this._x*e,this._y*e,this._z*e)},r.prototype.scaleToRef=function(e,t){return t.copyFromFloats(this._x*e,this._y*e,this._z*e)},r.prototype.applyRotationQuaternionToRef=function(e,t){var i=e.w*this.x+e.y*this.z-e.z*this.y,n=e.w*this.y+e.z*this.x-e.x*this.z,s=e.w*this.z+e.x*this.y-e.y*this.x,o=-e.x*this.x-e.y*this.y-e.z*this.z;return t.x=i*e.w+o*-e.x+n*-e.z-s*-e.y,t.y=n*e.w+o*-e.y+s*-e.x-i*-e.z,t.z=s*e.w+o*-e.z+i*-e.y-n*-e.x,t},r.prototype.applyRotationQuaternionInPlace=function(e){return this.applyRotationQuaternionToRef(e,this)},r.prototype.applyRotationQuaternion=function(e){return this.applyRotationQuaternionToRef(e,r.Zero())},r.prototype.scaleAndAddToRef=function(e,t){return t.addInPlaceFromFloats(this._x*e,this._y*e,this._z*e)},r.prototype.projectOnPlane=function(e,t){var i=r.Zero();return this.projectOnPlaneToRef(e,t,i),i},r.prototype.projectOnPlaneToRef=function(e,t,i){var n=P.Vector3[0];e.normal.scaleToRef(-e.d,n);var s=P.Vector3[1];e.normal.negateToRef(s);var o=this,a=o.x,u=o.y,h=o.z,f=r.Dot(s,this);if(f<=se*se){i.copyFrom(t);return}var l=P.Vector3[2];n.subtractToRef(t,l);var c=r.Dot(l,s)/f;i.set(t.x+a*c,t.y+u*c,t.z+h*c)},r.prototype.equals=function(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z},r.prototype.equalsWithEpsilon=function(e,t){return t===void 0&&(t=se),e&&B.WithinEpsilon(this._x,e._x,t)&&B.WithinEpsilon(this._y,e._y,t)&&B.WithinEpsilon(this._z,e._z,t)},r.prototype.equalsToFloats=function(e,t,i){return this._x===e&&this._y===t&&this._z===i},r.prototype.multiplyInPlace=function(e){return this.x*=e._x,this.y*=e._y,this.z*=e._z,this},r.prototype.multiply=function(e){return this.multiplyByFloats(e._x,e._y,e._z)},r.prototype.multiplyToRef=function(e,t){return t.copyFromFloats(this._x*e._x,this._y*e._y,this._z*e._z)},r.prototype.multiplyByFloats=function(e,t,i){return new r(this._x*e,this._y*t,this._z*i)},r.prototype.divide=function(e){return new r(this._x/e._x,this._y/e._y,this._z/e._z)},r.prototype.divideToRef=function(e,t){return t.copyFromFloats(this._x/e._x,this._y/e._y,this._z/e._z)},r.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},r.prototype.minimizeInPlace=function(e){return this.minimizeInPlaceFromFloats(e._x,e._y,e._z)},r.prototype.maximizeInPlace=function(e){return this.maximizeInPlaceFromFloats(e._x,e._y,e._z)},r.prototype.minimizeInPlaceFromFloats=function(e,t,i){return e<this._x&&(this.x=e),t<this._y&&(this.y=t),i<this._z&&(this.z=i),this},r.prototype.maximizeInPlaceFromFloats=function(e,t,i){return e>this._x&&(this.x=e),t>this._y&&(this.y=t),i>this._z&&(this.z=i),this},r.prototype.isNonUniformWithinEpsilon=function(e){var t=Math.abs(this._x),i=Math.abs(this._y);if(!B.WithinEpsilon(t,i,e))return!0;var n=Math.abs(this._z);return!B.WithinEpsilon(t,n,e)||!B.WithinEpsilon(i,n,e)},Object.defineProperty(r.prototype,"isNonUniform",{get:function(){var e=Math.abs(this._x),t=Math.abs(this._y);if(e!==t)return!0;var i=Math.abs(this._z);return e!==i},enumerable:!1,configurable:!0}),r.prototype.floor=function(){return new r(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},r.prototype.fract=function(){return new r(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))},r.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},r.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},Object.defineProperty(r.prototype,"hasAZeroComponent",{get:function(){return this._x*this._y*this._z===0},enumerable:!1,configurable:!0}),r.prototype.normalize=function(){return this.normalizeFromLength(this.length())},r.prototype.reorderInPlace=function(e){var t=this;return e=e.toLowerCase(),e==="xyz"?this:(P.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(i,n){t[i]=P.Vector3[0][e[n]]}),this)},r.prototype.rotateByQuaternionToRef=function(e,t){return e.toRotationMatrix(P.Matrix[0]),r.TransformCoordinatesToRef(this,P.Matrix[0],t),t},r.prototype.rotateByQuaternionAroundPointToRef=function(e,t,i){return this.subtractToRef(t,P.Vector3[0]),P.Vector3[0].rotateByQuaternionToRef(e,P.Vector3[0]),t.addToRef(P.Vector3[0],i),i},r.prototype.cross=function(e){return r.Cross(this,e)},r.prototype.normalizeFromLength=function(e){return e===0||e===1?this:this.scaleInPlace(1/e)},r.prototype.normalizeToNew=function(){var e=new r(0,0,0);return this.normalizeToRef(e),e},r.prototype.normalizeToRef=function(e){var t=this.length();return t===0||t===1?e.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/t,e)},r.prototype.clone=function(){return new r(this._x,this._y,this._z)},r.prototype.copyFrom=function(e){return this.copyFromFloats(e._x,e._y,e._z)},r.prototype.copyFromFloats=function(e,t,i){return this.x=e,this.y=t,this.z=i,this},r.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},r.prototype.setAll=function(e){return this.x=this.y=this.z=e,this},r.GetClipFactor=function(e,t,i,n){var s=r.Dot(e,i)-n,o=r.Dot(t,i)-n,a=s/(s-o);return a},r.GetAngleBetweenVectors=function(e,t,i){var n=e.normalizeToRef(P.Vector3[1]),s=t.normalizeToRef(P.Vector3[2]),o=r.Dot(n,s);o=B.Clamp(o,-1,1);var a=Math.acos(o),u=P.Vector3[3];return r.CrossToRef(n,s,u),r.Dot(u,i)>0?isNaN(a)?0:a:isNaN(a)?-Math.PI:-Math.acos(o)},r.GetAngleBetweenVectorsOnPlane=function(e,t,i){P.Vector3[0].copyFrom(e);var n=P.Vector3[0];P.Vector3[1].copyFrom(t);var s=P.Vector3[1];P.Vector3[2].copyFrom(i);var o=P.Vector3[2],a=P.Vector3[3],u=P.Vector3[4];n.normalize(),s.normalize(),o.normalize(),r.CrossToRef(o,n,a),r.CrossToRef(a,o,u);var h=Math.atan2(r.Dot(s,a),r.Dot(s,u));return B.NormalizeRadians(h)},r.SlerpToRef=function(e,t,i,n){i=B.Clamp(i,0,1);var s=P.Vector3[0],o=P.Vector3[1];s.copyFrom(e);var a=s.length();s.normalizeFromLength(a),o.copyFrom(t);var u=o.length();o.normalizeFromLength(u);var h=r.Dot(s,o),f,l;if(h<1-se){var c=Math.acos(h),_=1/Math.sin(c);f=Math.sin((1-i)*c)*_,l=Math.sin(i*c)*_}else f=1-i,l=i;s.scaleInPlace(f),o.scaleInPlace(l),n.copyFrom(s).addInPlace(o),n.scaleInPlace(B.Lerp(a,u,i))},r.SmoothToRef=function(e,t,i,n,s){r.SlerpToRef(e,t,n===0?1:i/n,s)},r.FromArray=function(e,t){return t===void 0&&(t=0),new r(e[t],e[t+1],e[t+2])},r.FromFloatArray=function(e,t){return r.FromArray(e,t)},r.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2]},r.FromFloatArrayToRef=function(e,t,i){return r.FromArrayToRef(e,t,i)},r.FromFloatsToRef=function(e,t,i,n){n.copyFromFloats(e,t,i)},r.Zero=function(){return new r(0,0,0)},r.One=function(){return new r(1,1,1)},r.Up=function(){return new r(0,1,0)},Object.defineProperty(r,"UpReadOnly",{get:function(){return r._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(r,"RightReadOnly",{get:function(){return r._RightReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(r,"LeftReadOnly",{get:function(){return r._LeftReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(r,"LeftHandedForwardReadOnly",{get:function(){return r._LeftHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(r,"RightHandedForwardReadOnly",{get:function(){return r._RightHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ZeroReadOnly",{get:function(){return r._ZeroReadOnly},enumerable:!1,configurable:!0}),r.Down=function(){return new r(0,-1,0)},r.Forward=function(e){return e===void 0&&(e=!1),new r(0,0,e?-1:1)},r.Backward=function(e){return e===void 0&&(e=!1),new r(0,0,e?1:-1)},r.Right=function(){return new r(1,0,0)},r.Left=function(){return new r(-1,0,0)},r.TransformCoordinates=function(e,t){var i=r.Zero();return r.TransformCoordinatesToRef(e,t,i),i},r.TransformCoordinatesToRef=function(e,t,i){r.TransformCoordinatesFromFloatsToRef(e._x,e._y,e._z,t,i)},r.TransformCoordinatesFromFloatsToRef=function(e,t,i,n,s){var o=n.m,a=e*o[0]+t*o[4]+i*o[8]+o[12],u=e*o[1]+t*o[5]+i*o[9]+o[13],h=e*o[2]+t*o[6]+i*o[10]+o[14],f=1/(e*o[3]+t*o[7]+i*o[11]+o[15]);s.x=a*f,s.y=u*f,s.z=h*f},r.TransformNormal=function(e,t){var i=r.Zero();return r.TransformNormalToRef(e,t,i),i},r.TransformNormalToRef=function(e,t,i){this.TransformNormalFromFloatsToRef(e._x,e._y,e._z,t,i)},r.TransformNormalFromFloatsToRef=function(e,t,i,n,s){var o=n.m;s.x=e*o[0]+t*o[4]+i*o[8],s.y=e*o[1]+t*o[5]+i*o[9],s.z=e*o[2]+t*o[6]+i*o[10]},r.CatmullRom=function(e,t,i,n,s){var o=s*s,a=s*o,u=.5*(2*t._x+(-e._x+i._x)*s+(2*e._x-5*t._x+4*i._x-n._x)*o+(-e._x+3*t._x-3*i._x+n._x)*a),h=.5*(2*t._y+(-e._y+i._y)*s+(2*e._y-5*t._y+4*i._y-n._y)*o+(-e._y+3*t._y-3*i._y+n._y)*a),f=.5*(2*t._z+(-e._z+i._z)*s+(2*e._z-5*t._z+4*i._z-n._z)*o+(-e._z+3*t._z-3*i._z+n._z)*a);return new r(u,h,f)},r.Clamp=function(e,t,i){var n=new r;return r.ClampToRef(e,t,i,n),n},r.ClampToRef=function(e,t,i,n){var s=e._x;s=s>i._x?i._x:s,s=s<t._x?t._x:s;var o=e._y;o=o>i._y?i._y:o,o=o<t._y?t._y:o;var a=e._z;a=a>i._z?i._z:a,a=a<t._z?t._z:a,n.copyFromFloats(s,o,a)},r.CheckExtends=function(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)},r.Hermite=function(e,t,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,f=a-2*o+s,l=a-o,c=e._x*u+i._x*h+t._x*f+n._x*l,_=e._y*u+i._y*h+t._y*f+n._y*l,d=e._z*u+i._z*h+t._z*f+n._z*l;return new r(c,_,d)},r.Hermite1stDerivative=function(e,t,i,n,s){var o=r.Zero();return this.Hermite1stDerivativeToRef(e,t,i,n,s,o),o},r.Hermite1stDerivativeToRef=function(e,t,i,n,s,o){var a=s*s;o.x=(a-s)*6*e.x+(3*a-4*s+1)*t.x+(-a+s)*6*i.x+(3*a-2*s)*n.x,o.y=(a-s)*6*e.y+(3*a-4*s+1)*t.y+(-a+s)*6*i.y+(3*a-2*s)*n.y,o.z=(a-s)*6*e.z+(3*a-4*s+1)*t.z+(-a+s)*6*i.z+(3*a-2*s)*n.z},r.Lerp=function(e,t,i){var n=new r(0,0,0);return r.LerpToRef(e,t,i,n),n},r.LerpToRef=function(e,t,i,n){n.x=e._x+(t._x-e._x)*i,n.y=e._y+(t._y-e._y)*i,n.z=e._z+(t._z-e._z)*i},r.Dot=function(e,t){return e._x*t._x+e._y*t._y+e._z*t._z},r.Cross=function(e,t){var i=r.Zero();return r.CrossToRef(e,t,i),i},r.CrossToRef=function(e,t,i){var n=e._y*t._z-e._z*t._y,s=e._z*t._x-e._x*t._z,o=e._x*t._y-e._y*t._x;i.copyFromFloats(n,s,o)},r.Normalize=function(e){var t=r.Zero();return r.NormalizeToRef(e,t),t},r.NormalizeToRef=function(e,t){e.normalizeToRef(t)},r.Project=function(e,t,i,n){var s=new r;return r.ProjectToRef(e,t,i,n,s),s},r.ProjectToRef=function(e,t,i,n,s){var o=n.width,a=n.height,u=n.x,h=n.y,f=P.Matrix[1];oe.FromValuesToRef(o/2,0,0,0,0,-a/2,0,0,0,0,.5,0,u+o/2,a/2+h,.5,1,f);var l=P.Matrix[0];return t.multiplyToRef(i,l),l.multiplyToRef(f,l),r.TransformCoordinatesToRef(e,l,s),s},r._UnprojectFromInvertedMatrixToRef=function(e,t,i){r.TransformCoordinatesToRef(e,t,i);var n=t.m,s=e._x*n[3]+e._y*n[7]+e._z*n[11]+n[15];B.WithinEpsilon(s,1)&&i.scaleInPlace(1/s)},r.UnprojectFromTransform=function(e,t,i,n,s){return this.Unproject(e,t,i,n,s,oe.IdentityReadOnly)},r.Unproject=function(e,t,i,n,s,o){var a=r.Zero();return r.UnprojectToRef(e,t,i,n,s,o,a),a},r.UnprojectToRef=function(e,t,i,n,s,o,a){r.UnprojectFloatsToRef(e._x,e._y,e._z,t,i,n,s,o,a)},r.UnprojectFloatsToRef=function(e,t,i,n,s,o,a,u,h){var f,l=P.Matrix[0];o.multiplyToRef(a,l),l.multiplyToRef(u,l),l.invert();var c=P.Vector3[0];c.x=e/n*2-1,c.y=-(t/s*2-1),!((f=Z.LastCreatedEngine)===null||f===void 0)&&f.isNDCHalfZRange?c.z=i:c.z=2*i-1,r._UnprojectFromInvertedMatrixToRef(c,l,h)},r.Minimize=function(e,t){var i=e.clone();return i.minimizeInPlace(t),i},r.Maximize=function(e,t){var i=e.clone();return i.maximizeInPlace(t),i},r.Distance=function(e,t){return Math.sqrt(r.DistanceSquared(e,t))},r.DistanceSquared=function(e,t){var i=e._x-t._x,n=e._y-t._y,s=e._z-t._z;return i*i+n*n+s*s},r.ProjectOnTriangleToRef=function(e,t,i,n,s){var o=P.Vector3[0],a=P.Vector3[1],u=P.Vector3[2],h=P.Vector3[3],f=P.Vector3[4];i.subtractToRef(t,o),n.subtractToRef(t,a),n.subtractToRef(i,u);var l=o.length(),c=a.length(),_=u.length();if(l<se||c<se||_<se)return s.copyFrom(t),r.Distance(e,t);e.subtractToRef(t,f),r.CrossToRef(o,a,h);var d=h.length();if(d<se)return s.copyFrom(t),r.Distance(e,t);h.normalizeFromLength(d);var g=f.length();if(g<se)return s.copyFrom(t),0;f.normalizeFromLength(g);var p=r.Dot(h,f),y=P.Vector3[5],v=P.Vector3[6];y.copyFrom(h).scaleInPlace(-g*p),v.copyFrom(e).addInPlace(y);var b=P.Vector3[4],C=P.Vector3[5],m=P.Vector3[7],S=P.Vector3[8];b.copyFrom(o).scaleInPlace(1/l),S.copyFrom(a).scaleInPlace(1/c),b.addInPlace(S).scaleInPlace(-1),C.copyFrom(o).scaleInPlace(-1/l),S.copyFrom(u).scaleInPlace(1/_),C.addInPlace(S).scaleInPlace(-1),m.copyFrom(u).scaleInPlace(-1/_),S.copyFrom(a).scaleInPlace(-1/c),m.addInPlace(S).scaleInPlace(-1);var M=P.Vector3[9],w;M.copyFrom(v).subtractInPlace(t),r.CrossToRef(b,M,S),w=r.Dot(S,h);var x=w;M.copyFrom(v).subtractInPlace(i),r.CrossToRef(C,M,S),w=r.Dot(S,h);var z=w;M.copyFrom(v).subtractInPlace(n),r.CrossToRef(m,M,S),w=r.Dot(S,h);var U=w,I=P.Vector3[10],H,R;x>0&&z<0?(I.copyFrom(o),H=t,R=i):z>0&&U<0?(I.copyFrom(u),H=i,R=n):(I.copyFrom(a).scaleInPlace(-1),H=n,R=t);var j=P.Vector3[9],K=P.Vector3[4];H.subtractToRef(v,S),R.subtractToRef(v,j),r.CrossToRef(S,j,K);var J=r.Dot(K,h)<0;if(!J)return s.copyFrom(v),Math.abs(g*p);var L=P.Vector3[5];r.CrossToRef(I,K,L),L.normalize();var Y=P.Vector3[9];Y.copyFrom(H).subtractInPlace(v);var ne=Y.length();if(ne<se)return s.copyFrom(H),r.Distance(e,H);Y.normalizeFromLength(ne);var pe=r.Dot(L,Y),ge=P.Vector3[7];ge.copyFrom(v).addInPlace(L.scaleInPlace(ne*pe)),S.copyFrom(ge).subtractInPlace(H),g=I.length(),I.normalizeFromLength(g);var Pe=r.Dot(S,I)/Math.max(g,se);return Pe=B.Clamp(Pe,0,1),ge.copyFrom(H).addInPlace(I.scaleInPlace(Pe*g)),s.copyFrom(ge),r.Distance(e,ge)},r.Center=function(e,t){return r.CenterToRef(e,t,r.Zero())},r.CenterToRef=function(e,t,i){return i.copyFromFloats((e._x+t._x)/2,(e._y+t._y)/2,(e._z+t._z)/2)},r.RotationFromAxis=function(e,t,i){var n=r.Zero();return r.RotationFromAxisToRef(e,t,i,n),n},r.RotationFromAxisToRef=function(e,t,i,n){var s=P.Quaternion[0];be.RotationQuaternionFromAxisToRef(e,t,i,s),s.toEulerAnglesToRef(n)},r._UpReadOnly=r.Up(),r._LeftHandedForwardReadOnly=r.Forward(!1),r._RightHandedForwardReadOnly=r.Forward(!0),r._RightReadOnly=r.Right(),r._LeftReadOnly=r.Left(),r._ZeroReadOnly=r.Zero(),r}(),ft=function(){function r(e,t,i,n){this.x=e,this.y=t,this.z=i,this.w=n}return r.prototype.toString=function(){return"{X: ".concat(this.x," Y: ").concat(this.y," Z: ").concat(this.z," W: ").concat(this.w,"}")},r.prototype.getClassName=function(){return"Vector4"},r.prototype.getHashCode=function(){var e=he(this.x),t=he(this.y),i=he(this.z),n=he(this.w),s=e;return s=s*397^t,s=s*397^i,s=s*397^n,s},r.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},r.prototype.toArray=function(e,t){return t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},r.prototype.fromArray=function(e,t){return t===void 0&&(t=0),r.FromArrayToRef(e,t,this),this},r.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},r.prototype.add=function(e){return new r(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},r.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},r.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},r.prototype.subtract=function(e){return new r(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},r.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},r.prototype.subtractFromFloats=function(e,t,i,n){return new r(this.x-e,this.y-t,this.z-i,this.w-n)},r.prototype.subtractFromFloatsToRef=function(e,t,i,n,s){return s.x=this.x-e,s.y=this.y-t,s.z=this.z-i,s.w=this.w-n,this},r.prototype.negate=function(){return new r(-this.x,-this.y,-this.z,-this.w)},r.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},r.prototype.negateToRef=function(e){return e.copyFromFloats(this.x*-1,this.y*-1,this.z*-1,this.w*-1)},r.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},r.prototype.scale=function(e){return new r(this.x*e,this.y*e,this.z*e,this.w*e)},r.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},r.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},r.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},r.prototype.equalsWithEpsilon=function(e,t){return t===void 0&&(t=se),e&&B.WithinEpsilon(this.x,e.x,t)&&B.WithinEpsilon(this.y,e.y,t)&&B.WithinEpsilon(this.z,e.z,t)&&B.WithinEpsilon(this.w,e.w,t)},r.prototype.equalsToFloats=function(e,t,i,n){return this.x===e&&this.y===t&&this.z===i&&this.w===n},r.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},r.prototype.multiply=function(e){return new r(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)},r.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},r.prototype.multiplyByFloats=function(e,t,i,n){return new r(this.x*e,this.y*t,this.z*i,this.w*n)},r.prototype.divide=function(e){return new r(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)},r.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},r.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},r.prototype.minimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},r.prototype.maximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},r.prototype.fract=function(){return new r(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},r.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},r.prototype.normalize=function(){var e=this.length();return e===0?this:this.scaleInPlace(1/e)},r.prototype.toVector3=function(){return new F(this.x,this.y,this.z)},r.prototype.clone=function(){return new r(this.x,this.y,this.z,this.w)},r.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},r.prototype.copyFromFloats=function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},r.prototype.set=function(e,t,i,n){return this.copyFromFloats(e,t,i,n)},r.prototype.setAll=function(e){return this.x=this.y=this.z=this.w=e,this},r.FromArray=function(e,t){return t||(t=0),new r(e[t],e[t+1],e[t+2],e[t+3])},r.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3]},r.FromFloatArrayToRef=function(e,t,i){r.FromArrayToRef(e,t,i)},r.FromFloatsToRef=function(e,t,i,n,s){s.x=e,s.y=t,s.z=i,s.w=n},r.Zero=function(){return new r(0,0,0,0)},r.One=function(){return new r(1,1,1,1)},r.Normalize=function(e){var t=r.Zero();return r.NormalizeToRef(e,t),t},r.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},r.Minimize=function(e,t){var i=e.clone();return i.minimizeInPlace(t),i},r.Maximize=function(e,t){var i=e.clone();return i.maximizeInPlace(t),i},r.Distance=function(e,t){return Math.sqrt(r.DistanceSquared(e,t))},r.DistanceSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y,s=e.z-t.z,o=e.w-t.w;return i*i+n*n+s*s+o*o},r.Center=function(e,t){return r.CenterToRef(e,t,r.Zero())},r.CenterToRef=function(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2,(e.w+t.w)/2)},r.TransformCoordinates=function(e,t){var i=r.Zero();return r.TransformCoordinatesToRef(e,t,i),i},r.TransformCoordinatesToRef=function(e,t,i){r.TransformCoordinatesFromFloatsToRef(e._x,e._y,e._z,t,i)},r.TransformCoordinatesFromFloatsToRef=function(e,t,i,n,s){var o=n.m,a=e*o[0]+t*o[4]+i*o[8]+o[12],u=e*o[1]+t*o[5]+i*o[9]+o[13],h=e*o[2]+t*o[6]+i*o[10]+o[14],f=e*o[3]+t*o[7]+i*o[11]+o[15];s.x=a,s.y=u,s.z=h,s.w=f},r.TransformNormal=function(e,t){var i=r.Zero();return r.TransformNormalToRef(e,t,i),i},r.TransformNormalToRef=function(e,t,i){var n=t.m,s=e.x*n[0]+e.y*n[4]+e.z*n[8],o=e.x*n[1]+e.y*n[5]+e.z*n[9],a=e.x*n[2]+e.y*n[6]+e.z*n[10];i.x=s,i.y=o,i.z=a,i.w=e.w},r.TransformNormalFromFloatsToRef=function(e,t,i,n,s,o){var a=s.m;o.x=e*a[0]+t*a[4]+i*a[8],o.y=e*a[1]+t*a[5]+i*a[9],o.z=e*a[2]+t*a[6]+i*a[10],o.w=n},r.FromVector3=function(e,t){return t===void 0&&(t=0),new r(e._x,e._y,e._z,t)},r}(),be=function(){function r(e,t,i,n){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),n===void 0&&(n=1),this._isDirty=!0,this._x=e,this._y=t,this._z=i,this._w=n}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"w",{get:function(){return this._w},set:function(e){this._w=e,this._isDirty=!0},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z," W: ").concat(this._w,"}")},r.prototype.getClassName=function(){return"Quaternion"},r.prototype.getHashCode=function(){var e=he(this._x),t=he(this._y),i=he(this._z),n=he(this._w),s=e;return s=s*397^t,s=s*397^i,s=s*397^n,s},r.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},r.prototype.toArray=function(e,t){return t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},r.prototype.equals=function(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z&&this._w===e._w},r.prototype.equalsWithEpsilon=function(e,t){return t===void 0&&(t=se),e&&B.WithinEpsilon(this._x,e._x,t)&&B.WithinEpsilon(this._y,e._y,t)&&B.WithinEpsilon(this._z,e._z,t)&&B.WithinEpsilon(this._w,e._w,t)},r.prototype.clone=function(){return new r(this._x,this._y,this._z,this._w)},r.prototype.copyFrom=function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this.w=e._w,this},r.prototype.copyFromFloats=function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},r.prototype.set=function(e,t,i,n){return this.copyFromFloats(e,t,i,n)},r.prototype.add=function(e){return new r(this._x+e._x,this._y+e._y,this._z+e._z,this._w+e._w)},r.prototype.addInPlace=function(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._w+=e._w,this},r.prototype.subtract=function(e){return new r(this._x-e._x,this._y-e._y,this._z-e._z,this._w-e._w)},r.prototype.subtractInPlace=function(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._w-=e._w,this},r.prototype.scale=function(e){return new r(this._x*e,this._y*e,this._z*e,this._w*e)},r.prototype.scaleToRef=function(e,t){return t.x=this._x*e,t.y=this._y*e,t.z=this._z*e,t.w=this._w*e,this},r.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},r.prototype.scaleAndAddToRef=function(e,t){return t.x+=this._x*e,t.y+=this._y*e,t.z+=this._z*e,t.w+=this._w*e,this},r.prototype.multiply=function(e){var t=new r(0,0,0,1);return this.multiplyToRef(e,t),t},r.prototype.multiplyToRef=function(e,t){var i=this._x*e._w+this._y*e._z-this._z*e._y+this._w*e._x,n=-this._x*e._z+this._y*e._w+this._z*e._x+this._w*e._y,s=this._x*e._y-this._y*e._x+this._z*e._w+this._w*e._z,o=-this._x*e._x-this._y*e._y-this._z*e._z+this._w*e._w;return t.copyFromFloats(i,n,s,o),this},r.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},r.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this._x,-this._y,-this._z,this._w),this},r.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},r.prototype.conjugate=function(){return new r(-this._x,-this._y,-this._z,this._w)},r.prototype.invert=function(){var e=this.conjugate(),t=this.lengthSquared();return t==0||t==1||e.scaleInPlace(1/t),e},r.prototype.invertInPlace=function(){this.conjugateInPlace();var e=this.lengthSquared();return e==0||e==1?this:(this.scaleInPlace(1/e),this)},r.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},r.prototype.length=function(){return Math.sqrt(this.lengthSquared())},r.prototype.normalize=function(){var e=this.length();if(e===0)return this;var t=1/e;return this.scaleInPlace(t),this},r.prototype.normalizeToNew=function(){var e=this.length();if(e===0)return this.clone();var t=1/e;return this.scale(t)},r.prototype.toEulerAngles=function(){var e=F.Zero();return this.toEulerAnglesToRef(e),e},r.prototype.toEulerAnglesToRef=function(e){var t=this._z,i=this._x,n=this._y,s=this._w,o=n*t-i*s,a=.4999999;if(o<-a)e.y=2*Math.atan2(n,s),e.x=Math.PI/2,e.z=0;else if(o>a)e.y=2*Math.atan2(n,s),e.x=-Math.PI/2,e.z=0;else{var u=s*s,h=t*t,f=i*i,l=n*n;e.z=Math.atan2(2*(i*n+t*s),-h-f+l+u),e.x=Math.asin(-2*o),e.y=Math.atan2(2*(t*i+n*s),h-f-l+u)}return this},r.prototype.toRotationMatrix=function(e){return oe.FromQuaternionToRef(this,e),this},r.prototype.fromRotationMatrix=function(e){return r.FromRotationMatrixToRef(e,this),this},r.FromRotationMatrix=function(e){var t=new r;return r.FromRotationMatrixToRef(e,t),t},r.FromRotationMatrixToRef=function(e,t){var i=e.m,n=i[0],s=i[4],o=i[8],a=i[1],u=i[5],h=i[9],f=i[2],l=i[6],c=i[10],_=n+u+c,d;_>0?(d=.5/Math.sqrt(_+1),t.w=.25/d,t.x=(l-h)*d,t.y=(o-f)*d,t.z=(a-s)*d):n>u&&n>c?(d=2*Math.sqrt(1+n-u-c),t.w=(l-h)/d,t.x=.25*d,t.y=(s+a)/d,t.z=(o+f)/d):u>c?(d=2*Math.sqrt(1+u-n-c),t.w=(o-f)/d,t.x=(s+a)/d,t.y=.25*d,t.z=(h+l)/d):(d=2*Math.sqrt(1+c-n-u),t.w=(a-s)/d,t.x=(o+f)/d,t.y=(h+l)/d,t.z=.25*d)},r.Dot=function(e,t){return e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w},r.AreClose=function(e,t){var i=r.Dot(e,t);return i>=0},r.SmoothToRef=function(e,t,i,n,s){var o=n===0?1:i/n;o=B.Clamp(o,0,1),r.SlerpToRef(e,t,o,s)},r.Zero=function(){return new r(0,0,0,0)},r.Inverse=function(e){return new r(-e._x,-e._y,-e._z,e._w)},r.InverseToRef=function(e,t){return t.set(-e._x,-e._y,-e._z,e._w),t},r.Identity=function(){return new r(0,0,0,1)},r.IsIdentity=function(e){return e&&e._x===0&&e._y===0&&e._z===0&&e._w===1},r.RotationAxis=function(e,t){return r.RotationAxisToRef(e,t,new r)},r.RotationAxisToRef=function(e,t,i){var n=Math.sin(t/2);return e.normalize(),i.w=Math.cos(t/2),i.x=e._x*n,i.y=e._y*n,i.z=e._z*n,i},r.FromArray=function(e,t){return t||(t=0),new r(e[t],e[t+1],e[t+2],e[t+3])},r.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3]},r.FromEulerAngles=function(e,t,i){var n=new r;return r.RotationYawPitchRollToRef(t,e,i,n),n},r.FromEulerAnglesToRef=function(e,t,i,n){return r.RotationYawPitchRollToRef(t,e,i,n),n},r.FromEulerVector=function(e){var t=new r;return r.RotationYawPitchRollToRef(e._y,e._x,e._z,t),t},r.FromEulerVectorToRef=function(e,t){return r.RotationYawPitchRollToRef(e._y,e._x,e._z,t),t},r.FromUnitVectorsToRef=function(e,t,i){var n=F.Dot(e,t)+1;return n<se?Math.abs(e.x)>Math.abs(e.z)?i.set(-e.y,e.x,0,0):i.set(0,-e.z,e.y,0):(F.CrossToRef(e,t,ue.Vector3[0]),i.set(ue.Vector3[0].x,ue.Vector3[0].y,ue.Vector3[0].z,n)),i.normalize()},r.RotationYawPitchRoll=function(e,t,i){var n=new r;return r.RotationYawPitchRollToRef(e,t,i,n),n},r.RotationYawPitchRollToRef=function(e,t,i,n){var s=i*.5,o=t*.5,a=e*.5,u=Math.sin(s),h=Math.cos(s),f=Math.sin(o),l=Math.cos(o),c=Math.sin(a),_=Math.cos(a);n.x=_*f*h+c*l*u,n.y=c*l*h-_*f*u,n.z=_*l*u-c*f*h,n.w=_*l*h+c*f*u},r.RotationAlphaBetaGamma=function(e,t,i){var n=new r;return r.RotationAlphaBetaGammaToRef(e,t,i,n),n},r.RotationAlphaBetaGammaToRef=function(e,t,i,n){var s=(i+e)*.5,o=(i-e)*.5,a=t*.5;n.x=Math.cos(o)*Math.sin(a),n.y=Math.sin(o)*Math.sin(a),n.z=Math.sin(s)*Math.cos(a),n.w=Math.cos(s)*Math.cos(a)},r.RotationQuaternionFromAxis=function(e,t,i){var n=new r(0,0,0,0);return r.RotationQuaternionFromAxisToRef(e,t,i,n),n},r.RotationQuaternionFromAxisToRef=function(e,t,i,n){var s=P.Matrix[0];oe.FromXYZAxesToRef(e.normalize(),t.normalize(),i.normalize(),s),r.FromRotationMatrixToRef(s,n)},r.FromLookDirectionLH=function(e,t){var i=new r;return r.FromLookDirectionLHToRef(e,t,i),i},r.FromLookDirectionLHToRef=function(e,t,i){var n=P.Matrix[0];oe.LookDirectionLHToRef(e,t,n),r.FromRotationMatrixToRef(n,i)},r.FromLookDirectionRH=function(e,t){var i=new r;return r.FromLookDirectionRHToRef(e,t,i),i},r.FromLookDirectionRHToRef=function(e,t,i){var n=P.Matrix[0];return oe.LookDirectionRHToRef(e,t,n),r.FromRotationMatrixToRef(n,i)},r.Slerp=function(e,t,i){var n=r.Identity();return r.SlerpToRef(e,t,i,n),n},r.SlerpToRef=function(e,t,i,n){var s,o,a=e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w,u=!1;if(a<0&&(u=!0,a=-a),a>.999999)o=1-i,s=u?-i:i;else{var h=Math.acos(a),f=1/Math.sin(h);o=Math.sin((1-i)*h)*f,s=u?-Math.sin(i*h)*f:Math.sin(i*h)*f}n.x=o*e._x+s*t._x,n.y=o*e._y+s*t._y,n.z=o*e._z+s*t._z,n.w=o*e._w+s*t._w},r.Hermite=function(e,t,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,f=a-2*o+s,l=a-o,c=e._x*u+i._x*h+t._x*f+n._x*l,_=e._y*u+i._y*h+t._y*f+n._y*l,d=e._z*u+i._z*h+t._z*f+n._z*l,g=e._w*u+i._w*h+t._w*f+n._w*l;return new r(c,_,d,g)},r.Hermite1stDerivative=function(e,t,i,n,s){var o=r.Zero();return this.Hermite1stDerivativeToRef(e,t,i,n,s,o),o},r.Hermite1stDerivativeToRef=function(e,t,i,n,s,o){var a=s*s;o.x=(a-s)*6*e.x+(3*a-4*s+1)*t.x+(-a+s)*6*i.x+(3*a-2*s)*n.x,o.y=(a-s)*6*e.y+(3*a-4*s+1)*t.y+(-a+s)*6*i.y+(3*a-2*s)*n.y,o.z=(a-s)*6*e.z+(3*a-4*s+1)*t.z+(-a+s)*6*i.z+(3*a-2*s)*n.z,o.w=(a-s)*6*e.w+(3*a-4*s+1)*t.w+(-a+s)*6*i.w+(3*a-2*s)*n.w},r}(),oe=function(){function r(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,Me.MatrixTrackPrecisionChange&&Me.MatrixTrackedMatrices.push(this),this._m=new Me.MatrixCurrentType(16),this.markAsUpdated()}return Object.defineProperty(r,"Use64Bits",{get:function(){return Me.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),r.prototype.markAsUpdated=function(){this.updateFlag=r._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},r.prototype._updateIdentityStatus=function(e,t,i,n){t===void 0&&(t=!1),i===void 0&&(i=!1),n===void 0&&(n=!0),this._isIdentity=e,this._isIdentity3x2=e||i,this._isIdentityDirty=this._isIdentity?!1:t,this._isIdentity3x2Dirty=this._isIdentity3x2?!1:n},r.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var e=this._m;this._isIdentity=e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1}return this._isIdentity},r.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,this._m[0]!==1||this._m[5]!==1||this._m[15]!==1?this._isIdentity3x2=!1:this._m[1]!==0||this._m[2]!==0||this._m[3]!==0||this._m[4]!==0||this._m[6]!==0||this._m[7]!==0||this._m[8]!==0||this._m[9]!==0||this._m[10]!==0||this._m[11]!==0||this._m[12]!==0||this._m[13]!==0||this._m[14]!==0?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},r.prototype.determinant=function(){if(this._isIdentity===!0)return 1;var e=this._m,t=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],u=e[6],h=e[7],f=e[8],l=e[9],c=e[10],_=e[11],d=e[12],g=e[13],p=e[14],y=e[15],v=c*y-p*_,b=l*y-g*_,C=l*p-g*c,m=f*y-d*_,S=f*p-c*d,M=f*g-d*l,w=+(a*v-u*b+h*C),x=-(o*v-u*m+h*S),z=+(o*b-a*m+h*M),U=-(o*C-a*S+u*M);return t*w+i*x+n*z+s*U},r.prototype.toArray=function(){return this._m},r.prototype.asArray=function(){return this._m},r.prototype.invert=function(){return this.invertToRef(this),this},r.prototype.reset=function(){return r.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},r.prototype.add=function(e){var t=new r;return this.addToRef(e,t),t},r.prototype.addToRef=function(e,t){for(var i=this._m,n=t._m,s=e.m,o=0;o<16;o++)n[o]=i[o]+s[o];return t.markAsUpdated(),this},r.prototype.addToSelf=function(e){for(var t=this._m,i=e.m,n=0;n<16;n++)t[n]+=i[n];return this.markAsUpdated(),this},r.prototype.invertToRef=function(e){if(this._isIdentity===!0)return r.IdentityToRef(e),this;var t=this._m,i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],u=t[5],h=t[6],f=t[7],l=t[8],c=t[9],_=t[10],d=t[11],g=t[12],p=t[13],y=t[14],v=t[15],b=_*v-y*d,C=c*v-p*d,m=c*y-p*_,S=l*v-g*d,M=l*y-_*g,w=l*p-g*c,x=+(u*b-h*C+f*m),z=-(a*b-h*S+f*M),U=+(a*C-u*S+f*w),I=-(a*m-u*M+h*w),H=i*x+n*z+s*U+o*I;if(H===0)return e.copyFrom(this),this;var R=1/H,j=h*v-y*f,K=u*v-p*f,J=u*y-p*h,L=a*v-g*f,Y=a*y-g*h,ne=a*p-g*u,pe=h*d-_*f,ge=u*d-c*f,Pe=u*_-c*h,Qe=a*d-l*f,St=a*_-l*h,Mt=a*c-l*u,fr=-(n*b-s*C+o*m),lr=+(i*b-s*S+o*M),cr=-(i*C-n*S+o*w),_r=+(i*m-n*M+s*w),dr=+(n*j-s*K+o*J),pr=-(i*j-s*L+o*Y),gr=+(i*K-n*L+o*ne),vr=-(i*J-n*Y+s*ne),yr=-(n*pe-s*ge+o*Pe),mr=+(i*pe-s*Qe+o*St),br=-(i*ge-n*Qe+o*Mt),Tr=+(i*Pe-n*St+s*Mt);return r.FromValuesToRef(x*R,fr*R,dr*R,yr*R,z*R,lr*R,pr*R,mr*R,U*R,cr*R,gr*R,br*R,I*R,_r*R,vr*R,Tr*R,e),this},r.prototype.addAtIndex=function(e,t){return this._m[e]+=t,this.markAsUpdated(),this},r.prototype.multiplyAtIndex=function(e,t){return this._m[e]*=t,this.markAsUpdated(),this},r.prototype.setTranslationFromFloats=function(e,t,i){return this._m[12]=e,this._m[13]=t,this._m[14]=i,this.markAsUpdated(),this},r.prototype.addTranslationFromFloats=function(e,t,i){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=i,this.markAsUpdated(),this},r.prototype.setTranslation=function(e){return this.setTranslationFromFloats(e._x,e._y,e._z)},r.prototype.getTranslation=function(){return new F(this._m[12],this._m[13],this._m[14])},r.prototype.getTranslationToRef=function(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],this},r.prototype.removeRotationAndScaling=function(){var e=this.m;return r.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e[12],e[13],e[14],e[15],this),this._updateIdentityStatus(e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1),this},r.prototype.multiply=function(e){var t=new r;return this.multiplyToRef(e,t),t},r.prototype.copyFrom=function(e){e.copyToArray(this._m);var t=e;return this.updateFlag=t.updateFlag,this._updateIdentityStatus(t._isIdentity,t._isIdentityDirty,t._isIdentity3x2,t._isIdentity3x2Dirty),this},r.prototype.copyToArray=function(e,t){t===void 0&&(t=0);var i=this._m;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],this},r.prototype.multiplyToRef=function(e,t){return this._isIdentity?(t.copyFrom(e),this):e._isIdentity?(t.copyFrom(this),this):(this.multiplyToArray(e,t._m,0),t.markAsUpdated(),this)},r.prototype.multiplyToArray=function(e,t,i){var n=this._m,s=e.m,o=n[0],a=n[1],u=n[2],h=n[3],f=n[4],l=n[5],c=n[6],_=n[7],d=n[8],g=n[9],p=n[10],y=n[11],v=n[12],b=n[13],C=n[14],m=n[15],S=s[0],M=s[1],w=s[2],x=s[3],z=s[4],U=s[5],I=s[6],H=s[7],R=s[8],j=s[9],K=s[10],J=s[11],L=s[12],Y=s[13],ne=s[14],pe=s[15];return t[i]=o*S+a*z+u*R+h*L,t[i+1]=o*M+a*U+u*j+h*Y,t[i+2]=o*w+a*I+u*K+h*ne,t[i+3]=o*x+a*H+u*J+h*pe,t[i+4]=f*S+l*z+c*R+_*L,t[i+5]=f*M+l*U+c*j+_*Y,t[i+6]=f*w+l*I+c*K+_*ne,t[i+7]=f*x+l*H+c*J+_*pe,t[i+8]=d*S+g*z+p*R+y*L,t[i+9]=d*M+g*U+p*j+y*Y,t[i+10]=d*w+g*I+p*K+y*ne,t[i+11]=d*x+g*H+p*J+y*pe,t[i+12]=v*S+b*z+C*R+m*L,t[i+13]=v*M+b*U+C*j+m*Y,t[i+14]=v*w+b*I+C*K+m*ne,t[i+15]=v*x+b*H+C*J+m*pe,this},r.prototype.equals=function(e){var t=e;if(!t)return!1;if((this._isIdentity||t._isIdentity)&&!this._isIdentityDirty&&!t._isIdentityDirty)return this._isIdentity&&t._isIdentity;var i=this.m,n=t.m;return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]&&i[9]===n[9]&&i[10]===n[10]&&i[11]===n[11]&&i[12]===n[12]&&i[13]===n[13]&&i[14]===n[14]&&i[15]===n[15]},r.prototype.clone=function(){var e=new r;return e.copyFrom(this),e},r.prototype.getClassName=function(){return"Matrix"},r.prototype.getHashCode=function(){for(var e=he(this._m[0]),t=1;t<16;t++)e=e*397^he(this._m[t]);return e},r.prototype.decomposeToTransformNode=function(e){return e.rotationQuaternion=e.rotationQuaternion||new be,this.decompose(e.scaling,e.rotationQuaternion,e.position)},r.prototype.decompose=function(e,t,i,n){if(this._isIdentity)return i&&i.setAll(0),e&&e.setAll(1),t&&t.copyFromFloats(0,0,0,1),!0;var s=this._m;if(i&&i.copyFromFloats(s[12],s[13],s[14]),e=e||P.Vector3[0],e.x=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),e.y=Math.sqrt(s[4]*s[4]+s[5]*s[5]+s[6]*s[6]),e.z=Math.sqrt(s[8]*s[8]+s[9]*s[9]+s[10]*s[10]),n){var o=n.scaling.x<0?-1:1,a=n.scaling.y<0?-1:1,u=n.scaling.z<0?-1:1;e.x*=o,e.y*=a,e.z*=u}else this.determinant()<=0&&(e.y*=-1);if(e._x===0||e._y===0||e._z===0)return t&&t.copyFromFloats(0,0,0,1),!1;if(t){var h=1/e._x,f=1/e._y,l=1/e._z;r.FromValuesToRef(s[0]*h,s[1]*h,s[2]*h,0,s[4]*f,s[5]*f,s[6]*f,0,s[8]*l,s[9]*l,s[10]*l,0,0,0,0,1,P.Matrix[0]),be.FromRotationMatrixToRef(P.Matrix[0],t)}return!0},r.prototype.getRow=function(e){if(e<0||e>3)return null;var t=e*4;return new ft(this._m[t+0],this._m[t+1],this._m[t+2],this._m[t+3])},r.prototype.setRow=function(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)},r.prototype.transpose=function(){return r.Transpose(this)},r.prototype.transposeToRef=function(e){return r.TransposeToRef(this,e),this},r.prototype.setRowFromFloats=function(e,t,i,n,s){if(e<0||e>3)return this;var o=e*4;return this._m[o+0]=t,this._m[o+1]=i,this._m[o+2]=n,this._m[o+3]=s,this.markAsUpdated(),this},r.prototype.scale=function(e){var t=new r;return this.scaleToRef(e,t),t},r.prototype.scaleToRef=function(e,t){for(var i=0;i<16;i++)t._m[i]=this._m[i]*e;return t.markAsUpdated(),this},r.prototype.scaleAndAddToRef=function(e,t){for(var i=0;i<16;i++)t._m[i]+=this._m[i]*e;return t.markAsUpdated(),this},r.prototype.toNormalMatrix=function(e){var t=P.Matrix[0];this.invertToRef(t),t.transposeToRef(e);var i=e._m;r.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,e)},r.prototype.getRotationMatrix=function(){var e=new r;return this.getRotationMatrixToRef(e),e},r.prototype.getRotationMatrixToRef=function(e){var t=P.Vector3[0];if(!this.decompose(t))return r.IdentityToRef(e),this;var i=this._m,n=1/t._x,s=1/t._y,o=1/t._z;return r.FromValuesToRef(i[0]*n,i[1]*n,i[2]*n,0,i[4]*s,i[5]*s,i[6]*s,0,i[8]*o,i[9]*o,i[10]*o,0,0,0,0,1,e),this},r.prototype.toggleModelMatrixHandInPlace=function(){var e=this._m;e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this.markAsUpdated()},r.prototype.toggleProjectionMatrixHandInPlace=function(){var e=this._m;e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this.markAsUpdated()},r.FromArray=function(e,t){t===void 0&&(t=0);var i=new r;return r.FromArrayToRef(e,t,i),i},r.FromArrayToRef=function(e,t,i){for(var n=0;n<16;n++)i._m[n]=e[n+t];i.markAsUpdated()},r.FromFloat32ArrayToRefScaled=function(e,t,i,n){for(var s=0;s<16;s++)n._m[s]=e[s+t]*i;n.markAsUpdated()},Object.defineProperty(r,"IdentityReadOnly",{get:function(){return r._IdentityReadOnly},enumerable:!1,configurable:!0}),r.FromValuesToRef=function(e,t,i,n,s,o,a,u,h,f,l,c,_,d,g,p,y){var v=y._m;v[0]=e,v[1]=t,v[2]=i,v[3]=n,v[4]=s,v[5]=o,v[6]=a,v[7]=u,v[8]=h,v[9]=f,v[10]=l,v[11]=c,v[12]=_,v[13]=d,v[14]=g,v[15]=p,y.markAsUpdated()},r.FromValues=function(e,t,i,n,s,o,a,u,h,f,l,c,_,d,g,p){var y=new r,v=y._m;return v[0]=e,v[1]=t,v[2]=i,v[3]=n,v[4]=s,v[5]=o,v[6]=a,v[7]=u,v[8]=h,v[9]=f,v[10]=l,v[11]=c,v[12]=_,v[13]=d,v[14]=g,v[15]=p,y.markAsUpdated(),y},r.Compose=function(e,t,i){var n=new r;return r.ComposeToRef(e,t,i,n),n},r.ComposeToRef=function(e,t,i,n){var s=n._m,o=t._x,a=t._y,u=t._z,h=t._w,f=o+o,l=a+a,c=u+u,_=o*f,d=o*l,g=o*c,p=a*l,y=a*c,v=u*c,b=h*f,C=h*l,m=h*c,S=e._x,M=e._y,w=e._z;s[0]=(1-(p+v))*S,s[1]=(d+m)*S,s[2]=(g-C)*S,s[3]=0,s[4]=(d-m)*M,s[5]=(1-(_+v))*M,s[6]=(y+b)*M,s[7]=0,s[8]=(g+C)*w,s[9]=(y-b)*w,s[10]=(1-(_+p))*w,s[11]=0,s[12]=i._x,s[13]=i._y,s[14]=i._z,s[15]=1,n.markAsUpdated()},r.Identity=function(){var e=r.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return e._updateIdentityStatus(!0),e},r.IdentityToRef=function(e){r.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e),e._updateIdentityStatus(!0)},r.Zero=function(){var e=r.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return e._updateIdentityStatus(!1),e},r.RotationX=function(e){var t=new r;return r.RotationXToRef(e,t),t},r.Invert=function(e){var t=new r;return e.invertToRef(t),t},r.RotationXToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e);r.FromValuesToRef(1,0,0,0,0,n,i,0,0,-i,n,0,0,0,0,1,t),t._updateIdentityStatus(n===1&&i===0)},r.RotationY=function(e){var t=new r;return r.RotationYToRef(e,t),t},r.RotationYToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e);r.FromValuesToRef(n,0,-i,0,0,1,0,0,i,0,n,0,0,0,0,1,t),t._updateIdentityStatus(n===1&&i===0)},r.RotationZ=function(e){var t=new r;return r.RotationZToRef(e,t),t},r.RotationZToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e);r.FromValuesToRef(n,i,0,0,-i,n,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(n===1&&i===0)},r.RotationAxis=function(e,t){var i=new r;return r.RotationAxisToRef(e,t,i),i},r.RotationAxisToRef=function(e,t,i){var n=Math.sin(-t),s=Math.cos(-t),o=1-s;e.normalize();var a=i._m;a[0]=e._x*e._x*o+s,a[1]=e._x*e._y*o-e._z*n,a[2]=e._x*e._z*o+e._y*n,a[3]=0,a[4]=e._y*e._x*o+e._z*n,a[5]=e._y*e._y*o+s,a[6]=e._y*e._z*o-e._x*n,a[7]=0,a[8]=e._z*e._x*o-e._y*n,a[9]=e._z*e._y*o+e._x*n,a[10]=e._z*e._z*o+s,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,i.markAsUpdated()},r.RotationAlignToRef=function(e,t,i){var n=F.Dot(t,e),s=i._m;if(n<-1+se)s[0]=-1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0;else{var o=F.Cross(t,e),a=1/(1+n);s[0]=o._x*o._x*a+n,s[1]=o._y*o._x*a-o._z,s[2]=o._z*o._x*a+o._y,s[3]=0,s[4]=o._x*o._y*a+o._z,s[5]=o._y*o._y*a+n,s[6]=o._z*o._y*a-o._x,s[7]=0,s[8]=o._x*o._z*a-o._y,s[9]=o._y*o._z*a+o._x,s[10]=o._z*o._z*a+n,s[11]=0}s[12]=0,s[13]=0,s[14]=0,s[15]=1,i.markAsUpdated()},r.RotationYawPitchRoll=function(e,t,i){var n=new r;return r.RotationYawPitchRollToRef(e,t,i,n),n},r.RotationYawPitchRollToRef=function(e,t,i,n){be.RotationYawPitchRollToRef(e,t,i,P.Quaternion[0]),P.Quaternion[0].toRotationMatrix(n)},r.Scaling=function(e,t,i){var n=new r;return r.ScalingToRef(e,t,i,n),n},r.ScalingToRef=function(e,t,i,n){r.FromValuesToRef(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1,n),n._updateIdentityStatus(e===1&&t===1&&i===1)},r.Translation=function(e,t,i){var n=new r;return r.TranslationToRef(e,t,i,n),n},r.TranslationToRef=function(e,t,i,n){r.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1,n),n._updateIdentityStatus(e===0&&t===0&&i===0)},r.Lerp=function(e,t,i){var n=new r;return r.LerpToRef(e,t,i,n),n},r.LerpToRef=function(e,t,i,n){for(var s=n._m,o=e.m,a=t.m,u=0;u<16;u++)s[u]=o[u]*(1-i)+a[u]*i;n.markAsUpdated()},r.DecomposeLerp=function(e,t,i){var n=new r;return r.DecomposeLerpToRef(e,t,i,n),n},r.DecomposeLerpToRef=function(e,t,i,n){var s=P.Vector3[0],o=P.Quaternion[0],a=P.Vector3[1];e.decompose(s,o,a);var u=P.Vector3[2],h=P.Quaternion[1],f=P.Vector3[3];t.decompose(u,h,f);var l=P.Vector3[4];F.LerpToRef(s,u,i,l);var c=P.Quaternion[2];be.SlerpToRef(o,h,i,c);var _=P.Vector3[5];F.LerpToRef(a,f,i,_),r.ComposeToRef(l,c,_,n)},r.LookAtLH=function(e,t,i){var n=new r;return r.LookAtLHToRef(e,t,i,n),n},r.LookAtLHToRef=function(e,t,i,n){var s=P.Vector3[0],o=P.Vector3[1],a=P.Vector3[2];t.subtractToRef(e,a),a.normalize(),F.CrossToRef(i,a,s);var u=s.lengthSquared();u===0?s.x=1:s.normalizeFromLength(Math.sqrt(u)),F.CrossToRef(a,s,o),o.normalize();var h=-F.Dot(s,e),f=-F.Dot(o,e),l=-F.Dot(a,e);r.FromValuesToRef(s._x,o._x,a._x,0,s._y,o._y,a._y,0,s._z,o._z,a._z,0,h,f,l,1,n)},r.LookAtRH=function(e,t,i){var n=new r;return r.LookAtRHToRef(e,t,i,n),n},r.LookAtRHToRef=function(e,t,i,n){var s=P.Vector3[0],o=P.Vector3[1],a=P.Vector3[2];e.subtractToRef(t,a),a.normalize(),F.CrossToRef(i,a,s);var u=s.lengthSquared();u===0?s.x=1:s.normalizeFromLength(Math.sqrt(u)),F.CrossToRef(a,s,o),o.normalize();var h=-F.Dot(s,e),f=-F.Dot(o,e),l=-F.Dot(a,e);r.FromValuesToRef(s._x,o._x,a._x,0,s._y,o._y,a._y,0,s._z,o._z,a._z,0,h,f,l,1,n)},r.LookDirectionLH=function(e,t){var i=new r;return r.LookDirectionLHToRef(e,t,i),i},r.LookDirectionLHToRef=function(e,t,i){var n=P.Vector3[0];n.copyFrom(e),n.scaleInPlace(-1);var s=P.Vector3[1];F.CrossToRef(t,n,s),r.FromValuesToRef(s._x,s._y,s._z,0,t._x,t._y,t._z,0,n._x,n._y,n._z,0,0,0,0,1,i)},r.LookDirectionRH=function(e,t){var i=new r;return r.LookDirectionRHToRef(e,t,i),i},r.LookDirectionRHToRef=function(e,t,i){var n=P.Vector3[2];F.CrossToRef(t,e,n),r.FromValuesToRef(n._x,n._y,n._z,0,t._x,t._y,t._z,0,e._x,e._y,e._z,0,0,0,0,1,i)},r.OrthoLH=function(e,t,i,n,s){var o=new r;return r.OrthoLHToRef(e,t,i,n,o,s),o},r.OrthoLHToRef=function(e,t,i,n,s,o){var a=i,u=n,h=2/e,f=2/t,l=2/(u-a),c=-(u+a)/(u-a);r.FromValuesToRef(h,0,0,0,0,f,0,0,0,0,l,0,0,0,c,1,s),o&&s.multiplyToRef(Ce,s),s._updateIdentityStatus(h===1&&f===1&&l===1&&c===0)},r.OrthoOffCenterLH=function(e,t,i,n,s,o,a){var u=new r;return r.OrthoOffCenterLHToRef(e,t,i,n,s,o,u,a),u},r.OrthoOffCenterLHToRef=function(e,t,i,n,s,o,a,u){var h=s,f=o,l=2/(t-e),c=2/(n-i),_=2/(f-h),d=-(f+h)/(f-h),g=(e+t)/(e-t),p=(n+i)/(i-n);r.FromValuesToRef(l,0,0,0,0,c,0,0,0,0,_,0,g,p,d,1,a),u&&a.multiplyToRef(Ce,a),a.markAsUpdated()},r.OrthoOffCenterRH=function(e,t,i,n,s,o,a){var u=new r;return r.OrthoOffCenterRHToRef(e,t,i,n,s,o,u,a),u},r.OrthoOffCenterRHToRef=function(e,t,i,n,s,o,a,u){r.OrthoOffCenterLHToRef(e,t,i,n,s,o,a,u),a._m[10]*=-1},r.PerspectiveLH=function(e,t,i,n,s,o){o===void 0&&(o=0);var a=new r,u=i,h=n,f=2*u/e,l=2*u/t,c=(h+u)/(h-u),_=-2*h*u/(h-u),d=Math.tan(o);return r.FromValuesToRef(f,0,0,0,0,l,0,d,0,0,c,1,0,0,_,0,a),s&&a.multiplyToRef(Ce,a),a._updateIdentityStatus(!1),a},r.PerspectiveFovLH=function(e,t,i,n,s,o,a){o===void 0&&(o=0),a===void 0&&(a=!1);var u=new r;return r.PerspectiveFovLHToRef(e,t,i,n,u,!0,s,o,a),u},r.PerspectiveFovLHToRef=function(e,t,i,n,s,o,a,u,h){o===void 0&&(o=!0),u===void 0&&(u=0),h===void 0&&(h=!1);var f=i,l=n,c=1/Math.tan(e*.5),_=o?c/t:c,d=o?c:c*t,g=h&&f===0?-1:l!==0?(l+f)/(l-f):1,p=h&&f===0?2*l:l!==0?-2*l*f/(l-f):-2*f,y=Math.tan(u);r.FromValuesToRef(_,0,0,0,0,d,0,y,0,0,g,1,0,0,p,0,s),a&&s.multiplyToRef(Ce,s),s._updateIdentityStatus(!1)},r.PerspectiveFovReverseLHToRef=function(e,t,i,n,s,o,a,u){o===void 0&&(o=!0),u===void 0&&(u=0);var h=1/Math.tan(e*.5),f=o?h/t:h,l=o?h:h*t,c=Math.tan(u);r.FromValuesToRef(f,0,0,0,0,l,0,c,0,0,-i,1,0,0,1,0,s),a&&s.multiplyToRef(Ce,s),s._updateIdentityStatus(!1)},r.PerspectiveFovRH=function(e,t,i,n,s,o,a){o===void 0&&(o=0),a===void 0&&(a=!1);var u=new r;return r.PerspectiveFovRHToRef(e,t,i,n,u,!0,s,o,a),u},r.PerspectiveFovRHToRef=function(e,t,i,n,s,o,a,u,h){o===void 0&&(o=!0),u===void 0&&(u=0),h===void 0&&(h=!1);var f=i,l=n,c=1/Math.tan(e*.5),_=o?c/t:c,d=o?c:c*t,g=h&&f===0?1:l!==0?-(l+f)/(l-f):-1,p=h&&f===0?2*l:l!==0?-2*l*f/(l-f):-2*f,y=Math.tan(u);r.FromValuesToRef(_,0,0,0,0,d,0,y,0,0,g,-1,0,0,p,0,s),a&&s.multiplyToRef(Ce,s),s._updateIdentityStatus(!1)},r.PerspectiveFovReverseRHToRef=function(e,t,i,n,s,o,a,u){o===void 0&&(o=!0),u===void 0&&(u=0);var h=1/Math.tan(e*.5),f=o?h/t:h,l=o?h:h*t,c=Math.tan(u);r.FromValuesToRef(f,0,0,0,0,l,0,c,0,0,-i,-1,0,0,-1,0,s),a&&s.multiplyToRef(Ce,s),s._updateIdentityStatus(!1)},r.PerspectiveFovWebVRToRef=function(e,t,i,n,s,o,a){s===void 0&&(s=!1),a===void 0&&(a=0);var u=s?-1:1,h=Math.tan(e.upDegrees*Math.PI/180),f=Math.tan(e.downDegrees*Math.PI/180),l=Math.tan(e.leftDegrees*Math.PI/180),c=Math.tan(e.rightDegrees*Math.PI/180),_=2/(l+c),d=2/(h+f),g=Math.tan(a),p=n._m;p[0]=_,p[1]=p[2]=p[3]=p[4]=0,p[5]=d,p[6]=0,p[7]=g,p[8]=(l-c)*_*.5,p[9]=-((h-f)*d*.5),p[10]=-i/(t-i),p[11]=1*u,p[12]=p[13]=p[15]=0,p[14]=-(2*i*t)/(i-t),o&&n.multiplyToRef(Ce,n),n.markAsUpdated()},r.GetFinalMatrix=function(e,t,i,n,s,o){var a=e.width,u=e.height,h=e.x,f=e.y,l=r.FromValues(a/2,0,0,0,0,-u/2,0,0,0,0,o-s,0,h+a/2,u/2+f,s,1),c=P.Matrix[0];return t.multiplyToRef(i,c),c.multiplyToRef(n,c),c.multiply(l)},r.GetAsMatrix2x2=function(e){var t=e.m,i=[t[0],t[1],t[4],t[5]];return Me.MatrixUse64Bits?i:new Float32Array(i)},r.GetAsMatrix3x3=function(e){var t=e.m,i=[t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]];return Me.MatrixUse64Bits?i:new Float32Array(i)},r.Transpose=function(e){var t=new r;return r.TransposeToRef(e,t),t},r.TransposeToRef=function(e,t){var i=t._m,n=e.m;i[0]=n[0],i[1]=n[4],i[2]=n[8],i[3]=n[12],i[4]=n[1],i[5]=n[5],i[6]=n[9],i[7]=n[13],i[8]=n[2],i[9]=n[6],i[10]=n[10],i[11]=n[14],i[12]=n[3],i[13]=n[7],i[14]=n[11],i[15]=n[15],t.markAsUpdated(),t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty)},r.Reflection=function(e){var t=new r;return r.ReflectionToRef(e,t),t},r.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,n=e.normal.y,s=e.normal.z,o=-2*i,a=-2*n,u=-2*s;r.FromValuesToRef(o*i+1,a*i,u*i,0,o*n,a*n+1,u*n,0,o*s,a*s,u*s+1,0,o*e.d,a*e.d,u*e.d,1,t)},r.FromXYZAxesToRef=function(e,t,i,n){r.FromValuesToRef(e._x,e._y,e._z,0,t._x,t._y,t._z,0,i._x,i._y,i._z,0,0,0,0,1,n)},r.FromQuaternionToRef=function(e,t){var i=e._x*e._x,n=e._y*e._y,s=e._z*e._z,o=e._x*e._y,a=e._z*e._w,u=e._z*e._x,h=e._y*e._w,f=e._y*e._z,l=e._x*e._w;t._m[0]=1-2*(n+s),t._m[1]=2*(o+a),t._m[2]=2*(u-h),t._m[3]=0,t._m[4]=2*(o-a),t._m[5]=1-2*(s+i),t._m[6]=2*(f+l),t._m[7]=0,t._m[8]=2*(u+h),t._m[9]=2*(f-l),t._m[10]=1-2*(n+i),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t.markAsUpdated()},r._UpdateFlagSeed=0,r._IdentityReadOnly=r.Identity(),r}(),P=function(){function r(){}return r.Vector3=me.BuildTuple(11,F.Zero),r.Matrix=me.BuildTuple(2,oe.Identity),r.Quaternion=me.BuildTuple(3,be.Zero),r}(),ue=function(){function r(){}return r.Vector2=me.BuildTuple(3,de.Zero),r.Vector3=me.BuildTuple(13,F.Zero),r.Vector4=me.BuildTuple(3,ft.Zero),r.Quaternion=me.BuildTuple(2,be.Zero),r.Matrix=me.BuildTuple(8,oe.Identity),r}();ke("BABYLON.Vector2",de);ke("BABYLON.Vector3",F);ke("BABYLON.Vector4",ft);ke("BABYLON.Matrix",oe);var Ce=oe.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1),ci=Object.freeze(Object.defineProperty({__proto__:null,Vector2:de,Vector3:F,Vector4:ft,Quaternion:be,Matrix:oe,TmpVectors:ue},Symbol.toStringTag,{value:"Module"})),_i=function(){function r(e){e===void 0&&(e=30),this._enabled=!0,this._rollingFrameTime=new di(e)}return r.prototype.sampleFrame=function(e){if(e===void 0&&(e=we.Now),!!this._enabled){if(this._lastFrameTimeMs!=null){var t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}},Object.defineProperty(r.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return e===0?0:1e3/e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!1,configurable:!0}),r.prototype.enable=function(){this._enabled=!0},r.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(r.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},r}(),di=function(){function r(e){this._samples=new Array(e),this.reset()}return r.prototype.add=function(e){var t;if(this.isSaturated()){var i=this._samples[this._pos];t=i-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(i-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},r.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},r.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},r.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},r.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},r}(),Ke=function(){function r(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(r.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"average",{get:function(){return this._average},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!1,configurable:!0}),r.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},r.prototype.addCount=function(e,t){!r.Enabled||(this._current+=e,t&&this._fetchResult())},r.prototype.beginMonitoring=function(){!r.Enabled||(this._startMonitoringTime=we.Now)},r.prototype.endMonitoring=function(e){if(e===void 0&&(e=!0),!!r.Enabled){e&&this.fetchNewFrame();var t=we.Now;this._current=t-this._startMonitoringTime,e&&this._fetchResult()}},r.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=we.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},r.Enabled=!0,r}();$.prototype.setAlphaConstants=function(r,e,t,i){this._alphaState.setAlphaBlendConstants(r,e,t,i)};$.prototype.setAlphaMode=function(r,e){if(e===void 0&&(e=!1),this._alphaMode!==r){switch(r){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break}e||(this.depthCullingState.depthMask=r===0),this._alphaMode=r}};$.prototype.getAlphaMode=function(){return this._alphaMode};$.prototype.setAlphaEquation=function(r){if(this._alphaEquation!==r){switch(r){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774);break}this._alphaEquation=r}};$.prototype.getAlphaEquation=function(){return this._alphaEquation};function pi(r,e,t,i){switch(t===void 0&&(t=!1),r){case 3:{var n=e instanceof ArrayBuffer?new Int8Array(e):new Int8Array(e);return i&&n.set(new Int8Array(i)),n}case 0:{var s=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e);return i&&s.set(new Uint8Array(i)),s}case 4:{var o=e instanceof ArrayBuffer?new Int16Array(e):new Int16Array(t?e/2:e);return i&&o.set(new Int16Array(i)),o}case 5:case 8:case 9:case 10:case 2:{var a=e instanceof ArrayBuffer?new Uint16Array(e):new Uint16Array(t?e/2:e);return i&&a.set(new Uint16Array(i)),a}case 6:{var u=e instanceof ArrayBuffer?new Int32Array(e):new Int32Array(t?e/4:e);return i&&u.set(new Int32Array(i)),u}case 7:case 11:case 12:case 13:case 14:case 15:{var h=e instanceof ArrayBuffer?new Uint32Array(e):new Uint32Array(t?e/4:e);return i&&h.set(new Uint32Array(i)),h}case 1:{var f=e instanceof ArrayBuffer?new Float32Array(e):new Float32Array(t?e/4:e);return i&&f.set(new Float32Array(i)),f}}var l=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e);return i&&l.set(new Uint8Array(i)),l}$.prototype._readTexturePixelsSync=function(r,e,t,i,n,s,o,a,u,h){var f,l;i===void 0&&(i=-1),n===void 0&&(n=0),s===void 0&&(s=null),o===void 0&&(o=!0),a===void 0&&(a=!1),u===void 0&&(u=0),h===void 0&&(h=0);var c=this._gl;if(!c)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var _=c.createFramebuffer();if(!_)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=_}c.bindFramebuffer(c.FRAMEBUFFER,this._dummyFramebuffer),i>-1?c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+i,(f=r._hardwareTexture)===null||f===void 0?void 0:f.underlyingResource,n):c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,(l=r._hardwareTexture)===null||l===void 0?void 0:l.underlyingResource,n);var d=r.type!==void 0?this._getWebGLTextureType(r.type):c.UNSIGNED_BYTE;if(a)s||(s=pi(r.type,4*e*t));else switch(d){case c.UNSIGNED_BYTE:s||(s=new Uint8Array(4*e*t)),d=c.UNSIGNED_BYTE;break;default:s||(s=new Float32Array(4*e*t)),d=c.FLOAT;break}return o&&this.flushFramebuffer(),c.readPixels(u,h,e,t,c.RGBA,d,s),c.bindFramebuffer(c.FRAMEBUFFER,this._currentFramebuffer),s};$.prototype._readTexturePixels=function(r,e,t,i,n,s,o,a,u,h){return i===void 0&&(i=-1),n===void 0&&(n=0),s===void 0&&(s=null),o===void 0&&(o=!0),a===void 0&&(a=!1),u===void 0&&(u=0),h===void 0&&(h=0),Promise.resolve(this._readTexturePixelsSync(r,e,t,i,n,s,o,a,u,h))};$.prototype.updateDynamicIndexBuffer=function(r,e,t){this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(r);var i;r.is32Bits?i=e instanceof Uint32Array?e:new Uint32Array(e):i=e instanceof Uint16Array?e:new Uint16Array(e),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()};$.prototype.updateDynamicVertexBuffer=function(r,e,t,i){this.bindArrayBuffer(r),t===void 0&&(t=0);var n=e.byteLength||e.length;i===void 0||i>=n&&t===0?e instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,t,new Float32Array(e)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,t,e):e instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(e).subarray(t,t+i)):(e instanceof ArrayBuffer?e=new Uint8Array(e,t,i):e=new Uint8Array(e.buffer,e.byteOffset+t,i),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)),this._resetVertexBufferBinding()};var A=function(r){Q(e,r);function e(t,i,n,s){s===void 0&&(s=!1);var o=r.call(this,t,i,n,s)||this;if(o.enableOfflineSupport=!1,o.disableManifestCheck=!1,o.disableContextMenu=!0,o.scenes=new Array,o._virtualScenes=new Array,o.onNewSceneAddedObservable=new E,o.postProcesses=new Array,o.isPointerLock=!1,o.onResizeObservable=new E,o.onCanvasBlurObservable=new E,o.onCanvasFocusObservable=new E,o.onCanvasPointerOutObservable=new E,o.onBeginFrameObservable=new E,o.customAnimationFrameRequester=null,o.onEndFrameObservable=new E,o.onBeforeShaderCompilationObservable=new E,o.onAfterShaderCompilationObservable=new E,o._deterministicLockstep=!1,o._lockstepMaxSteps=4,o._timeStep=1/60,o._fps=60,o._deltaTime=0,o._drawCalls=new Ke,o.canvasTabIndex=1,o.disablePerformanceMonitorInBackground=!1,o._performanceMonitor=new _i,o._compatibilityMode=!0,o.currentRenderPassId=0,o._renderPassNames=["main"],e.Instances.push(o),!t)return o;if(o._features.supportRenderPasses=!0,n=o._creationOptions,t.getContext){var a=t;if(o._sharedInit(a,!!n.doNotHandleTouchAction,n.audioEngine),X()){var u=document;o._onFullscreenChange=function(){u.fullscreen!==void 0?o.isFullscreen=u.fullscreen:u.mozFullScreen!==void 0?o.isFullscreen=u.mozFullScreen:u.webkitIsFullScreen!==void 0?o.isFullscreen=u.webkitIsFullScreen:u.msIsFullScreen!==void 0&&(o.isFullscreen=u.msIsFullScreen),o.isFullscreen&&o._pointerLockRequested&&a&&e._RequestPointerlock(a)},document.addEventListener("fullscreenchange",o._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",o._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",o._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",o._onFullscreenChange,!1),o._onPointerLockChange=function(){o.isPointerLock=u.mozPointerLockElement===a||u.webkitPointerLockElement===a||u.msPointerLockElement===a||u.pointerLockElement===a},document.addEventListener("pointerlockchange",o._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",o._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",o._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",o._onPointerLockChange,!1),!e.audioEngine&&n.audioEngine&&e.AudioEngineFactory&&(e.audioEngine=e.AudioEngineFactory(o.getRenderingCanvas(),o.getAudioContext(),o.getAudioDestination()))}o._connectVREvents(),o.enableOfflineSupport=e.OfflineProviderFactory!==void 0,o._deterministicLockstep=!!n.deterministicLockstep,o._lockstepMaxSteps=n.lockstepMaxSteps||0,o._timeStep=n.timeStep||1/60}return o._prepareVRComponent(),n.autoEnableWebVR&&o.initWebVR(),o}return Object.defineProperty(e,"NpmPackage",{get:function(){return $.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Version",{get:function(){return $.Version},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Instances",{get:function(){return Z.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LastCreatedEngine",{get:function(){return Z.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return Z.LastCreatedScene},enumerable:!1,configurable:!0}),e.prototype._createImageBitmapFromSource=function(t,i){var n=this,s=new Promise(function(o,a){var u=new Image;u.onload=function(){u.decode().then(function(){n.createImageBitmap(u,i).then(function(h){o(h)})})},u.onerror=function(){a("Error loading image ".concat(u.src))},u.src=t});return s},e.prototype.createImageBitmap=function(t,i){return createImageBitmap(t,i)},e.prototype.resizeImageBitmap=function(t,i,n){var s=this.createCanvas(i,n),o=s.getContext("2d");if(!o)throw new Error("Unable to get 2d context for resizeImageBitmap");o.drawImage(t,0,0);var a=o.getImageData(0,0,i,n).data;return a},e.MarkAllMaterialsAsDirty=function(t,i){for(var n=0;n<e.Instances.length;n++)for(var s=e.Instances[n],o=0;o<s.scenes.length;o++)s.scenes[o].markAllMaterialsAsDirty(t,i)},e.DefaultLoadingScreenFactory=function(t){throw V("LoadingScreen")},Object.defineProperty(e.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!e._RescalePostProcessFactory},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"compatibilityMode",{get:function(){return this._compatibilityMode},set:function(t){this._compatibilityMode=!0},enumerable:!1,configurable:!0}),e.prototype.getInputElement=function(){return this._renderingCanvas},e.prototype._sharedInit=function(t,i,n){var s=this;if(r.prototype._sharedInit.call(this,t,i,n),this._onCanvasFocus=function(){s.onCanvasFocusObservable.notifyObservers(s)},this._onCanvasBlur=function(){s.onCanvasBlurObservable.notifyObservers(s)},this._onCanvasContextMenu=function(a){s.disableContextMenu&&a.preventDefault()},t.addEventListener("focus",this._onCanvasFocus),t.addEventListener("blur",this._onCanvasBlur),t.addEventListener("contextmenu",this._onCanvasContextMenu),this._onBlur=function(){s.disablePerformanceMonitorInBackground&&s._performanceMonitor.disable(),s._windowIsBackground=!0},this._onFocus=function(){s.disablePerformanceMonitorInBackground&&s._performanceMonitor.enable(),s._windowIsBackground=!1},this._onCanvasPointerOut=function(a){document.elementFromPoint(a.clientX,a.clientY)!==t&&s.onCanvasPointerOutObservable.notifyObservers(a)},X()){var o=this.getHostWindow();o&&(o.addEventListener("blur",this._onBlur),o.addEventListener("focus",this._onFocus))}t.addEventListener("pointerout",this._onCanvasPointerOut),i||this._disableTouchAction(),!e.audioEngine&&n&&e.AudioEngineFactory&&(e.audioEngine=e.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination()))},e.prototype.getAspectRatio=function(t,i){i===void 0&&(i=!1);var n=t.viewport;return this.getRenderWidth(i)*n.width/(this.getRenderHeight(i)*n.height)},e.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},e.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},e.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},e.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},e.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},e.prototype.getTimeStep=function(){return this._timeStep*1e3},e.prototype.generateMipMapsForCubemap=function(t,i){if(i===void 0&&(i=!0),t.generateMipMaps){var n=this._gl;this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,t,!0),n.generateMipmap(n.TEXTURE_CUBE_MAP),i&&this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null)}},e.prototype.getDepthBuffer=function(){return this._depthCullingState.depthTest},e.prototype.setDepthBuffer=function(t){this._depthCullingState.depthTest=t},e.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},e.prototype.setDepthWrite=function(t){this._depthCullingState.depthMask=t},e.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},e.prototype.setStencilBuffer=function(t){this._stencilState.stencilTest=t},e.prototype.getStencilMask=function(){return this._stencilState.stencilMask},e.prototype.setStencilMask=function(t){this._stencilState.stencilMask=t},e.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},e.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},e.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},e.prototype.setStencilFunction=function(t){this._stencilState.stencilFunc=t},e.prototype.setStencilFunctionReference=function(t){this._stencilState.stencilFuncRef=t},e.prototype.setStencilFunctionMask=function(t){this._stencilState.stencilFuncMask=t},e.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},e.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},e.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},e.prototype.setStencilOperationFail=function(t){this._stencilState.stencilOpStencilFail=t},e.prototype.setStencilOperationDepthFail=function(t){this._stencilState.stencilOpDepthFail=t},e.prototype.setStencilOperationPass=function(t){this._stencilState.stencilOpStencilDepthPass=t},e.prototype.setDitheringState=function(t){t?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},e.prototype.setRasterizerState=function(t){t?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},e.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},e.prototype.setDepthFunction=function(t){this._depthCullingState.depthFunc=t},e.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},e.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},e.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},e.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},e.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},e.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},e.prototype.setDirectViewport=function(t,i,n,s){var o=this._cachedViewport;return this._cachedViewport=null,this._viewport(t,i,n,s),o},e.prototype.scissorClear=function(t,i,n,s,o){this.enableScissor(t,i,n,s),this.clear(o,!0,!0,!0),this.disableScissor()},e.prototype.enableScissor=function(t,i,n,s){var o=this._gl;o.enable(o.SCISSOR_TEST),o.scissor(t,i,n,s)},e.prototype.disableScissor=function(){var t=this._gl;t.disable(t.SCISSOR_TEST)},e.prototype._reportDrawCall=function(t){t===void 0&&(t=1),this._drawCalls.addCount(t,!1)},e.prototype.initWebVR=function(){throw V("WebVRCamera")},e.prototype._prepareVRComponent=function(){},e.prototype._connectVREvents=function(t,i){},e.prototype._submitVRFrame=function(){},e.prototype.disableVR=function(){},e.prototype.isVRPresenting=function(){return!1},e.prototype._requestVRFrame=function(){},e.prototype._loadFileAsync=function(t,i,n){var s=this;return new Promise(function(o,a){s._loadFile(t,function(u){o(u)},void 0,i,n,function(u,h){a(h)})})},e.prototype.getVertexShaderSource=function(t){var i=this._gl.getAttachedShaders(t);return i?this._gl.getShaderSource(i[0]):null},e.prototype.getFragmentShaderSource=function(t){var i=this._gl.getAttachedShaders(t);return i?this._gl.getShaderSource(i[1]):null},e.prototype.setDepthStencilTexture=function(t,i,n,s){t!==void 0&&(i&&(this._boundUniforms[t]=i),!n||!n.depthStencilTexture?this._setTexture(t,null,void 0,void 0,s):this._setTexture(t,n,!1,!0,s))},e.prototype.setTextureFromPostProcess=function(t,i,n){var s,o=null;i&&(i._textures.data[i._currentRenderTextureInd]?o=i._textures.data[i._currentRenderTextureInd]:i._forcedOutputTexture&&(o=i._forcedOutputTexture)),this._bindTexture(t,(s=o==null?void 0:o.texture)!==null&&s!==void 0?s:null,n)},e.prototype.setTextureFromPostProcessOutput=function(t,i,n){var s,o;this._bindTexture(t,(o=(s=i==null?void 0:i._outputTexture)===null||s===void 0?void 0:s.texture)!==null&&o!==void 0?o:null,n)},e.prototype._rebuildBuffers=function(){for(var t=0,i=this.scenes;t<i.length;t++){var n=i[t];n.resetCachedMaterial(),n._rebuildGeometries(),n._rebuildTextures()}for(var s=0,o=this._virtualScenes;s<o.length;s++){var n=o[s];n.resetCachedMaterial(),n._rebuildGeometries(),n._rebuildTextures()}r.prototype._rebuildBuffers.call(this)},e.prototype._renderFrame=function(){for(var t=0;t<this._activeRenderLoops.length;t++){var i=this._activeRenderLoops[t];i()}},e.prototype._renderLoop=function(){if(!this._contextWasLost){var t=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(t=!1),t&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},e.prototype._renderViews=function(){return!1},e.prototype.switchFullscreen=function(t){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(t)},e.prototype.enterFullscreen=function(t){this.isFullscreen||(this._pointerLockRequested=t,this._renderingCanvas&&e._RequestFullscreen(this._renderingCanvas))},e.prototype.exitFullscreen=function(){this.isFullscreen&&e._ExitFullscreen()},e.prototype.enterPointerlock=function(){this._renderingCanvas&&e._RequestPointerlock(this._renderingCanvas)},e.prototype.exitPointerlock=function(){e._ExitPointerlock()},e.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),r.prototype.beginFrame.call(this)},e.prototype.endFrame=function(){r.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},e.prototype.resize=function(t){t===void 0&&(t=!1),!this.isVRPresenting()&&r.prototype.resize.call(this,t)},e.prototype.setSize=function(t,i,n){if(n===void 0&&(n=!1),!this._renderingCanvas||!r.prototype.setSize.call(this,t,i,n))return!1;if(this.scenes){for(var s=0;s<this.scenes.length;s++)for(var o=this.scenes[s],a=0;a<o.cameras.length;a++){var u=o.cameras[a];u._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},e.prototype._deletePipelineContext=function(t){var i=t;i&&i.program&&i.transformFeedback&&(this.deleteTransformFeedback(i.transformFeedback),i.transformFeedback=null),r.prototype._deletePipelineContext.call(this,t)},e.prototype.createShaderProgram=function(t,i,n,s,o,a){a===void 0&&(a=null),o=o||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var u=r.prototype.createShaderProgram.call(this,t,i,n,s,o,a);return this.onAfterShaderCompilationObservable.notifyObservers(this),u},e.prototype._createShaderProgram=function(t,i,n,s,o){o===void 0&&(o=null);var a=s.createProgram();if(t.program=a,!a)throw new Error("Unable to create program");if(s.attachShader(a,i),s.attachShader(a,n),this.webGLVersion>1&&o){var u=this.createTransformFeedback();this.bindTransformFeedback(u),this.setTranformFeedbackVaryings(a,o),t.transformFeedback=u}return s.linkProgram(a),this.webGLVersion>1&&o&&this.bindTransformFeedback(null),t.context=s,t.vertexShader=i,t.fragmentShader=n,t.isParallelCompiled||this._finalizePipelineContext(t),a},e.prototype._releaseTexture=function(t){r.prototype._releaseTexture.call(this,t)},e.prototype._releaseRenderTargetWrapper=function(t){r.prototype._releaseRenderTargetWrapper.call(this,t),this.scenes.forEach(function(i){i.postProcesses.forEach(function(n){n._outputTexture===t&&(n._outputTexture=null)}),i.cameras.forEach(function(n){n._postProcesses.forEach(function(s){s&&s._outputTexture===t&&(s._outputTexture=null)})})})},e.prototype.getRenderPassNames=function(){return this._renderPassNames},e.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},e.prototype.createRenderPassId=function(t){var i=++e._RenderPassIdCounter;return this._renderPassNames[i]=t!=null?t:"NONAME",i},e.prototype.releaseRenderPassId=function(t){this._renderPassNames[t]=void 0;for(var i=0;i<this.scenes.length;++i)for(var n=this.scenes[i],s=0;s<n.meshes.length;++s){var o=n.meshes[s];if(o.subMeshes)for(var a=0;a<o.subMeshes.length;++a){var u=o.subMeshes[a];u._removeDrawWrapper(t)}}},e.prototype._rescaleTexture=function(t,i,n,s,o){var a=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var u=this.createRenderTargetTexture({width:i.width,height:i.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&e._RescalePostProcessFactory&&(this._rescalePostProcess=e._RescalePostProcessFactory(this)),this._rescalePostProcess.externalTextureSamplerBinding=!0,this._rescalePostProcess.getEffect().executeWhenCompiled(function(){a._rescalePostProcess.onApply=function(f){f._bindTexture("textureSampler",t)};var h=n;h||(h=a.scenes[a.scenes.length-1]),h.postProcessManager.directRender([a._rescalePostProcess],u,!0),a._bindTextureDirectly(a._gl.TEXTURE_2D,i,!0),a._gl.copyTexImage2D(a._gl.TEXTURE_2D,0,s,0,0,i.width,i.height,0),a.unBindFramebuffer(u),u.dispose(),o&&o()})},e.prototype.getFps=function(){return this._fps},e.prototype.getDeltaTime=function(){return this._deltaTime},e.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},e.prototype.wrapWebGLTexture=function(t){var i=new rr(t,this._gl),n=new tt(this,ie.Unknown,!0);return n._hardwareTexture=i,n.isReady=!0,n},e.prototype._uploadImageToTexture=function(t,i,n,s){n===void 0&&(n=0),s===void 0&&(s=0);var o=this._gl,a=this._getWebGLTextureType(t.type),u=this._getInternalFormat(t.format),h=this._getRGBABufferInternalSizedFormat(t.type,u),f=t.isCube?o.TEXTURE_CUBE_MAP:o.TEXTURE_2D;this._bindTextureDirectly(f,t,!0),this._unpackFlipY(t.invertY);var l=o.TEXTURE_2D;t.isCube&&(l=o.TEXTURE_CUBE_MAP_POSITIVE_X+n),o.texImage2D(l,s,h,u,a,i),this._bindTextureDirectly(f,null,!0)},e.prototype.updateTextureComparisonFunction=function(t,i){if(this.webGLVersion===1){D.Error("WebGL 1 does not support texture comparison.");return}var n=this._gl;t.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,t,!0),i===0?(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,i),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),i===0?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t._comparisonFunction=i},e.prototype.createInstancesBuffer=function(t){var i=this._gl.createBuffer();if(!i)throw new Error("Unable to create instance buffer");var n=new Ye(i);return n.capacity=t,this.bindArrayBuffer(n),this._gl.bufferData(this._gl.ARRAY_BUFFER,t,this._gl.DYNAMIC_DRAW),n.references=1,n},e.prototype.deleteInstancesBuffer=function(t){this._gl.deleteBuffer(t)},e.prototype._clientWaitAsync=function(t,i,n){i===void 0&&(i=0),n===void 0&&(n=10);var s=this._gl;return new Promise(function(o,a){var u=function(){var h=s.clientWaitSync(t,i,0);if(h==s.WAIT_FAILED){a();return}if(h==s.TIMEOUT_EXPIRED){setTimeout(u,n);return}o()};u()})},e.prototype._readPixelsAsync=function(t,i,n,s,o,a,u){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var h=this._gl,f=h.createBuffer();h.bindBuffer(h.PIXEL_PACK_BUFFER,f),h.bufferData(h.PIXEL_PACK_BUFFER,u.byteLength,h.STREAM_READ),h.readPixels(t,i,n,s,o,a,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);var l=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);return l?(h.flush(),this._clientWaitAsync(l,0,10).then(function(){return h.deleteSync(l),h.bindBuffer(h.PIXEL_PACK_BUFFER,f),h.getBufferSubData(h.PIXEL_PACK_BUFFER,0,u),h.bindBuffer(h.PIXEL_PACK_BUFFER,null),h.deleteBuffer(f),u})):null},e.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();e.Instances.length===1&&e.audioEngine&&(e.audioEngine.dispose(),e.audioEngine=null),this.disableVR(),X()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._renderingCanvas.removeEventListener("contextmenu",this._onCanvasContextMenu)),ot()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),r.prototype.dispose.call(this);var t=e.Instances.indexOf(this);t>=0&&e.Instances.splice(t,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},e.prototype._disableTouchAction=function(){!this._renderingCanvas||!this._renderingCanvas.setAttribute||(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none",this._renderingCanvas.style.webkitTapHighlightColor="transparent")},e.prototype.displayLoadingUI=function(){if(!!X()){var t=this.loadingScreen;t&&t.displayLoadingUI()}},e.prototype.hideLoadingUI=function(){if(!!X()){var t=this._loadingScreen;t&&t.hideLoadingUI()}},Object.defineProperty(e.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=e.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(t){this._loadingScreen=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIText",{set:function(t){this.loadingScreen.loadingUIText=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{set:function(t){this.loadingScreen.loadingUIBackgroundColor=t},enumerable:!1,configurable:!0}),e.prototype.createVideoElement=function(t){return document.createElement("video")},e._RequestPointerlock=function(t){t.requestPointerLock=t.requestPointerLock||t.msRequestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock&&(t.requestPointerLock(),t.focus())},e._ExitPointerlock=function(){var t=document;document.exitPointerLock=document.exitPointerLock||t.msExitPointerLock||t.mozExitPointerLock||t.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},e._RequestFullscreen=function(t){var i=t.requestFullscreen||t.msRequestFullscreen||t.webkitRequestFullscreen||t.mozRequestFullScreen;!i||i.call(t)},e._ExitFullscreen=function(){var t=document;document.exitFullscreen?document.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msCancelFullScreen&&t.msCancelFullScreen()},e.prototype.getFontOffset=function(t){var i=document.createElement("span");i.innerHTML="Hg",i.setAttribute("style","font: ".concat(t," !important"));var n=document.createElement("div");n.style.display="inline-block",n.style.width="1px",n.style.height="0px",n.style.verticalAlign="bottom";var s=document.createElement("div");s.style.whiteSpace="nowrap",s.appendChild(i),s.appendChild(n),document.body.appendChild(s);var o=0,a=0;try{a=n.getBoundingClientRect().top-i.getBoundingClientRect().top,n.style.verticalAlign="baseline",o=n.getBoundingClientRect().top-i.getBoundingClientRect().top}finally{document.body.removeChild(s)}return{ascent:o,height:a,descent:a-o}},e.ALPHA_DISABLE=0,e.ALPHA_ADD=1,e.ALPHA_COMBINE=2,e.ALPHA_SUBTRACT=3,e.ALPHA_MULTIPLY=4,e.ALPHA_MAXIMIZED=5,e.ALPHA_ONEONE=6,e.ALPHA_PREMULTIPLIED=7,e.ALPHA_PREMULTIPLIED_PORTERDUFF=8,e.ALPHA_INTERPOLATE=9,e.ALPHA_SCREENMODE=10,e.DELAYLOADSTATE_NONE=0,e.DELAYLOADSTATE_LOADED=1,e.DELAYLOADSTATE_LOADING=2,e.DELAYLOADSTATE_NOTLOADED=4,e.NEVER=512,e.ALWAYS=519,e.LESS=513,e.EQUAL=514,e.LEQUAL=515,e.GREATER=516,e.GEQUAL=518,e.NOTEQUAL=517,e.KEEP=7680,e.REPLACE=7681,e.INCR=7682,e.DECR=7683,e.INVERT=5386,e.INCR_WRAP=34055,e.DECR_WRAP=34056,e.TEXTURE_CLAMP_ADDRESSMODE=0,e.TEXTURE_WRAP_ADDRESSMODE=1,e.TEXTURE_MIRROR_ADDRESSMODE=2,e.TEXTUREFORMAT_ALPHA=0,e.TEXTUREFORMAT_LUMINANCE=1,e.TEXTUREFORMAT_LUMINANCE_ALPHA=2,e.TEXTUREFORMAT_RGB=4,e.TEXTUREFORMAT_RGBA=5,e.TEXTUREFORMAT_RED=6,e.TEXTUREFORMAT_R=6,e.TEXTUREFORMAT_RG=7,e.TEXTUREFORMAT_RED_INTEGER=8,e.TEXTUREFORMAT_R_INTEGER=8,e.TEXTUREFORMAT_RG_INTEGER=9,e.TEXTUREFORMAT_RGB_INTEGER=10,e.TEXTUREFORMAT_RGBA_INTEGER=11,e.TEXTURETYPE_UNSIGNED_BYTE=0,e.TEXTURETYPE_UNSIGNED_INT=0,e.TEXTURETYPE_FLOAT=1,e.TEXTURETYPE_HALF_FLOAT=2,e.TEXTURETYPE_BYTE=3,e.TEXTURETYPE_SHORT=4,e.TEXTURETYPE_UNSIGNED_SHORT=5,e.TEXTURETYPE_INT=6,e.TEXTURETYPE_UNSIGNED_INTEGER=7,e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,e.TEXTURETYPE_UNSIGNED_INT_24_8=12,e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,e.TEXTURE_NEAREST_SAMPLINGMODE=1,e.TEXTURE_BILINEAR_SAMPLINGMODE=2,e.TEXTURE_TRILINEAR_SAMPLINGMODE=3,e.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,e.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,e.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,e.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,e.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,e.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,e.TEXTURE_NEAREST_LINEAR=7,e.TEXTURE_NEAREST_NEAREST=1,e.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,e.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,e.TEXTURE_LINEAR_LINEAR=2,e.TEXTURE_LINEAR_NEAREST=12,e.TEXTURE_EXPLICIT_MODE=0,e.TEXTURE_SPHERICAL_MODE=1,e.TEXTURE_PLANAR_MODE=2,e.TEXTURE_CUBIC_MODE=3,e.TEXTURE_PROJECTION_MODE=4,e.TEXTURE_SKYBOX_MODE=5,e.TEXTURE_INVCUBIC_MODE=6,e.TEXTURE_EQUIRECTANGULAR_MODE=7,e.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,e.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,e.SCALEMODE_FLOOR=1,e.SCALEMODE_NEAREST=2,e.SCALEMODE_CEILING=3,e._RescalePostProcessFactory=null,e._RenderPassIdCounter=0,e}($),gi=Object.freeze(Object.defineProperty({__proto__:null,Engine:A},Symbol.toStringTag,{value:"Module"})),rt=function(){function r(e,t,i,n,s){n===void 0&&(n=null);var o=this,a,u,h,f,l;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new E,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=F.Zero(),this._localDirection=new F(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=e,i=i||Z.LastCreatedScene,!!i)if(this._scene=i,r._SceneComponentInitialization(i),this._readyToPlayCallback=n,this._customAttenuationFunction=function(b,C,m,S,M){return C<m?b*(1-C/m):0},s&&(this.autoplay=s.autoplay||!1,this._loop=s.loop||!1,s.volume!==void 0&&(this._volume=s.volume),this._spatialSound=(a=s.spatialSound)!==null&&a!==void 0?a:!1,this.maxDistance=(u=s.maxDistance)!==null&&u!==void 0?u:100,this.useCustomAttenuation=(h=s.useCustomAttenuation)!==null&&h!==void 0?h:!1,this.rolloffFactor=s.rolloffFactor||1,this.refDistance=s.refDistance||1,this.distanceModel=s.distanceModel||"linear",this._playbackRate=s.playbackRate||1,this._streaming=(f=s.streaming)!==null&&f!==void 0?f:!1,this._length=s.length,this._offset=s.offset),((l=A.audioEngine)===null||l===void 0?void 0:l.canUseWebAudio)&&A.audioEngine.audioContext){this._soundGain=A.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);var c=!0;if(t)try{typeof t=="string"?this._urlType="String":t instanceof ArrayBuffer?this._urlType="ArrayBuffer":t instanceof HTMLMediaElement?this._urlType="MediaElement":t instanceof MediaStream?this._urlType="MediaStream":Array.isArray(t)&&(this._urlType="Array");var _=[],d=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=A.audioEngine.audioContext.createMediaElementSource(t),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=A.audioEngine.audioContext.createMediaStreamSource(t),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":t.byteLength>0&&(d=!0,this._soundLoaded(t));break;case"String":_.push(t);case"Array":_.length===0&&(_=t);for(var g=function(b){var C=_[b];if(d=s&&s.skipCodecCheck||C.indexOf(".mp3",C.length-4)!==-1&&A.audioEngine.isMP3supported||C.indexOf(".ogg",C.length-4)!==-1&&A.audioEngine.isOGGsupported||C.indexOf(".wav",C.length-4)!==-1||C.indexOf(".m4a",C.length-4)!==-1||C.indexOf(".mp4",C.length-4)!==-1||C.indexOf("blob:")!==-1,d)return p._streaming?(p._htmlAudioElement=new Audio(C),p._htmlAudioElement.controls=!1,p._htmlAudioElement.loop=p.loop,le.SetCorsBehavior(C,p._htmlAudioElement),p._htmlAudioElement.preload="auto",p._htmlAudioElement.addEventListener("canplaythrough",function(){o._isReadyToPlay=!0,o.autoplay&&o.play(0,o._offset,o._length),o._readyToPlayCallback&&o._readyToPlayCallback()}),document.body.appendChild(p._htmlAudioElement),p._htmlAudioElement.load()):p._scene._loadFile(C,function(m){o._soundLoaded(m)},void 0,!0,!0,function(m){m&&D.Error("XHR "+m.status+" error on: "+C+"."),D.Error("Sound creation aborted."),o._scene.mainSoundTrack.removeSound(o)}),"break"},p=this,y=0;y<_.length;y++){var v=g(y);if(v==="break")break}break;default:c=!1;break}c?d||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout(function(){o._readyToPlayCallback&&o._readyToPlayCallback()},1e3)):D.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch{D.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),A.audioEngine&&!A.audioEngine.WarnedWebAudioUnsupported&&(D.Error("Web Audio is not supported by your browser."),A.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){o._readyToPlayCallback&&o._readyToPlayCallback()},1e3)}return Object.defineProperty(r.prototype,"loop",{get:function(){return this._loop},set:function(e){e!==this._loop&&(this._loop=e,this.updateOptions({loop:e}))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentTime",{get:function(){var e;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;var t=this._startOffset;return this.isPlaying&&((e=A.audioEngine)===null||e===void 0?void 0:e.audioContext)&&(t+=A.audioEngine.audioContext.currentTime-this._startTime),t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"spatialSound",{get:function(){return this._spatialSound},set:function(e){var t;this._spatialSound=e,this._spatialSound&&((t=A.audioEngine)===null||t===void 0?void 0:t.canUseWebAudio)&&A.audioEngine.audioContext&&this._createSpatialParameters()},enumerable:!1,configurable:!0}),r.prototype.dispose=function(){var e;!((e=A.audioEngine)===null||e===void 0)&&e.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,this.soundTrackId===-1?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null))},r.prototype.isReady=function(){return this._isReadyToPlay},r.prototype.getClassName=function(){return"Sound"},r.prototype._soundLoaded=function(e){var t=this,i;!(!((i=A.audioEngine)===null||i===void 0)&&i.audioContext)||A.audioEngine.audioContext.decodeAudioData(e,function(n){t._audioBuffer=n,t._isReadyToPlay=!0,t.autoplay&&t.play(0,t._offset,t._length),t._readyToPlayCallback&&t._readyToPlayCallback()},function(n){D.Error("Error while decoding audio data for: "+t.name+" / Error: "+n)})},r.prototype.setAudioBuffer=function(e){var t;!((t=A.audioEngine)===null||t===void 0)&&t.canUseWebAudio&&(this._audioBuffer=e,this._isReadyToPlay=!0)},r.prototype.updateOptions=function(e){var t,i,n,s,o,a,u,h,f,l;e&&(this.loop=(t=e.loop)!==null&&t!==void 0?t:this.loop,this.maxDistance=(i=e.maxDistance)!==null&&i!==void 0?i:this.maxDistance,this.useCustomAttenuation=(n=e.useCustomAttenuation)!==null&&n!==void 0?n:this.useCustomAttenuation,this.rolloffFactor=(s=e.rolloffFactor)!==null&&s!==void 0?s:this.rolloffFactor,this.refDistance=(o=e.refDistance)!==null&&o!==void 0?o:this.refDistance,this.distanceModel=(a=e.distanceModel)!==null&&a!==void 0?a:this.distanceModel,this._playbackRate=(u=e.playbackRate)!==null&&u!==void 0?u:this._playbackRate,this._length=(h=e.length)!==null&&h!==void 0?h:void 0,this._offset=(f=e.offset)!==null&&f!==void 0?f:void 0,this.setVolume((l=e.volume)!==null&&l!==void 0?l:this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),this._offset!==void 0&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),this._length!==void 0&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(this._offset|0)+this._length))))},r.prototype._createSpatialParameters=function(){var e,t;((e=A.audioEngine)===null||e===void 0?void 0:e.canUseWebAudio)&&A.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=(t=this._soundPanner)!==null&&t!==void 0?t:A.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))},r.prototype._updateSpatialParameters=function(){this._spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},r.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},r.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},r.prototype._switchPanningModel=function(){var e;((e=A.audioEngine)===null||e===void 0?void 0:e.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},r.prototype.connectToSoundTrackAudioNode=function(e){var t;((t=A.audioEngine)===null||t===void 0?void 0:t.canUseWebAudio)&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(e),this._isOutputConnected=!0)},r.prototype.setDirectionalCone=function(e,t,i){if(t<e){D.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle.");return}this._coneInnerAngle=e,this._coneOuterAngle=t,this._coneOuterGain=i,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))},Object.defineProperty(r.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(e){var t;if(e!=this._coneInnerAngle){if(this._coneOuterAngle<e){D.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");return}this._coneInnerAngle=e,((t=A.audioEngine)===null||t===void 0?void 0:t.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(e){var t;if(e!=this._coneOuterAngle){if(e<this._coneInnerAngle){D.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");return}this._coneOuterAngle=e,((t=A.audioEngine)===null||t===void 0?void 0:t.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!1,configurable:!0}),r.prototype.setPosition=function(e){var t;e.equals(this._position)||(this._position.copyFrom(e),((t=A.audioEngine)===null||t===void 0?void 0:t.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))},r.prototype.setLocalDirectionToMesh=function(e){var t;this._localDirection=e,((t=A.audioEngine)===null||t===void 0?void 0:t.canUseWebAudio)&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()},r.prototype._updateDirection=function(){if(!(!this._connectedTransformNode||!this._soundPanner)){var e=this._connectedTransformNode.getWorldMatrix(),t=F.TransformNormal(this._localDirection,e);t.normalize(),this._soundPanner.orientationX.value=t.x,this._soundPanner.orientationY.value=t.y,this._soundPanner.orientationZ.value=t.z}},r.prototype.updateDistanceFromListener=function(){var e;if(((e=A.audioEngine)===null||e===void 0?void 0:e.canUseWebAudio)&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var t=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},r.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},r.prototype.play=function(e,t,i){var n=this,s,o,a,u;if(this._isReadyToPlay&&this._scene.audioEnabled&&((s=A.audioEngine)===null||s===void 0?void 0:s.audioContext))try{this._startOffset<0&&(e=-this._startOffset,this._startOffset=0);var h=e?((o=A.audioEngine)===null||o===void 0?void 0:o.audioContext.currentTime)+e:(a=A.audioEngine)===null||a===void 0?void 0:a.audioContext.currentTime;if((!this._soundSource||!this._streamingSource)&&this._spatialSound&&this._soundPanner&&(!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(this._streamingSource||(this._streamingSource=A.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){n._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement){var f=function(){var c,_;if(!((c=A.audioEngine)===null||c===void 0)&&c.unlocked){var d=n._htmlAudioElement.play();d!==void 0&&d.catch(function(){var g,p;(g=A.audioEngine)===null||g===void 0||g.lock(),(n.loop||n.autoplay)&&((p=A.audioEngine)===null||p===void 0||p.onAudioUnlockedObservable.addOnce(function(){f()}))})}else(n.loop||n.autoplay)&&((_=A.audioEngine)===null||_===void 0||_.onAudioUnlockedObservable.addOnce(function(){f()}))};f()}}else{var l=function(){var c,_,d;if(!((c=A.audioEngine)===null||c===void 0)&&c.audioContext){if(i=i||n._length,t=t||n._offset,n._soundSource){var g=n._soundSource;g.onended=function(){g.disconnect()}}if(n._soundSource=(_=A.audioEngine)===null||_===void 0?void 0:_.audioContext.createBufferSource(),n._soundSource&&n._inputAudioNode){n._soundSource.buffer=n._audioBuffer,n._soundSource.connect(n._inputAudioNode),n._soundSource.loop=n.loop,t!==void 0&&(n._soundSource.loopStart=t),i!==void 0&&(n._soundSource.loopEnd=(t|0)+i),n._soundSource.playbackRate.value=n._playbackRate,n._soundSource.onended=function(){n._onended()},h=e?((d=A.audioEngine)===null||d===void 0?void 0:d.audioContext.currentTime)+e:A.audioEngine.audioContext.currentTime;var p=n.isPaused?n._startOffset%n._soundSource.buffer.duration:t||0;n._soundSource.start(h,p,n.loop?void 0:i)}}};((u=A.audioEngine)===null||u===void 0?void 0:u.audioContext.state)==="suspended"?setTimeout(function(){var c;((c=A.audioEngine)===null||c===void 0?void 0:c.audioContext.state)==="suspended"?(A.audioEngine.lock(),(n.loop||n.autoplay)&&A.audioEngine.onAudioUnlockedObservable.addOnce(function(){l()})):l()},500):l()}this._startTime=h,this.isPlaying=!0,this.isPaused=!1}catch(c){D.Error("Error while trying to play audio: "+this.name+", "+c.message)}},r.prototype._onended=function(){this.isPlaying=!1,this._startOffset=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},r.prototype.stop=function(e){var t=this,i;if(this.isPlaying){if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1;else if(((i=A.audioEngine)===null||i===void 0?void 0:i.audioContext)&&this._soundSource){var n=e?A.audioEngine.audioContext.currentTime+e:void 0;this._soundSource.stop(n),n===void 0?(this.isPlaying=!1,this._soundSource.onended=function(){}):this._soundSource.onended=function(){t.isPlaying=!1},this.isPaused||(this._startOffset=0)}}},r.prototype.pause=function(){var e;this.isPlaying&&(this.isPaused=!0,this._streaming?(this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect(),this.isPlaying=!1):!((e=A.audioEngine)===null||e===void 0)&&e.audioContext&&(this.stop(0),this._startOffset+=A.audioEngine.audioContext.currentTime-this._startTime))},r.prototype.setVolume=function(e,t){var i;((i=A.audioEngine)===null||i===void 0?void 0:i.canUseWebAudio)&&this._soundGain&&(t&&A.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(A.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,A.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(e,A.audioEngine.audioContext.currentTime+t)):this._soundGain.gain.value=e),this._volume=e},r.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},r.prototype.getVolume=function(){return this._volume},r.prototype.attachToMesh=function(e){var t=this;this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=e,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=function(i){return t._onRegisterAfterWorldMatrixUpdate(i)},this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)},r.prototype.detachFromMesh=function(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)},r.prototype._onRegisterAfterWorldMatrixUpdate=function(e){var t;if(!e.getBoundingInfo)this.setPosition(e.absolutePosition);else{var i=e,n=i.getBoundingInfo();this.setPosition(n.boundingSphere.centerWorld)}((t=A.audioEngine)===null||t===void 0?void 0:t.canUseWebAudio)&&this._isDirectional&&this.isPlaying&&this._updateDirection()},r.prototype.clone=function(){var e=this;if(this._streaming)return null;var t=function(){e._isReadyToPlay?(n._audioBuffer=e.getAudioBuffer(),n._isReadyToPlay=!0,n.autoplay&&n.play(0,e._offset,e._length)):window.setTimeout(t,300)},i={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},n=new r(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,i);return this.useCustomAttenuation&&n.setAttenuationFunction(this._customAttenuationFunction),n.setPosition(this._position),n.setPlaybackRate(this._playbackRate),t(),n},r.prototype.getAudioBuffer=function(){return this._audioBuffer},r.prototype.getSoundSource=function(){return this._soundSource},r.prototype.getSoundGain=function(){return this._soundGain},r.prototype.serialize=function(){var e={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(e.connectedMeshId=this._connectedTransformNode.id),e.position=this._position.asArray(),e.refDistance=this.refDistance,e.distanceModel=this.distanceModel,e.isDirectional=this._isDirectional,e.localDirectionToMesh=this._localDirection.asArray(),e.coneInnerAngle=this._coneInnerAngle,e.coneOuterAngle=this._coneOuterAngle,e.coneOuterGain=this._coneOuterGain),e},r.Parse=function(e,t,i,n){var s=e.name,o;e.url?o=i+e.url:o=i+s;var a={autoplay:e.autoplay,loop:e.loop,volume:e.volume,spatialSound:e.spatialSound,maxDistance:e.maxDistance,rolloffFactor:e.rolloffFactor,refDistance:e.refDistance,distanceModel:e.distanceModel,playbackRate:e.playbackRate},u;if(!n)u=new r(s,o,t,function(){t._removePendingData(u)},a),t._addPendingData(u);else{var h=function(){n._isReadyToPlay?(u._audioBuffer=n.getAudioBuffer(),u._isReadyToPlay=!0,u.autoplay&&u.play(0,u._offset,u._length)):window.setTimeout(h,300)};u=new r(s,new ArrayBuffer(0),t,null,a),h()}if(e.position){var f=F.FromArray(e.position);u.setPosition(f)}if(e.isDirectional&&(u.setDirectionalCone(e.coneInnerAngle||360,e.coneOuterAngle||360,e.coneOuterGain||0),e.localDirectionToMesh)){var l=F.FromArray(e.localDirectionToMesh);u.setLocalDirectionToMesh(l)}if(e.connectedMeshId){var c=t.getMeshById(e.connectedMeshId);c&&u.attachToMesh(c)}return e.metadata&&(u.metadata=e.metadata),u},r._SceneComponentInitialization=function(e){throw V("AudioSceneComponent")},r}(),vi=function(){function r(e,t){t===void 0&&(t={}),this.id=-1,this._isInitialized=!1,e=e||Z.LastCreatedScene,e&&(this._scene=e,this.soundCollection=new Array,this._options=t,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}return r.prototype._initializeSoundTrackAudioGraph=function(){var e;((e=A.audioEngine)===null||e===void 0?void 0:e.canUseWebAudio)&&A.audioEngine.audioContext&&(this._outputAudioNode=A.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(A.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)},r.prototype.dispose=function(){if(A.audioEngine&&A.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},r.prototype.addSound=function(e){var t;this._isInitialized||this._initializeSoundTrackAudioGraph(),((t=A.audioEngine)===null||t===void 0?void 0:t.canUseWebAudio)&&this._outputAudioNode&&e.connectToSoundTrackAudioNode(this._outputAudioNode),e.soundTrackId&&(e.soundTrackId===-1?this._scene.mainSoundTrack.removeSound(e):this._scene.soundTracks&&this._scene.soundTracks[e.soundTrackId].removeSound(e)),this.soundCollection.push(e),e.soundTrackId=this.id},r.prototype.removeSound=function(e){var t=this.soundCollection.indexOf(e);t!==-1&&this.soundCollection.splice(t,1)},r.prototype.setVolume=function(e){var t;((t=A.audioEngine)===null||t===void 0?void 0:t.canUseWebAudio)&&this._outputAudioNode&&(this._outputAudioNode.gain.value=e)},r.prototype.switchPanningModelToHRTF=function(){var e;if(!((e=A.audioEngine)===null||e===void 0)&&e.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()},r.prototype.switchPanningModelToEqualPower=function(){var e;if(!((e=A.audioEngine)===null||e===void 0)&&e.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()},r.prototype.connectToAnalyser=function(e){var t;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=e,((t=A.audioEngine)===null||t===void 0?void 0:t.canUseWebAudio)&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,A.audioEngine.masterGain))},r}(),_e=function(){function r(){}return r.NAME_EFFECTLAYER="EffectLayer",r.NAME_LAYER="Layer",r.NAME_LENSFLARESYSTEM="LensFlareSystem",r.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",r.NAME_PARTICLESYSTEM="ParticleSystem",r.NAME_GAMEPAD="Gamepad",r.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",r.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",r.NAME_PREPASSRENDERER="PrePassRenderer",r.NAME_DEPTHRENDERER="DepthRenderer",r.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",r.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",r.NAME_SPRITE="Sprite",r.NAME_SUBSURFACE="SubSurface",r.NAME_OUTLINERENDERER="Outline",r.NAME_PROCEDURALTEXTURE="ProceduralTexture",r.NAME_SHADOWGENERATOR="ShadowGenerator",r.NAME_OCTREE="Octree",r.NAME_PHYSICSENGINE="PhysicsEngine",r.NAME_AUDIO="Audio",r.STEP_ISREADYFORMESH_EFFECTLAYER=0,r.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,r.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,r.STEP_BEFORECAMERADRAW_PREPASS=0,r.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,r.STEP_BEFORECAMERADRAW_LAYER=2,r.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,r.STEP_BEFORERENDERTARGETDRAW_LAYER=1,r.STEP_BEFORERENDERINGMESH_PREPASS=0,r.STEP_BEFORERENDERINGMESH_OUTLINE=1,r.STEP_AFTERRENDERINGMESH_PREPASS=0,r.STEP_AFTERRENDERINGMESH_OUTLINE=1,r.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,r.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,r.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,r.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,r.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,r.STEP_BEFORECLEAR_PREPASS=1,r.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,r.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,r.STEP_AFTERRENDERTARGETDRAW_LAYER=1,r.STEP_AFTERCAMERADRAW_PREPASS=0,r.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,r.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,r.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,r.STEP_AFTERCAMERADRAW_LAYER=4,r.STEP_AFTERRENDER_AUDIO=0,r.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,r.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,r.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,r.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,r.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,r.STEP_POINTERMOVE_SPRITE=0,r.STEP_POINTERDOWN_SPRITE=0,r.STEP_POINTERUP_SPRITE=0,r}(),q=function(r){Q(e,r);function e(t){return r.apply(this,t)||this}return e.Create=function(){return Object.create(e.prototype)},e.prototype.registerStep=function(t,i,n){for(var s=0,o=Number.MAX_VALUE;s<this.length;s++){var a=this[s];if(o=a.index,t<o)break}this.splice(s,0,{index:t,component:i,action:n.bind(i)})},e.prototype.clear=function(){this.length=0},e}(Array),ye=function(){function r(e){this.length=0,this.data=new Array(e),this._id=r._GlobalId++}return r.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)},r.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this.data[t])},r.prototype.sort=function(e){this.data.sort(e)},r.prototype.reset=function(){this.length=0},r.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},r.prototype.concat=function(e){if(e.length!==0){this.length+e.length>this.data.length&&(this.data.length=(this.length+e.length)*2);for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},r.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},r.prototype.contains=function(e){return this.indexOf(e)!==-1},r._GlobalId=0,r}(),Oe=function(r){Q(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._duplicateId=0,t}return e.prototype.push=function(t){r.prototype.push.call(this,t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(t){return t.__smartArrayFlags&&t.__smartArrayFlags[this._id]===this._duplicateId?!1:(this.push(t),!0)},e.prototype.reset=function(){r.prototype.reset.call(this),this._duplicateId++},e.prototype.concatWithNoDuplicate=function(t){if(t.length!==0){this.length+t.length>this.data.length&&(this.data.length=(this.length+t.length)*2);for(var i=0;i<t.length;i++){var n=(t.data||t)[i];this.pushNoDuplicate(n)}}},e}(ye),Dt=function(){function r(){this._count=0,this._data={}}return r.prototype.copyFrom=function(e){var t=this;this.clear(),e.forEach(function(i,n){return t.add(i,n)})},r.prototype.get=function(e){var t=this._data[e];if(t!==void 0)return t},r.prototype.getOrAddWithFactory=function(e,t){var i=this.get(e);return i!==void 0||(i=t(e),i&&this.add(e,i)),i},r.prototype.getOrAdd=function(e,t){var i=this.get(e);return i!==void 0?i:(this.add(e,t),t)},r.prototype.contains=function(e){return this._data[e]!==void 0},r.prototype.add=function(e,t){return this._data[e]!==void 0?!1:(this._data[e]=t,++this._count,!0)},r.prototype.set=function(e,t){return this._data[e]===void 0?!1:(this._data[e]=t,!0)},r.prototype.getAndRemove=function(e){var t=this.get(e);return t!==void 0?(delete this._data[e],--this._count,t):null},r.prototype.remove=function(e){return this.contains(e)?(delete this._data[e],--this._count,!0):!1},r.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(r.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),r.prototype.forEach=function(e){for(var t in this._data){var i=this._data[t];e(t,i)}},r.prototype.first=function(e){for(var t in this._data){var i=this._data[t],n=e(t,i);if(n)return n}return null},r}(),yi=function(){function r(){}return r.Eval=function(e,t){return e.match(/\([^()]*\)/g)?e=e.replace(/\([^()]*\)/g,function(i){return i=i.slice(1,i.length-1),r._HandleParenthesisContent(i,t)}):e=r._HandleParenthesisContent(e,t),e==="true"?!0:e==="false"?!1:r.Eval(e,t)},r._HandleParenthesisContent=function(e,t){t=t||function(f){return f==="true"};var i,n=e.split("||");for(var s in n)if(Object.prototype.hasOwnProperty.call(n,s)){var o=r._SimplifyNegation(n[s].trim()),a=o.split("&&");if(a.length>1)for(var u=0;u<a.length;++u){var h=r._SimplifyNegation(a[u].trim());if(h!=="true"&&h!=="false"?h[0]==="!"?i=!t(h.substring(1)):i=t(h):i=h==="true",!i){o="false";break}}if(i||o==="true"){i=!0;break}o!=="true"&&o!=="false"?o[0]==="!"?i=!t(o.substring(1)):i=t(o):i=o==="true"}return i?"true":"false"},r._SimplifyNegation=function(e){return e=e.replace(/^[\s!]+/,function(t){return t=t.replace(/[\s]/g,function(){return""}),t.length%2?"!":""}),e=e.trim(),e==="!true"?e="false":e==="!false"&&(e="true"),e},r}(),Se=function(){function r(){}return r.EnableFor=function(e){e._tags=e._tags||{},e.hasTags=function(){return r.HasTags(e)},e.addTags=function(t){return r.AddTagsTo(e,t)},e.removeTags=function(t){return r.RemoveTagsFrom(e,t)},e.matchesTagsQuery=function(t){return r.MatchesQuery(e,t)}},r.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},r.HasTags=function(e){if(!e._tags)return!1;var t=e._tags;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))return!0;return!1},r.GetTags=function(e,t){if(t===void 0&&(t=!0),!e._tags)return null;if(t){var i=[];for(var n in e._tags)Object.prototype.hasOwnProperty.call(e._tags,n)&&e._tags[n]===!0&&i.push(n);return i.join(" ")}else return e._tags},r.AddTagsTo=function(e,t){if(!!t&&typeof t=="string"){var i=t.split(" ");i.forEach(function(n){r._AddTagTo(e,n)})}},r._AddTagTo=function(e,t){t=t.trim(),!(t===""||t==="true"||t==="false")&&(t.match(/[\s]/)||t.match(/^([!]|([|]|[&]){2})/)||(r.EnableFor(e),e._tags[t]=!0))},r.RemoveTagsFrom=function(e,t){if(!!r.HasTags(e)){var i=t.split(" ");for(var n in i)r._RemoveTagFrom(e,i[n])}},r._RemoveTagFrom=function(e,t){delete e._tags[t]},r.MatchesQuery=function(e,t){return t===void 0?!0:t===""?r.HasTags(e):yi.Eval(t,function(i){return r.HasTags(e)&&e._tags[i]})},r}(),ur=function(){function r(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return r.AddParser=function(e,t){this._BabylonFileParsers[e]=t},r.GetParser=function(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null},r.AddIndividualParser=function(e,t){this._IndividualBabylonFileParsers[e]=t},r.GetIndividualParser=function(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null},r.Parse=function(e,t,i,n){for(var s in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,s)&&this._BabylonFileParsers[s](e,t,i,n)},Object.defineProperty(r.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture=e},enumerable:!1,configurable:!0}),r.prototype.getNodes=function(){var e=new Array;return e=e.concat(this.meshes),e=e.concat(this.lights),e=e.concat(this.cameras),e=e.concat(this.transformNodes),this.skeletons.forEach(function(t){return e=e.concat(t.bones)}),e},r._BabylonFileParsers={},r._IndividualBabylonFileParsers={},r}(),Ne=function(){function r(e,t,i){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),this.r=e,this.g=t,this.b=i}return r.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},r.prototype.getClassName=function(){return"Color3"},r.prototype.getHashCode=function(){var e=this.r*255|0;return e=e*397^(this.g*255|0),e=e*397^(this.b*255|0),e},r.prototype.toArray=function(e,t){return t===void 0&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},r.prototype.fromArray=function(e,t){return t===void 0&&(t=0),r.FromArrayToRef(e,t,this),this},r.prototype.toColor4=function(e){return e===void 0&&(e=1),new fe(this.r,this.g,this.b,e)},r.prototype.asArray=function(){return[this.r,this.g,this.b]},r.prototype.toLuminance=function(){return this.r*.3+this.g*.59+this.b*.11},r.prototype.multiply=function(e){return new r(this.r*e.r,this.g*e.g,this.b*e.b)},r.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},r.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},r.prototype.equalsFloats=function(e,t,i){return this.r===e&&this.g===t&&this.b===i},r.prototype.scale=function(e){return new r(this.r*e,this.g*e,this.b*e)},r.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},r.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,this},r.prototype.clampToRef=function(e,t,i){return e===void 0&&(e=0),t===void 0&&(t=1),i.r=B.Clamp(this.r,e,t),i.g=B.Clamp(this.g,e,t),i.b=B.Clamp(this.b,e,t),this},r.prototype.add=function(e){return new r(this.r+e.r,this.g+e.g,this.b+e.b)},r.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},r.prototype.subtract=function(e){return new r(this.r-e.r,this.g-e.g,this.b-e.b)},r.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},r.prototype.clone=function(){return new r(this.r,this.g,this.b)},r.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},r.prototype.copyFromFloats=function(e,t,i){return this.r=e,this.g=t,this.b=i,this},r.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},r.prototype.toHexString=function(){var e=Math.round(this.r*255),t=Math.round(this.g*255),i=Math.round(this.b*255);return"#"+B.ToHex(e)+B.ToHex(t)+B.ToHex(i)},r.prototype.toLinearSpace=function(){var e=new r;return this.toLinearSpaceToRef(e),e},r.prototype.toHSV=function(){var e=new r;return this.toHSVToRef(e),e},r.prototype.toHSVToRef=function(e){var t=this.r,i=this.g,n=this.b,s=Math.max(t,i,n),o=Math.min(t,i,n),a=0,u=0,h=s,f=s-o;s!==0&&(u=f/s),s!=o&&(s==t?(a=(i-n)/f,i<n&&(a+=6)):s==i?a=(n-t)/f+2:s==n&&(a=(t-i)/f+4),a*=60),e.r=a,e.g=u,e.b=h},r.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,Ue),e.g=Math.pow(this.g,Ue),e.b=Math.pow(this.b,Ue),this},r.prototype.toGammaSpace=function(){var e=new r;return this.toGammaSpaceToRef(e),e},r.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,Le),e.g=Math.pow(this.g,Le),e.b=Math.pow(this.b,Le),this},r.HSVtoRGBToRef=function(e,t,i,n){var s=i*t,o=e/60,a=s*(1-Math.abs(o%2-1)),u=0,h=0,f=0;o>=0&&o<=1?(u=s,h=a):o>=1&&o<=2?(u=a,h=s):o>=2&&o<=3?(h=s,f=a):o>=3&&o<=4?(h=a,f=s):o>=4&&o<=5?(u=a,f=s):o>=5&&o<=6&&(u=s,f=a);var l=i-s;n.set(u+l,h+l,f+l)},r.FromHexString=function(e){if(e.substring(0,1)!=="#"||e.length!==7)return new r(0,0,0);var t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16);return r.FromInts(t,i,n)},r.FromArray=function(e,t){return t===void 0&&(t=0),new r(e[t],e[t+1],e[t+2])},r.FromArrayToRef=function(e,t,i){t===void 0&&(t=0),i.r=e[t],i.g=e[t+1],i.b=e[t+2]},r.FromInts=function(e,t,i){return new r(e/255,t/255,i/255)},r.Lerp=function(e,t,i){var n=new r(0,0,0);return r.LerpToRef(e,t,i,n),n},r.LerpToRef=function(e,t,i,n){n.r=e.r+(t.r-e.r)*i,n.g=e.g+(t.g-e.g)*i,n.b=e.b+(t.b-e.b)*i},r.Hermite=function(e,t,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,f=a-2*o+s,l=a-o,c=e.r*u+i.r*h+t.r*f+n.r*l,_=e.g*u+i.g*h+t.g*f+n.g*l,d=e.b*u+i.b*h+t.b*f+n.b*l;return new r(c,_,d)},r.Hermite1stDerivative=function(e,t,i,n,s){var o=r.Black();return this.Hermite1stDerivativeToRef(e,t,i,n,s,o),o},r.Hermite1stDerivativeToRef=function(e,t,i,n,s,o){var a=s*s;o.r=(a-s)*6*e.r+(3*a-4*s+1)*t.r+(-a+s)*6*i.r+(3*a-2*s)*n.r,o.g=(a-s)*6*e.g+(3*a-4*s+1)*t.g+(-a+s)*6*i.g+(3*a-2*s)*n.g,o.b=(a-s)*6*e.b+(3*a-4*s+1)*t.b+(-a+s)*6*i.b+(3*a-2*s)*n.b},r.Red=function(){return new r(1,0,0)},r.Green=function(){return new r(0,1,0)},r.Blue=function(){return new r(0,0,1)},r.Black=function(){return new r(0,0,0)},Object.defineProperty(r,"BlackReadOnly",{get:function(){return r._BlackReadOnly},enumerable:!1,configurable:!0}),r.White=function(){return new r(1,1,1)},r.Purple=function(){return new r(.5,0,.5)},r.Magenta=function(){return new r(1,0,1)},r.Yellow=function(){return new r(1,1,0)},r.Gray=function(){return new r(.5,.5,.5)},r.Teal=function(){return new r(0,1,1)},r.Random=function(){return new r(Math.random(),Math.random(),Math.random())},r._BlackReadOnly=r.Black(),r}(),fe=function(){function r(e,t,i,n){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),n===void 0&&(n=1),this.r=e,this.g=t,this.b=i,this.a=n}return r.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},r.prototype.asArray=function(){return[this.r,this.g,this.b,this.a]},r.prototype.toArray=function(e,t){return t===void 0&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},r.prototype.fromArray=function(e,t){return t===void 0&&(t=0),r.FromArrayToRef(e,t,this),this},r.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a},r.prototype.add=function(e){return new r(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)},r.prototype.subtract=function(e){return new r(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)},r.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},r.prototype.scale=function(e){return new r(this.r*e,this.g*e,this.b*e,this.a*e)},r.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},r.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,this},r.prototype.clampToRef=function(e,t,i){return e===void 0&&(e=0),t===void 0&&(t=1),i.r=B.Clamp(this.r,e,t),i.g=B.Clamp(this.g,e,t),i.b=B.Clamp(this.b,e,t),i.a=B.Clamp(this.a,e,t),this},r.prototype.multiply=function(e){return new r(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)},r.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t},r.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},r.prototype.getClassName=function(){return"Color4"},r.prototype.getHashCode=function(){var e=this.r*255|0;return e=e*397^(this.g*255|0),e=e*397^(this.b*255|0),e=e*397^(this.a*255|0),e},r.prototype.clone=function(){return new r(this.r,this.g,this.b,this.a)},r.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},r.prototype.copyFromFloats=function(e,t,i,n){return this.r=e,this.g=t,this.b=i,this.a=n,this},r.prototype.set=function(e,t,i,n){return this.copyFromFloats(e,t,i,n)},r.prototype.toHexString=function(e){e===void 0&&(e=!1);var t=Math.round(this.r*255),i=Math.round(this.g*255),n=Math.round(this.b*255);if(e)return"#"+B.ToHex(t)+B.ToHex(i)+B.ToHex(n);var s=Math.round(this.a*255);return"#"+B.ToHex(t)+B.ToHex(i)+B.ToHex(n)+B.ToHex(s)},r.prototype.toLinearSpace=function(){var e=new r;return this.toLinearSpaceToRef(e),e},r.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,Ue),e.g=Math.pow(this.g,Ue),e.b=Math.pow(this.b,Ue),e.a=this.a,this},r.prototype.toGammaSpace=function(){var e=new r;return this.toGammaSpaceToRef(e),e},r.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,Le),e.g=Math.pow(this.g,Le),e.b=Math.pow(this.b,Le),e.a=this.a,this},r.FromHexString=function(e){if(e.substring(0,1)!=="#"||e.length!==9&&e.length!==7)return new r(0,0,0,0);var t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16),s=e.length===9?parseInt(e.substring(7,9),16):255;return r.FromInts(t,i,n,s)},r.Lerp=function(e,t,i){var n=new r(0,0,0,0);return r.LerpToRef(e,t,i,n),n},r.LerpToRef=function(e,t,i,n){n.r=e.r+(t.r-e.r)*i,n.g=e.g+(t.g-e.g)*i,n.b=e.b+(t.b-e.b)*i,n.a=e.a+(t.a-e.a)*i},r.Hermite=function(e,t,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,f=a-2*o+s,l=a-o,c=e.r*u+i.r*h+t.r*f+n.r*l,_=e.g*u+i.g*h+t.g*f+n.g*l,d=e.b*u+i.b*h+t.b*f+n.b*l,g=e.a*u+i.a*h+t.a*f+n.a*l;return new r(c,_,d,g)},r.Hermite1stDerivative=function(e,t,i,n,s){var o=new r;return this.Hermite1stDerivativeToRef(e,t,i,n,s,o),o},r.Hermite1stDerivativeToRef=function(e,t,i,n,s,o){var a=s*s;o.r=(a-s)*6*e.r+(3*a-4*s+1)*t.r+(-a+s)*6*i.r+(3*a-2*s)*n.r,o.g=(a-s)*6*e.g+(3*a-4*s+1)*t.g+(-a+s)*6*i.g+(3*a-2*s)*n.g,o.b=(a-s)*6*e.b+(3*a-4*s+1)*t.b+(-a+s)*6*i.b+(3*a-2*s)*n.b,o.a=(a-s)*6*e.a+(3*a-4*s+1)*t.a+(-a+s)*6*i.a+(3*a-2*s)*n.a},r.FromColor3=function(e,t){return t===void 0&&(t=1),new r(e.r,e.g,e.b,t)},r.FromArray=function(e,t){return t===void 0&&(t=0),new r(e[t],e[t+1],e[t+2],e[t+3])},r.FromArrayToRef=function(e,t,i){t===void 0&&(t=0),i.r=e[t],i.g=e[t+1],i.b=e[t+2],i.a=e[t+3]},r.FromInts=function(e,t,i,n){return new r(e/255,t/255,i/255,n/255)},r.CheckColors4=function(e,t){if(e.length===t*3){for(var i=[],n=0;n<e.length;n+=3){var s=n/3*4;i[s]=e[n],i[s+1]=e[n+1],i[s+2]=e[n+2],i[s+3]=1}return i}return e},r}(),mi=function(){function r(){}return r.Color3=me.BuildArray(3,Ne.Black),r.Color4=me.BuildArray(3,function(){return new fe(0,0,0,0)}),r}();ke("BABYLON.Color3",Ne);ke("BABYLON.Color4",fe);var bi=Object.freeze(Object.defineProperty({__proto__:null,Color3:Ne,Color4:fe,TmpColors:mi},Symbol.toStringTag,{value:"Module"})),it={},$e={},Bt=function(r,e,t){var i=r();Se&&Se.AddTagsTo(i,e.tags);var n=gt(i);for(var s in n){var o=n[s],a=e[s],u=o.type;if(a!=null&&(s!=="uniqueId"||Ae.AllowLoadingUniqueId))switch(u){case 0:case 6:case 11:i[s]=a;break;case 1:i[s]=t||a.isRenderTarget?a:a.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:i[s]=t?a:a.clone();break}}return i};function Ti(r){var e=r.getClassName();return it[e]||(it[e]={}),it[e]}function gt(r){var e=r.getClassName();if($e[e])return $e[e];$e[e]={};for(var t=$e[e],i=r,n=e;n;){var s=it[n];for(var o in s)t[o]=s[o];var a=void 0,u=!1;do{if(a=Object.getPrototypeOf(i),!a.getClassName){u=!0;break}if(a.getClassName()!==n)break;i=a}while(a);if(u)break;n=a.getClassName(),i=a}return t}function Ee(r,e){return function(t,i){var n=Ti(t);n[i]||(n[i]={type:r,sourceName:e})}}function Ei(r,e){return e===void 0&&(e=null),function(t,i){var n=e||"_"+i;Object.defineProperty(t,i,{get:function(){return this[n]},set:function(s){typeof this.equals=="function"&&this.equals(s)||this[n]!==s&&(this[n]=s,t[r].apply(this))},enumerable:!0,configurable:!0})}}function ji(r,e){return e===void 0&&(e=null),Ei(r,e)}function G(r){return Ee(0,r)}function Ri(r){return Ee(1,r)}function Xi(r){return Ee(2,r)}function Yi(r){return Ee(3,r)}function qi(r){return Ee(4,r)}function Zi(r){return Ee(5,r)}function Qi(r){return Ee(6,r)}function Ai(r){return Ee(7,r)}function Pi(r){return Ee(8,r)}function Ji(r){return Ee(10,r)}var Ae=function(){function r(){}return r.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var i=0;i<e.animations.length;i++){var n=e.animations[i];t.animations.push(n.serialize())}}},r.Serialize=function(e,t){t||(t={}),Se&&(t.tags=Se.GetTags(e));var i=gt(e);for(var n in i){var s=i[n],o=s.sourceName||n,a=s.type,u=e[n];if(u!=null&&(n!=="uniqueId"||r.AllowLoadingUniqueId))switch(a){case 0:t[o]=u;break;case 1:t[o]=u.serialize();break;case 2:t[o]=u.asArray();break;case 3:t[o]=u.serialize();break;case 4:t[o]=u.asArray();break;case 5:t[o]=u.asArray();break;case 6:t[o]=u.id;break;case 7:t[o]=u.serialize();break;case 8:t[o]=u.asArray();break;case 9:t[o]=u.serialize();break;case 10:t[o]=u.asArray();break;case 11:t[o]=u.id;break;case 12:t[o]=u.asArray();break}}return t},r.Parse=function(e,t,i,n){n===void 0&&(n=null);var s=e();n||(n=""),Se&&Se.AddTagsTo(s,t.tags);var o=gt(s);for(var a in o){var u=o[a],h=t[u.sourceName||a],f=u.type;if(h!=null&&(a!=="uniqueId"||r.AllowLoadingUniqueId)){var l=s;switch(f){case 0:l[a]=h;break;case 1:i&&(l[a]=r._TextureParser(h,i,n));break;case 2:l[a]=Ne.FromArray(h);break;case 3:l[a]=r._FresnelParametersParser(h);break;case 4:l[a]=de.FromArray(h);break;case 5:l[a]=F.FromArray(h);break;case 6:i&&(l[a]=i.getLastMeshById(h));break;case 7:l[a]=r._ColorCurvesParser(h);break;case 8:l[a]=fe.FromArray(h);break;case 9:l[a]=r._ImageProcessingConfigurationParser(h);break;case 10:l[a]=be.FromArray(h);break;case 11:i&&(l[a]=i.getCameraById(h));break;case 12:l[a]=oe.FromArray(h);break}}}return s},r.Clone=function(e,t){return Bt(e,t,!1)},r.Instanciate=function(e,t){return Bt(e,t,!0)},r.AllowLoadingUniqueId=!1,r._ImageProcessingConfigurationParser=function(e){throw V("ImageProcessingConfiguration")},r._FresnelParametersParser=function(e){throw V("FresnelParameters")},r._ColorCurvesParser=function(e){throw V("ColorCurves")},r._TextureParser=function(e,t,i){throw V("Texture")},r}();function It(r,e,t,i){var n=t.value;t.value=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=n;if(typeof _native!="undefined"&&_native[e]){var u=_native[e];i?a=function(){for(var h=[],f=0;f<arguments.length;f++)h[f]=arguments[f];return i.apply(void 0,h)?u.apply(void 0,h):n.apply(void 0,h)}:a=u}return r[e]=a,a.apply(void 0,s)}}It.filter=function(r){return function(e,t,i){return It(e,t,i,r)}};var Ci=function(){function r(e){if(this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=e,e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&this._setDefaultValue(t)}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),r.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},r.prototype.markAsUnprocessed=function(){this._isDirty=!0},r.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},r.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},r.prototype.markAsLightDirty=function(e){e===void 0&&(e=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0},r.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},r.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},r.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},r.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},r.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},r.prototype.rebuild=function(){this._keys=[];for(var e=0,t=Object.keys(this);e<t.length;e++){var i=t[e];i[0]!=="_"&&this._keys.push(i)}if(this._externalProperties)for(var n in this._externalProperties)this._keys.indexOf(n)===-1&&this._keys.push(n)},r.prototype.isEqual=function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var i=this._keys[t];if(this[i]!==e[i])return!1}return!0},r.prototype.cloneTo=function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var i=this._keys[t];e[i]=this[i]}},r.prototype.reset=function(){var e=this;this._keys.forEach(function(t){return e._setDefaultValue(t)})},r.prototype._setDefaultValue=function(e){var t,i,n,s,o,a=(n=(i=(t=this._externalProperties)===null||t===void 0?void 0:t[e])===null||i===void 0?void 0:i.type)!==null&&n!==void 0?n:typeof this[e],u=(o=(s=this._externalProperties)===null||s===void 0?void 0:s[e])===null||o===void 0?void 0:o.default;switch(a){case"number":this[e]=u!=null?u:0;break;case"string":this[e]=u!=null?u:"";break;default:this[e]=u!=null?u:!1;break}},r.prototype.toString=function(){for(var e="",t=0;t<this._keys.length;t++){var i=this._keys[t],n=this[i],s=typeof n;switch(s){case"number":case"string":e+="#define "+i+" "+n+`
`;break;default:n&&(e+="#define "+i+`
`);break}}return e},r}(),nt=function(){function r(){this._dirty=!0,this._tempColor=new fe(0,0,0,0),this._globalCurve=new fe(0,0,0,0),this._highlightsCurve=new fe(0,0,0,0),this._midtonesCurve=new fe(0,0,0,0),this._shadowsCurve=new fe(0,0,0,0),this._positiveCurve=new fe(0,0,0,0),this._negativeCurve=new fe(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(r.prototype,"globalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),r.prototype.getClassName=function(){return"ColorCurves"},r.Bind=function(e,t,i,n,s){i===void 0&&(i="vCameraColorCurvePositive"),n===void 0&&(n="vCameraColorCurveNeutral"),s===void 0&&(s="vCameraColorCurveNegative"),e._dirty&&(e._dirty=!1,e._getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e._getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e._getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e._getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(n,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(s,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))},r.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},r.prototype._getColorGradingDataToRef=function(e,t,i,n,s){e!=null&&(e=r._Clamp(e,0,360),t=r._Clamp(t,-100,100),i=r._Clamp(i,-100,100),n=r._Clamp(n,-100,100),t=r._ApplyColorGradingSliderNonlinear(t),t*=.5,n=r._ApplyColorGradingSliderNonlinear(n),t<0&&(t*=-1,e=(e+180)%360),r._FromHSBToRef(e,t,50+.25*n,s),s.scaleToRef(2,s),s.a=1+.01*i)},r._ApplyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100,t},r._FromHSBToRef=function(e,t,i,n){var s=r._Clamp(e,0,360),o=r._Clamp(t/100,0,1),a=r._Clamp(i/100,0,1);if(o===0)n.r=a,n.g=a,n.b=a;else{s/=60;var u=Math.floor(s),h=s-u,f=a*(1-o),l=a*(1-o*h),c=a*(1-o*(1-h));switch(u){case 0:n.r=a,n.g=c,n.b=f;break;case 1:n.r=l,n.g=a,n.b=f;break;case 2:n.r=f,n.g=a,n.b=c;break;case 3:n.r=f,n.g=l,n.b=a;break;case 4:n.r=c,n.g=f,n.b=a;break;default:n.r=a,n.g=f,n.b=l;break}}n.a=1},r._Clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},r.prototype.clone=function(){return Ae.Clone(function(){return new r},this)},r.prototype.serialize=function(){return Ae.Serialize(this)},r.Parse=function(e){return Ae.Parse(function(){return new r},e,null,null)},N([G()],r.prototype,"_globalHue",void 0),N([G()],r.prototype,"_globalDensity",void 0),N([G()],r.prototype,"_globalSaturation",void 0),N([G()],r.prototype,"_globalExposure",void 0),N([G()],r.prototype,"_highlightsHue",void 0),N([G()],r.prototype,"_highlightsDensity",void 0),N([G()],r.prototype,"_highlightsSaturation",void 0),N([G()],r.prototype,"_highlightsExposure",void 0),N([G()],r.prototype,"_midtonesHue",void 0),N([G()],r.prototype,"_midtonesDensity",void 0),N([G()],r.prototype,"_midtonesSaturation",void 0),N([G()],r.prototype,"_midtonesExposure",void 0),r}();Ae._ColorCurvesParser=nt.Parse;var $i=function(r){Q(e,r);function e(){var t=r.call(this)||this;return t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return e}(Ci),vt=function(){function r(){this.colorCurves=new nt,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=r.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new fe(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=r.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new E}return Object.defineProperty(r.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"contrast",{get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"skipFinalColorClamp",{get:function(){return this._skipFinalColorClamp},set:function(e){this._skipFinalColorClamp!==e&&(this._skipFinalColorClamp=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),r.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},r.prototype.getClassName=function(){return"ImageProcessingConfiguration"},r.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),t.VIGNETTE&&(e.push("vInverseScreenSize"),e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&nt.PrepareUniforms(e)},r.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},r.prototype.prepareDefines=function(e,t){if(t===void 0&&(t=!1),t!==this.applyByPostProcess||!this._isEnabled){e.VIGNETTE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.IMAGEPROCESSING=!1,e.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled;return}switch(e.VIGNETTE=this.vignetteEnabled,e.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===r._VIGNETTEMODE_MULTIPLY,e.VIGNETTEBLENDMODEOPAQUE=!e.VIGNETTEBLENDMODEMULTIPLY,e.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case r.TONEMAPPING_ACES:e.TONEMAPPING_ACES=!0;break;default:e.TONEMAPPING_ACES=!1;break}e.CONTRAST=this.contrast!==1,e.EXPOSURE=this.exposure!==1,e.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,e.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,e.COLORGRADING?e.COLORGRADING3D=this.colorGradingTexture.is3D:e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,e.SAMPLER3DBGRMAP=this.colorGradingBGR,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,e.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,e.IMAGEPROCESSING=e.VIGNETTE||e.TONEMAPPING||e.CONTRAST||e.EXPOSURE||e.COLORCURVES||e.COLORGRADING},r.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},r.prototype.bind=function(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&nt.Bind(this.colorCurves,e),this._vignetteEnabled){var i=1/e.getEngine().getRenderWidth(),n=1/e.getEngine().getRenderHeight();e.setFloat2("vInverseScreenSize",i,n);var s=t!=null?t:n/i,o=Math.tan(this.vignetteCameraFov*.5),a=o*s,u=Math.sqrt(a*o);a=le.Mix(a,u,this.vignetteStretch),o=le.Mix(o,u,this.vignetteStretch),e.setFloat4("vignetteSettings1",a,o,-a*this.vignetteCentreX,-o*this.vignetteCentreY);var h=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,h)}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);var f=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(f-1)/f,.5/f,f,this.colorGradingTexture.level)}},r.prototype.clone=function(){return Ae.Clone(function(){return new r},this)},r.prototype.serialize=function(){return Ae.Serialize(this)},r.Parse=function(e){return Ae.Parse(function(){return new r},e,null,null)},Object.defineProperty(r,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(r,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),r.TONEMAPPING_STANDARD=0,r.TONEMAPPING_ACES=1,r._VIGNETTEMODE_MULTIPLY=0,r._VIGNETTEMODE_OPAQUE=1,N([Ai()],r.prototype,"colorCurves",void 0),N([G()],r.prototype,"_colorCurvesEnabled",void 0),N([Ri("colorGradingTexture")],r.prototype,"_colorGradingTexture",void 0),N([G()],r.prototype,"_colorGradingEnabled",void 0),N([G()],r.prototype,"_colorGradingWithGreenDepth",void 0),N([G()],r.prototype,"_colorGradingBGR",void 0),N([G()],r.prototype,"_exposure",void 0),N([G()],r.prototype,"_toneMappingEnabled",void 0),N([G()],r.prototype,"_toneMappingType",void 0),N([G()],r.prototype,"_contrast",void 0),N([G()],r.prototype,"vignetteStretch",void 0),N([G()],r.prototype,"vignetteCentreX",void 0),N([G()],r.prototype,"vignetteCentreY",void 0),N([G()],r.prototype,"vignetteWeight",void 0),N([Pi()],r.prototype,"vignetteColor",void 0),N([G()],r.prototype,"vignetteCameraFov",void 0),N([G()],r.prototype,"_vignetteBlendMode",void 0),N([G()],r.prototype,"_vignetteEnabled",void 0),N([G()],r.prototype,"_skipFinalColorClamp",void 0),N([G()],r.prototype,"_applyByPostProcess",void 0),N([G()],r.prototype,"_isEnabled",void 0),r}();Ae._ImageProcessingConfigurationParser=vt.Parse;$.prototype.createUniformBuffer=function(r){var e=this._gl.createBuffer();if(!e)throw new Error("Unable to create uniform buffer");var t=new Ye(e);return this.bindUniformBuffer(t),r instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,r,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(r),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),t.references=1,t};$.prototype.createDynamicUniformBuffer=function(r){var e=this._gl.createBuffer();if(!e)throw new Error("Unable to create dynamic uniform buffer");var t=new Ye(e);return this.bindUniformBuffer(t),r instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,r,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(r),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),t.references=1,t};$.prototype.updateUniformBuffer=function(r,e,t,i){this.bindUniformBuffer(r),t===void 0&&(t=0),i===void 0?e instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,t,e):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,t,new Float32Array(e)):e instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,e.subarray(t,t+i)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(e).subarray(t,t+i)),this.bindUniformBuffer(null)};$.prototype.bindUniformBuffer=function(r){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,r?r.underlyingResource:null)};$.prototype.bindUniformBufferBase=function(r,e,t){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,e,r?r.underlyingResource:null)};$.prototype.bindUniformBlock=function(r,e,t){var i=r.program,n=this._gl.getUniformBlockIndex(i,e);n!==4294967295&&this._gl.uniformBlockBinding(i,n,t)};var Si=function(){function r(e,t,i,n,s){s===void 0&&(s=!1),this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers||s,this._dynamic=i,this._name=n!=null?n:"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform)}return Object.defineProperty(r.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),r.prototype.isDynamic=function(){return this._dynamic!==void 0},r.prototype.getData=function(){return this._bufferData},r.prototype.getBuffer=function(){return this._buffer},r.prototype._fillAlignment=function(e){var t;if(e<=2?t=e:t=4,this._uniformLocationPointer%t!==0){var i=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var n=this._uniformLocationPointer-i,s=0;s<n;s++)this._data.push(0)}},r.prototype.addUniform=function(e,t,i){if(i===void 0&&(i=0),!this._noUBO&&this._uniformLocations[e]===void 0){var n;if(i>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;if(this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:i},t==16)t=t*i;else{var s=4-t,o=s*i;t=t*i+o}n=[];for(var a=0;a<t;a++)n.push(0)}else{if(t instanceof Array)n=t,t=n.length;else{t=t,n=[];for(var a=0;a<t;a++)n.push(0)}this._fillAlignment(t)}this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(var a=0;a<t;a++)this._data.push(n[a]);this._needSync=!0}},r.prototype.addMatrix=function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))},r.prototype.addFloat2=function(e,t,i){var n=[t,i];this.addUniform(e,n)},r.prototype.addFloat3=function(e,t,i,n){var s=[t,i,n];this.addUniform(e,s)},r.prototype.addColor3=function(e,t){var i=[t.r,t.g,t.b];this.addUniform(e,i)},r.prototype.addColor4=function(e,t,i){var n=[t.r,t.g,t.b,i];this.addUniform(e,n)},r.prototype.addVector3=function(e,t){var i=[t.x,t.y,t.z];this.addUniform(e,i)},r.prototype.addMatrix3x3=function(e){this.addUniform(e,12)},r.prototype.addMatrix2x2=function(e){this.addUniform(e,8)},r.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},r.prototype._rebuild=function(){this._noUBO||!this._bufferData||(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))},Object.defineProperty(r.prototype,"_numBuffers",{get:function(){return this._buffers.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"_indexBuffer",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),r.prototype._buffersEqual=function(e,t){for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0},r.prototype._copyBuffer=function(e,t){for(var i=0;i<e.length;++i)t[i]=e[i]},r.prototype.update=function(){if(!this._noUBO){if(this.bindUniformBuffer(),!this._buffer){this.create();return}if(!this._dynamic&&!this._needSync){this._createBufferOnWrite=this._engine._features.trackUbosInFrame;return}if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1])if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1])){this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame;return}else this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1]);this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(r._UpdatedUbosInFrame[this._name]||(r._UpdatedUbosInFrame[this._name]=0),r._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}},r.prototype._createNewBuffer=function(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()},r.prototype._checkNewFrame=function(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=this._bufferIndex!==0,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)},r.prototype.updateUniform=function(e,t,i){this._checkNewFrame();var n=this._uniformLocations[e];if(n===void 0){if(this._buffer){D.Error("Cannot add an uniform after UBO has been created.");return}this.addUniform(e,i),n=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(var o=0;o<i;o++)this._bufferData[n+o]=t[o];else{for(var s=!1,o=0;o<i;o++)(i===16&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[n+o]!==le.FloatRound(t[o]))&&(s=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[n+o]=t[o]);this._needSync=this._needSync||s}},r.prototype.updateUniformArray=function(e,t,i){this._checkNewFrame();var n=this._uniformLocations[e];if(n===void 0){D.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform.");return}this._buffer||this.create();var s=this._uniformArraySizes[e];if(this._dynamic)for(var h=0;h<i;h++)this._bufferData[n+h]=t[h];else{for(var o=!1,a=0,u=0,h=0;h<i;h++)if(this._bufferData[n+u*4+a]!==le.FloatRound(t[h])&&(o=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[n+u*4+a]=t[h]),a++,a===s.strideSize){for(;a<4;a++)this._bufferData[n+u*4+a]=0;a=0,u++}this._needSync=this._needSync||o}},r.prototype._cacheMatrix=function(e,t){this._checkNewFrame();var i=this._valueCache[e],n=t.updateFlag;return i!==void 0&&i===n?!1:(this._valueCache[e]=n,!0)},r.prototype._updateMatrix3x3ForUniform=function(e,t){for(var i=0;i<3;i++)r._TempBuffer[i*4]=t[i*3],r._TempBuffer[i*4+1]=t[i*3+1],r._TempBuffer[i*4+2]=t[i*3+2],r._TempBuffer[i*4+3]=0;this.updateUniform(e,r._TempBuffer,12)},r.prototype._updateMatrix3x3ForEffect=function(e,t){this._currentEffect.setMatrix3x3(e,t)},r.prototype._updateMatrix2x2ForEffect=function(e,t){this._currentEffect.setMatrix2x2(e,t)},r.prototype._updateMatrix2x2ForUniform=function(e,t){for(var i=0;i<2;i++)r._TempBuffer[i*4]=t[i*2],r._TempBuffer[i*4+1]=t[i*2+1],r._TempBuffer[i*4+2]=0,r._TempBuffer[i*4+3]=0;this.updateUniform(e,r._TempBuffer,8)},r.prototype._updateFloatForEffect=function(e,t){this._currentEffect.setFloat(e,t)},r.prototype._updateFloatForUniform=function(e,t){r._TempBuffer[0]=t,this.updateUniform(e,r._TempBuffer,1)},r.prototype._updateFloat2ForEffect=function(e,t,i,n){n===void 0&&(n=""),this._currentEffect.setFloat2(e+n,t,i)},r.prototype._updateFloat2ForUniform=function(e,t,i){r._TempBuffer[0]=t,r._TempBuffer[1]=i,this.updateUniform(e,r._TempBuffer,2)},r.prototype._updateFloat3ForEffect=function(e,t,i,n,s){s===void 0&&(s=""),this._currentEffect.setFloat3(e+s,t,i,n)},r.prototype._updateFloat3ForUniform=function(e,t,i,n){r._TempBuffer[0]=t,r._TempBuffer[1]=i,r._TempBuffer[2]=n,this.updateUniform(e,r._TempBuffer,3)},r.prototype._updateFloat4ForEffect=function(e,t,i,n,s,o){o===void 0&&(o=""),this._currentEffect.setFloat4(e+o,t,i,n,s)},r.prototype._updateFloat4ForUniform=function(e,t,i,n,s){r._TempBuffer[0]=t,r._TempBuffer[1]=i,r._TempBuffer[2]=n,r._TempBuffer[3]=s,this.updateUniform(e,r._TempBuffer,4)},r.prototype._updateFloatArrayForEffect=function(e,t){this._currentEffect.setFloatArray(e,t)},r.prototype._updateFloatArrayForUniform=function(e,t){this.updateUniformArray(e,t,t.length)},r.prototype._updateArrayForEffect=function(e,t){this._currentEffect.setArray(e,t)},r.prototype._updateArrayForUniform=function(e,t){this.updateUniformArray(e,t,t.length)},r.prototype._updateIntArrayForEffect=function(e,t){this._currentEffect.setIntArray(e,t)},r.prototype._updateIntArrayForUniform=function(e,t){r._TempBufferInt32View.set(t),this.updateUniformArray(e,r._TempBuffer,t.length)},r.prototype._updateMatrixForEffect=function(e,t){this._currentEffect.setMatrix(e,t)},r.prototype._updateMatrixForUniform=function(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.toArray(),16)},r.prototype._updateMatricesForEffect=function(e,t){this._currentEffect.setMatrices(e,t)},r.prototype._updateMatricesForUniform=function(e,t){this.updateUniform(e,t,t.length)},r.prototype._updateVector3ForEffect=function(e,t){this._currentEffect.setVector3(e,t)},r.prototype._updateVector3ForUniform=function(e,t){r._TempBuffer[0]=t.x,r._TempBuffer[1]=t.y,r._TempBuffer[2]=t.z,this.updateUniform(e,r._TempBuffer,3)},r.prototype._updateVector4ForEffect=function(e,t){this._currentEffect.setVector4(e,t)},r.prototype._updateVector4ForUniform=function(e,t){r._TempBuffer[0]=t.x,r._TempBuffer[1]=t.y,r._TempBuffer[2]=t.z,r._TempBuffer[3]=t.w,this.updateUniform(e,r._TempBuffer,4)},r.prototype._updateColor3ForEffect=function(e,t,i){i===void 0&&(i=""),this._currentEffect.setColor3(e+i,t)},r.prototype._updateColor3ForUniform=function(e,t){r._TempBuffer[0]=t.r,r._TempBuffer[1]=t.g,r._TempBuffer[2]=t.b,this.updateUniform(e,r._TempBuffer,3)},r.prototype._updateColor4ForEffect=function(e,t,i,n){n===void 0&&(n=""),this._currentEffect.setColor4(e+n,t,i)},r.prototype._updateDirectColor4ForEffect=function(e,t,i){i===void 0&&(i=""),this._currentEffect.setDirectColor4(e+i,t)},r.prototype._updateColor4ForUniform=function(e,t,i){r._TempBuffer[0]=t.r,r._TempBuffer[1]=t.g,r._TempBuffer[2]=t.b,r._TempBuffer[3]=i,this.updateUniform(e,r._TempBuffer,4)},r.prototype._updateDirectColor4ForUniform=function(e,t){r._TempBuffer[0]=t.r,r._TempBuffer[1]=t.g,r._TempBuffer[2]=t.b,r._TempBuffer[3]=t.a,this.updateUniform(e,r._TempBuffer,4)},r.prototype._updateIntForEffect=function(e,t,i){i===void 0&&(i=""),this._currentEffect.setInt(e+i,t)},r.prototype._updateIntForUniform=function(e,t){r._TempBufferInt32View[0]=t,this.updateUniform(e,r._TempBuffer,1)},r.prototype._updateInt2ForEffect=function(e,t,i,n){n===void 0&&(n=""),this._currentEffect.setInt2(e+n,t,i)},r.prototype._updateInt2ForUniform=function(e,t,i){r._TempBufferInt32View[0]=t,r._TempBufferInt32View[1]=i,this.updateUniform(e,r._TempBuffer,2)},r.prototype._updateInt3ForEffect=function(e,t,i,n,s){s===void 0&&(s=""),this._currentEffect.setInt3(e+s,t,i,n)},r.prototype._updateInt3ForUniform=function(e,t,i,n){r._TempBufferInt32View[0]=t,r._TempBufferInt32View[1]=i,r._TempBufferInt32View[2]=n,this.updateUniform(e,r._TempBuffer,3)},r.prototype._updateInt4ForEffect=function(e,t,i,n,s,o){o===void 0&&(o=""),this._currentEffect.setInt4(e+o,t,i,n,s)},r.prototype._updateInt4ForUniform=function(e,t,i,n,s){r._TempBufferInt32View[0]=t,r._TempBufferInt32View[1]=i,r._TempBufferInt32View[2]=n,r._TempBufferInt32View[3]=s,this.updateUniform(e,r._TempBuffer,4)},r.prototype.setTexture=function(e,t){this._currentEffect.setTexture(e,t)},r.prototype.updateUniformDirectly=function(e,t){this.updateUniform(e,t,t.length),this.update()},r.prototype.bindToEffect=function(e,t){this._currentEffect=e,this._currentEffectName=t},r.prototype.bindUniformBuffer=function(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)},r.prototype.unbindEffect=function(){this._currentEffect=void 0,this._currentEffectName=void 0},r.prototype.setDataBuffer=function(e){if(!this._buffers)return this._buffer===e;for(var t=0;t<this._buffers.length;++t){var i=this._buffers[t];if(i[0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1},r.prototype.dispose=function(){if(!this._noUBO){var e=this._engine._uniformBuffers,t=e.indexOf(this);if(t!==-1&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(var i=0;i<this._buffers.length;++i){var n=this._buffers[i][0];this._engine._releaseBuffer(n)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},r._UpdatedUbosInFrame={},r._MAX_UNIFORM_SIZE=256,r._TempBuffer=new Float32Array(r._MAX_UNIFORM_SIZE),r._TempBufferInt32View=new Uint32Array(r._TempBuffer.buffer),r}(),Lt=function(){function r(e,t,i,n,s,o,a,u){n===void 0&&(n=0),s===void 0&&(s=!1),o===void 0&&(o=!1),a===void 0&&(a=!1),this._isAlreadyOwned=!1,e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=i,this._instanced=o,this._divisor=u||1,t instanceof tr?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=a?n:n*Float32Array.BYTES_PER_ELEMENT,s||this.create()}return r.prototype.createVertexBuffer=function(e,t,i,n,s,o,a){o===void 0&&(o=!1);var u=o?t:t*Float32Array.BYTES_PER_ELEMENT,h=n?o?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new ce(this._engine,this,e,this._updatable,!0,h,s===void 0?this._instanced:s,u,i,void 0,void 0,!0,this._divisor||a)},r.prototype.isUpdatable=function(){return this._updatable},r.prototype.getData=function(){return this._data},r.prototype.getBuffer=function(){return this._buffer},r.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},r.prototype.create=function(e){e===void 0&&(e=null),!(!e&&this._buffer)&&(e=e||this._data,e&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e)))},r.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},r.prototype.update=function(e){this.create(e)},r.prototype.updateDirectly=function(e,t,i,n){n===void 0&&(n=!1),!!this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,n?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),t===0&&i===void 0?this._data=e:this._data=null)},r.prototype._increaseReferences=function(){if(!!this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}},r.prototype.dispose=function(){!this._buffer||this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)},r}(),ce=function(){function r(e,t,i,n,s,o,a,u,h,f,l,c,_,d){if(l===void 0&&(l=!1),c===void 0&&(c=!1),_===void 0&&(_=1),d===void 0&&(d=!1),t instanceof Lt?(this._buffer=t,this._ownsBuffer=d):(this._buffer=new Lt(e,t,n,o,s,a,c),this._ownsBuffer=!0),this.uniqueId=r._Counter++,this._kind=i,f==null){var g=this.getData();this.type=r.FLOAT,g instanceof Int8Array?this.type=r.BYTE:g instanceof Uint8Array?this.type=r.UNSIGNED_BYTE:g instanceof Int16Array?this.type=r.SHORT:g instanceof Uint16Array?this.type=r.UNSIGNED_SHORT:g instanceof Int32Array?this.type=r.INT:g instanceof Uint32Array&&(this.type=r.UNSIGNED_INT)}else this.type=f;var p=r.GetTypeByteLength(this.type);c?(this._size=h||(o?o/p:r.DeduceStride(i)),this.byteStride=o||this._buffer.byteStride||this._size*p,this.byteOffset=u||0):(this._size=h||o||r.DeduceStride(i),this.byteStride=o?o*p:this._buffer.byteStride||this._size*p,this.byteOffset=(u||0)*p),this.normalized=l,this._instanced=a!==void 0?a:!1,this._instanceDivisor=a?_:0,this._computeHashCode()}return Object.defineProperty(r.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,e==0?this._instanced=!1:this._instanced=!0,this._computeHashCode()},enumerable:!1,configurable:!0}),r.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},r.prototype._rebuild=function(){!this._buffer||this._buffer._rebuild()},r.prototype.getKind=function(){return this._kind},r.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},r.prototype.getData=function(){return this._buffer.getData()},r.prototype.getFloatData=function(e,t){var i=this.getData();if(!i)return null;var n=this.getSize()*r.GetTypeByteLength(this.type),s=e*this.getSize();if(this.type!==r.FLOAT||this.byteStride!==n){var o=new Float32Array(s);return this.forEach(s,function(l,c){return o[c]=l}),o}if(!(i instanceof Array||i instanceof Float32Array)||this.byteOffset!==0||i.length!==s)if(i instanceof Array){var a=this.byteOffset/4;return i.slice(a,a+s)}else{if(i instanceof ArrayBuffer)return new Float32Array(i,this.byteOffset,s);var a=i.byteOffset+this.byteOffset;if(t){var u=new Float32Array(s),h=new Float32Array(i.buffer,a,s);return u.set(h),u}var f=a%4;return f&&(a=Math.max(0,a-f)),new Float32Array(i.buffer,a,s)}return t?i.slice():i},r.prototype.getBuffer=function(){return this._buffer.getBuffer()},r.prototype.getStrideSize=function(){return this.byteStride/r.GetTypeByteLength(this.type)},r.prototype.getOffset=function(){return this.byteOffset/r.GetTypeByteLength(this.type)},r.prototype.getSize=function(e){return e===void 0&&(e=!1),e?this._size*r.GetTypeByteLength(this.type):this._size},r.prototype.getIsInstanced=function(){return this._instanced},r.prototype.getInstanceDivisor=function(){return this._instanceDivisor},r.prototype.create=function(e){this._buffer.create(e)},r.prototype.update=function(e){this._buffer.update(e)},r.prototype.updateDirectly=function(e,t,i){i===void 0&&(i=!1),this._buffer.updateDirectly(e,t,void 0,i)},r.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},r.prototype.forEach=function(e,t){r.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,t)},r.DeduceStride=function(e){switch(e){case r.UVKind:case r.UV2Kind:case r.UV3Kind:case r.UV4Kind:case r.UV5Kind:case r.UV6Kind:return 2;case r.NormalKind:case r.PositionKind:return 3;case r.ColorKind:case r.MatricesIndicesKind:case r.MatricesIndicesExtraKind:case r.MatricesWeightsKind:case r.MatricesWeightsExtraKind:case r.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}},r.GetTypeByteLength=function(e){switch(e){case r.BYTE:case r.UNSIGNED_BYTE:return 1;case r.SHORT:case r.UNSIGNED_SHORT:return 2;case r.INT:case r.UNSIGNED_INT:case r.FLOAT:return 4;default:throw new Error("Invalid type '".concat(e,"'"))}},r.ForEach=function(e,t,i,n,s,o,a,u){if(e instanceof Array)for(var h=t/4,f=i/4,l=0;l<o;l+=n){for(var c=0;c<n;c++)u(e[h+c],l+c);h+=f}else for(var _=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),d=r.GetTypeByteLength(s),l=0;l<o;l+=n){for(var g=t,c=0;c<n;c++){var p=r._GetFloatValue(_,s,g,a);u(p,l+c),g+=d}t+=i}},r._GetFloatValue=function(e,t,i,n){switch(t){case r.BYTE:{var s=e.getInt8(i);return n&&(s=Math.max(s/127,-1)),s}case r.UNSIGNED_BYTE:{var s=e.getUint8(i);return n&&(s=s/255),s}case r.SHORT:{var s=e.getInt16(i,!0);return n&&(s=Math.max(s/32767,-1)),s}case r.UNSIGNED_SHORT:{var s=e.getUint16(i,!0);return n&&(s=s/65535),s}case r.INT:return e.getInt32(i,!0);case r.UNSIGNED_INT:return e.getUint32(i,!0);case r.FLOAT:return e.getFloat32(i,!0);default:throw new Error("Invalid component type ".concat(t))}},r._Counter=0,r.BYTE=5120,r.UNSIGNED_BYTE=5121,r.SHORT=5122,r.UNSIGNED_SHORT=5123,r.INT=5124,r.UNSIGNED_INT=5125,r.FLOAT=5126,r.PositionKind="position",r.NormalKind="normal",r.TangentKind="tangent",r.UVKind="uv",r.UV2Kind="uv2",r.UV3Kind="uv3",r.UV4Kind="uv4",r.UV5Kind="uv5",r.UV6Kind="uv6",r.ColorKind="color",r.ColorInstanceKind="instanceColor",r.MatricesIndicesKind="matricesIndices",r.MatricesWeightsKind="matricesWeights",r.MatricesIndicesExtraKind="matricesIndicesExtra",r.MatricesWeightsExtraKind="matricesWeightsExtra",r}(),ut=function(){function r(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}return r.prototype.getNormal=function(e,t){if(e===void 0&&(e=!1),t===void 0&&(t=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(ce.NormalKind))return null;var i=this.pickedMesh.getIndices();if(!i)return null;var n;if(t){var s=this.pickedMesh.getVerticesData(ce.NormalKind),o=F.FromArray(s,i[this.faceId*3]*3),a=F.FromArray(s,i[this.faceId*3+1]*3),u=F.FromArray(s,i[this.faceId*3+2]*3);o=o.scale(this.bu),a=a.scale(this.bv),u=u.scale(1-this.bu-this.bv),n=new F(o.x+a.x+u.x,o.y+a.y+u.y,o.z+a.z+u.z)}else{var h=this.pickedMesh.getVerticesData(ce.PositionKind),f=F.FromArray(h,i[this.faceId*3]*3),l=F.FromArray(h,i[this.faceId*3+1]*3),c=F.FromArray(h,i[this.faceId*3+2]*3),_=f.subtract(l),d=c.subtract(l);n=F.Cross(_,d)}if(e){var g=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(ue.Matrix[0].copyFrom(g),g=ue.Matrix[0],g.setTranslationFromFloats(0,0,0),g.invert(),g.transposeToRef(ue.Matrix[1]),g=ue.Matrix[1]),n=F.TransformNormal(n,g)}return n.normalize(),n},r.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(ce.UVKind))return null;var e=this.pickedMesh.getIndices();if(!e)return null;var t=this.pickedMesh.getVerticesData(ce.UVKind);if(!t)return null;var i=de.FromArray(t,e[this.faceId*3]*2),n=de.FromArray(t,e[this.faceId*3+1]*2),s=de.FromArray(t,e[this.faceId*3+2]*2);return i=i.scale(this.bu),n=n.scale(this.bv),s=s.scale(1-this.bu-this.bv),new de(i.x+n.x+s.x,i.y+n.y+s.y)},r}(),ae=function(){function r(e,t,i,n,s,o){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=n,this.sourceEvent=s,this.additionalData=o}return r.CreateNew=function(e,t,i){var n=e.getScene();return new r(e,n.pointerX,n.pointerY,n.meshUnderPointer||e,t,i)},r.CreateNewFromSprite=function(e,t,i,n){return new r(e,t.pointerX,t.pointerY,t.meshUnderPointer,i,n)},r.CreateNewFromScene=function(e,t){return new r(null,e.pointerX,e.pointerY,e.meshUnderPointer,t)},r.CreateNewFromPrimitive=function(e,t,i,n){return new r(e,t.x,t.y,null,i,n)},r}(),Ut=function(){function r(e){this._vertexBuffers={},this._scene=e}return r.prototype._prepareBuffers=function(){if(!this._vertexBuffers[ce.PositionKind]){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[ce.PositionKind]=new ce(this._scene.getEngine(),e,ce.PositionKind,!1,!1,2),this._buildIndexBuffer()}},r.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},r.prototype._rebuild=function(){var e=this._vertexBuffers[ce.PositionKind];!e||(e._rebuild(),this._buildIndexBuffer())},r.prototype._prepareFrame=function(e,t){e===void 0&&(e=null),t===void 0&&(t=null);var i=this._scene.activeCamera;return!i||(t=t||i._postProcesses.filter(function(n){return n!=null}),!t||t.length===0||!this._scene.postProcessesEnabled)?!1:(t[0].activate(i,e,t!=null),!0)},r.prototype.directRender=function(e,t,i,n,s,o){var a;t===void 0&&(t=null),i===void 0&&(i=!1),n===void 0&&(n=0),s===void 0&&(s=0),o===void 0&&(o=!1);for(var u=this._scene.getEngine(),h=0;h<e.length;h++){h<e.length-1?e[h+1].activate(this._scene.activeCamera,t==null?void 0:t.texture):(t?u.bindFramebuffer(t,n,void 0,void 0,i,s):o||u.restoreDefaultFramebuffer(),(a=u._debugInsertMarker)===null||a===void 0||a.call(u,"post process ".concat(e[h].name," output")));var f=e[h],l=f.apply();l&&(f.onBeforeRenderObservable.notifyObservers(l),this._prepareBuffers(),u.bindBuffers(this._vertexBuffers,this._indexBuffer,l),u.drawElementsType(0,0,6),f.onAfterRenderObservable.notifyObservers(l))}u.setDepthBuffer(!0),u.setDepthWrite(!0)},r.prototype._finalizeFrame=function(e,t,i,n,s){var o;s===void 0&&(s=!1);var a=this._scene.activeCamera;if(!!a&&(n=n||a._postProcesses.filter(function(_){return _!=null}),!(n.length===0||!this._scene.postProcessesEnabled))){for(var u=this._scene.getEngine(),h=0,f=n.length;h<f;h++){var l=n[h];if(h<f-1?l._outputTexture=n[h+1].activate(a,t==null?void 0:t.texture):(t?(u.bindFramebuffer(t,i,void 0,void 0,s),l._outputTexture=t):(u.restoreDefaultFramebuffer(),l._outputTexture=null),(o=u._debugInsertMarker)===null||o===void 0||o.call(u,"post process ".concat(n[h].name," output"))),e)break;var c=l.apply();c&&(l.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),u.bindBuffers(this._vertexBuffers,this._indexBuffer,c),u.drawElementsType(0,0,6),l.onAfterRenderObservable.notifyObservers(c))}u.setDepthBuffer(!0),u.setDepthWrite(!0),u.setAlphaMode(0)}},r.prototype.dispose=function(){var e=this._vertexBuffers[ce.PositionKind];e&&(e.dispose(),this._vertexBuffers[ce.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},r}(),Mi=function(){function r(e,t,i,n,s){i===void 0&&(i=null),n===void 0&&(n=null),s===void 0&&(s=null),this.index=e,this._opaqueSubMeshes=new ye(256),this._transparentSubMeshes=new ye(256),this._alphaTestSubMeshes=new ye(256),this._depthOnlySubMeshes=new ye(256),this._particleSystems=new ye(256),this._spriteManagers=new ye(256),this._empty=!0,this._edgesRenderers=new Oe(16),this._scene=t,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=n,this.transparentSortCompareFn=s}return Object.defineProperty(r.prototype,"opaqueSortCompareFn",{set:function(e){e?this._opaqueSortCompareFn=e:this._opaqueSortCompareFn=r.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alphaTestSortCompareFn",{set:function(e){e?this._alphaTestSortCompareFn=e:this._alphaTestSortCompareFn=r.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"transparentSortCompareFn",{set:function(e){e?this._transparentSortCompareFn=e:this._transparentSortCompareFn=r.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted},enumerable:!1,configurable:!0}),r.prototype.render=function(e,t,i,n){if(e){e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);return}var s=this._scene.getEngine();this._depthOnlySubMeshes.length!==0&&(s.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),s.setColorWrite(!0)),this._opaqueSubMeshes.length!==0&&this._renderOpaque(this._opaqueSubMeshes),this._alphaTestSubMeshes.length!==0&&this._renderAlphaTest(this._alphaTestSubMeshes);var o=s.getStencilBuffer();if(s.setStencilBuffer(!1),t&&this._renderSprites(),i&&this._renderParticles(n),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length!==0||this._scene.useOrderIndependentTransparency){if(s.setStencilBuffer(o),this._scene.useOrderIndependentTransparency){var a=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);a.length&&this._renderTransparent(a)}else this._renderTransparent(this._transparentSubMeshes);s.setAlphaMode(0)}if(s.setStencilBuffer(!1),this._edgesRenderers.length){for(var u=0;u<this._edgesRenderers.length;u++)this._edgesRenderers.data[u].render();s.setAlphaMode(0)}s.setStencilBuffer(o)},r.prototype._renderOpaqueSorted=function(e){return r._RenderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},r.prototype._renderAlphaTestSorted=function(e){return r._RenderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},r.prototype._renderTransparentSorted=function(e){return r._RenderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)},r._RenderSorted=function(e,t,i,n){var s=0,o,a=i?i.globalPosition:r._ZeroVector;if(n)for(;s<e.length;s++)o=e.data[s],o._alphaIndex=o.getMesh().alphaIndex,o._distanceToCamera=F.Distance(o.getBoundingInfo().boundingSphere.centerWorld,a);var u=e.length===e.data.length?e.data:e.data.slice(0,e.length);t&&u.sort(t);var h=u[0].getMesh().getScene();for(s=0;s<u.length;s++)if(o=u[s],!(h._activeMeshesFrozenButKeepClipping&&!o.isInFrustum(h._frustumPlanes))){if(n){var f=o.getMaterial();if(f&&f.needDepthPrePass){var l=f.getScene().getEngine();l.setColorWrite(!1),l.setAlphaMode(0),o.render(!1),l.setColorWrite(!0)}}o.render(n)}},r.defaultTransparentSortCompare=function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:r.backToFrontSortCompare(e,t)},r.backToFrontSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0},r.frontToBackSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0},r.PainterSortCompare=function(e,t){var i=e.getMesh(),n=t.getMesh();return i.material&&n.material?i.material.uniqueId-n.material.uniqueId:i.uniqueId-n.uniqueId},r.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset(),this._empty=!0},r.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},r.prototype.dispatch=function(e,t,i){t===void 0&&(t=e.getMesh()),i===void 0&&(i=e.getMaterial()),i!=null&&(i.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):i.needAlphaTesting()?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)},r.prototype.dispatchSprites=function(e){this._spriteManagers.push(e),this._empty=!1},r.prototype.dispatchParticles=function(e){this._particleSystems.push(e),this._empty=!1},r.prototype._renderParticles=function(e){if(this._particleSystems.length!==0){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var i=0;i<this._particleSystems.length;i++){var n=this._particleSystems.data[i];if((t&&t.layerMask&n.layerMask)!==0){var s=n.emitter;(!s.position||!e||e.indexOf(s)!==-1)&&this._scene._activeParticles.addCount(n.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},r.prototype._renderSprites=function(){if(!(!this._scene.spritesEnabled||this._spriteManagers.length===0)){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var i=this._spriteManagers.data[t];(e&&e.layerMask&i.layerMask)!==0&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},r._ZeroVector=F.Zero(),r}(),Oi=function(){function r(){}return r}(),Fi=function(){function r(e){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Oi,this._scene=e;for(var t=r.MIN_RENDERINGGROUPS;t<r.MAX_RENDERINGGROUPS;t++)this._autoClearDepthStencil[t]={autoClear:!0,depth:!0,stencil:!0}}return r.prototype._clearDepthStencilBuffer=function(e,t){e===void 0&&(e=!0),t===void 0&&(t=!0),!this._depthStencilBufferAlreadyCleaned&&(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)},r.prototype.render=function(e,t,i,n){var s=this._renderingGroupInfo;if(s.scene=this._scene,s.camera=this._scene.activeCamera,this._scene.spriteManagers&&n)for(var o=0;o<this._scene.spriteManagers.length;o++){var a=this._scene.spriteManagers[o];this.dispatchSprites(a)}for(var o=r.MIN_RENDERINGGROUPS;o<r.MAX_RENDERINGGROUPS;o++){this._depthStencilBufferAlreadyCleaned=o===r.MIN_RENDERINGGROUPS;var u=this._renderingGroups[o];if(!(!u||u._empty)){var h=Math.pow(2,o);if(s.renderingGroupId=o,this._scene.onBeforeRenderingGroupObservable.notifyObservers(s,h),r.AUTOCLEAR){var f=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(o):this._autoClearDepthStencil[o];f&&f.autoClear&&this._clearDepthStencilBuffer(f.depth,f.stencil)}for(var l=0,c=this._scene._beforeRenderingGroupDrawStage;l<c.length;l++){var _=c[l];_.action(o)}u.render(e,n,i,t);for(var d=0,g=this._scene._afterRenderingGroupDrawStage;d<g.length;d++){var _=g[d];_.action(o)}this._scene.onAfterRenderingGroupObservable.notifyObservers(s,h)}}},r.prototype.reset=function(){for(var e=r.MIN_RENDERINGGROUPS;e<r.MAX_RENDERINGGROUPS;e++){var t=this._renderingGroups[e];t&&t.prepare()}},r.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},r.prototype.freeRenderingGroups=function(){for(var e=r.MIN_RENDERINGGROUPS;e<r.MAX_RENDERINGGROUPS;e++){var t=this._renderingGroups[e];t&&t.dispose()}},r.prototype._prepareRenderingGroup=function(e){this._renderingGroups[e]===void 0&&(this._renderingGroups[e]=new Mi(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))},r.prototype.dispatchSprites=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchSprites(e)},r.prototype.dispatchParticles=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchParticles(e)},r.prototype.dispatch=function(e,t,i){t===void 0&&(t=e.getMesh());var n=t.renderingGroupId||0;this._prepareRenderingGroup(n),this._renderingGroups[n].dispatch(e,t,i)},r.prototype.setRenderingOrder=function(e,t,i,n){if(t===void 0&&(t=null),i===void 0&&(i=null),n===void 0&&(n=null),this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=i,this._customTransparentSortCompareFn[e]=n,this._renderingGroups[e]){var s=this._renderingGroups[e];s.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],s.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],s.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}},r.prototype.setRenderingAutoClearDepthStencil=function(e,t,i,n){i===void 0&&(i=!0),n===void 0&&(n=!0),this._autoClearDepthStencil[e]={autoClear:t,depth:i,stencil:n}},r.prototype.getAutoClearDepthStencilSetup=function(e){return this._autoClearDepthStencil[e]},r.MAX_RENDERINGGROUPS=4,r.MIN_RENDERINGGROUPS=0,r.AUTOCLEAR=!0,r}(),k=function(){function r(){}return r.POINTERDOWN=1,r.POINTERUP=2,r.POINTERMOVE=4,r.POINTERWHEEL=8,r.POINTERPICK=16,r.POINTERTAP=32,r.POINTERDOUBLETAP=64,r}(),hr=function(){function r(e,t){this.type=e,this.event=t}return r}(),wi=function(r){Q(e,r);function e(t,i,n,s){var o=r.call(this,t,i)||this;return o.ray=null,o.skipOnPointerObservable=!1,o.localPosition=new de(n,s),o}return e}(hr),Ve=function(r){Q(e,r);function e(t,i,n){var s=r.call(this,t,i)||this;return s.pickInfo=n,s}return e}(hr),We=function(){function r(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(r,"HasTriggers",{get:function(){for(var e in r.Triggers)if(Object.prototype.hasOwnProperty.call(r.Triggers,e))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(r,"HasPickTriggers",{get:function(){for(var e in r.Triggers)if(Object.prototype.hasOwnProperty.call(r.Triggers,e)){var t=parseInt(e);if(t>=1&&t<=7)return!0}return!1},enumerable:!1,configurable:!0}),r.HasSpecificTrigger=function(e){for(var t in r.Triggers)if(Object.prototype.hasOwnProperty.call(r.Triggers,t)){var i=parseInt(t);if(i===e)return!0}return!1},r.Triggers={},r}(),Nt=function(){function r(){}return r.KEYDOWN=1,r.KEYUP=2,r}(),yt=function(){function r(e,t){this.type=e,this.event=t}return r}(),kt=function(r){Q(e,r);function e(t,i){var n=r.call(this,t,i)||this;return n.type=t,n.event=i,n.skipOnKeyboardObservable=!1,n}return Object.defineProperty(e.prototype,"skipOnPointerObservable",{get:function(){return this.skipOnKeyboardObservable},set:function(t){this.skipOnKeyboardObservable=t},enumerable:!1,configurable:!0}),e}(yt),T;(function(r){r[r.Generic=0]="Generic",r[r.Keyboard=1]="Keyboard",r[r.Mouse=2]="Mouse",r[r.Touch=3]="Touch",r[r.DualShock=4]="DualShock",r[r.Xbox=5]="Xbox",r[r.Switch=6]="Switch",r[r.DualSense=7]="DualSense"})(T||(T={}));var O;(function(r){r[r.Horizontal=0]="Horizontal",r[r.Vertical=1]="Vertical",r[r.LeftClick=2]="LeftClick",r[r.MiddleClick=3]="MiddleClick",r[r.RightClick=4]="RightClick",r[r.BrowserBack=5]="BrowserBack",r[r.BrowserForward=6]="BrowserForward",r[r.MouseWheelX=7]="MouseWheelX",r[r.MouseWheelY=8]="MouseWheelY",r[r.MouseWheelZ=9]="MouseWheelZ",r[r.Move=12]="Move"})(O||(O={}));var ht;(function(r){r[r.Horizontal=0]="Horizontal",r[r.Vertical=1]="Vertical",r[r.LeftClick=2]="LeftClick",r[r.MiddleClick=3]="MiddleClick",r[r.RightClick=4]="RightClick",r[r.BrowserBack=5]="BrowserBack",r[r.BrowserForward=6]="BrowserForward",r[r.MouseWheelX=7]="MouseWheelX",r[r.MouseWheelY=8]="MouseWheelY",r[r.MouseWheelZ=9]="MouseWheelZ",r[r.DeltaHorizontal=10]="DeltaHorizontal",r[r.DeltaVertical=11]="DeltaVertical"})(ht||(ht={}));var Gt;(function(r){r[r.Cross=0]="Cross",r[r.Circle=1]="Circle",r[r.Square=2]="Square",r[r.Triangle=3]="Triangle",r[r.L1=4]="L1",r[r.R1=5]="R1",r[r.L2=6]="L2",r[r.R2=7]="R2",r[r.Share=8]="Share",r[r.Options=9]="Options",r[r.L3=10]="L3",r[r.R3=11]="R3",r[r.DPadUp=12]="DPadUp",r[r.DPadDown=13]="DPadDown",r[r.DPadLeft=14]="DPadLeft",r[r.DPadRight=15]="DPadRight",r[r.Home=16]="Home",r[r.TouchPad=17]="TouchPad",r[r.LStickXAxis=18]="LStickXAxis",r[r.LStickYAxis=19]="LStickYAxis",r[r.RStickXAxis=20]="RStickXAxis",r[r.RStickYAxis=21]="RStickYAxis"})(Gt||(Gt={}));var zt;(function(r){r[r.Cross=0]="Cross",r[r.Circle=1]="Circle",r[r.Square=2]="Square",r[r.Triangle=3]="Triangle",r[r.L1=4]="L1",r[r.R1=5]="R1",r[r.L2=6]="L2",r[r.R2=7]="R2",r[r.Create=8]="Create",r[r.Options=9]="Options",r[r.L3=10]="L3",r[r.R3=11]="R3",r[r.DPadUp=12]="DPadUp",r[r.DPadDown=13]="DPadDown",r[r.DPadLeft=14]="DPadLeft",r[r.DPadRight=15]="DPadRight",r[r.Home=16]="Home",r[r.TouchPad=17]="TouchPad",r[r.LStickXAxis=18]="LStickXAxis",r[r.LStickYAxis=19]="LStickYAxis",r[r.RStickXAxis=20]="RStickXAxis",r[r.RStickYAxis=21]="RStickYAxis"})(zt||(zt={}));var Vt;(function(r){r[r.A=0]="A",r[r.B=1]="B",r[r.X=2]="X",r[r.Y=3]="Y",r[r.LB=4]="LB",r[r.RB=5]="RB",r[r.LT=6]="LT",r[r.RT=7]="RT",r[r.Back=8]="Back",r[r.Start=9]="Start",r[r.LS=10]="LS",r[r.RS=11]="RS",r[r.DPadUp=12]="DPadUp",r[r.DPadDown=13]="DPadDown",r[r.DPadLeft=14]="DPadLeft",r[r.DPadRight=15]="DPadRight",r[r.Home=16]="Home",r[r.LStickXAxis=17]="LStickXAxis",r[r.LStickYAxis=18]="LStickYAxis",r[r.RStickXAxis=19]="RStickXAxis",r[r.RStickYAxis=20]="RStickYAxis"})(Vt||(Vt={}));var Wt;(function(r){r[r.B=0]="B",r[r.A=1]="A",r[r.Y=2]="Y",r[r.X=3]="X",r[r.L=4]="L",r[r.R=5]="R",r[r.ZL=6]="ZL",r[r.ZR=7]="ZR",r[r.Minus=8]="Minus",r[r.Plus=9]="Plus",r[r.LS=10]="LS",r[r.RS=11]="RS",r[r.DPadUp=12]="DPadUp",r[r.DPadDown=13]="DPadDown",r[r.DPadLeft=14]="DPadLeft",r[r.DPadRight=15]="DPadRight",r[r.Home=16]="Home",r[r.Capture=17]="Capture",r[r.LStickXAxis=18]="LStickXAxis",r[r.LStickYAxis=19]="LStickYAxis",r[r.RStickXAxis=20]="RStickXAxis",r[r.RStickYAxis=21]="RStickYAxis"})(Wt||(Wt={}));var Ht;(function(r){r[r.PointerMove=0]="PointerMove",r[r.PointerDown=1]="PointerDown",r[r.PointerUp=2]="PointerUp"})(Ht||(Ht={}));var xi=function(){function r(){}return r.DOM_DELTA_PIXEL=0,r.DOM_DELTA_LINE=1,r.DOM_DELTA_PAGE=2,r}(),Fe=function(){function r(){}return r.CreateDeviceEvent=function(e,t,i,n,s,o){switch(e){case T.Keyboard:return this._CreateKeyboardEvent(i,n,s,o);case T.Mouse:if(i===O.MouseWheelX||i===O.MouseWheelY||i===O.MouseWheelZ)return this._CreateWheelEvent(e,t,i,n,s,o);case T.Touch:return this._CreatePointerEvent(e,t,i,n,s,o);default:throw"Unable to generate event for device ".concat(T[e])}},r._CreatePointerEvent=function(e,t,i,n,s,o){var a=this._CreateMouseEvent(e,t,i,n,s,o);return e===T.Mouse?(a.deviceType=T.Mouse,a.pointerId=1,a.pointerType="mouse"):(a.deviceType=T.Touch,a.pointerId=t,a.pointerType="touch"),i===O.Move?a.type="pointermove":i>=O.LeftClick&&i<=O.RightClick&&(a.type=n===1?"pointerdown":"pointerup",a.button=i-2),a},r._CreateWheelEvent=function(e,t,i,n,s,o){var a=this._CreateMouseEvent(e,t,i,n,s,o);switch(a.type="wheel",a.deltaMode=xi.DOM_DELTA_PIXEL,a.deltaX=0,a.deltaY=0,a.deltaZ=0,i){case O.MouseWheelX:a.deltaX=n;break;case O.MouseWheelY:a.deltaY=n;break;case O.MouseWheelZ:a.deltaZ=n;break}return a},r._CreateMouseEvent=function(e,t,i,n,s,o){var a=this._CreateEvent(o),u=s.pollInput(e,t,O.Horizontal),h=s.pollInput(e,t,O.Vertical);return o?(a.movementX=0,a.movementY=0,a.offsetX=a.movementX-o.getBoundingClientRect().x,a.offsetY=a.movementY-o.getBoundingClientRect().y):(a.movementX=s.pollInput(e,t,ht.DeltaHorizontal),a.movementY=s.pollInput(e,t,ht.DeltaVertical),a.offsetX=0,a.offsetY=0),this._CheckNonCharacterKeys(a,s),a.clientX=u,a.clientY=h,a.x=u,a.y=h,a.deviceType=e,a.deviceSlot=t,a.inputIndex=i,a},r._CreateKeyboardEvent=function(e,t,i,n){var s=this._CreateEvent(n);return this._CheckNonCharacterKeys(s,i),s.deviceType=T.Keyboard,s.deviceSlot=0,s.inputIndex=e,s.type=t===1?"keydown":"keyup",s.key=String.fromCharCode(e),s.keyCode=e,s},r._CheckNonCharacterKeys=function(e,t){var i=t.isDeviceAvailable(T.Keyboard),n=i&&t.pollInput(T.Keyboard,0,18)===1,s=i&&t.pollInput(T.Keyboard,0,17)===1,o=i&&(t.pollInput(T.Keyboard,0,91)===1||t.pollInput(T.Keyboard,0,92)===1||t.pollInput(T.Keyboard,0,93)===1),a=i&&t.pollInput(T.Keyboard,0,16)===1;e.altKey=n,e.ctrlKey=s,e.metaKey=o,e.shiftKey=a},r._CreateEvent=function(e){var t={};return t.preventDefault=function(){},t.target=e,t},r}(),Di=function(){function r(e,t,i){var n=this;this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(e,t,function(s,o,a,u){var h=Fe.CreateDeviceEvent(s,o,a,u,n);i(s,o,h)}):this._createDummyNativeInput()}return r.prototype.pollInput=function(e,t,i){return this._nativeInput.pollInput(e,t,i)},r.prototype.isDeviceAvailable=function(e){return e===T.Mouse||e===T.Touch},r.prototype.dispose=function(){this._nativeInput.dispose()},r.prototype._createDummyNativeInput=function(){var e={pollInput:function(){return 0},isDeviceAvailable:function(){return!1},dispose:function(){}};return e},r}(),Kt=255,jt=Object.keys(O).length/2,Bi=function(){function r(e,t,i,n){var s=this;this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=le.IsSafari(),this._usingMacOS=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=function(o){},this._keyboardUpEvent=function(o){},this._keyboardBlurEvent=function(o){},this._pointerMoveEvent=function(o){},this._pointerDownEvent=function(o){},this._pointerUpEvent=function(o){},this._pointerCancelEvent=function(o){},this._pointerWheelEvent=function(o){},this._pointerBlurEvent=function(o){},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=pt.IsNavigatorAvailable()&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!==-1,this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=function(o){},this._gamepadDisconnectedEvent=function(o){},this._eventPrefix=le.GetPointerPrefix(e),this._engine=e,this._onDeviceConnected=t,this._onDeviceDisconnected=i,this._onInputChanged=n,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=function(){s._enableEvents()})}return r.prototype.pollInput=function(e,t,i){var n=this._inputs[e][t];if(!n)throw"Unable to find device ".concat(T[e]);e>=T.DualShock&&e<=T.DualSense&&this._updateDevice(e,t,i);var s=n[i];if(s===void 0)throw"Unable to find input ".concat(i," for device ").concat(T[e]," in slot ").concat(t);return i===O.Move&&le.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),s},r.prototype.isDeviceAvailable=function(e){return this._inputs[e]!==void 0},r.prototype.dispose=function(){this._onDeviceConnected=function(){},this._onDeviceDisconnected=function(){},this._onInputChanged=function(){},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()},r.prototype._enableEvents=function(){var e=this===null||this===void 0?void 0:this._engine.getInputElement();if(e&&(!this._eventsAttached||this._elementToAttachTo!==e)){if(this._disableEvents(),this._inputs)for(var t=0,i=this._inputs;t<i.length;t++){var n=i[t];if(n)for(var s in n){var o=+s,a=n[o];if(a)for(var u=0;u<a.length;u++)a[u]=0}}this._elementToAttachTo=e,this._elementToAttachTo.tabIndex=this._elementToAttachTo.tabIndex!==-1?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}},r.prototype._disableEvents=function(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1},r.prototype._checkForConnectedDevices=function(){if(navigator.getGamepads)for(var e=navigator.getGamepads(),t=0,i=e;t<i.length;t++){var n=i[t];n&&this._addGamePad(n)}typeof matchMedia=="function"&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(T.Mouse,0,0,0)},r.prototype._addGamePad=function(e){var t=this._getGamepadDeviceType(e.id),i=e.index;this._gamepads=this._gamepads||new Array(e.index+1),this._registerDevice(t,i,e.buttons.length+e.axes.length),this._gamepads[i]=t},r.prototype._addPointerDevice=function(e,t,i,n){this._pointerActive||(this._pointerActive=!0),this._registerDevice(e,t,jt);var s=this._inputs[e][t];s[0]=i,s[1]=n},r.prototype._registerDevice=function(e,t,i){if(t===void 0)throw"Unable to register device ".concat(T[e]," to undefined slot.");if(this._inputs[e]||(this._inputs[e]={}),!this._inputs[e][t]){for(var n=new Array(i),s=0;s<i;s++)n[s]=0;this._inputs[e][t]=n,this._onDeviceConnected(e,t)}},r.prototype._unregisterDevice=function(e,t){this._inputs[e][t]&&(delete this._inputs[e][t],this._onDeviceDisconnected(e,t))},r.prototype._handleKeyActions=function(){var e=this;this._keyboardDownEvent=function(t){e._keyboardActive||(e._keyboardActive=!0,e._registerDevice(T.Keyboard,0,Kt));var i=e._inputs[T.Keyboard][0];if(i){i[t.keyCode]=1;var n=t;n.inputIndex=t.keyCode,e._usingMacOS&&t.metaKey&&t.key!=="Meta"&&(e._metaKeys.includes(t.keyCode)||e._metaKeys.push(t.keyCode)),e._onInputChanged(T.Keyboard,0,n)}},this._keyboardUpEvent=function(t){e._keyboardActive||(e._keyboardActive=!0,e._registerDevice(T.Keyboard,0,Kt));var i=e._inputs[T.Keyboard][0];if(i){i[t.keyCode]=0;var n=t;if(n.inputIndex=t.keyCode,e._usingMacOS&&t.key==="Meta"&&e._metaKeys.length>0){for(var s=0,o=e._metaKeys;s<o.length;s++){var a=o[s],u=Fe.CreateDeviceEvent(T.Keyboard,0,a,0,e,e._elementToAttachTo);i[a]=0,e._onInputChanged(T.Keyboard,0,u)}e._metaKeys.splice(0,e._metaKeys.length)}e._onInputChanged(T.Keyboard,0,n)}},this._keyboardBlurEvent=function(){if(e._keyboardActive){for(var t=e._inputs[T.Keyboard][0],i=0;i<t.length;i++)if(t[i]!==0){t[i]=0;var n=Fe.CreateDeviceEvent(T.Keyboard,0,i,0,e,e._elementToAttachTo);e._onInputChanged(T.Keyboard,0,n)}e._usingMacOS&&e._metaKeys.splice(0,e._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)},r.prototype._handlePointerActions=function(){var e=this;this._maxTouchPoints=pt.IsNavigatorAvailable()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(var t=0;t<this._maxTouchPoints;t++)this._activeTouchIds[t]=-1;this._pointerMoveEvent=function(o){var a=e._getPointerType(o),u=a===T.Mouse?0:e._activeTouchIds.indexOf(o.pointerId);e._inputs[a]||(e._inputs[a]={}),e._inputs[a][u]||e._addPointerDevice(a,u,o.clientX,o.clientY);var h=e._inputs[a][u];if(h){h[O.Horizontal]=o.clientX,h[O.Vertical]=o.clientY;var f=o;f.inputIndex=O.Move,e._onInputChanged(a,u,f),!e._usingSafari&&o.button!==-1&&(f.inputIndex=o.button+2,h[o.button+2]=h[o.button+2]?0:1,e._onInputChanged(a,u,f))}},this._pointerDownEvent=function(o){var a=e._getPointerType(o),u=a===T.Mouse?0:o.pointerId;if(a===T.Touch){var h=e._activeTouchIds.indexOf(-1);if(h>=0)u=h,e._activeTouchIds[h]=o.pointerId;else{le.Warn("Max number of touches exceeded.  Ignoring touches in excess of ".concat(e._maxTouchPoints));return}}e._inputs[a]||(e._inputs[a]={}),e._inputs[a][u]?a===T.Touch&&e._onDeviceConnected(a,u):e._addPointerDevice(a,u,o.clientX,o.clientY);var f=e._inputs[a][u];if(f){var l=f[O.Horizontal],c=f[O.Vertical];if(a===T.Mouse){if(e._mouseId===-1&&(o.pointerId===void 0?e._mouseId=e._isUsingFirefox?0:1:e._mouseId=o.pointerId),!document.pointerLockElement)try{e._elementToAttachTo.setPointerCapture(e._mouseId)}catch{}}else if(o.pointerId&&!document.pointerLockElement)try{e._elementToAttachTo.setPointerCapture(o.pointerId)}catch{}f[O.Horizontal]=o.clientX,f[O.Vertical]=o.clientY,f[o.button+2]=1;var _=o;_.inputIndex=o.button+2,e._onInputChanged(a,u,_),(l!==o.clientX||c!==o.clientY)&&(_.inputIndex=O.Move,e._onInputChanged(a,u,_))}},this._pointerUpEvent=function(o){var a,u,h,f,l,c=e._getPointerType(o),_=c===T.Mouse?0:e._activeTouchIds.indexOf(o.pointerId);if(c===T.Touch){if(_===-1)return;e._activeTouchIds[_]=-1}var d=(a=e._inputs[c])===null||a===void 0?void 0:a[_];if(d&&d[o.button+2]!==0){var g=d[O.Horizontal],p=d[O.Vertical];d[O.Horizontal]=o.clientX,d[O.Vertical]=o.clientY,d[o.button+2]=0;var y=o;(g!==o.clientX||p!==o.clientY)&&(y.inputIndex=O.Move,e._onInputChanged(c,_,y)),y.inputIndex=o.button+2,c===T.Mouse&&e._mouseId>=0&&((h=(u=e._elementToAttachTo).hasPointerCapture)===null||h===void 0?void 0:h.call(u,e._mouseId))?e._elementToAttachTo.releasePointerCapture(e._mouseId):o.pointerId&&((l=(f=e._elementToAttachTo).hasPointerCapture)===null||l===void 0?void 0:l.call(f,o.pointerId))&&e._elementToAttachTo.releasePointerCapture(o.pointerId),e._onInputChanged(c,_,y),c===T.Touch&&e._onDeviceDisconnected(c,_)}},this._pointerCancelEvent=function(o){var a,u,h,f;if(o.pointerType==="mouse"){var l=e._inputs[T.Mouse][0];e._mouseId>=0&&((u=(a=e._elementToAttachTo).hasPointerCapture)===null||u===void 0?void 0:u.call(a,e._mouseId))&&e._elementToAttachTo.releasePointerCapture(e._mouseId);for(var c=O.LeftClick;c<=O.BrowserForward;c++)if(l[c]===1){l[c]=0;var _=Fe.CreateDeviceEvent(T.Mouse,0,c,0,e,e._elementToAttachTo);e._onInputChanged(T.Mouse,0,_)}}else{var d=e._activeTouchIds.indexOf(o.pointerId);!((f=(h=e._elementToAttachTo).hasPointerCapture)===null||f===void 0)&&f.call(h,o.pointerId)&&e._elementToAttachTo.releasePointerCapture(o.pointerId),e._inputs[T.Touch][d][O.LeftClick]=0;var _=Fe.CreateDeviceEvent(T.Touch,d,O.LeftClick,0,e,e._elementToAttachTo);e._onInputChanged(T.Touch,d,_),e._activeTouchIds[d]=-1,e._onDeviceDisconnected(T.Touch,d)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";var i=!1,n=function(){};try{var s=Object.defineProperty({},"passive",{get:function(){i=!0}});this._elementToAttachTo.addEventListener("test",n,s),this._elementToAttachTo.removeEventListener("test",n,s)}catch{}this._pointerBlurEvent=function(){var o,a,u,h,f;if(e.isDeviceAvailable(T.Mouse)){var l=e._inputs[T.Mouse][0];e._mouseId>=0&&((a=(o=e._elementToAttachTo).hasPointerCapture)===null||a===void 0?void 0:a.call(o,e._mouseId))&&e._elementToAttachTo.releasePointerCapture(e._mouseId);for(var c=O.LeftClick;c<=O.BrowserForward;c++)if(l[c]===1){l[c]=0;var _=Fe.CreateDeviceEvent(T.Mouse,0,c,0,e,e._elementToAttachTo);e._onInputChanged(T.Mouse,0,_)}}if(e.isDeviceAvailable(T.Touch))for(var l=e._inputs[T.Touch],d=0;d<e._activeTouchIds.length;d++){var g=e._activeTouchIds[d];if(!((h=(u=e._elementToAttachTo).hasPointerCapture)===null||h===void 0)&&h.call(u,g)&&e._elementToAttachTo.releasePointerCapture(g),g!==-1&&((f=l[d])===null||f===void 0?void 0:f[O.LeftClick])===1){l[d][O.LeftClick]=0;var _=Fe.CreateDeviceEvent(T.Touch,d,O.LeftClick,0,e,e._elementToAttachTo);e._onInputChanged(T.Touch,d,_),e._activeTouchIds[d]=-1,e._onDeviceDisconnected(T.Touch,d)}}},this._pointerWheelEvent=function(o){var a=T.Mouse,u=0;e._inputs[a]||(e._inputs[a]=[]),e._inputs[a][u]||(e._pointerActive=!0,e._registerDevice(a,u,jt));var h=e._inputs[a][u];if(h){h[O.MouseWheelX]=o.deltaX||0,h[O.MouseWheelY]=o.deltaY||o.wheelDelta||0,h[O.MouseWheelZ]=o.deltaZ||0;var f=o;h[O.MouseWheelX]!==0&&(f.inputIndex=O.MouseWheelX,e._onInputChanged(a,u,f)),h[O.MouseWheelY]!==0&&(f.inputIndex=O.MouseWheelY,e._onInputChanged(a,u,f)),h[O.MouseWheelZ]!==0&&(f.inputIndex=O.MouseWheelZ,e._onInputChanged(a,u,f))}},this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,i?{passive:!0}:!1),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add(function(){if(e.isDeviceAvailable(T.Mouse)){var o=e._inputs[T.Mouse][0];o[O.MouseWheelX]=0,o[O.MouseWheelY]=0,o[O.MouseWheelZ]=0}})},r.prototype._handleGamepadActions=function(){var e=this;this._gamepadConnectedEvent=function(t){e._addGamePad(t.gamepad)},this._gamepadDisconnectedEvent=function(t){if(e._gamepads){var i=e._getGamepadDeviceType(t.gamepad.id),n=t.gamepad.index;e._unregisterDevice(i,n),delete e._gamepads[n]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},r.prototype._updateDevice=function(e,t,i){var n=navigator.getGamepads()[t];if(n&&e===this._gamepads[t]){var s=this._inputs[e][t];i>=n.buttons.length?s[i]=n.axes[i-n.buttons.length].valueOf():s[i]=n.buttons[i].value}},r.prototype._getGamepadDeviceType=function(e){return e.indexOf("054c")!==-1?e.indexOf("0ce6")!==-1?T.DualSense:T.DualShock:e.indexOf("Xbox One")!==-1||e.search("Xbox 360")!==-1||e.search("xinput")!==-1?T.Xbox:e.indexOf("057e")!==-1?T.Switch:T.Generic},r.prototype._getPointerType=function(e){var t=T.Mouse;return(e.pointerType==="touch"||e.pointerType==="pen"||e.touches)&&(t=T.Touch),t},r}(),Xt=function(){function r(e,t,i){i===void 0&&(i=0),this.deviceType=t,this.deviceSlot=i,this.onInputChangedObservable=new E,this._deviceInputSystem=e}return r.prototype.getInput=function(e){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,e)},r}(),Ii=function(){function r(e){var t=this;this._registeredManagers=new Array,this._refCount=0,this.registerManager=function(a){for(var u=0;u<t._devices.length;u++){var h=t._devices[u];for(var f in h){var l=+f;a._addDevice(new Xt(t._deviceInputSystem,u,l))}}t._registeredManagers.push(a)},this.unregisterManager=function(a){var u=t._registeredManagers.indexOf(a);u>-1&&t._registeredManagers.splice(u,1)};var i=Object.keys(T).length/2;this._devices=new Array(i);var n=function(a,u){t._devices[a]||(t._devices[a]=new Array),t._devices[a][u]||(t._devices[a][u]=u);for(var h=0,f=t._registeredManagers;h<f.length;h++){var l=f[h],c=new Xt(t._deviceInputSystem,a,u);l._addDevice(c)}},s=function(a,u){var h;!((h=t._devices[a])===null||h===void 0)&&h[u]&&delete t._devices[a][u];for(var f=0,l=t._registeredManagers;f<l.length;f++){var c=l[f];c._removeDevice(a,u)}},o=function(a,u,h){if(h)for(var f=0,l=t._registeredManagers;f<l.length;f++){var c=l[f];c._onInputChanged(a,u,h)}};typeof _native!="undefined"?this._deviceInputSystem=new Di(n,s,o):this._deviceInputSystem=new Bi(e,n,s,o)}return r.prototype.dispose=function(){this._deviceInputSystem.dispose()},r}(),Li=function(){function r(e){var t=this,i=Object.keys(T).length/2;this._devices=new Array(i),this._firstDevice=new Array(i),this._engine=e,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new Ii(e)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new E(function(n){for(var s=0,o=t._devices;s<o.length;s++){var a=o[s];if(a)for(var u=0,h=a;u<h.length;u++){var f=h[u];f&&t.onDeviceConnectedObservable.notifyObserver(n,f)}}}),this.onDeviceDisconnectedObservable=new E,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=e.onDisposeObservable.add(function(){t.dispose()})}return r.prototype.getDeviceSource=function(e,t){if(t===void 0){if(this._firstDevice[e]===void 0)return null;t=this._firstDevice[e]}return!this._devices[e]||this._devices[e][t]===void 0?null:this._devices[e][t]},r.prototype.getDeviceSources=function(e){return this._devices[e].filter(function(t){return!!t})},r.prototype.dispose=function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)},r.prototype._addDevice=function(e){this._devices[e.deviceType]||(this._devices[e.deviceType]=new Array),this._devices[e.deviceType][e.deviceSlot]||(this._devices[e.deviceType][e.deviceSlot]=e,this._updateFirstDevices(e.deviceType)),this.onDeviceConnectedObservable.notifyObservers(e)},r.prototype._removeDevice=function(e,t){var i,n,s=(i=this._devices[e])===null||i===void 0?void 0:i[t];this.onDeviceDisconnectedObservable.notifyObservers(s),!((n=this._devices[e])===null||n===void 0)&&n[t]&&delete this._devices[e][t],this._updateFirstDevices(e)},r.prototype._onInputChanged=function(e,t,i){var n,s;(s=(n=this._devices[e])===null||n===void 0?void 0:n[t])===null||s===void 0||s.onInputChangedObservable.notifyObservers(i)},r.prototype._updateFirstDevices=function(e){switch(e){case T.Keyboard:case T.Mouse:this._firstDevice[e]=0;break;case T.Touch:case T.DualSense:case T.DualShock:case T.Xbox:case T.Switch:case T.Generic:{delete this._firstDevice[e];var t=this._devices[e];if(t){for(var i=0;i<t.length;i++)if(t[i]){this._firstDevice[e]=i;break}}break}}},r}(),Yt=function(){function r(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(r.prototype,"singleClick",{get:function(){return this._singleClick},set:function(e){this._singleClick=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(e){this._doubleClick=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"ignore",{get:function(){return this._ignore},set:function(e){this._ignore=e},enumerable:!1,configurable:!0}),r}(),Re=function(){function r(e){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new de(0,0),this._previousStartingPointerPosition=new de(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._deviceSourceManager=null,this._scene=e||Z.LastCreatedScene,this._scene}return Object.defineProperty(r.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),r.prototype.getMeshUnderPointerByPointerId=function(e){return this._meshUnderPointerId[e]||null},Object.defineProperty(r.prototype,"unTranslatedPointer",{get:function(){return new de(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"pointerX",{get:function(){return this._pointerX},set:function(e){this._pointerX=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"pointerY",{get:function(){return this._pointerY},set:function(e){this._pointerY=e},enumerable:!1,configurable:!0}),r.prototype._updatePointerPosition=function(e){var t=this._scene.getEngine().getInputElementClientRect();!t||(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},r.prototype._processPointerMove=function(e,t){var i=this._scene,n=i.getEngine(),s=n.getInputElement();s&&(s.tabIndex=n.canvasTabIndex,i.doNotHandleCursors||(s.style.cursor=i.defaultCursor));var o=!!(e&&e.hit&&e.pickedMesh);if(o){if(i.setPointerOverMesh(e.pickedMesh,t.pointerId,e),!i.doNotHandleCursors&&s&&this._pointerOverMesh){var a=this._pointerOverMesh._getActionManagerForTrigger();a&&a.hasPointerTriggers&&(s.style.cursor=a.hoverCursor||i.hoverCursor)}}else i.setPointerOverMesh(null,t.pointerId,e);for(var u=0,h=i._pointerMoveStage;u<h.length;u++){var f=h[u];e=f.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,o,s)}if(e){var l=t.type==="wheel"||t.type==="mousewheel"||t.type==="DOMMouseScroll"?k.POINTERWHEEL:k.POINTERMOVE;if(i.onPointerMove&&i.onPointerMove(t,e,l),i.onPointerObservable.hasObservers()){var c=new Ve(l,t,e);this._setRayOnPointerInfo(c),i.onPointerObservable.notifyObservers(c,l)}}},r.prototype._setRayOnPointerInfo=function(e){var t=this._scene;e.pickInfo&&!e.pickInfo._pickingUnavailable&&(e.pickInfo.ray||(e.pickInfo.ray=t.createPickingRay(e.event.offsetX,e.event.offsetY,oe.Identity(),t.activeCamera)))},r.prototype._checkPrePointerObservable=function(e,t,i){var n=this._scene,s=new wi(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(s.ray=e.ray,e.originMesh&&(s.nearInteractionPickingInfo=e)),n.onPrePointerObservable.notifyObservers(s,i),!!s.skipOnPointerObservable},r.prototype.simulatePointerMove=function(e,t){var i=new PointerEvent("pointermove",t);i.inputIndex=O.Move,!this._checkPrePointerObservable(e,i,k.POINTERMOVE)&&this._processPointerMove(e,i)},r.prototype.simulatePointerDown=function(e,t){var i=new PointerEvent("pointerdown",t);i.inputIndex=i.button+2,!this._checkPrePointerObservable(e,i,k.POINTERDOWN)&&this._processPointerDown(e,i)},r.prototype._processPointerDown=function(e,t){var i=this,n=this._scene;if(e&&e.hit&&e.pickedMesh){this._pickedDownMesh=e.pickedMesh;var s=e.pickedMesh._getActionManagerForTrigger();if(s){if(s.hasPickTriggers)switch(s.processTrigger(5,ae.CreateNew(e.pickedMesh,t)),t.button){case 0:s.processTrigger(2,ae.CreateNew(e.pickedMesh,t));break;case 1:s.processTrigger(4,ae.CreateNew(e.pickedMesh,t));break;case 2:s.processTrigger(3,ae.CreateNew(e.pickedMesh,t));break}s.hasSpecificTrigger(8)&&window.setTimeout(function(){var l=n.pick(i._unTranslatedPointerX,i._unTranslatedPointerY,function(c){return c.isPickable&&c.isVisible&&c.isReady()&&c.actionManager&&c.actionManager.hasSpecificTrigger(8)&&c===i._pickedDownMesh},!1,n.cameraToUseForPointers);l&&l.hit&&l.pickedMesh&&s&&i._totalPointersPressed!==0&&Date.now()-i._startingPointerTime>r.LongPressDelay&&!i._isPointerSwiping()&&(i._startingPointerTime=0,s.processTrigger(8,ae.CreateNew(l.pickedMesh,t)))},r.LongPressDelay)}}else for(var o=0,a=n._pointerDownStage;o<a.length;o++){var u=a[o];e=u.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t)}if(e){var h=k.POINTERDOWN;if(n.onPointerDown&&n.onPointerDown(t,e,h),n.onPointerObservable.hasObservers()){var f=new Ve(h,t,e);this._setRayOnPointerInfo(f),n.onPointerObservable.notifyObservers(f,h)}}},r.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>r.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>r.DragMovementThreshold},r.prototype.simulatePointerUp=function(e,t,i){var n=new PointerEvent("pointerup",t);n.inputIndex=O.Move;var s=new Yt;i?s.doubleClick=!0:s.singleClick=!0,!this._checkPrePointerObservable(e,n,k.POINTERUP)&&this._processPointerUp(e,n,s)},r.prototype._processPointerUp=function(e,t,i){var n=this._scene;if(e&&e.hit&&e.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(n.onPointerPick&&n.onPointerPick(t,e),i.singleClick&&!i.ignore&&n.onPointerObservable.hasObservers())){var s=k.POINTERPICK,o=new Ve(s,t,e);this._setRayOnPointerInfo(o),n.onPointerObservable.notifyObservers(o,s)}var a=e.pickedMesh._getActionManagerForTrigger();if(a&&!i.ignore){a.processTrigger(7,ae.CreateNew(e.pickedMesh,t,e)),!i.hasSwiped&&i.singleClick&&a.processTrigger(1,ae.CreateNew(e.pickedMesh,t,e));var u=e.pickedMesh._getActionManagerForTrigger(6);i.doubleClick&&u&&u.processTrigger(6,ae.CreateNew(e.pickedMesh,t,e))}}else if(!i.ignore)for(var h=0,f=n._pointerUpStage;h<f.length;h++){var l=f[h];e=l.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t)}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var c=this._pickedDownMesh._getActionManagerForTrigger(16);c&&c.processTrigger(16,ae.CreateNew(this._pickedDownMesh,t))}var _=0;if(n.onPointerObservable.hasObservers()){if(!i.ignore&&!i.hasSwiped&&(i.singleClick&&n.onPointerObservable.hasSpecificMask(k.POINTERTAP)?_=k.POINTERTAP:i.doubleClick&&n.onPointerObservable.hasSpecificMask(k.POINTERDOUBLETAP)&&(_=k.POINTERDOUBLETAP),_)){var o=new Ve(_,t,e);this._setRayOnPointerInfo(o),n.onPointerObservable.notifyObservers(o,_)}if(!i.ignore){_=k.POINTERUP;var o=new Ve(_,t,e);this._setRayOnPointerInfo(o),n.onPointerObservable.notifyObservers(o,_)}}n.onPointerUp&&!i.ignore&&n.onPointerUp(t,e,_)},r.prototype.isPointerCaptured=function(e){return e===void 0&&(e=0),this._pointerCaptures[e]},r.prototype.attachControl=function(e,t,i,n){var s=this;e===void 0&&(e=!0),t===void 0&&(t=!0),i===void 0&&(i=!0),n===void 0&&(n=null);var o=this._scene,a=o.getEngine();n||(n=a.getInputElement()),this._alreadyAttached&&this.detachControl(),n&&(this._alreadyAttachedTo=n),this._deviceSourceManager=new Li(a),this._initActionManager=function(u){if(!s._meshPickProceed){var h=o.skipPointerUpPicking?null:o.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,o.pointerUpPredicate,!1,o.cameraToUseForPointers);s._currentPickResult=h,h&&(u=h.hit&&h.pickedMesh?h.pickedMesh._getActionManagerForTrigger():null),s._meshPickProceed=!0}return u},this._delayedSimpleClick=function(u,h,f){(Date.now()-s._previousStartingPointerTime>r.DoubleClickDelay&&!s._doubleClickOccured||u!==s._previousButtonPressed)&&(s._doubleClickOccured=!1,h.singleClick=!0,h.ignore=!1,f(h,s._currentPickResult))},this._initClickEvent=function(u,h,f,l){var c=new Yt;s._currentPickResult=null;var _=null,d=u.hasSpecificMask(k.POINTERPICK)||h.hasSpecificMask(k.POINTERPICK)||u.hasSpecificMask(k.POINTERTAP)||h.hasSpecificMask(k.POINTERTAP)||u.hasSpecificMask(k.POINTERDOUBLETAP)||h.hasSpecificMask(k.POINTERDOUBLETAP);!d&&We&&(_=s._initActionManager(_,c),_&&(d=_.hasPickTriggers));var g=!1;if(d){var p=f.button;if(c.hasSwiped=s._isPointerSwiping(),!c.hasSwiped){var y=!r.ExclusiveDoubleClickMode;y||(y=!u.hasSpecificMask(k.POINTERDOUBLETAP)&&!h.hasSpecificMask(k.POINTERDOUBLETAP),y&&!We.HasSpecificTrigger(6)&&(_=s._initActionManager(_,c),_&&(y=!_.hasSpecificTrigger(6)))),y?(Date.now()-s._previousStartingPointerTime>r.DoubleClickDelay||p!==s._previousButtonPressed)&&(c.singleClick=!0,l(c,s._currentPickResult),g=!0):(s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,s._delayedSimpleClickTimeout=window.setTimeout(s._delayedSimpleClick.bind(s,p,c,l),r.DoubleClickDelay));var v=u.hasSpecificMask(k.POINTERDOUBLETAP)||h.hasSpecificMask(k.POINTERDOUBLETAP);!v&&We.HasSpecificTrigger(6)&&(_=s._initActionManager(_,c),_&&(v=_.hasSpecificTrigger(6))),v&&(p===s._previousButtonPressed&&Date.now()-s._previousStartingPointerTime<r.DoubleClickDelay&&!s._doubleClickOccured?(!c.hasSwiped&&!s._isPointerSwiping()?(s._previousStartingPointerTime=0,s._doubleClickOccured=!0,c.doubleClick=!0,c.ignore=!1,r.ExclusiveDoubleClickMode&&s._previousDelayedSimpleClickTimeout&&clearTimeout(s._previousDelayedSimpleClickTimeout),s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,l(c,s._currentPickResult)):(s._doubleClickOccured=!1,s._previousStartingPointerTime=s._startingPointerTime,s._previousStartingPointerPosition.x=s._startingPointerPosition.x,s._previousStartingPointerPosition.y=s._startingPointerPosition.y,s._previousButtonPressed=p,r.ExclusiveDoubleClickMode?(s._previousDelayedSimpleClickTimeout&&clearTimeout(s._previousDelayedSimpleClickTimeout),s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,l(c,s._previousPickResult)):l(c,s._currentPickResult)),g=!0):(s._doubleClickOccured=!1,s._previousStartingPointerTime=s._startingPointerTime,s._previousStartingPointerPosition.x=s._startingPointerPosition.x,s._previousStartingPointerPosition.y=s._startingPointerPosition.y,s._previousButtonPressed=p))}}g||l(c,s._currentPickResult)},this._onPointerMove=function(u){if(u.pointerId===void 0&&(u.pointerId=0),s._updatePointerPosition(u),!s._checkPrePointerObservable(null,u,u.type==="wheel"||u.type==="mousewheel"||u.type==="DOMMouseScroll"?k.POINTERWHEEL:k.POINTERMOVE)&&!(!o.cameraToUseForPointers&&!o.activeCamera)){if(o.skipPointerMovePicking){s._processPointerMove(new ut,u);return}o.pointerMovePredicate||(o.pointerMovePredicate=function(f){return f.isPickable&&f.isVisible&&f.isReady()&&f.isEnabled()&&(f.enablePointerMoveEvents||o.constantlyUpdateMeshUnderPointer||f._getActionManagerForTrigger()!==null)&&(!o.cameraToUseForPointers||(o.cameraToUseForPointers.layerMask&f.layerMask)!==0)});var h=o.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,o.pointerMovePredicate,!1,o.cameraToUseForPointers,o.pointerMoveTrianglePredicate);s._processPointerMove(h,u)}},this._onPointerDown=function(u){if(s._totalPointersPressed++,s._pickedDownMesh=null,s._meshPickProceed=!1,u.pointerId===void 0&&(u.pointerId=0),s._updatePointerPosition(u),o.preventDefaultOnPointerDown&&n&&(u.preventDefault(),n.focus()),s._startingPointerPosition.x=s._pointerX,s._startingPointerPosition.y=s._pointerY,s._startingPointerTime=Date.now(),!s._checkPrePointerObservable(null,u,k.POINTERDOWN)&&!(!o.cameraToUseForPointers&&!o.activeCamera)){s._pointerCaptures[u.pointerId]=!0,o.pointerDownPredicate||(o.pointerDownPredicate=function(f){return f.isPickable&&f.isVisible&&f.isReady()&&f.isEnabled()&&(!o.cameraToUseForPointers||(o.cameraToUseForPointers.layerMask&f.layerMask)!==0)}),s._pickedDownMesh=null;var h;o.skipPointerDownPicking?h=new ut:h=o.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,o.pointerDownPredicate,!1,o.cameraToUseForPointers),s._processPointerDown(h,u)}},this._onPointerUp=function(u){s._totalPointersPressed!==0&&(s._totalPointersPressed--,s._pickedUpMesh=null,s._meshPickProceed=!1,u.pointerId===void 0&&(u.pointerId=0),s._updatePointerPosition(u),o.preventDefaultOnPointerUp&&n&&(u.preventDefault(),n.focus()),s._initClickEvent(o.onPrePointerObservable,o.onPointerObservable,u,function(h,f){o.onPrePointerObservable.hasObservers()&&!h.ignore&&(!h.hasSwiped&&(h.singleClick&&o.onPrePointerObservable.hasSpecificMask(k.POINTERTAP)&&s._checkPrePointerObservable(null,u,k.POINTERTAP)||h.doubleClick&&o.onPrePointerObservable.hasSpecificMask(k.POINTERDOUBLETAP)&&s._checkPrePointerObservable(null,u,k.POINTERDOUBLETAP))||s._checkPrePointerObservable(null,u,k.POINTERUP))||!s._pointerCaptures[u.pointerId]&&u.buttons>0||(s._pointerCaptures[u.pointerId]=!1,!(!o.cameraToUseForPointers&&!o.activeCamera)&&(o.pointerUpPredicate||(o.pointerUpPredicate=function(l){return l.isPickable&&l.isVisible&&l.isReady()&&l.isEnabled()&&(!o.cameraToUseForPointers||(o.cameraToUseForPointers.layerMask&l.layerMask)!==0)}),!s._meshPickProceed&&(We&&We.HasTriggers||o.onPointerObservable.hasObservers())&&s._initActionManager(null,h),f||(f=s._currentPickResult),s._processPointerUp(f,u,h),s._previousPickResult=s._currentPickResult))}))},this._onKeyDown=function(u){var h=Nt.KEYDOWN;if(o.onPreKeyboardObservable.hasObservers()){var f=new kt(h,u);if(o.onPreKeyboardObservable.notifyObservers(f,h),f.skipOnKeyboardObservable)return}if(o.onKeyboardObservable.hasObservers()){var f=new yt(h,u);o.onKeyboardObservable.notifyObservers(f,h)}o.actionManager&&o.actionManager.processTrigger(14,ae.CreateNewFromScene(o,u))},this._onKeyUp=function(u){var h=Nt.KEYUP;if(o.onPreKeyboardObservable.hasObservers()){var f=new kt(h,u);if(o.onPreKeyboardObservable.notifyObservers(f,h),f.skipOnKeyboardObservable)return}if(o.onKeyboardObservable.hasObservers()){var f=new yt(h,u);o.onKeyboardObservable.notifyObservers(f,h)}o.actionManager&&o.actionManager.processTrigger(15,ae.CreateNewFromScene(o,u))},this._deviceSourceManager.onDeviceConnectedObservable.add(function(u){u.deviceType===T.Mouse?u.onInputChangedObservable.add(function(h){h.inputIndex===O.LeftClick||h.inputIndex===O.MiddleClick||h.inputIndex===O.RightClick?t&&u.getInput(h.inputIndex)===1?s._onPointerDown(h):e&&u.getInput(h.inputIndex)===0&&s._onPointerUp(h):i&&(h.inputIndex===O.Move||h.inputIndex===O.MouseWheelX||h.inputIndex===O.MouseWheelY||h.inputIndex===O.MouseWheelZ)&&s._onPointerMove(h)}):u.deviceType===T.Touch?u.onInputChangedObservable.add(function(h){h.inputIndex===O.LeftClick&&(t&&u.getInput(h.inputIndex)===1?s._onPointerDown(h):e&&u.getInput(h.inputIndex)===0&&s._onPointerUp(h)),i&&h.inputIndex===O.Move&&s._onPointerMove(h)}):u.deviceType===T.Keyboard&&u.onInputChangedObservable.add(function(h){h.type==="keydown"?s._onKeyDown(h):h.type==="keyup"&&s._onKeyUp(h)})}),this._alreadyAttached=!0},r.prototype.detachControl=function(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)},r.prototype.setPointerOverMesh=function(e,t,i){if(t===void 0&&(t=0),this._meshUnderPointerId[t]!==e){var n=this._meshUnderPointerId[t],s;n&&(s=n._getActionManagerForTrigger(10),s&&s.processTrigger(10,ae.CreateNew(n,void 0,{pointerId:t}))),e?(this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,s=e._getActionManagerForTrigger(9),s&&s.processTrigger(9,ae.CreateNew(e,void 0,{pointerId:t,pickResult:i}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null)}},r.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},r.prototype._invalidateMesh=function(e){this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null);for(var t in this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]},r.DragMovementThreshold=10,r.LongPressDelay=500,r.DoubleClickDelay=300,r.ExclusiveDoubleClickMode=!1,r}(),Ui=function(){function r(e,t,i,n){this.normal=new F(e,t,i),this.d=n}return r.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},r.prototype.clone=function(){return new r(this.normal.x,this.normal.y,this.normal.z,this.d)},r.prototype.getClassName=function(){return"Plane"},r.prototype.getHashCode=function(){var e=this.normal.getHashCode();return e=e*397^(this.d|0),e},r.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return e!==0&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},r.prototype.transform=function(e){var t=r._TmpMatrix;e.invertToRef(t);var i=t.m,n=this.normal.x,s=this.normal.y,o=this.normal.z,a=this.d,u=n*i[0]+s*i[1]+o*i[2]+a*i[3],h=n*i[4]+s*i[5]+o*i[6]+a*i[7],f=n*i[8]+s*i[9]+o*i[10]+a*i[11],l=n*i[12]+s*i[13]+o*i[14]+a*i[15];return new r(u,h,f,l)},r.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},r.prototype.copyFromPoints=function(e,t,i){var n=t.x-e.x,s=t.y-e.y,o=t.z-e.z,a=i.x-e.x,u=i.y-e.y,h=i.z-e.z,f=s*h-o*u,l=o*a-n*h,c=n*u-s*a,_=Math.sqrt(f*f+l*l+c*c),d;return _!==0?d=1/_:d=0,this.normal.x=f*d,this.normal.y=l*d,this.normal.z=c*d,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},r.prototype.isFrontFacingTo=function(e,t){var i=F.Dot(this.normal,e);return i<=t},r.prototype.signedDistanceTo=function(e){return F.Dot(e,this.normal)+this.d},r.FromArray=function(e){return new r(e[0],e[1],e[2],e[3])},r.FromPoints=function(e,t,i){var n=new r(0,0,0,0);return n.copyFromPoints(e,t,i),n},r.FromPositionAndNormal=function(e,t){var i=new r(0,0,0,0);return t.normalize(),i.normal=t,i.d=-(t.x*e.x+t.y*e.y+t.z*e.z),i},r.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var n=-(t.x*e.x+t.y*e.y+t.z*e.z);return F.Dot(i,t)+n},r._TmpMatrix=oe.Identity(),r}(),qt=function(){function r(){}return r.GetPlanes=function(e){for(var t=[],i=0;i<6;i++)t.push(new Ui(0,0,0,0));return r.GetPlanesToRef(e,t),t},r.GetNearPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]+i[2],t.normal.y=i[7]+i[6],t.normal.z=i[11]+i[10],t.d=i[15]+i[14],t.normalize()},r.GetFarPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]-i[2],t.normal.y=i[7]-i[6],t.normal.z=i[11]-i[10],t.d=i[15]-i[14],t.normalize()},r.GetLeftPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]+i[0],t.normal.y=i[7]+i[4],t.normal.z=i[11]+i[8],t.d=i[15]+i[12],t.normalize()},r.GetRightPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]-i[0],t.normal.y=i[7]-i[4],t.normal.z=i[11]-i[8],t.d=i[15]-i[12],t.normalize()},r.GetTopPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]-i[1],t.normal.y=i[7]-i[5],t.normal.z=i[11]-i[9],t.d=i[15]-i[13],t.normalize()},r.GetBottomPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]+i[1],t.normal.y=i[7]+i[5],t.normal.z=i[11]+i[9],t.d=i[15]+i[13],t.normalize()},r.GetPlanesToRef=function(e,t){r.GetNearPlaneToRef(e,t[0]),r.GetFarPlaneToRef(e,t[1]),r.GetLeftPlaneToRef(e,t[2]),r.GetRightPlaneToRef(e,t[3]),r.GetTopPlaneToRef(e,t[4]),r.GetBottomPlaneToRef(e,t[5])},r}(),Ni=function(){function r(){}return Object.defineProperty(r,"UniqueId",{get:function(){var e=this._UniqueIdCounter;return this._UniqueIdCounter++,e},enumerable:!1,configurable:!0}),r._UniqueIdCounter=1,r}(),ki=function(){function r(){}return r.CompareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},r.FALLOFF_DEFAULT=0,r.FALLOFF_PHYSICAL=1,r.FALLOFF_GLTF=2,r.FALLOFF_STANDARD=3,r.LIGHTMAP_DEFAULT=0,r.LIGHTMAP_SPECULAR=1,r.LIGHTMAP_SHADOWSONLY=2,r.INTENSITYMODE_AUTOMATIC=0,r.INTENSITYMODE_LUMINOUSPOWER=1,r.INTENSITYMODE_LUMINOUSINTENSITY=2,r.INTENSITYMODE_ILLUMINANCE=3,r.INTENSITYMODE_LUMINANCE=4,r.LIGHTTYPEID_POINTLIGHT=0,r.LIGHTTYPEID_DIRECTIONALLIGHT=1,r.LIGHTTYPEID_SPOTLIGHT=2,r.LIGHTTYPEID_HEMISPHERICLIGHT=3,r}(),Zt=function(){function r(e,t){r.IsAvailable&&(this._observer=new window.ComputePressureObserver(e,t))}return Object.defineProperty(r,"IsAvailable",{get:function(){return X()&&"ComputePressureObserver"in window},enumerable:!1,configurable:!0}),r.prototype.observe=function(){var e,t;!((e=this._observer)===null||e===void 0)&&e.observe&&((t=this._observer)===null||t===void 0||t.observe().catch(function(){}))},r.prototype.unobserve=function(){var e,t;!((e=this._observer)===null||e===void 0)&&e.unobserve&&((t=this._observer)===null||t===void 0||t.unobserve())},r}(),W=function(r){Q(e,r);function e(t,i){var n=r.call(this)||this;n._inputManager=new Re(n),n.cameraToUseForPointers=null,n._isScene=!0,n._blockEntityCollection=!1,n.autoClear=!0,n.autoClearDepthAndStencil=!0,n.clearColor=new fe(.2,.2,.3,1),n.ambientColor=new Ne(0,0,0),n.environmentIntensity=1,n._forceWireframe=!1,n._skipFrustumClipping=!1,n._forcePointsCloud=!1,n.animationsEnabled=!0,n._animationPropertiesOverride=null,n.useConstantAnimationDeltaTime=!1,n.constantlyUpdateMeshUnderPointer=!1,n.hoverCursor="pointer",n.defaultCursor="",n.doNotHandleCursors=!1,n.preventDefaultOnPointerDown=!0,n.preventDefaultOnPointerUp=!0,n.metadata=null,n.reservedDataStore=null,n.disableOfflineSupportExceptionRules=new Array,n.onDisposeObservable=new E,n._onDisposeObserver=null,n.onBeforeRenderObservable=new E,n._onBeforeRenderObserver=null,n.onAfterRenderObservable=new E,n.onAfterRenderCameraObservable=new E,n._onAfterRenderObserver=null,n.onBeforeAnimationsObservable=new E,n.onAfterAnimationsObservable=new E,n.onBeforeDrawPhaseObservable=new E,n.onAfterDrawPhaseObservable=new E,n.onReadyObservable=new E,n.onBeforeCameraRenderObservable=new E,n._onBeforeCameraRenderObserver=null,n.onAfterCameraRenderObservable=new E,n._onAfterCameraRenderObserver=null,n.onBeforeActiveMeshesEvaluationObservable=new E,n.onAfterActiveMeshesEvaluationObservable=new E,n.onBeforeParticlesRenderingObservable=new E,n.onAfterParticlesRenderingObservable=new E,n.onDataLoadedObservable=new E,n.onNewCameraAddedObservable=new E,n.onCameraRemovedObservable=new E,n.onNewLightAddedObservable=new E,n.onLightRemovedObservable=new E,n.onNewGeometryAddedObservable=new E,n.onGeometryRemovedObservable=new E,n.onNewTransformNodeAddedObservable=new E,n.onTransformNodeRemovedObservable=new E,n.onNewMeshAddedObservable=new E,n.onMeshRemovedObservable=new E,n.onNewSkeletonAddedObservable=new E,n.onSkeletonRemovedObservable=new E,n.onNewMaterialAddedObservable=new E,n.onNewMultiMaterialAddedObservable=new E,n.onMaterialRemovedObservable=new E,n.onMultiMaterialRemovedObservable=new E,n.onNewTextureAddedObservable=new E,n.onTextureRemovedObservable=new E,n.onBeforeRenderTargetsRenderObservable=new E,n.onAfterRenderTargetsRenderObservable=new E,n.onBeforeStepObservable=new E,n.onAfterStepObservable=new E,n.onActiveCameraChanged=new E,n.onBeforeRenderingGroupObservable=new E,n.onAfterRenderingGroupObservable=new E,n.onMeshImportedObservable=new E,n.onAnimationFileImportedObservable=new E,n._registeredForLateAnimationBindings=new Oe(256),n.skipPointerMovePicking=!1,n.skipPointerDownPicking=!1,n.skipPointerUpPicking=!1,n.onPrePointerObservable=new E,n.onPointerObservable=new E,n.onPreKeyboardObservable=new E,n.onKeyboardObservable=new E,n._useRightHandedSystem=!1,n._timeAccumulator=0,n._currentStepId=0,n._currentInternalStep=0,n._fogEnabled=!0,n._fogMode=e.FOGMODE_NONE,n.fogColor=new Ne(.2,.2,.3),n.fogDensity=.1,n.fogStart=0,n.fogEnd=1e3,n.needsPreviousWorldMatrices=!1,n._shadowsEnabled=!0,n._lightsEnabled=!0,n.activeCameras=new Array,n._texturesEnabled=!0,n.physicsEnabled=!0,n.particlesEnabled=!0,n.spritesEnabled=!0,n._skeletonsEnabled=!0,n.lensFlaresEnabled=!0,n.collisionsEnabled=!0,n.gravity=new F(0,-9.807,0),n.postProcessesEnabled=!0,n.renderTargetsEnabled=!0,n.dumpNextRenderTargets=!1,n.customRenderTargets=new Array,n.importedMeshesFiles=new Array,n.probesEnabled=!0,n._meshesForIntersections=new Oe(256),n.proceduralTexturesEnabled=!0,n._totalVertices=new Ke,n._activeIndices=new Ke,n._activeParticles=new Ke,n._activeBones=new Ke,n._animationTime=0,n.animationTimeScale=1,n._renderId=0,n._frameId=0,n._executeWhenReadyTimeoutId=null,n._intermediateRendering=!1,n._defaultFrameBufferCleared=!1,n._viewUpdateFlag=-1,n._projectionUpdateFlag=-1,n._toBeDisposed=new Array(256),n._activeRequests=new Array,n._pendingData=new Array,n._isDisposed=!1,n.dispatchAllSubMeshesOfActiveMeshes=!1,n._activeMeshes=new ye(256),n._processedMaterials=new ye(256),n._renderTargets=new Oe(256),n._materialsRenderTargets=new Oe(256),n._activeParticleSystems=new ye(256),n._activeSkeletons=new Oe(32),n._softwareSkinnedMeshes=new Oe(32),n._activeAnimatables=new Array,n._transformMatrix=oe.Zero(),n.requireLightSorting=!1,n._components=[],n._serializableComponents=[],n._transientComponents=[],n._beforeCameraUpdateStage=q.Create(),n._beforeClearStage=q.Create(),n._beforeRenderTargetClearStage=q.Create(),n._gatherRenderTargetsStage=q.Create(),n._gatherActiveCameraRenderTargetsStage=q.Create(),n._isReadyForMeshStage=q.Create(),n._beforeEvaluateActiveMeshStage=q.Create(),n._evaluateSubMeshStage=q.Create(),n._preActiveMeshStage=q.Create(),n._cameraDrawRenderTargetStage=q.Create(),n._beforeCameraDrawStage=q.Create(),n._beforeRenderTargetDrawStage=q.Create(),n._beforeRenderingGroupDrawStage=q.Create(),n._beforeRenderingMeshStage=q.Create(),n._afterRenderingMeshStage=q.Create(),n._afterRenderingGroupDrawStage=q.Create(),n._afterCameraDrawStage=q.Create(),n._afterRenderTargetDrawStage=q.Create(),n._afterRenderStage=q.Create(),n._pointerMoveStage=q.Create(),n._pointerDownStage=q.Create(),n._pointerUpStage=q.Create(),n._geometriesByUniqueId=null,n._defaultMeshCandidates={data:[],length:0},n._defaultSubMeshCandidates={data:[],length:0},n._preventFreeActiveMeshesAndRenderingGroups=!1,n._activeMeshesFrozen=!1,n._activeMeshesFrozenButKeepClipping=!1,n._skipEvaluateActiveMeshesCompletely=!1,n._allowPostProcessClearColor=!0,n.getDeterministicFrameTime=function(){return n._engine.getTimeStep()},n._blockMaterialDirtyMechanism=!1,n._perfCollector=null,n.onComputePressureChanged=new E;var s=st({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},i);return n._engine=t||Z.LastCreatedEngine,s.virtual?n._engine._virtualScenes.push(n):(Z._LastCreatedScene=n,n._engine.scenes.push(n)),n._uid=null,n._renderingManager=new Fi(n),Ut&&(n.postProcessManager=new Ut(n)),X()&&n.attachControl(),n._createUbo(),vt&&(n._imageProcessingConfiguration=new vt),n.setDefaultCandidateProviders(),s.useGeometryUniqueIdsMap&&(n._geometriesByUniqueId={}),n.useMaterialMeshMap=s.useMaterialMeshMap,n.useClonedMeshMap=s.useClonedMeshMap,(!i||!i.virtual)&&n._engine.onNewSceneAddedObservable.notifyObservers(n),Zt.IsAvailable&&(n._computePressureObserver=new Zt(function(o){n.onComputePressureChanged.notifyObservers(o)},{cpuUtilizationThresholds:[.25,.5,.75,.9],cpuSpeedThresholds:[.5]}),n._computePressureObserver.observe()),n}return e.DefaultMaterialFactory=function(t){throw V("StandardMaterial")},e.CollisionCoordinatorFactory=function(){throw V("DefaultCollisionCoordinator")},Object.defineProperty(e.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(t){this._environmentTexture!==t&&(this._environmentTexture=t,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(t){this._forceWireframe!==t&&(this._forceWireframe=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(t){this._skipFrustumClipping!==t&&(this._skipFrustumClipping=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(t){this._forcePointsCloud!==t&&(this._forcePointsCloud=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(t){this._animationPropertiesOverride=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"beforeRender",{set:function(t){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),t&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"afterRender",{set:function(t){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),t&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"beforeCameraRender",{set:function(t){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"afterCameraRender",{set:function(t){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DragMovementThreshold",{get:function(){return Re.DragMovementThreshold},set:function(t){Re.DragMovementThreshold=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LongPressDelay",{get:function(){return Re.LongPressDelay},set:function(t){Re.LongPressDelay=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DoubleClickDelay",{get:function(){return Re.DoubleClickDelay},set:function(t){Re.DoubleClickDelay=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ExclusiveDoubleClickMode",{get:function(){return Re.ExclusiveDoubleClickMode},set:function(t){Re.ExclusiveDoubleClickMode=t},enumerable:!1,configurable:!0}),e.prototype.bindEyePosition=function(t,i,n){var s;i===void 0&&(i="vEyePosition"),n===void 0&&(n=!1);var o=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(s=this.activeCamera.globalPosition)!==null&&s!==void 0?s:this.activeCamera.devicePosition,a=this.useRightHandedSystem===(this._mirroredCameraPosition!=null);return ue.Vector4[0].set(o.x,o.y,o.z,a?-1:1),t&&(n?t.setFloat3(i,ue.Vector4[0].x,ue.Vector4[0].y,ue.Vector4[0].z):t.setVector4(i,ue.Vector4[0])),ue.Vector4[0]},e.prototype.finalizeSceneUbo=function(){var t=this.getSceneUniformBuffer(),i=this.bindEyePosition(null);return t.updateFloat4("vEyePosition",i.x,i.y,i.z,i.w),t.update(),t},Object.defineProperty(e.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(t){this._useRightHandedSystem!==t&&(this._useRightHandedSystem=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),e.prototype.setStepId=function(t){this._currentStepId=t},e.prototype.getStepId=function(){return this._currentStepId},e.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(e.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fogMode",{get:function(){return this._fogMode},set:function(t){this._fogMode!==t&&(this._fogMode=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"prePass",{get:function(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(t){this._shadowsEnabled!==t&&(this._shadowsEnabled=t,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(t){this._lightsEnabled!==t&&(this._lightsEnabled=t,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(t){t!==this._activeCamera&&(this._activeCamera=t,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=e.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(t){this._defaultMaterial=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(t){this._texturesEnabled!==t&&(this._texturesEnabled=t,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(t){this._skeletonsEnabled!==t&&(this._skeletonsEnabled=t,this.markAllMaterialsAsDirty(8))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=e.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),e.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var t=0,i=this._transientComponents;t<i.length;t++){var n=i[t];n.register()}this._transientComponents=[]}},e.prototype._addComponent=function(t){this._components.push(t),this._transientComponents.push(t);var i=t;i.addFromContainer&&i.serialize&&this._serializableComponents.push(i)},e.prototype._getComponent=function(t){for(var i=0,n=this._components;i<n.length;i++){var s=n[i];if(s.name===t)return s}return null},e.prototype.getClassName=function(){return"Scene"},e.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},e.prototype._getDefaultSubMeshCandidates=function(t){return this._defaultSubMeshCandidates.data=t.subMeshes,this._defaultSubMeshCandidates.length=t.subMeshes.length,this._defaultSubMeshCandidates},e.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(e.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(t){this._inputManager.pointerX=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(t){this._inputManager.pointerY=t},enumerable:!1,configurable:!0}),e.prototype.getCachedMaterial=function(){return this._cachedMaterial},e.prototype.getCachedEffect=function(){return this._cachedEffect},e.prototype.getCachedVisibility=function(){return this._cachedVisibility},e.prototype.isCachedMaterialInvalid=function(t,i,n){return n===void 0&&(n=1),this._cachedEffect!==i||this._cachedMaterial!==t||this._cachedVisibility!==n},e.prototype.getEngine=function(){return this._engine},e.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(e.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),e.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(e.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),e.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(e.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),e.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(e.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),e.prototype.getActiveMeshes=function(){return this._activeMeshes},e.prototype.getAnimationRatio=function(){return this._animationRatio!==void 0?this._animationRatio:1},e.prototype.getRenderId=function(){return this._renderId},e.prototype.getFrameId=function(){return this._frameId},e.prototype.incrementRenderId=function(){this._renderId++},e.prototype._createUbo=function(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())},e.prototype.simulatePointerMove=function(t,i){return this._inputManager.simulatePointerMove(t,i),this},e.prototype.simulatePointerDown=function(t,i){return this._inputManager.simulatePointerDown(t,i),this},e.prototype.simulatePointerUp=function(t,i,n){return this._inputManager.simulatePointerUp(t,i,n),this},e.prototype.isPointerCaptured=function(t){return t===void 0&&(t=0),this._inputManager.isPointerCaptured(t)},e.prototype.attachControl=function(t,i,n){t===void 0&&(t=!0),i===void 0&&(i=!0),n===void 0&&(n=!0),this._inputManager.attachControl(t,i,n)},e.prototype.detachControl=function(){this._inputManager.detachControl()},e.prototype.isReady=function(t){if(t===void 0&&(t=!0),this._isDisposed)return!1;var i,n=this.getEngine(),s=!0;for(this._pendingData.length>0&&(s=!1),t&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),i=0;i<this.meshes.length;i++){var o=this.meshes[i];if(!(!o.subMeshes||o.subMeshes.length===0)){if(!o.isReady(!0)){s=!1;continue}for(var a=o.hasThinInstances||o.getClassName()==="InstancedMesh"||o.getClassName()==="InstancedLinesMesh"||n.getCaps().instancedArrays&&o.instances.length>0,u=0,h=this._isReadyForMeshStage;u<h.length;u++){var f=h[u];f.action(o,a)||(s=!1)}if(!!t){var l=o.material||this.defaultMaterial;if(l)if(l._storeEffectOnSubMeshes)for(var c=0,_=o.subMeshes;c<_.length;c++){var d=_[c],g=d.getMaterial();g&&g.hasRenderTargetTextures&&g.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(g)===-1&&(this._processedMaterials.push(g),this._materialsRenderTargets.concatWithNoDuplicate(g.getRenderTargetTextures()))}else l.hasRenderTargetTextures&&l.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(l)===-1&&(this._processedMaterials.push(l),this._materialsRenderTargets.concatWithNoDuplicate(l.getRenderTargetTextures()))}}}if(!s||!n.areAllEffectsReady())return!1;if(t)for(i=0;i<this._materialsRenderTargets.length;++i){var p=this._materialsRenderTargets.data[i];if(!p.isReadyForRendering())return!1}for(i=0;i<this.geometries.length;i++){var y=this.geometries[i];if(y.delayLoadState===2)return!1}if(this.activeCameras&&this.activeCameras.length>0)for(var v=0,b=this.activeCameras;v<b.length;v++){var C=b[v];if(!C.isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var m=0,S=this.particleSystems;m<S.length;m++){var M=S[m];if(!M.isReady())return!1}return!0},e.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},e.prototype.registerBeforeRender=function(t){this.onBeforeRenderObservable.add(t)},e.prototype.unregisterBeforeRender=function(t){this.onBeforeRenderObservable.removeCallback(t)},e.prototype.registerAfterRender=function(t){this.onAfterRenderObservable.add(t)},e.prototype.unregisterAfterRender=function(t){this.onAfterRenderObservable.removeCallback(t)},e.prototype._executeOnceBeforeRender=function(t){var i=this,n=function(){t(),setTimeout(function(){i.unregisterBeforeRender(n)})};this.registerBeforeRender(n)},e.prototype.executeOnceBeforeRender=function(t,i){var n=this;i!==void 0?setTimeout(function(){n._executeOnceBeforeRender(t)},i):this._executeOnceBeforeRender(t)},e.prototype._addPendingData=function(t){this._pendingData.push(t)},e.prototype._removePendingData=function(t){var i=this.isLoading,n=this._pendingData.indexOf(t);n!==-1&&this._pendingData.splice(n,1),i&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},e.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(e.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!1,configurable:!0}),e.prototype.executeWhenReady=function(t,i){i===void 0&&(i=!1),this.onReadyObservable.add(t),this._executeWhenReadyTimeoutId===null&&this._checkIsReady(i)},e.prototype.whenReadyAsync=function(t){var i=this;return t===void 0&&(t=!1),new Promise(function(n){i.executeWhenReady(function(){n()},t)})},e.prototype._checkIsReady=function(t){var i=this;if(t===void 0&&(t=!1),this._registerTransientComponents(),this.isReady(t)){this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=null;return}if(this._isDisposed){this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=null;return}this._executeWhenReadyTimeoutId=setTimeout(function(){i._checkIsReady(t)},100)},Object.defineProperty(e.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),e.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=we.Now},e.prototype.getViewMatrix=function(){return this._viewMatrix},e.prototype.getProjectionMatrix=function(){return this._projectionMatrix},e.prototype.getTransformMatrix=function(){return this._transformMatrix},e.prototype.setTransformMatrix=function(t,i,n,s){!n&&!s&&this._multiviewSceneUbo&&(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),!(this._viewUpdateFlag===t.updateFlag&&this._projectionUpdateFlag===i.updateFlag)&&(this._viewUpdateFlag=t.updateFlag,this._projectionUpdateFlag=i.updateFlag,this._viewMatrix=t,this._projectionMatrix=i,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?qt.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=qt.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(n,s):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))},e.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},e.prototype.createSceneUniformBuffer=function(t){var i=new Si(this._engine,void 0,!1,t!=null?t:"scene");return i.addUniform("viewProjection",16),i.addUniform("view",16),i.addUniform("projection",16),i.addUniform("vEyePosition",4),i},e.prototype.setSceneUniformBuffer=function(t){this._sceneUbo=t,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1},e.prototype.getUniqueId=function(){return Ni.UniqueId},e.prototype.addMesh=function(t,i){var n=this;i===void 0&&(i=!1),!this._blockEntityCollection&&(this.meshes.push(t),t._resyncLightSources(),t.parent||t._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(t),i&&t.getChildMeshes().forEach(function(s){n.addMesh(s)}))},e.prototype.removeMesh=function(t,i){var n=this;i===void 0&&(i=!1);var s=this.meshes.indexOf(t);return s!==-1&&(this.meshes[s]=this.meshes[this.meshes.length-1],this.meshes.pop(),t.parent||t._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(t),this.onMeshRemovedObservable.notifyObservers(t),i&&t.getChildMeshes().forEach(function(o){n.removeMesh(o)}),s},e.prototype.addTransformNode=function(t){this._blockEntityCollection||t.getScene()===this&&t._indexInSceneTransformNodesArray!==-1||(t._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(t),t.parent||t._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(t))},e.prototype.removeTransformNode=function(t){var i=t._indexInSceneTransformNodesArray;if(i!==-1){if(i!==this.transformNodes.length-1){var n=this.transformNodes[this.transformNodes.length-1];this.transformNodes[i]=n,n._indexInSceneTransformNodesArray=i}t._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),t.parent||t._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(t),i},e.prototype.removeSkeleton=function(t){var i=this.skeletons.indexOf(t);return i!==-1&&(this.skeletons.splice(i,1),this.onSkeletonRemovedObservable.notifyObservers(t),this._executeActiveContainerCleanup(this._activeSkeletons)),i},e.prototype.removeMorphTargetManager=function(t){var i=this.morphTargetManagers.indexOf(t);return i!==-1&&this.morphTargetManagers.splice(i,1),i},e.prototype.removeLight=function(t){var i=this.lights.indexOf(t);if(i!==-1){for(var n=0,s=this.meshes;n<s.length;n++){var o=s[n];o._removeLightSource(t,!1)}this.lights.splice(i,1),this.sortLightsByPriority(),t.parent||t._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(t),i},e.prototype.removeCamera=function(t){var i=this.cameras.indexOf(t);if(i!==-1&&(this.cameras.splice(i,1),t.parent||t._removeFromSceneRootNodes()),this.activeCameras){var n=this.activeCameras.indexOf(t);n!==-1&&this.activeCameras.splice(n,1)}return this.activeCamera===t&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(t),i},e.prototype.removeParticleSystem=function(t){var i=this.particleSystems.indexOf(t);return i!==-1&&(this.particleSystems.splice(i,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),i},e.prototype.removeAnimation=function(t){var i=this.animations.indexOf(t);return i!==-1&&this.animations.splice(i,1),i},e.prototype.stopAnimation=function(t,i,n){},e.prototype.removeAnimationGroup=function(t){var i=this.animationGroups.indexOf(t);return i!==-1&&this.animationGroups.splice(i,1),i},e.prototype.removeMultiMaterial=function(t){var i=this.multiMaterials.indexOf(t);return i!==-1&&this.multiMaterials.splice(i,1),this.onMultiMaterialRemovedObservable.notifyObservers(t),i},e.prototype.removeMaterial=function(t){var i=t._indexInSceneMaterialArray;if(i!==-1&&i<this.materials.length){if(i!==this.materials.length-1){var n=this.materials[this.materials.length-1];this.materials[i]=n,n._indexInSceneMaterialArray=i}t._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(t),i},e.prototype.removeActionManager=function(t){var i=this.actionManagers.indexOf(t);return i!==-1&&this.actionManagers.splice(i,1),i},e.prototype.removeTexture=function(t){var i=this.textures.indexOf(t);return i!==-1&&this.textures.splice(i,1),this.onTextureRemovedObservable.notifyObservers(t),i},e.prototype.addLight=function(t){if(!this._blockEntityCollection){this.lights.push(t),this.sortLightsByPriority(),t.parent||t._addToSceneRootNodes();for(var i=0,n=this.meshes;i<n.length;i++){var s=n[i];s.lightSources.indexOf(t)===-1&&(s.lightSources.push(t),s._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(t)}},e.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(ki.CompareLightsPriority)},e.prototype.addCamera=function(t){this._blockEntityCollection||(this.cameras.push(t),this.onNewCameraAddedObservable.notifyObservers(t),t.parent||t._addToSceneRootNodes())},e.prototype.addSkeleton=function(t){this._blockEntityCollection||(this.skeletons.push(t),this.onNewSkeletonAddedObservable.notifyObservers(t))},e.prototype.addParticleSystem=function(t){this._blockEntityCollection||this.particleSystems.push(t)},e.prototype.addAnimation=function(t){this._blockEntityCollection||this.animations.push(t)},e.prototype.addAnimationGroup=function(t){this._blockEntityCollection||this.animationGroups.push(t)},e.prototype.addMultiMaterial=function(t){this._blockEntityCollection||(this.multiMaterials.push(t),this.onNewMultiMaterialAddedObservable.notifyObservers(t))},e.prototype.addMaterial=function(t){this._blockEntityCollection||t.getScene()===this&&t._indexInSceneMaterialArray!==-1||(t._indexInSceneMaterialArray=this.materials.length,this.materials.push(t),this.onNewMaterialAddedObservable.notifyObservers(t))},e.prototype.addMorphTargetManager=function(t){this._blockEntityCollection||this.morphTargetManagers.push(t)},e.prototype.addGeometry=function(t){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[t.uniqueId]=this.geometries.length),this.geometries.push(t))},e.prototype.addActionManager=function(t){this.actionManagers.push(t)},e.prototype.addTexture=function(t){this._blockEntityCollection||(this.textures.push(t),this.onNewTextureAddedObservable.notifyObservers(t))},e.prototype.switchActiveCamera=function(t,i){i===void 0&&(i=!0);var n=this._engine.getInputElement();!n||(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=t,i&&t.attachControl())},e.prototype.setActiveCameraById=function(t){var i=this.getCameraById(t);return i?(this.activeCamera=i,i):null},e.prototype.setActiveCameraByName=function(t){var i=this.getCameraByName(t);return i?(this.activeCamera=i,i):null},e.prototype.getAnimationGroupByName=function(t){for(var i=0;i<this.animationGroups.length;i++)if(this.animationGroups[i].name===t)return this.animationGroups[i];return null},e.prototype.getMaterialByUniqueID=function(t){for(var i=0;i<this.materials.length;i++)if(this.materials[i].uniqueId===t)return this.materials[i];return null},e.prototype.getMaterialById=function(t){for(var i=0;i<this.materials.length;i++)if(this.materials[i].id===t)return this.materials[i];return null},e.prototype.getLastMaterialById=function(t,i){i===void 0&&(i=!1);for(var n=this.materials.length-1;n>=0;n--)if(this.materials[n].id===t)return this.materials[n];if(i){for(var n=this.multiMaterials.length-1;n>=0;n--)if(this.multiMaterials[n].id===t)return this.multiMaterials[n]}return null},e.prototype.getMaterialByName=function(t){for(var i=0;i<this.materials.length;i++)if(this.materials[i].name===t)return this.materials[i];return null},e.prototype.getTextureByUniqueId=function(t){for(var i=0;i<this.textures.length;i++)if(this.textures[i].uniqueId===t)return this.textures[i];return null},e.prototype.getTextureByName=function(t){for(var i=0;i<this.textures.length;i++)if(this.textures[i].name===t)return this.textures[i];return null},e.prototype.getCameraById=function(t){for(var i=0;i<this.cameras.length;i++)if(this.cameras[i].id===t)return this.cameras[i];return null},e.prototype.getCameraByUniqueId=function(t){for(var i=0;i<this.cameras.length;i++)if(this.cameras[i].uniqueId===t)return this.cameras[i];return null},e.prototype.getCameraByName=function(t){for(var i=0;i<this.cameras.length;i++)if(this.cameras[i].name===t)return this.cameras[i];return null},e.prototype.getBoneById=function(t){for(var i=0;i<this.skeletons.length;i++)for(var n=this.skeletons[i],s=0;s<n.bones.length;s++)if(n.bones[s].id===t)return n.bones[s];return null},e.prototype.getBoneByName=function(t){for(var i=0;i<this.skeletons.length;i++)for(var n=this.skeletons[i],s=0;s<n.bones.length;s++)if(n.bones[s].name===t)return n.bones[s];return null},e.prototype.getLightByName=function(t){for(var i=0;i<this.lights.length;i++)if(this.lights[i].name===t)return this.lights[i];return null},e.prototype.getLightById=function(t){for(var i=0;i<this.lights.length;i++)if(this.lights[i].id===t)return this.lights[i];return null},e.prototype.getLightByUniqueId=function(t){for(var i=0;i<this.lights.length;i++)if(this.lights[i].uniqueId===t)return this.lights[i];return null},e.prototype.getParticleSystemById=function(t){for(var i=0;i<this.particleSystems.length;i++)if(this.particleSystems[i].id===t)return this.particleSystems[i];return null},e.prototype.getGeometryById=function(t){for(var i=0;i<this.geometries.length;i++)if(this.geometries[i].id===t)return this.geometries[i];return null},e.prototype._getGeometryByUniqueId=function(t){if(this._geometriesByUniqueId){var i=this._geometriesByUniqueId[t];if(i!==void 0)return this.geometries[i]}else for(var i=0;i<this.geometries.length;i++)if(this.geometries[i].uniqueId===t)return this.geometries[i];return null},e.prototype.pushGeometry=function(t,i){return!i&&this._getGeometryByUniqueId(t.uniqueId)?!1:(this.addGeometry(t),this.onNewGeometryAddedObservable.notifyObservers(t),!0)},e.prototype.removeGeometry=function(t){var i;if(this._geometriesByUniqueId){if(i=this._geometriesByUniqueId[t.uniqueId],i===void 0)return!1}else if(i=this.geometries.indexOf(t),i<0)return!1;if(i!==this.geometries.length-1){var n=this.geometries[this.geometries.length-1];n&&(this.geometries[i]=n,this._geometriesByUniqueId&&(this._geometriesByUniqueId[n.uniqueId]=i,this._geometriesByUniqueId[t.uniqueId]=void 0))}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(t),!0},e.prototype.getGeometries=function(){return this.geometries},e.prototype.getMeshById=function(t){for(var i=0;i<this.meshes.length;i++)if(this.meshes[i].id===t)return this.meshes[i];return null},e.prototype.getMeshesById=function(t){return this.meshes.filter(function(i){return i.id===t})},e.prototype.getTransformNodeById=function(t){for(var i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].id===t)return this.transformNodes[i];return null},e.prototype.getTransformNodeByUniqueId=function(t){for(var i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].uniqueId===t)return this.transformNodes[i];return null},e.prototype.getTransformNodesById=function(t){return this.transformNodes.filter(function(i){return i.id===t})},e.prototype.getMeshByUniqueId=function(t){for(var i=0;i<this.meshes.length;i++)if(this.meshes[i].uniqueId===t)return this.meshes[i];return null},e.prototype.getLastMeshById=function(t){for(var i=this.meshes.length-1;i>=0;i--)if(this.meshes[i].id===t)return this.meshes[i];return null},e.prototype.getLastEntryById=function(t){var i;for(i=this.meshes.length-1;i>=0;i--)if(this.meshes[i].id===t)return this.meshes[i];for(i=this.transformNodes.length-1;i>=0;i--)if(this.transformNodes[i].id===t)return this.transformNodes[i];for(i=this.cameras.length-1;i>=0;i--)if(this.cameras[i].id===t)return this.cameras[i];for(i=this.lights.length-1;i>=0;i--)if(this.lights[i].id===t)return this.lights[i];return null},e.prototype.getNodeById=function(t){var i=this.getMeshById(t);if(i)return i;var n=this.getTransformNodeById(t);if(n)return n;var s=this.getLightById(t);if(s)return s;var o=this.getCameraById(t);if(o)return o;var a=this.getBoneById(t);return a||null},e.prototype.getNodeByName=function(t){var i=this.getMeshByName(t);if(i)return i;var n=this.getTransformNodeByName(t);if(n)return n;var s=this.getLightByName(t);if(s)return s;var o=this.getCameraByName(t);if(o)return o;var a=this.getBoneByName(t);return a||null},e.prototype.getMeshByName=function(t){for(var i=0;i<this.meshes.length;i++)if(this.meshes[i].name===t)return this.meshes[i];return null},e.prototype.getTransformNodeByName=function(t){for(var i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].name===t)return this.transformNodes[i];return null},e.prototype.getLastSkeletonById=function(t){for(var i=this.skeletons.length-1;i>=0;i--)if(this.skeletons[i].id===t)return this.skeletons[i];return null},e.prototype.getSkeletonByUniqueId=function(t){for(var i=0;i<this.skeletons.length;i++)if(this.skeletons[i].uniqueId===t)return this.skeletons[i];return null},e.prototype.getSkeletonById=function(t){for(var i=0;i<this.skeletons.length;i++)if(this.skeletons[i].id===t)return this.skeletons[i];return null},e.prototype.getSkeletonByName=function(t){for(var i=0;i<this.skeletons.length;i++)if(this.skeletons[i].name===t)return this.skeletons[i];return null},e.prototype.getMorphTargetManagerById=function(t){for(var i=0;i<this.morphTargetManagers.length;i++)if(this.morphTargetManagers[i].uniqueId===t)return this.morphTargetManagers[i];return null},e.prototype.getMorphTargetById=function(t){for(var i=0;i<this.morphTargetManagers.length;++i)for(var n=this.morphTargetManagers[i],s=0;s<n.numTargets;++s){var o=n.getTarget(s);if(o.id===t)return o}return null},e.prototype.getMorphTargetByName=function(t){for(var i=0;i<this.morphTargetManagers.length;++i)for(var n=this.morphTargetManagers[i],s=0;s<n.numTargets;++s){var o=n.getTarget(s);if(o.name===t)return o}return null},e.prototype.getPostProcessByName=function(t){for(var i=0;i<this.postProcesses.length;++i){var n=this.postProcesses[i];if(n.name===t)return n}return null},e.prototype.isActiveMesh=function(t){return this._activeMeshes.indexOf(t)!==-1},Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid||(this._uid=le.RandomId()),this._uid},enumerable:!1,configurable:!0}),e.prototype.addExternalData=function(t,i){return this._externalData||(this._externalData=new Dt),this._externalData.add(t,i)},e.prototype.getExternalData=function(t){return this._externalData?this._externalData.get(t):null},e.prototype.getOrAddExternalDataWithFactory=function(t,i){return this._externalData||(this._externalData=new Dt),this._externalData.getOrAddWithFactory(t,i)},e.prototype.removeExternalData=function(t){return this._externalData.remove(t)},e.prototype._evaluateSubMesh=function(t,i,n){if(n.hasInstances||n.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||i.alwaysSelectAsActiveMesh||i.subMeshes.length===1||t.isInFrustum(this._frustumPlanes)){for(var s=0,o=this._evaluateSubMeshStage;s<o.length;s++){var a=o[s];a.action(i,t)}var u=t.getMaterial();u!=null&&(u.hasRenderTargetTextures&&u.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(u)===-1&&(this._processedMaterials.push(u),this._materialsRenderTargets.concatWithNoDuplicate(u.getRenderTargetTextures())),this._renderingManager.dispatch(t,i,u))}},e.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(e.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(t){this._preventFreeActiveMeshesAndRenderingGroups!==t&&(t&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=t)},enumerable:!1,configurable:!0}),e.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var t=0;t<this.activeCameras.length;t++){var i=this.activeCameras[t];i&&i._activeMeshes&&i._activeMeshes.dispose()}},e.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var t=0;t<this.textures.length;t++){var i=this.textures[t];i&&i.renderList&&i.freeRenderingGroups()}},e.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},e.prototype.freezeActiveMeshes=function(t,i,n,s,o){var a=this;return t===void 0&&(t=!1),s===void 0&&(s=!0),o===void 0&&(o=!1),this.executeWhenReady(function(){if(!a.activeCamera){n&&n("No active camera found");return}if(a._frustumPlanes||a.updateTransformMatrix(),a._evaluateActiveMeshes(),a._activeMeshesFrozen=!0,a._activeMeshesFrozenButKeepClipping=o,a._skipEvaluateActiveMeshesCompletely=t,s)for(var u=0;u<a._activeMeshes.length;u++)a._activeMeshes.data[u]._freeze();i&&i()}),this},e.prototype.unfreezeActiveMeshes=function(){for(var t=0;t<this.meshes.length;t++){var i=this.meshes[t];i._internalAbstractMeshDataInfo&&(i._internalAbstractMeshDataInfo._isActive=!1)}for(var t=0;t<this._activeMeshes.length;t++)this._activeMeshes.data[t]._unFreeze();return this._activeMeshesFrozen=!1,this},e.prototype._executeActiveContainerCleanup=function(t){var i=this._engine.snapshotRendering&&this._engine.snapshotRenderingMode===1;!i&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce(function(){return t.dispose()})},e.prototype._evaluateActiveMeshes=function(){var t;if(this._engine.snapshotRendering&&this._engine.snapshotRenderingMode===1){this._activeMeshes.length>0&&((t=this.activeCamera)===null||t===void 0||t._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset());return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var i=this._activeMeshes.length,n=0;n<i;n++){var s=this._activeMeshes.data[n];s.computeWorldMatrix()}if(this._activeParticleSystems)for(var o=this._activeParticleSystems.length,n=0;n<o;n++)this._activeParticleSystems.data[n].animate();return}if(!!this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(var a=0,u=this._beforeEvaluateActiveMeshStage;a<u.length;a++){var h=u[a];h.action()}for(var f=this.getActiveMeshCandidates(),l=f.length,n=0;n<l;n++){var s=f.data[n];if(s._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!s.isBlocked&&(this._totalVertices.addCount(s.getTotalVertices(),!1),!(!s.isReady()||!s.isEnabled()||s.scaling.hasAZeroComponent))){s.computeWorldMatrix(),s.actionManager&&s.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(s);var c=this.customLODSelector?this.customLODSelector(s,this.activeCamera):s.getLOD(this.activeCamera);if(s._internalAbstractMeshDataInfo._currentLOD=c,s._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,c!=null&&(c!==s&&c.billboardMode!==0&&c.computeWorldMatrix(),s._preActivate(),s.isVisible&&s.visibility>0&&(s.layerMask&this.activeCamera.layerMask)!==0&&(this._skipFrustumClipping||s.alwaysSelectAsActiveMesh||s.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(s),this.activeCamera._activeMeshes.push(s),c!==s&&c._activate(this._renderId,!1);for(var _=0,d=this._preActiveMeshStage;_<d.length;_++){var h=d[_];h.action(s)}s._activate(this._renderId,!1)&&(s.isAnInstance?s._internalAbstractMeshDataInfo._actAsRegularMesh&&(c=s):c._internalAbstractMeshDataInfo._onlyForInstances=!1,c._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(s,c)),s._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var g=0;g<this.particleSystems.length;g++){var p=this.particleSystems[g];if(!(!p.isStarted()||!p.emitter)){var y=p.emitter;(!y.position||y.isEnabled())&&(this._activeParticleSystems.push(p),p.animate(),this._renderingManager.dispatchParticles(p))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},e.prototype._activeMesh=function(t,i){if(this._skeletonsEnabled&&i.skeleton!==null&&i.skeleton!==void 0&&(this._activeSkeletons.pushNoDuplicate(i.skeleton)&&(i.skeleton.prepare(),this._activeBones.addCount(i.skeleton.bones.length,!1)),i.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(i)),i&&i.subMeshes&&i.subMeshes.length>0)for(var n=this.getActiveSubMeshCandidates(i),s=n.length,o=0;o<s;o++){var a=n.data[o];this._evaluateSubMesh(a,i,t)}},e.prototype.updateTransformMatrix=function(t){if(!!this.activeCamera)if(this.activeCamera._renderingMultiview){var i=this.activeCamera._rigCameras[0],n=this.activeCamera._rigCameras[1];this.setTransformMatrix(i.getViewMatrix(),i.getProjectionMatrix(t),n.getViewMatrix(),n.getProjectionMatrix(t))}else this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(t))},e.prototype._bindFrameBuffer=function(t,i){i===void 0&&(i=!0),t&&t._multiviewTexture?t._multiviewTexture._bindFrameBuffer():t&&t.outputRenderTarget?t.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),i&&this._clearFrameBuffer(t)},e.prototype._clearFrameBuffer=function(t){if(!(t&&t._multiviewTexture))if(t&&t.outputRenderTarget){var i=t.outputRenderTarget;i.onClearObservable.hasObservers()?i.onClearObservable.notifyObservers(this._engine):i.skipInitialClear||(this._engine.clear(i.clearColor||this.clearColor,!i._cleared,!0,!0),i._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())},e.prototype._renderForCamera=function(t,i,n){var s,o,a;if(n===void 0&&(n=!0),!(t&&t._skipRendering)){var u=this._engine;if(this._activeCamera=t,!this.activeCamera)throw new Error("Active camera not set");if(u.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&n){var h=!0;t._renderingMultiview&&t.outputRenderTarget&&(h=t.outputRenderTarget.skipInitialClear,this.autoClear&&(t.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),t._renderingMultiview&&t.outputRenderTarget&&(t.outputRenderTarget.skipInitialClear=h)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var f=0;f<this._softwareSkinnedMeshes.length;f++){var l=this._softwareSkinnedMeshes.data[f];l.applySkeleton(l.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),i&&i.customRenderTargets&&i.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(i.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(var c=0,_=this._gatherActiveCameraRenderTargetsStage;c<_.length;c++){var d=_[c];d.action(this._renderTargets)}var g=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){le.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var p=0;p<this._renderTargets.length;p++){var y=this._renderTargets.data[p];if(y._shouldRender()){this._renderId++;var v=y.activeCamera&&y.activeCamera!==this.activeCamera;y.render(v,this.dumpNextRenderTargets),g=!0}}le.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var b=0,C=this._cameraDrawRenderTargetStage;b<C.length;b++){var d=C[b];g=d.action(this.activeCamera)||g}this._intermediateRendering=!1}this._engine.currentRenderPassId=(a=(o=(s=t.outputRenderTarget)===null||s===void 0?void 0:s.renderPassId)!==null&&o!==void 0?o:t.renderPassId)!==null&&a!==void 0?a:0,g&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!t._multiviewTexture&&!this.prePass&&this.postProcessManager._prepareFrame();for(var m=0,S=this._beforeCameraDrawStage;m<S.length;m++){var d=S[m];d.action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),u.snapshotRendering&&u.snapshotRenderingMode===1&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var M=0,w=this._afterCameraDrawStage;M<w.length;M++){var d=w[M];d.action(this.activeCamera)}if(this.postProcessManager&&!t._multiviewTexture){var x=t.outputRenderTarget?t.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(t.isIntermediate,x)}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},e.prototype._processSubCameras=function(t,i){if(i===void 0&&(i=!0),t.cameraRigMode===0||t._renderingMultiview){t._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(t,void 0,i),this.onAfterRenderCameraObservable.notifyObservers(t);return}if(t._useMultiviewToSingleView)this._renderMultiviewToSingleView(t);else{this.onBeforeCameraRenderObservable.notifyObservers(t);for(var n=0;n<t._rigCameras.length;n++)this._renderForCamera(t._rigCameras[n],t)}this._activeCamera=t,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(t)},e.prototype._checkIntersections=function(){for(var t=0;t<this._meshesForIntersections.length;t++){var i=this._meshesForIntersections.data[t];if(!!i.actionManager)for(var n=function(o){var a=i.actionManager.actions[o];if(a.trigger===12||a.trigger===13){var u=a.getTriggerParameter(),h=u.mesh?u.mesh:u,f=h.intersectsMesh(i,u.usePreciseIntersection),l=i._intersectionsInProgress.indexOf(h);f&&l===-1?a.trigger===12?(a._executeCurrent(ae.CreateNew(i,void 0,h)),i._intersectionsInProgress.push(h)):a.trigger===13&&i._intersectionsInProgress.push(h):!f&&l>-1&&(a.trigger===13&&a._executeCurrent(ae.CreateNew(i,void 0,h)),(!i.actionManager.hasSpecificTrigger(13,function(c){var _=c.mesh?c.mesh:c;return h===_})||a.trigger===13)&&i._intersectionsInProgress.splice(l,1))}},s=0;i.actionManager&&s<i.actionManager.actions.length;s++)n(s)}},e.prototype._advancePhysicsEngineStep=function(t){},e.prototype._animate=function(){},e.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var t=Math.max(e.MinDeltaTime,Math.min(this._engine.getDeltaTime(),e.MaxDeltaTime))+this._timeAccumulator,i=this._engine.getTimeStep(),n=1e3/i/1e3,s=0,o=this._engine.getLockstepMaxSteps(),a=Math.floor(t/i);for(a=Math.min(a,o);t>0&&s<a;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=i*n,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(i),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,s++,t-=i;this._timeAccumulator=t<0?0:t}else{var t=this.useConstantAnimationDeltaTime?16:Math.max(e.MinDeltaTime,Math.min(this._engine.getDeltaTime(),e.MaxDeltaTime));this._animationRatio=t*(60/1e3),this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(t)}},e.prototype._clear=function(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)},e.prototype._checkCameraRenderTarget=function(t){var i;if((t==null?void 0:t.outputRenderTarget)&&!(t!=null&&t.isRigCamera)&&(t.outputRenderTarget._cleared=!1),!((i=t==null?void 0:t.rigCameras)===null||i===void 0)&&i.length)for(var n=0;n<t.rigCameras.length;++n){var s=t.rigCameras[n].outputRenderTarget;s&&(s._cleared=!1)}},e.prototype.resetDrawCache=function(t){if(!!this.meshes)for(var i=0,n=this.meshes;i<n.length;i++){var s=n[i];s.resetDrawCache(t)}},e.prototype.render=function(t,i){var n,s,o;if(t===void 0&&(t=!0),i===void 0&&(i=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&this._executeWhenReadyTimeoutId===null&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),!((n=this.activeCameras)===null||n===void 0)&&n.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),i||this.animate();for(var a=0,u=this._beforeCameraUpdateStage;a<u.length;a++){var h=u[a];h.action()}if(t){if(this.activeCameras&&this.activeCameras.length>0)for(var f=0;f<this.activeCameras.length;f++){var l=this.activeCameras[f];if(l.update(),l.cameraRigMode!==0)for(var c=0;c<l._rigCameras.length;c++)l._rigCameras[c].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==0))for(var c=0;c<this.activeCamera._rigCameras.length;c++)this.activeCamera._rigCameras[c].update()}this.onBeforeRenderObservable.notifyObservers(this);var _=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var d=!((s=this.activeCameras)===null||s===void 0)&&s.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){le.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var g=0;g<this.customRenderTargets.length;g++){var p=this.customRenderTargets[g];if(p._shouldRender()){if(this._renderId++,this.activeCamera=p.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");_.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),p.render(d!==this.activeCamera,this.dumpNextRenderTargets)}}le.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(o=d==null?void 0:d.renderPassId)!==null&&o!==void 0?o:0,this.activeCamera=d,this._activeCamera&&this._activeCamera.cameraRigMode!==22&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var y=0,v=this._beforeClearStage;y<v.length;y++){var h=v[y];h.action()}this._clearFrameBuffer(this.activeCamera);for(var b=0,C=this._gatherRenderTargetsStage;b<C.length;b++){var h=C[b];h.action(this._renderTargets)}if(this.activeCameras&&this.activeCameras.length>0)for(var f=0;f<this.activeCameras.length;f++)this._processSubCameras(this.activeCameras[f],f>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();for(var m=0,S=this._afterRenderStage;m<S.length;m++){var h=S[m];h.action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(var c=0;c<this._toBeDisposed.length;c++){var M=this._toBeDisposed[c];M&&M.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}},e.prototype.freezeMaterials=function(){for(var t=0;t<this.materials.length;t++)this.materials[t].freeze()},e.prototype.unfreezeMaterials=function(){for(var t=0;t<this.materials.length;t++)this.materials[t].unfreeze()},e.prototype.dispose=function(){var t;if(!this.isDisposed){this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var i=this._activeRequests.slice(),n=0,s=i;n<s.length;n++){var o=s[n];o.abort()}this._activeRequests=[],this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onComputePressureChanged.clear(),(t=this._computePressureObserver)===null||t===void 0||t.unobserve(),this._computePressureObserver=void 0,this.detachControl();var a=this._engine.getInputElement();if(a)for(var u=0;u<this.cameras.length;u++)this.cameras[u].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,function(f){return f.dispose(!0)}),this._disposeList(this.transformNodes,function(f){return f.dispose(!0)}),this._disposeList(this.cameras),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);var h=this._engine.scenes.indexOf(this);h>-1&&this._engine.scenes.splice(h,1),Z._LastCreatedScene===this&&(this._engine.scenes.length>0?Z._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:Z._LastCreatedScene=null),h=this._engine._virtualScenes.indexOf(this),h>-1&&this._engine._virtualScenes.splice(h,1),this._engine.wipeCaches(!0),this._isDisposed=!0}},e.prototype._disposeList=function(t,i){var n=t.slice(0);i=i!=null?i:function(u){return u.dispose()};for(var s=0,o=n;s<o.length;s++){var a=o[s];i(a)}t.length=0},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),e.prototype.clearCachedVertexData=function(){for(var t=0;t<this.meshes.length;t++){var i=this.meshes[t],n=i.geometry;n&&n.clearCachedData()}},e.prototype.cleanCachedTextureBuffer=function(){for(var t=0,i=this.textures;t<i.length;t++){var n=i[t],s=n._buffer;s&&(n._buffer=null)}},e.prototype.getWorldExtends=function(t){var i=new F(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new F(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return t=t||function(){return!0},this.meshes.filter(t).forEach(function(s){if(s.computeWorldMatrix(!0),!(!s.subMeshes||s.subMeshes.length===0||s.infiniteDistance)){var o=s.getBoundingInfo(),a=o.boundingBox.minimumWorld,u=o.boundingBox.maximumWorld;F.CheckExtends(a,i,n),F.CheckExtends(u,i,n)}}),{min:i,max:n}},e.prototype.createPickingRay=function(t,i,n,s,o){throw V("Ray")},e.prototype.createPickingRayToRef=function(t,i,n,s,o,a,u){throw V("Ray")},e.prototype.createPickingRayInCameraSpace=function(t,i,n){throw V("Ray")},e.prototype.createPickingRayInCameraSpaceToRef=function(t,i,n,s){throw V("Ray")},e.prototype.pick=function(t,i,n,s,o,a){var u=new ut;return u._pickingUnavailable=!0,u},e.prototype.pickWithBoundingInfo=function(t,i,n,s,o){var a=new ut;return a._pickingUnavailable=!0,a},e.prototype.pickWithRay=function(t,i,n,s){throw V("Ray")},e.prototype.multiPick=function(t,i,n,s,o){throw V("Ray")},e.prototype.multiPickWithRay=function(t,i,n){throw V("Ray")},e.prototype.setPointerOverMesh=function(t,i,n){this._inputManager.setPointerOverMesh(t,i,n)},e.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},e.prototype._rebuildGeometries=function(){for(var t=0,i=this.geometries;t<i.length;t++){var n=i[t];n._rebuild()}for(var s=0,o=this.meshes;s<o.length;s++){var a=o[s];a._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var u=0,h=this._components;u<h.length;u++){var f=h[u];f.rebuild()}for(var l=0,c=this.particleSystems;l<c.length;l++){var _=c[l];_.rebuild()}if(this.spriteManagers)for(var d=0,g=this.spriteManagers;d<g.length;d++){var p=g[d];p.rebuild()}},e.prototype._rebuildTextures=function(){for(var t=0,i=this.textures;t<i.length;t++){var n=i[t];n._rebuild()}this.markAllMaterialsAsDirty(1)},e.prototype._getByTags=function(t,i,n){if(i===void 0)return t;var s=[];n=n||function(u){};for(var o in t){var a=t[o];Se&&Se.MatchesQuery(a,i)&&(s.push(a),n(a))}return s},e.prototype.getMeshesByTags=function(t,i){return this._getByTags(this.meshes,t,i)},e.prototype.getCamerasByTags=function(t,i){return this._getByTags(this.cameras,t,i)},e.prototype.getLightsByTags=function(t,i){return this._getByTags(this.lights,t,i)},e.prototype.getMaterialByTags=function(t,i){return this._getByTags(this.materials,t,i).concat(this._getByTags(this.multiMaterials,t,i))},e.prototype.getTransformNodesByTags=function(t,i){return this._getByTags(this.transformNodes,t,i)},e.prototype.setRenderingOrder=function(t,i,n,s){i===void 0&&(i=null),n===void 0&&(n=null),s===void 0&&(s=null),this._renderingManager.setRenderingOrder(t,i,n,s)},e.prototype.setRenderingAutoClearDepthStencil=function(t,i,n,s){n===void 0&&(n=!0),s===void 0&&(s=!0),this._renderingManager.setRenderingAutoClearDepthStencil(t,i,n,s)},e.prototype.getAutoClearDepthStencilSetup=function(t){return this._renderingManager.getAutoClearDepthStencilSetup(t)},Object.defineProperty(e.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(t){this._blockMaterialDirtyMechanism!==t&&(this._blockMaterialDirtyMechanism=t,t||this.markAllMaterialsAsDirty(63))},enumerable:!1,configurable:!0}),e.prototype.markAllMaterialsAsDirty=function(t,i){if(!this._blockMaterialDirtyMechanism)for(var n=0,s=this.materials;n<s.length;n++){var o=s[n];i&&!i(o)||o.markAsDirty(t)}},e.prototype._loadFile=function(t,i,n,s,o,a,u){var h=this,f=xe(t,i,n,s?this.offlineProvider:void 0,o,a,u);return this._activeRequests.push(f),f.onCompleteObservable.add(function(l){h._activeRequests.splice(h._activeRequests.indexOf(l),1)}),f},e.prototype._loadFileAsync=function(t,i,n,s,o){var a=this;return new Promise(function(u,h){a._loadFile(t,function(f){u(f)},i,n,s,function(f,l){h(l)},o)})},e.prototype._requestFile=function(t,i,n,s,o,a,u){var h=this,f=At(t,i,n,s?this.offlineProvider:void 0,o,a,u);return this._activeRequests.push(f),f.onCompleteObservable.add(function(l){h._activeRequests.splice(h._activeRequests.indexOf(l),1)}),f},e.prototype._requestFileAsync=function(t,i,n,s,o){var a=this;return new Promise(function(u,h){a._requestFile(t,function(f){u(f)},i,n,s,function(f){h(f)},o)})},e.prototype._readFile=function(t,i,n,s,o){var a=this,u=qe(t,i,n,s,o);return this._activeRequests.push(u),u.onCompleteObservable.add(function(h){a._activeRequests.splice(a._activeRequests.indexOf(h),1)}),u},e.prototype._readFileAsync=function(t,i,n){var s=this;return new Promise(function(o,a){s._readFile(t,function(u){o(u)},i,n,function(u){a(u)})})},e.prototype.getPerfCollector=function(){throw V("performanceViewerSceneExtension")},e.FOGMODE_NONE=0,e.FOGMODE_EXP=1,e.FOGMODE_EXP2=2,e.FOGMODE_LINEAR=3,e.MinDeltaTime=1,e.MaxDeltaTime=1e3,e}(ur);W.prototype.setActiveCameraByID=function(r){return this.setActiveCameraById(r)};W.prototype.getLastMaterialByID=function(r){return this.getLastMaterialById(r)};W.prototype.getMaterialByID=function(r){return this.getMaterialById(r)};W.prototype.getTextureByUniqueID=function(r){return this.getTextureByUniqueId(r)};W.prototype.getCameraByID=function(r){return this.getCameraById(r)};W.prototype.getCameraByUniqueID=function(r){return this.getCameraByUniqueId(r)};W.prototype.getBoneByID=function(r){return this.getBoneById(r)};W.prototype.getLightByID=function(r){return this.getLightById(r)};W.prototype.getLightByUniqueID=function(r){return this.getLightByUniqueId(r)};W.prototype.getParticleSystemByID=function(r){return this.getParticleSystemById(r)};W.prototype.getGeometryByID=function(r){return this.getGeometryById(r)};W.prototype.getMeshByID=function(r){return this.getMeshById(r)};W.prototype.getMeshesByID=function(r){return this.getMeshesById(r)};W.prototype.getTransformNodeByID=function(r){return this.getTransformNodeById(r)};W.prototype.getTransformNodeByUniqueID=function(r){return this.getTransformNodeByUniqueId(r)};W.prototype.getTransformNodesByID=function(r){return this.getTransformNodesById(r)};W.prototype.getMeshByUniqueID=function(r){return this.getMeshByUniqueId(r)};W.prototype.getLastMeshByID=function(r){return this.getLastMeshById(r)};W.prototype.getLastEntryByID=function(r){return this.getLastEntryById(r)};W.prototype.getNodeByID=function(r){return this.getNodeById(r)};W.prototype.getLastSkeletonByID=function(r){return this.getLastSkeletonById(r)};var Gi=Object.freeze(Object.defineProperty({__proto__:null,Scene:W},Symbol.toStringTag,{value:"Module"}));A.AudioEngineFactory=function(r,e,t){return new zi(r,e,t)};var zi=function(){function r(e,t,i){e===void 0&&(e=null),t===void 0&&(t=null),i===void 0&&(i=null);var n=this;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!0,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new E,this.onAudioLockedObservable=new E,this._tryToRun=!1,this._onResize=function(){n._moveButtonToTopLeft()},!!X()){(typeof window.AudioContext!="undefined"||typeof window.webkitAudioContext!="undefined")&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);var s=document.createElement("audio");this._hostElement=e,this._audioContext=t,this._audioDestination=i;try{s&&!!s.canPlayType&&(s.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||s.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch{}try{s&&!!s.canPlayType&&s.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch{}}}return Object.defineProperty(r.prototype,"audioContext",{get:function(){return this._audioContextInitialized?!this.unlocked&&!this._muteButton&&this._displayMuteButton():this._initializeAudioContext(),this._audioContext},enumerable:!1,configurable:!0}),r.prototype.lock=function(){this._triggerSuspendedState()},r.prototype.unlock=function(){this._triggerRunningState()},r.prototype._resumeAudioContext=function(){var e;return this._audioContext.resume!==void 0&&(e=this._audioContext.resume()),e||Promise.resolve()},r.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,this._audioContext.state==="running"&&this._triggerRunningState())}catch(e){this.canUseWebAudio=!1,D.Error("Web Audio: "+e.message)}},r.prototype._triggerRunningState=function(){var e=this;this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then(function(){e._tryToRun=!1,e._muteButton&&e._hideMuteButton(),e.unlocked=!0,e.onAudioUnlockedObservable.notifyObservers(e)}).catch(function(){e._tryToRun=!1,e.unlocked=!1}))},r.prototype._triggerSuspendedState=function(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()},r.prototype._displayMuteButton=function(){var e=this;if(!(this.useCustomUnlockedButton||this._muteButton)){this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";var t=window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png",i=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+t+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",n=document.createElement("style");n.appendChild(document.createTextNode(i)),document.getElementsByTagName("head")[0].appendChild(n),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",function(){e._triggerRunningState()},!0),this._muteButton.addEventListener("click",function(){e._triggerRunningState()},!0),window.addEventListener("resize",this._onResize)}},r.prototype._moveButtonToTopLeft=function(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")},r.prototype._hideMuteButton=function(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)},r.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()},r.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},r.prototype.setGlobalVolume=function(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)},r.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},r}();ur.AddParser(_e.NAME_AUDIO,function(r,e,t,i){var n,s=[],o;if(t.sounds=t.sounds||[],r.sounds!==void 0&&r.sounds!==null)for(var a=0,u=r.sounds.length;a<u;a++){var h=r.sounds[a];!((n=A.audioEngine)===null||n===void 0)&&n.canUseWebAudio?(h.url||(h.url=h.name),s[h.url]?t.sounds.push(rt.Parse(h,e,i,s[h.url])):(o=rt.Parse(h,e,i),s[h.url]=o,t.sounds.push(o))):t.sounds.push(new rt(h.name,null,e))}s=[]});Object.defineProperty(W.prototype,"mainSoundTrack",{get:function(){var r=this._getComponent(_e.NAME_AUDIO);return r||(r=new Te(this),this._addComponent(r)),this._mainSoundTrack||(this._mainSoundTrack=new vi(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0});W.prototype.getSoundByName=function(r){var e;for(e=0;e<this.mainSoundTrack.soundCollection.length;e++)if(this.mainSoundTrack.soundCollection[e].name===r)return this.mainSoundTrack.soundCollection[e];if(this.soundTracks){for(var t=0;t<this.soundTracks.length;t++)for(e=0;e<this.soundTracks[t].soundCollection.length;e++)if(this.soundTracks[t].soundCollection[e].name===r)return this.soundTracks[t].soundCollection[e]}return null};Object.defineProperty(W.prototype,"audioEnabled",{get:function(){var r=this._getComponent(_e.NAME_AUDIO);return r||(r=new Te(this),this._addComponent(r)),r.audioEnabled},set:function(r){var e=this._getComponent(_e.NAME_AUDIO);e||(e=new Te(this),this._addComponent(e)),r?e.enableAudio():e.disableAudio()},enumerable:!0,configurable:!0});Object.defineProperty(W.prototype,"headphone",{get:function(){var r=this._getComponent(_e.NAME_AUDIO);return r||(r=new Te(this),this._addComponent(r)),r.headphone},set:function(r){var e=this._getComponent(_e.NAME_AUDIO);e||(e=new Te(this),this._addComponent(e)),r?e.switchAudioModeForHeadphones():e.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0});Object.defineProperty(W.prototype,"audioListenerPositionProvider",{get:function(){var r=this._getComponent(_e.NAME_AUDIO);return r||(r=new Te(this),this._addComponent(r)),r.audioListenerPositionProvider},set:function(r){var e=this._getComponent(_e.NAME_AUDIO);if(e||(e=new Te(this),this._addComponent(e)),typeof r!="function")throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");e.audioListenerPositionProvider=r},enumerable:!0,configurable:!0});Object.defineProperty(W.prototype,"audioPositioningRefreshRate",{get:function(){var r=this._getComponent(_e.NAME_AUDIO);return r||(r=new Te(this),this._addComponent(r)),r.audioPositioningRefreshRate},set:function(r){var e=this._getComponent(_e.NAME_AUDIO);e||(e=new Te(this),this._addComponent(e)),e.audioPositioningRefreshRate=r},enumerable:!0,configurable:!0});var Te=function(){function r(e){this.name=_e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this._audioListenerPositionProvider=null,this._cachedCameraDirection=new F,this._cachedCameraPosition=new F,this._lastCheck=0,this._invertMatrixTemp=new oe,this._cameraDirectionTemp=new F,e=e||Z.LastCreatedScene,e&&(this.scene=e,e.soundTracks=new Array,e.sounds=new Array)}return Object.defineProperty(r.prototype,"audioEnabled",{get:function(){return this._audioEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"headphone",{get:function(){return this._headphone},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"audioListenerPositionProvider",{get:function(){return this._audioListenerPositionProvider},set:function(e){this._audioListenerPositionProvider=e},enumerable:!1,configurable:!0}),r.prototype.register=function(){this.scene._afterRenderStage.registerStep(_e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)},r.prototype.rebuild=function(){},r.prototype.serialize=function(e){if(e.sounds=[],this.scene.soundTracks)for(var t=0;t<this.scene.soundTracks.length;t++)for(var i=this.scene.soundTracks[t],n=0;n<i.soundCollection.length;n++)e.sounds.push(i.soundCollection[n].serialize())},r.prototype.addFromContainer=function(e){var t=this;!e.sounds||e.sounds.forEach(function(i){i.play(),i.autoplay=!0,t.scene.mainSoundTrack.addSound(i)})},r.prototype.removeFromContainer=function(e,t){var i=this;t===void 0&&(t=!1),e.sounds&&e.sounds.forEach(function(n){n.stop(),n.autoplay=!1,i.scene.mainSoundTrack.removeSound(n),t&&n.dispose()})},r.prototype.dispose=function(){var e=this.scene;if(e._mainSoundTrack&&e.mainSoundTrack.dispose(),e.soundTracks)for(var t=0;t<e.soundTracks.length;t++)e.soundTracks[t].dispose()},r.prototype.disableAudio=function(){var e=this.scene;this._audioEnabled=!1,A.audioEngine&&A.audioEngine.audioContext&&A.audioEngine.audioContext.suspend();var t;for(t=0;t<e.mainSoundTrack.soundCollection.length;t++)e.mainSoundTrack.soundCollection[t].pause();if(e.soundTracks)for(t=0;t<e.soundTracks.length;t++)for(var i=0;i<e.soundTracks[t].soundCollection.length;i++)e.soundTracks[t].soundCollection[i].pause()},r.prototype.enableAudio=function(){var e=this.scene;this._audioEnabled=!0,A.audioEngine&&A.audioEngine.audioContext&&A.audioEngine.audioContext.resume();var t;for(t=0;t<e.mainSoundTrack.soundCollection.length;t++)e.mainSoundTrack.soundCollection[t].isPaused&&e.mainSoundTrack.soundCollection[t].play();if(e.soundTracks)for(t=0;t<e.soundTracks.length;t++)for(var i=0;i<e.soundTracks[t].soundCollection.length;i++)e.soundTracks[t].soundCollection[i].isPaused&&e.soundTracks[t].soundCollection[i].play()},r.prototype.switchAudioModeForHeadphones=function(){var e=this.scene;if(this._headphone=!0,e.mainSoundTrack.switchPanningModelToHRTF(),e.soundTracks)for(var t=0;t<e.soundTracks.length;t++)e.soundTracks[t].switchPanningModelToHRTF()},r.prototype.switchAudioModeForNormalSpeakers=function(){var e=this.scene;if(this._headphone=!1,e.mainSoundTrack.switchPanningModelToEqualPower(),e.soundTracks)for(var t=0;t<e.soundTracks.length;t++)e.soundTracks[t].switchPanningModelToEqualPower()},r.prototype._afterRender=function(){var e=we.Now;if(!(this._lastCheck&&e-this._lastCheck<this.audioPositioningRefreshRate)){this._lastCheck=e;var t=this.scene;if(!(!this._audioEnabled||!t._mainSoundTrack||!t.soundTracks||t._mainSoundTrack.soundCollection.length===0&&t.soundTracks.length===1)){var i=A.audioEngine;if(!!i&&i.audioContext){if(this._audioListenerPositionProvider){var n=this._audioListenerPositionProvider();n.x=n.x||0,n.y=n.y||0,n.z=n.z||0,i.audioContext.listener.setPosition(n.x,n.y,n.z)}else{var s=void 0;t.activeCameras&&t.activeCameras.length>0?s=t.activeCameras[0]:s=t.activeCamera,s?(this._cachedCameraPosition.equals(s.globalPosition)||(this._cachedCameraPosition.copyFrom(s.globalPosition),i.audioContext.listener.setPosition(s.globalPosition.x,s.globalPosition.y,s.globalPosition.z)),s.rigCameras&&s.rigCameras.length>0&&(s=s.rigCameras[0]),s.getViewMatrix().invertToRef(this._invertMatrixTemp),F.TransformNormalToRef(r._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),!isNaN(this._cameraDirectionTemp.x)&&!isNaN(this._cameraDirectionTemp.y)&&!isNaN(this._cameraDirectionTemp.z)&&(this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.copyFrom(this._cameraDirectionTemp),i.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0)))):i.audioContext.listener.setPosition(0,0,0)}var o=void 0;for(o=0;o<t.mainSoundTrack.soundCollection.length;o++){var a=t.mainSoundTrack.soundCollection[o];a.useCustomAttenuation&&a.updateDistanceFromListener()}if(t.soundTracks)for(o=0;o<t.soundTracks.length;o++)for(var u=0;u<t.soundTracks[o].soundCollection.length;u++){var a=t.soundTracks[o].soundCollection[u];a.useCustomAttenuation&&a.updateDistanceFromListener()}}}}},r._CameraDirection=new F(0,0,-1),r}();rt._SceneComponentInitialization=function(r){var e=r._getComponent(_e.NAME_AUDIO);e||(e=new Te(r),r._addComponent(e))};const Vi=[{name:"textBoxBlue1",option:{materialOpt:{textureUrl:Ar}},initPosition:[0,16,-12]},{name:"textBoxBlue2",option:{materialOpt:{textureUrl:Pr}},initPosition:[0,14,-9]},{name:"textBoxBlue3",option:{materialOpt:{textureUrl:Cr}},initPosition:[0,12,-6]},{name:"textBoxBlue4",option:{materialOpt:{textureUrl:Sr}},initPosition:[0,10,-3]},{name:"textBoxBlue5",option:{materialOpt:{textureUrl:Mr}},initPosition:[0,12,0]},{name:"textBoxBlue6",option:{materialOpt:{textureUrl:Or}},initPosition:[0,14,3]},{name:"textBoxOrange1",option:{materialOpt:{textureUrl:Fr}},initPosition:[0,10,6]},{name:"textBoxOrange2",option:{materialOpt:{textureUrl:wr}},initPosition:[0,13,6]},{name:"textBoxOrange3",option:{materialOpt:{textureUrl:xr}},initPosition:[0,16,6]},{name:"textBoxOrange4",option:{materialOpt:{textureUrl:Dr}},initPosition:[0,19,9]},{name:"textBoxOrange5",option:{materialOpt:{textureUrl:Br}},initPosition:[0,16,9]},{name:"textBoxOrange6",option:{materialOpt:{textureUrl:Ir}},initPosition:[0,13,9]}];var Wi=async()=>{const r=document.getElementById("app"),{Engine:e}=await te(()=>Promise.resolve().then(function(){return gi}),void 0),t=new e(r,!0,{preserveDrawingBuffer:!0,stencil:!0},!1),{Scene:i}=await te(()=>Promise.resolve().then(function(){return Gi}),void 0),n=new i(t),{Vector3:s}=await te(()=>Promise.resolve().then(function(){return ci}),void 0),{Color4:o,Color3:a}=await te(()=>Promise.resolve().then(function(){return bi}),void 0);n.clearColor=new o(247/255,207/255,212/255,1),n.ambientColor=new a(1,1,1);const u=te(()=>import("./cannonJSPlugin.94faec6b.js"),["chunk/cannonJSPlugin.94faec6b.js","chunk/physicsImpostor.7ec1beab.js","chunk/abstractMesh.8bf71ac2.js","chunk/node.0c51c0e0.js","chunk/math.axis.aa7ca8fa.js","chunk/boundingInfo.71d69726.js","chunk/math.functions.ef221795.js","chunk/mesh.7b1ddb4e.js","chunk/material.4eb4d890.js","chunk/materialHelper.19d69264.js","chunk/light.40a4b08b.js","chunk/thinMaterialHelper.ab63cfd8.js","chunk/physicsJoint.16ce030f.js","chunk/physicsEngine.3d5bd84b.js","entry/index.a3769e15.js"]),h=te(()=>import("./cannon.df848110.js").then(function(R){return R.c}),["chunk/cannon.df848110.js","chunk/_commonjsHelpers.3e80cb1c.js"]),[{CannonJSPlugin:f},l]=await Promise.all([u,h]);await te(()=>import("./physicsEngineComponent.3c1a6727.js"),["chunk/physicsEngineComponent.3c1a6727.js","chunk/abstractMesh.8bf71ac2.js","chunk/node.0c51c0e0.js","chunk/math.axis.aa7ca8fa.js","chunk/boundingInfo.71d69726.js","chunk/math.functions.ef221795.js","chunk/physicsEngine.3d5bd84b.js","chunk/physicsJoint.16ce030f.js","entry/index.a3769e15.js"]),n.enablePhysics(new s(0,Er,0),new f(!0,1,l.default));const{ArcRotateCamera:c}=await te(()=>import("./arcRotateCamera.5b261ad5.js"),["chunk/arcRotateCamera.5b261ad5.js","chunk/node.0c51c0e0.js","chunk/mesh.7b1ddb4e.js","chunk/abstractMesh.8bf71ac2.js","chunk/math.axis.aa7ca8fa.js","chunk/boundingInfo.71d69726.js","chunk/math.functions.ef221795.js","chunk/material.4eb4d890.js","chunk/materialHelper.19d69264.js","chunk/light.40a4b08b.js","chunk/thinMaterialHelper.ab63cfd8.js","chunk/animation.d3a7fda1.js","chunk/math.size.f34aa5eb.js","entry/index.a3769e15.js"]),_=new c("ArcRotateCamera",0,.5*Math.PI,Ie/2+Rr+Be,new s(0,Be*Math.tan(De)/2,0),n);_.fov=De,_.lowerRadiusLimit=2;const d=(await te(()=>import("./Light1.653cc3a1.js"),["chunk/Light1.653cc3a1.js","chunk/directionalLight.f3b3f7c1.js","chunk/node.0c51c0e0.js","chunk/light.40a4b08b.js","chunk/math.axis.aa7ca8fa.js","entry/index.a3769e15.js"])).default,g=new d(n);te(()=>import("./ClickSound.f6c2f424.js"),["chunk/ClickSound.f6c2f424.js","chunk/standardMaterial.fe3baa28.js","chunk/material.4eb4d890.js","chunk/boundingInfo.71d69726.js","chunk/math.functions.ef221795.js","chunk/materialHelper.19d69264.js","chunk/node.0c51c0e0.js","chunk/light.40a4b08b.js","chunk/thinMaterialHelper.ab63cfd8.js","chunk/clipPlaneVertex.58e6a1d5.js","chunk/math.size.f34aa5eb.js","chunk/effectFallbacks.db57095f.js","chunk/imageProcessingFunctions.117736a4.js","chunk/instancesDeclaration.872520ba.js","entry/index.a3769e15.js"]).then(R=>{new R.default(n)});const p=(await te(()=>import("./SceneBoard.7e622b12.js"),["chunk/SceneBoard.7e622b12.js","chunk/standardMaterial.fe3baa28.js","chunk/material.4eb4d890.js","chunk/boundingInfo.71d69726.js","chunk/math.functions.ef221795.js","chunk/materialHelper.19d69264.js","chunk/node.0c51c0e0.js","chunk/light.40a4b08b.js","chunk/thinMaterialHelper.ab63cfd8.js","chunk/clipPlaneVertex.58e6a1d5.js","chunk/math.size.f34aa5eb.js","chunk/effectFallbacks.db57095f.js","chunk/imageProcessingFunctions.117736a4.js","chunk/instancesDeclaration.872520ba.js","chunk/physicsImpostor.7ec1beab.js","chunk/abstractMesh.8bf71ac2.js","chunk/math.axis.aa7ca8fa.js","chunk/mesh.7b1ddb4e.js","chunk/physicsJoint.16ce030f.js","entry/index.a3769e15.js"])).default;new p(n,{h:Be*Math.tan(De),v:Be*Math.tan(De)*(r.width/r.height),d:Ie});const y=(await te(()=>import("./ParticleFlare.25df67e6.js"),["chunk/ParticleFlare.25df67e6.js","chunk/clipPlaneVertex.58e6a1d5.js","chunk/math.size.f34aa5eb.js","chunk/thinMaterialHelper.ab63cfd8.js","chunk/imageProcessingFunctions.117736a4.js","entry/index.a3769e15.js"])).default,v=new y(n),{ShadowGenerator:b}=await te(()=>import("./shadowGenerator.96706f33.js").then(function(R){return R.s}),["chunk/shadowGenerator.96706f33.js","chunk/light.40a4b08b.js","chunk/node.0c51c0e0.js","chunk/materialHelper.19d69264.js","chunk/thinMaterialHelper.ab63cfd8.js","chunk/clipPlaneVertex.58e6a1d5.js","chunk/math.size.f34aa5eb.js","chunk/effectFallbacks.db57095f.js"]);await te(()=>import("./shadowGeneratorSceneComponent.58bb1b32.js"),["chunk/shadowGeneratorSceneComponent.58bb1b32.js","chunk/shadowGenerator.96706f33.js","chunk/light.40a4b08b.js","chunk/node.0c51c0e0.js","chunk/materialHelper.19d69264.js","chunk/thinMaterialHelper.ab63cfd8.js","chunk/clipPlaneVertex.58e6a1d5.js","chunk/math.size.f34aa5eb.js","chunk/effectFallbacks.db57095f.js","chunk/boundingInfo.71d69726.js","chunk/instancesDeclaration.872520ba.js","entry/index.a3769e15.js"]);const C=new b(1024,g.light),m=(await te(()=>import("./CustomObj.d9b27c0a.js"),["chunk/CustomObj.d9b27c0a.js","chunk/standardMaterial.fe3baa28.js","chunk/material.4eb4d890.js","chunk/boundingInfo.71d69726.js","chunk/math.functions.ef221795.js","chunk/materialHelper.19d69264.js","chunk/node.0c51c0e0.js","chunk/light.40a4b08b.js","chunk/thinMaterialHelper.ab63cfd8.js","chunk/clipPlaneVertex.58e6a1d5.js","chunk/math.size.f34aa5eb.js","chunk/effectFallbacks.db57095f.js","chunk/imageProcessingFunctions.117736a4.js","chunk/instancesDeclaration.872520ba.js","chunk/animation.d3a7fda1.js","chunk/physicsImpostor.7ec1beab.js","chunk/abstractMesh.8bf71ac2.js","chunk/math.axis.aa7ca8fa.js","chunk/mesh.7b1ddb4e.js","chunk/physicsJoint.16ce030f.js","entry/index.a3769e15.js"])).default,S=[];setTimeout(()=>{Vi.forEach((R,j)=>{setTimeout(()=>{const K=new m(n,R.name,R.option);K.mesh.position=new s(...R.initPosition),S.push(K),C.addShadowCaster(K.mesh)},j*80)}),te(()=>import("./addBehaviors.af0121ac.js"),["chunk/addBehaviors.af0121ac.js","chunk/directionalLight.f3b3f7c1.js","chunk/node.0c51c0e0.js","chunk/light.40a4b08b.js","chunk/math.axis.aa7ca8fa.js","chunk/standardMaterial.fe3baa28.js","chunk/material.4eb4d890.js","chunk/boundingInfo.71d69726.js","chunk/math.functions.ef221795.js","chunk/materialHelper.19d69264.js","chunk/thinMaterialHelper.ab63cfd8.js","chunk/clipPlaneVertex.58e6a1d5.js","chunk/math.size.f34aa5eb.js","chunk/effectFallbacks.db57095f.js","chunk/imageProcessingFunctions.117736a4.js","chunk/instancesDeclaration.872520ba.js","chunk/animation.d3a7fda1.js","chunk/physicsImpostor.7ec1beab.js","chunk/abstractMesh.8bf71ac2.js","chunk/mesh.7b1ddb4e.js","chunk/physicsJoint.16ce030f.js","chunk/FollowMouseObj.a4dc814e.js","entry/index.a3769e15.js"]).then(R=>{R.default(n,S,v)})},500);const M=Be*Math.tan(De),w=Be*Math.tan(De)*(r.width/r.height),x=.5,z=R=>{var j,K,J,L,Y,ne;R.position.x>=Ie/2-x&&(R.position.x=Ie/2-x,(j=R.physicsImpostor)==null||j.setLinearVelocity(s.Zero())),R.position.x<-Ie/2+x&&(R.position.x=-Ie/2+x,(K=R.physicsImpostor)==null||K.setLinearVelocity(s.Zero())),R.position.z>w/2-x&&(R.position.z=w/2-x,(J=R.physicsImpostor)==null||J.setLinearVelocity(s.Zero())),R.position.z<-w/2+x&&(R.position.z=-w/2+x,(L=R.physicsImpostor)==null||L.setLinearVelocity(s.Zero())),R.position.y>M-x&&(R.position.y=M-x,(Y=R.physicsImpostor)==null||Y.setLinearVelocity(s.Zero())),R.position.y<x&&(R.position.y=x,(ne=R.physicsImpostor)==null||ne.setLinearVelocity(s.Zero()))},U=R=>{var j,K;for(let J of R){const L=(j=J.physicsImpostor)==null?void 0:j.getAngularVelocity();L&&!(L!=null&&L.equals(s.Zero()))&&((K=J.physicsImpostor)==null||K.setAngularVelocity(L.scale(.9)))}};let I;te(()=>import("./stats.min.28723f6c.js").then(function(R){return R.s}),["chunk/stats.min.28723f6c.js","chunk/_commonjsHelpers.3e80cb1c.js"]).then(R=>{I=new R.default,document.body.appendChild(I.dom)});const H=(await te(()=>import("./FollowMouseObj.a4dc814e.js").then(function(R){return R.a}),["chunk/FollowMouseObj.a4dc814e.js","chunk/standardMaterial.fe3baa28.js","chunk/material.4eb4d890.js","chunk/boundingInfo.71d69726.js","chunk/math.functions.ef221795.js","chunk/materialHelper.19d69264.js","chunk/node.0c51c0e0.js","chunk/light.40a4b08b.js","chunk/thinMaterialHelper.ab63cfd8.js","chunk/clipPlaneVertex.58e6a1d5.js","chunk/math.size.f34aa5eb.js","chunk/effectFallbacks.db57095f.js","chunk/imageProcessingFunctions.117736a4.js","chunk/instancesDeclaration.872520ba.js","chunk/physicsImpostor.7ec1beab.js","chunk/abstractMesh.8bf71ac2.js","chunk/math.axis.aa7ca8fa.js","chunk/mesh.7b1ddb4e.js","chunk/physicsJoint.16ce030f.js"])).default;t.runRenderLoop(()=>{I==null||I.begin(),S.forEach(R=>z(R.mesh)),z(H.getInstance(n).mesh),U(S.slice(0,6).map(R=>R.mesh)),n.render(),I==null||I.end()}),window.addEventListener("resize",()=>{t.resize()})},en=Object.freeze(Object.defineProperty({__proto__:null,default:Wi},Symbol.toStringTag,{value:"Module"}));export{at as $,me as A,Lt as B,fe as C,kr as D,bt as E,qt as F,fi as G,Xi as H,ji as I,k as J,we as K,D as L,oe as M,Qi as N,E as O,ut as P,be as Q,Tt as R,Ae as S,ue as T,Si as U,F as V,Nt as W,xi as X,B as Y,qi as Z,Q as _,ce as a,rt as a0,ve as a1,Ri as a2,Ci as a3,vt as a4,Yi as a5,li as a6,Qt as a7,ir as a8,Vr as a9,_t as aa,$ as ab,tt as ac,ie as ad,$i as ae,Ut as af,Fi as ag,Pi as ah,ur as ai,Er as aj,Ie as ak,en as al,V as b,Jt as c,ft as d,N as e,Ji as f,G as g,se as h,Ne as i,A as j,ke as k,Se as l,le as m,It as n,Z as o,de as p,Ki as q,_e as r,Zi as s,ii as t,st as u,Ui as v,ye as w,W as x,mi as y,ki as z};
