var $=Object.defineProperty;var q=(o,i,t)=>i in o?$(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t;var k=(o,i,t)=>(q(o,typeof i!="symbol"?i+"":i,t),t);import{Quaternion as F,Vector3 as L,Vector2 as tt,Matrix as y,TmpVectors as D,Vector4 as et}from"./math.vector.560c6bc4.js";import{Color3 as z,Color4 as it}from"./math.color.d29cb8ed.js";import{S as nt}from"./standardMaterial.114db29c.js";import{A as T,C as rt}from"./animation.df1e8d77.js";import{P as ot}from"./physicsImpostor.c9d13e49.js";import{T as at}from"./clipPlaneVertex.1e772c5b.js";import{S as st}from"./math.size.64d00435.js";import{_ as lt,P as ht,O as N}from"./precisionDate.1704d4c6.js";import{a as I}from"./scene.7f90ce88.js";import{A as x}from"./arrayTools.49279cc5.js";import{N as ft}from"./node.3cceef8b.js";import{S as c}from"./math.axis.43721c0c.js";import{M as j}from"./mesh.51493cf6.js";import{V as B}from"./abstractMesh.d4d5c19c.js";import{C as Q}from"./thinMaterialHelper.ab1f33f5.js";import"./performanceConfigurator.ee04355d.js";import"./decorators.5af14a95.js";import"./math.plane.7ea68d04.js";import"./material.ddd1f5e1.js";import"./boundingInfo.26e5828d.js";import"./math.functions.3c8565ae.js";import"./lightConstants.176abcb0.js";import"./materialHelper.8edca65e.js";import"./engine.535c373a.js";import"./perfCounter.4442bbd7.js";import"./engine.dynamicBuffer.fe9de623.js";import"./effectFallbacks.3405025b.js";import"./imageProcessingFunctions.3c9d02ee.js";import"./instancesDeclaration.03c72576.js";import"./physicsJoint.0bac1769.js";var ut=Object.freeze(new F(0,0,0,0)),mt=Object.freeze(L.Zero()),pt=Object.freeze(tt.Zero()),ct=Object.freeze(st.Zero()),_t=Object.freeze(z.Black()),vt=function(){function o(i,t,e,n){var r=this;if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._targetIsArray=!1,this._animation=t,this._target=i,this._scene=e,this._host=n,this._activeTargets=[],t._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===T.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=y.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,this._minFrame!==0){var a={frame:0,value:this._minValue};this._keys.splice(0,0,a)}if(this._target instanceof Array){for(var s=0,h=0,l=this._target;h<l.length;h++){var u=l[h];this._preparePath(u,s),this._getOriginalValues(s),s++}this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];var f=t.getEvents();f&&f.length>0&&f.forEach(function(m){r._events.push(m._clone())}),this._enableBlending=i&&i.animationPropertiesOverride?i.animationPropertiesOverride.enableBlending:this._animation.enableBlending}return Object.defineProperty(o.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"weight",{get:function(){return this._weight},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"target",{get:function(){return this._currentActiveTarget},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isAdditive",{get:function(){return this._host&&this._host.isAdditive},enumerable:!1,configurable:!0}),o.prototype._preparePath=function(i,t){t===void 0&&(t=0);var e=this._animation.targetPropertyPath;if(e.length>1){for(var n=i[e[0]],r=1;r<e.length-1;r++)n=n[e[r]];this._targetPath=e[e.length-1],this._activeTargets[t]=n}else this._targetPath=e[0],this._activeTargets[t]=i},Object.defineProperty(o.prototype,"animation",{get:function(){return this._animation},enumerable:!1,configurable:!0}),o.prototype.reset=function(i){if(i===void 0&&(i=!1),i)if(this._target instanceof Array)for(var t=0,e=0,n=this._target;e<n.length;e++){var r=n[e];this._originalValue[t]!==void 0&&this._setValue(r,this._activeTargets[t],this._originalValue[t],-1,t),t++}else this._originalValue[0]!==void 0&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(var t=0;t<this._events.length;t++)this._events[t].isDone=!1},o.prototype.isStopped=function(){return this._stopped},o.prototype.dispose=function(){var i=this._animation.runtimeAnimations.indexOf(this);i>-1&&this._animation.runtimeAnimations.splice(i,1)},o.prototype.setValue=function(i,t){if(this._targetIsArray){for(var e=0;e<this._target.length;e++){var n=this._target[e];this._setValue(n,this._activeTargets[e],i,t,e)}return}this._setValue(this._target,this._directTarget,i,t,0)},o.prototype._getOriginalValues=function(i){i===void 0&&(i=0);var t,e=this._activeTargets[i];e.getRestPose&&this._targetPath==="_matrix"?t=e.getRestPose():t=e[this._targetPath],t&&t.clone?this._originalValue[i]=t.clone():this._originalValue[i]=t},o.prototype._setValue=function(i,t,e,n,r){if(this._currentActiveTarget=t,this._weight=n,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){var a=t[this._targetPath];a.clone?this._originalBlendValue=a.clone():this._originalBlendValue=a}this._originalBlendValue.m?T.AllowMatrixDecomposeForInterpolation?this._currentValue?y.DecomposeLerpToRef(this._originalBlendValue,e,this._blendingFactor,this._currentValue):this._currentValue=y.DecomposeLerp(this._originalBlendValue,e,this._blendingFactor):this._currentValue?y.LerpToRef(this._originalBlendValue,e,this._blendingFactor,this._currentValue):this._currentValue=y.Lerp(this._originalBlendValue,e,this._blendingFactor):this._currentValue=T._UniversalLerp(this._originalBlendValue,e,this._blendingFactor);var s=i&&i.animationPropertiesOverride?i.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=s}else this._currentValue?this._currentValue.copyFrom?this._currentValue.copyFrom(e):this._currentValue=e:e!=null&&e.clone?this._currentValue=e.clone():this._currentValue=e;n!==-1?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[r]):t[this._targetPath]=this._currentValue,i.markAsDirty&&i.markAsDirty(this._animation.targetProperty)},o.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},o.prototype.goToFrame=function(i){var t=this._animation.getKeys();i<t[0].frame?i=t[0].frame:i>t[t.length-1].frame&&(i=t[t.length-1].frame);var e=this._events;if(e.length)for(var n=0;n<e.length;n++)e[n].onlyOnce||(e[n].isDone=e[n].frame<i);this._currentFrame=i;var r=this._animation._interpolate(i,this._animationState);this.setValue(r,-1)},o.prototype._prepareForSpeedRatioChange=function(i){var t=this._previousDelay*(this._animation.framePerSecond*i)/1e3;this._ratioOffset=this._previousRatio-t},o.prototype.animate=function(i,t,e,n,r,a){a===void 0&&(a=-1);var s=this._animation,h=s.targetPropertyPath;if(!h||h.length<1)return this._stopped=!0,!1;var l=!0;(t<this._minFrame||t>this._maxFrame)&&(t=this._minFrame),(e<this._minFrame||e>this._maxFrame)&&(e=this._maxFrame);var u=e-t,f,m=i*(s.framePerSecond*r)/1e3+this._ratioOffset,p=0;if(this._previousDelay=i,this._previousRatio=m,!n&&e>=t&&m>=u)l=!1,p=s._getKeyValue(this._maxValue);else if(!n&&t>=e&&m<=u)l=!1,p=s._getKeyValue(this._minValue);else if(this._animationState.loopMode!==T.ANIMATIONLOOPMODE_CYCLE){var _=e.toString()+t.toString();if(!this._offsetsCache[_]){this._animationState.repeatCount=0,this._animationState.loopMode=T.ANIMATIONLOOPMODE_CYCLE;var P=s._interpolate(t,this._animationState),g=s._interpolate(e,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),s.dataType){case T.ANIMATIONTYPE_FLOAT:this._offsetsCache[_]=g-P;break;case T.ANIMATIONTYPE_QUATERNION:this._offsetsCache[_]=g.subtract(P);break;case T.ANIMATIONTYPE_VECTOR3:this._offsetsCache[_]=g.subtract(P);break;case T.ANIMATIONTYPE_VECTOR2:this._offsetsCache[_]=g.subtract(P);break;case T.ANIMATIONTYPE_SIZE:this._offsetsCache[_]=g.subtract(P);break;case T.ANIMATIONTYPE_COLOR3:this._offsetsCache[_]=g.subtract(P);break}this._highLimitsCache[_]=g}p=this._highLimitsCache[_],f=this._offsetsCache[_]}if(f===void 0)switch(s.dataType){case T.ANIMATIONTYPE_FLOAT:f=0;break;case T.ANIMATIONTYPE_QUATERNION:f=ut;break;case T.ANIMATIONTYPE_VECTOR3:f=mt;break;case T.ANIMATIONTYPE_VECTOR2:f=pt;break;case T.ANIMATIONTYPE_SIZE:f=ct;break;case T.ANIMATIONTYPE_COLOR3:f=_t}var A;if(this._host&&this._host.syncRoot){var d=this._host.syncRoot,C=(d.masterFrame-d.fromFrame)/(d.toFrame-d.fromFrame);A=t+(e-t)*C}else m>0&&t>e||m<0&&t<e?A=l&&u!==0?e+m%u:t:A=l&&u!==0?t+m%u:e;var v=this._events;if((r>0&&this.currentFrame>A||r<0&&this.currentFrame<A)&&(this._onLoop(),v.length))for(var M=0;M<v.length;M++)v[M].onlyOnce||(v[M].isDone=!1);this._currentFrame=A,this._animationState.repeatCount=u===0?0:m/u>>0,this._animationState.highLimitValue=p,this._animationState.offsetValue=f;var E=s._interpolate(A,this._animationState);if(this.setValue(E,a),v.length){for(var M=0;M<v.length;M++)if(u>0&&A>=v[M].frame&&v[M].frame>=t||u<0&&A<=v[M].frame&&v[M].frame<=t){var b=v[M];b.isDone||(b.onlyOnce&&(v.splice(M,1),M--),b.isDone=!0,b.action(A))}}return l||(this._stopped=!0),l},o}(),gt=function(o){lt(i,o);function i(t,e,n,r,a,s,h){n===void 0&&(n=null),r===void 0&&(r=null),a===void 0&&(a=null),s===void 0&&(s=null),h===void 0&&(h=null);var l=o.call(this,t,e.getScene())||this;return l.name=t,l.children=new Array,l.animations=new Array,l._index=null,l._absoluteTransform=new y,l._invertedAbsoluteTransform=new y,l._scalingDeterminant=1,l._worldTransform=new y,l._needToDecompose=!0,l._needToCompose=!1,l._linkedTransformNode=null,l._waitingTransformNodeId=null,l._skeleton=e,l._localMatrix=r?r.clone():y.Identity(),l._restPose=a||l._localMatrix.clone(),l._baseMatrix=s||l._localMatrix.clone(),l._index=h,e.bones.push(l),l.setParent(n,!1),(s||r)&&l._updateDifferenceMatrix(),l}return Object.defineProperty(i.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(t){this._needToCompose=!1,t.updateFlag!==this._localMatrix.updateFlag&&(this._localMatrix.copyFrom(t),this._markAsDirtyAndDecompose())},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"Bone"},i.prototype.getSkeleton=function(){return this._skeleton},Object.defineProperty(i.prototype,"parent",{get:function(){return this._parentNode},set:function(t){this.setParent(t)},enumerable:!1,configurable:!0}),i.prototype.getParent=function(){return this.parent},i.prototype.getChildren=function(){return this.children},i.prototype.getIndex=function(){return this._index===null?this.getSkeleton().bones.indexOf(this):this._index},i.prototype.setParent=function(t,e){if(e===void 0&&(e=!0),this.parent!==t){if(this.parent){var n=this.parent.children.indexOf(this);n!==-1&&this.parent.children.splice(n,1)}this._parentNode=t,this.parent&&this.parent.children.push(this),e&&this._updateDifferenceMatrix(),this.markAsDirty()}},i.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},i.prototype.getBaseMatrix=function(){return this._baseMatrix},i.prototype.getRestPose=function(){return this._restPose},i.prototype.setRestPose=function(t){this._restPose.copyFrom(t)},i.prototype.getBindPose=function(){return this._baseMatrix},i.prototype.setBindPose=function(t){this.updateMatrix(t)},i.prototype.getWorldMatrix=function(){return this._worldTransform},i.prototype.returnToRest=function(){var t;if(this._linkedTransformNode){var e=D.Vector3[0],n=D.Quaternion[0],r=D.Vector3[1];this.getRestPose().decompose(e,n,r),this._linkedTransformNode.position.copyFrom(r),this._linkedTransformNode.rotationQuaternion=(t=this._linkedTransformNode.rotationQuaternion)!==null&&t!==void 0?t:F.Identity(),this._linkedTransformNode.rotationQuaternion.copyFrom(n),this._linkedTransformNode.scaling.copyFrom(e)}else this._matrix=this._restPose},i.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},i.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},i.prototype.linkTransformNode=function(t){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=t,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},i.prototype.getTransformNode=function(){return this._linkedTransformNode},Object.defineProperty(i.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(t){this._decompose(),this._localPosition.copyFrom(t),this._markAsDirtyAndCompose()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this.getRotation()},set:function(t){this.setRotation(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(t){this.setRotationQuaternion(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scaling",{get:function(){return this.getScale()},set:function(t){this.setScale(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!1,configurable:!0}),i.prototype._decompose=function(){!this._needToDecompose||(this._needToDecompose=!1,this._localScaling||(this._localScaling=L.Zero(),this._localRotation=F.Zero(),this._localPosition=L.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},i.prototype._compose=function(){if(!!this._needToCompose){if(!this._localScaling){this._needToCompose=!1;return}this._needToCompose=!1,y.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)}},i.prototype.updateMatrix=function(t,e,n){e===void 0&&(e=!0),n===void 0&&(n=!0),this._baseMatrix.copyFrom(t),e&&this._updateDifferenceMatrix(),n?this._matrix=t:this.markAsDirty()},i.prototype._updateDifferenceMatrix=function(t,e){if(e===void 0&&(e=!0),t||(t=this._baseMatrix),this.parent?t.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(t),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),e)for(var n=0;n<this.children.length;n++)this.children[n]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},i.prototype.markAsDirty=function(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this},i.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},i.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},i.prototype.translate=function(t,e,n){e===void 0&&(e=c.LOCAL);var r=this.getLocalMatrix();if(e==c.LOCAL)r.addAtIndex(12,t.x),r.addAtIndex(13,t.y),r.addAtIndex(14,t.z);else{var a=null;n&&(a=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=i._TmpMats[0],h=i._TmpVecs[0];this.parent?n&&a?(s.copyFrom(this.parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this.parent.getAbsoluteTransform()):y.IdentityToRef(s),s.setTranslationFromFloats(0,0,0),s.invert(),L.TransformCoordinatesToRef(t,s,h),r.addAtIndex(12,h.x),r.addAtIndex(13,h.y),r.addAtIndex(14,h.z)}this._markAsDirtyAndDecompose()},i.prototype.setPosition=function(t,e,n){e===void 0&&(e=c.LOCAL);var r=this.getLocalMatrix();if(e==c.LOCAL)r.setTranslationFromFloats(t.x,t.y,t.z);else{var a=null;n&&(a=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=i._TmpMats[0],h=i._TmpVecs[0];this.parent?(n&&a?(s.copyFrom(this.parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this.parent.getAbsoluteTransform()),s.invert()):y.IdentityToRef(s),L.TransformCoordinatesToRef(t,s,h),r.setTranslationFromFloats(h.x,h.y,h.z)}this._markAsDirtyAndDecompose()},i.prototype.setAbsolutePosition=function(t,e){this.setPosition(t,c.WORLD,e)},i.prototype.scale=function(t,e,n,r){r===void 0&&(r=!1);var a=this.getLocalMatrix(),s=i._TmpMats[0];y.ScalingToRef(t,e,n,s),s.multiplyToRef(a,a),s.invert();for(var h=0,l=this.children;h<l.length;h++){var u=l[h],f=u.getLocalMatrix();f.multiplyToRef(s,f),f.multiplyAtIndex(12,t),f.multiplyAtIndex(13,e),f.multiplyAtIndex(14,n),u._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),r)for(var m=0,p=this.children;m<p.length;m++){var u=p[m];u.scale(t,e,n,r)}},i.prototype.setScale=function(t){this._decompose(),this._localScaling.copyFrom(t),this._markAsDirtyAndCompose()},i.prototype.getScale=function(){return this._decompose(),this._localScaling},i.prototype.getScaleToRef=function(t){this._decompose(),t.copyFrom(this._localScaling)},i.prototype.setYawPitchRoll=function(t,e,n,r,a){if(r===void 0&&(r=c.LOCAL),r===c.LOCAL){var s=i._TmpQuat;F.RotationYawPitchRollToRef(t,e,n,s),this.setRotationQuaternion(s,r,a);return}var h=i._TmpMats[0];if(!!this._getNegativeRotationToRef(h,a)){var l=i._TmpMats[1];y.RotationYawPitchRollToRef(t,e,n,l),h.multiplyToRef(l,l),this._rotateWithMatrix(l,r,a)}},i.prototype.rotate=function(t,e,n,r){n===void 0&&(n=c.LOCAL);var a=i._TmpMats[0];a.setTranslationFromFloats(0,0,0),y.RotationAxisToRef(t,e,a),this._rotateWithMatrix(a,n,r)},i.prototype.setAxisAngle=function(t,e,n,r){if(n===void 0&&(n=c.LOCAL),n===c.LOCAL){var a=i._TmpQuat;F.RotationAxisToRef(t,e,a),this.setRotationQuaternion(a,n,r);return}var s=i._TmpMats[0];if(!!this._getNegativeRotationToRef(s,r)){var h=i._TmpMats[1];y.RotationAxisToRef(t,e,h),s.multiplyToRef(h,h),this._rotateWithMatrix(h,n,r)}},i.prototype.setRotation=function(t,e,n){e===void 0&&(e=c.LOCAL),this.setYawPitchRoll(t.y,t.x,t.z,e,n)},i.prototype.setRotationQuaternion=function(t,e,n){if(e===void 0&&(e=c.LOCAL),e===c.LOCAL){this._decompose(),this._localRotation.copyFrom(t),this._markAsDirtyAndCompose();return}var r=i._TmpMats[0];if(!!this._getNegativeRotationToRef(r,n)){var a=i._TmpMats[1];y.FromQuaternionToRef(t,a),r.multiplyToRef(a,a),this._rotateWithMatrix(a,e,n)}},i.prototype.setRotationMatrix=function(t,e,n){if(e===void 0&&(e=c.LOCAL),e===c.LOCAL){var r=i._TmpQuat;F.FromRotationMatrixToRef(t,r),this.setRotationQuaternion(r,e,n);return}var a=i._TmpMats[0];if(!!this._getNegativeRotationToRef(a,n)){var s=i._TmpMats[1];s.copyFrom(t),a.multiplyToRef(t,s),this._rotateWithMatrix(s,e,n)}},i.prototype._rotateWithMatrix=function(t,e,n){e===void 0&&(e=c.LOCAL);var r=this.getLocalMatrix(),a=r.m[12],s=r.m[13],h=r.m[14],l=this.getParent(),u=i._TmpMats[3],f=i._TmpMats[4];l&&e==c.WORLD?(n?(u.copyFrom(n.getWorldMatrix()),l.getAbsoluteTransform().multiplyToRef(u,u)):u.copyFrom(l.getAbsoluteTransform()),f.copyFrom(u),f.invert(),r.multiplyToRef(u,r),r.multiplyToRef(t,r),r.multiplyToRef(f,r)):e==c.WORLD&&n?(u.copyFrom(n.getWorldMatrix()),f.copyFrom(u),f.invert(),r.multiplyToRef(u,r),r.multiplyToRef(t,r),r.multiplyToRef(f,r)):r.multiplyToRef(t,r),r.setTranslationFromFloats(a,s,h),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},i.prototype._getNegativeRotationToRef=function(t,e){var n=i._TmpMats[2];return t.copyFrom(this.getAbsoluteTransform()),e?(t.multiplyToRef(e.getWorldMatrix(),t),y.ScalingToRef(e.scaling.x,e.scaling.y,e.scaling.z,n)):y.IdentityToRef(n),t.invert(),isNaN(t.m[0])?!1:(n.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyToRef(n,t),!0)},i.prototype.getPosition=function(t,e){t===void 0&&(t=c.LOCAL),e===void 0&&(e=null);var n=L.Zero();return this.getPositionToRef(t,e,n),n},i.prototype.getPositionToRef=function(t,e,n){if(t===void 0&&(t=c.LOCAL),t==c.LOCAL){var r=this.getLocalMatrix();n.x=r.m[12],n.y=r.m[13],n.z=r.m[14]}else{var a=null;e&&(a=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=i._TmpMats[0];e&&a?(s.copyFrom(this.getAbsoluteTransform()),s.multiplyToRef(a,s)):s=this.getAbsoluteTransform(),n.x=s.m[12],n.y=s.m[13],n.z=s.m[14]}},i.prototype.getAbsolutePosition=function(t){t===void 0&&(t=null);var e=L.Zero();return this.getPositionToRef(c.WORLD,t,e),e},i.prototype.getAbsolutePositionToRef=function(t,e){this.getPositionToRef(c.WORLD,t,e)},i.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this.parent)this._localMatrix.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var t=this._skeleton.getPoseMatrix();t&&this._absoluteTransform.multiplyToRef(t,this._absoluteTransform)}for(var e=this.children,n=e.length,r=0;r<n;r++)e[r].computeAbsoluteTransforms()},i.prototype.getDirection=function(t,e){e===void 0&&(e=null);var n=L.Zero();return this.getDirectionToRef(t,e,n),n},i.prototype.getDirectionToRef=function(t,e,n){e===void 0&&(e=null);var r=null;e&&(r=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=i._TmpMats[0];a.copyFrom(this.getAbsoluteTransform()),e&&r&&a.multiplyToRef(r,a),L.TransformNormalToRef(t,a,n),n.normalize()},i.prototype.getRotation=function(t,e){t===void 0&&(t=c.LOCAL),e===void 0&&(e=null);var n=L.Zero();return this.getRotationToRef(t,e,n),n},i.prototype.getRotationToRef=function(t,e,n){t===void 0&&(t=c.LOCAL),e===void 0&&(e=null);var r=i._TmpQuat;this.getRotationQuaternionToRef(t,e,r),r.toEulerAnglesToRef(n)},i.prototype.getRotationQuaternion=function(t,e){t===void 0&&(t=c.LOCAL),e===void 0&&(e=null);var n=F.Identity();return this.getRotationQuaternionToRef(t,e,n),n},i.prototype.getRotationQuaternionToRef=function(t,e,n){if(t===void 0&&(t=c.LOCAL),e===void 0&&(e=null),t==c.LOCAL)this._decompose(),n.copyFrom(this._localRotation);else{var r=i._TmpMats[0],a=this.getAbsoluteTransform();e?a.multiplyToRef(e.getWorldMatrix(),r):r.copyFrom(a),r.multiplyAtIndex(0,this._scalingDeterminant),r.multiplyAtIndex(1,this._scalingDeterminant),r.multiplyAtIndex(2,this._scalingDeterminant),r.decompose(void 0,n,void 0)}},i.prototype.getRotationMatrix=function(t,e){t===void 0&&(t=c.LOCAL);var n=y.Identity();return this.getRotationMatrixToRef(t,e,n),n},i.prototype.getRotationMatrixToRef=function(t,e,n){if(t===void 0&&(t=c.LOCAL),t==c.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(n);else{var r=i._TmpMats[0],a=this.getAbsoluteTransform();e?a.multiplyToRef(e.getWorldMatrix(),r):r.copyFrom(a),r.multiplyAtIndex(0,this._scalingDeterminant),r.multiplyAtIndex(1,this._scalingDeterminant),r.multiplyAtIndex(2,this._scalingDeterminant),r.getRotationMatrixToRef(n)}},i.prototype.getAbsolutePositionFromLocal=function(t,e){e===void 0&&(e=null);var n=L.Zero();return this.getAbsolutePositionFromLocalToRef(t,e,n),n},i.prototype.getAbsolutePositionFromLocalToRef=function(t,e,n){e===void 0&&(e=null);var r=null;e&&(r=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=i._TmpMats[0];e&&r?(a.copyFrom(this.getAbsoluteTransform()),a.multiplyToRef(r,a)):a=this.getAbsoluteTransform(),L.TransformCoordinatesToRef(t,a,n)},i.prototype.getLocalPositionFromAbsolute=function(t,e){e===void 0&&(e=null);var n=L.Zero();return this.getLocalPositionFromAbsoluteToRef(t,e,n),n},i.prototype.getLocalPositionFromAbsoluteToRef=function(t,e,n){e===void 0&&(e=null);var r=null;e&&(r=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=i._TmpMats[0];a.copyFrom(this.getAbsoluteTransform()),e&&r&&a.multiplyToRef(r,a),a.invert(),L.TransformCoordinatesToRef(t,a,n)},i.prototype.setCurrentPoseAsRest=function(){this.setRestPose(this.getLocalMatrix())},i._TmpVecs=x.BuildArray(2,L.Zero),i._TmpQuat=F.Identity(),i._TmpMats=x.BuildArray(5,y.Identity),i}(ft),U=function(){function o(i,t,e,n,r,a,s,h,l,u){e===void 0&&(e=0),n===void 0&&(n=100),r===void 0&&(r=!1),a===void 0&&(a=1),u===void 0&&(u=!1),this.target=t,this.fromFrame=e,this.toFrame=n,this.loopAnimation=r,this.onAnimationEnd=s,this.onAnimationLoop=l,this.isAdditive=u,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new N,this.onAnimationLoopObservable=new N,this._scene=i,h&&this.appendAnimations(t,h),this._speedRatio=a,i._activeAnimatables.push(this)}return Object.defineProperty(o.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"masterFrame",{get:function(){return this._runtimeAnimations.length===0?0:this._runtimeAnimations[0].currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"weight",{get:function(){return this._weight},set:function(i){if(i===-1){this._weight=-1;return}this._weight=Math.min(Math.max(i,0),1)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(i){for(var t=0;t<this._runtimeAnimations.length;t++){var e=this._runtimeAnimations[t];e._prepareForSpeedRatioChange(i)}this._speedRatio=i},enumerable:!1,configurable:!0}),o.prototype.syncWith=function(i){if(this._syncRoot=i,i){var t=this._scene._activeAnimatables.indexOf(this);t>-1&&(this._scene._activeAnimatables.splice(t,1),this._scene._activeAnimatables.push(this))}return this},o.prototype.getAnimations=function(){return this._runtimeAnimations},o.prototype.appendAnimations=function(i,t){for(var e=this,n=0;n<t.length;n++){var r=t[n],a=new vt(i,r,this._scene,this);a._onLoop=function(){e.onAnimationLoopObservable.notifyObservers(e),e.onAnimationLoop&&e.onAnimationLoop()},this._runtimeAnimations.push(a)}},o.prototype.getAnimationByTargetProperty=function(i){for(var t=this._runtimeAnimations,e=0;e<t.length;e++)if(t[e].animation.targetProperty===i)return t[e].animation;return null},o.prototype.getRuntimeAnimationByTargetProperty=function(i){for(var t=this._runtimeAnimations,e=0;e<t.length;e++)if(t[e].animation.targetProperty===i)return t[e];return null},o.prototype.reset=function(){for(var i=this._runtimeAnimations,t=0;t<i.length;t++)i[t].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},o.prototype.enableBlending=function(i){for(var t=this._runtimeAnimations,e=0;e<t.length;e++)t[e].animation.enableBlending=!0,t[e].animation.blendingSpeed=i},o.prototype.disableBlending=function(){for(var i=this._runtimeAnimations,t=0;t<i.length;t++)i[t].animation.enableBlending=!1},o.prototype.goToFrame=function(i){var t,e=this._runtimeAnimations;if(e[0]){var n=e[0].animation.framePerSecond;this._frameToSyncFromJump=(t=this._frameToSyncFromJump)!==null&&t!==void 0?t:e[0].currentFrame;var r=this.speedRatio===0?0:(i-this._frameToSyncFromJump)/n*1e3/this.speedRatio;this._manualJumpDelay=-r}for(var a=0;a<e.length;a++)e[a].goToFrame(i)},o.prototype.pause=function(){this._paused||(this._paused=!0)},o.prototype.restart=function(){this._paused=!1},o.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},o.prototype.stop=function(i,t){if(i||t){var e=this._scene._activeAnimatables.indexOf(this);if(e>-1){for(var n=this._runtimeAnimations,r=n.length-1;r>=0;r--){var a=n[r];i&&a.animation.name!=i||t&&!t(a.target)||(a.dispose(),n.splice(r,1))}n.length==0&&(this._scene._activeAnimatables.splice(e,1),this._raiseOnAnimationEnd())}}else{var r=this._scene._activeAnimatables.indexOf(this);if(r>-1){this._scene._activeAnimatables.splice(r,1);for(var n=this._runtimeAnimations,s=0;s<n.length;s++)n[s].dispose();this._raiseOnAnimationEnd()}}},o.prototype.waitAsync=function(){var i=this;return new Promise(function(t){i.onAnimationEndObservable.add(function(){t(i)},void 0,void 0,i,!0)})},o.prototype._animate=function(i){if(this._paused)return this.animationStarted=!1,this._pausedDelay===null&&(this._pausedDelay=i),!0;if(this._localDelayOffset===null?(this._localDelayOffset=i,this._pausedDelay=null):this._pausedDelay!==null&&(this._localDelayOffset+=i-this._pausedDelay,this._pausedDelay=null),this._manualJumpDelay!==null&&(this._localDelayOffset+=this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._weight===0)return!0;var t=!1,e=this._runtimeAnimations,n;for(n=0;n<e.length;n++){var r=e[n],a=r.animate(i-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);t=t||a}if(this.animationStarted=t,!t){if(this.disposeOnEnd)for(n=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(n,1),n=0;n<e.length;n++)e[n].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return t},o}();I.prototype._animate=function(){if(!!this.animationsEnabled){var o=ht.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=o}this.deltaTime=this.useConstantAnimationDeltaTime?16:(o-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=o;var i=this._activeAnimatables;if(i.length!==0){this._animationTime+=this.deltaTime;for(var t=this._animationTime,e=0;e<i.length;e++){var n=i[e];!n._animate(t)&&n.disposeOnEnd&&e--}this._processLateAnimationBindings()}}};I.prototype.beginWeightedAnimation=function(o,i,t,e,n,r,a,s,h,l,u){e===void 0&&(e=1),r===void 0&&(r=1),u===void 0&&(u=!1);var f=this.beginAnimation(o,i,t,n,r,a,s,!1,h,l,u);return f.weight=e,f};I.prototype.beginAnimation=function(o,i,t,e,n,r,a,s,h,l,u){n===void 0&&(n=1),s===void 0&&(s=!0),u===void 0&&(u=!1),i>t&&n>0&&(n*=-1),s&&this.stopAnimation(o,void 0,h),a||(a=new U(this,o,i,t,e,n,r,void 0,l,u));var f=h?h(o):!0;if(o.animations&&f&&a.appendAnimations(o,o.animations),o.getAnimatables)for(var m=o.getAnimatables(),p=0;p<m.length;p++)this.beginAnimation(m[p],i,t,e,n,r,a,s,h,l);return a.reset(),a};I.prototype.beginHierarchyAnimation=function(o,i,t,e,n,r,a,s,h,l,u,f){r===void 0&&(r=1),h===void 0&&(h=!0),f===void 0&&(f=!1);var m=o.getDescendants(i),p=[];p.push(this.beginAnimation(o,t,e,n,r,a,s,h,l,void 0,f));for(var _=0,P=m;_<P.length;_++){var g=P[_];p.push(this.beginAnimation(g,t,e,n,r,a,s,h,l,void 0,f))}return p};I.prototype.beginDirectAnimation=function(o,i,t,e,n,r,a,s,h){if(h===void 0&&(h=!1),r===void 0&&(r=1),t>e&&r>0)r*=-1;else if(e>t&&r<0){var l=e;e=t,t=l}var u=new U(this,o,t,e,n,r,a,i,s,h);return u};I.prototype.beginDirectHierarchyAnimation=function(o,i,t,e,n,r,a,s,h,l){l===void 0&&(l=!1);var u=o.getDescendants(i),f=[];f.push(this.beginDirectAnimation(o,t,e,n,r,a,s,h,l));for(var m=0,p=u;m<p.length;m++){var _=p[m];f.push(this.beginDirectAnimation(_,t,e,n,r,a,s,h,l))}return f};I.prototype.getAnimatableByTarget=function(o){for(var i=0;i<this._activeAnimatables.length;i++)if(this._activeAnimatables[i].target===o)return this._activeAnimatables[i];return null};I.prototype.getAllAnimatablesByTarget=function(o){for(var i=[],t=0;t<this._activeAnimatables.length;t++)this._activeAnimatables[t].target===o&&i.push(this._activeAnimatables[t]);return i};I.prototype.stopAnimation=function(o,i,t){for(var e=this.getAllAnimatablesByTarget(o),n=0,r=e;n<r.length;n++){var a=r[n];a.stop(i,t)}};I.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var o=0;o<this._activeAnimatables.length;o++)this._activeAnimatables[o].stop();this._activeAnimatables.length=0}for(var i=0,t=this.animationGroups;i<t.length;i++){var e=t[i];e.stop()}};I.prototype._registerTargetForLateAnimationBinding=function(o,i){var t=o.target;this._registeredForLateAnimationBindings.pushNoDuplicate(t),t._lateAnimationHolders||(t._lateAnimationHolders={}),t._lateAnimationHolders[o.targetPath]||(t._lateAnimationHolders[o.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:i}),o.isAdditive?(t._lateAnimationHolders[o.targetPath].additiveAnimations.push(o),t._lateAnimationHolders[o.targetPath].totalAdditiveWeight+=o.weight):(t._lateAnimationHolders[o.targetPath].animations.push(o),t._lateAnimationHolders[o.targetPath].totalWeight+=o.weight)};I.prototype._processLateAnimationBindingsForMatrices=function(o){if(o.totalWeight===0&&o.totalAdditiveWeight===0)return o.originalValue;var i=1,t=D.Vector3[0],e=D.Vector3[1],n=D.Quaternion[0],r=0,a=o.animations[0],s=o.originalValue,h=1,l=!1;if(o.totalWeight<1)h=1-o.totalWeight,s.decompose(e,n,t);else{if(r=1,i=o.totalWeight,h=a.weight/i,h==1)if(o.totalAdditiveWeight)l=!0;else return a.currentValue;a.currentValue.decompose(e,n,t)}if(!l){e.scaleInPlace(h),t.scaleInPlace(h),n.scaleInPlace(h);for(var u=r;u<o.animations.length;u++){var f=o.animations[u];if(f.weight!==0){h=f.weight/i;var m=D.Vector3[2],p=D.Vector3[3],_=D.Quaternion[1];f.currentValue.decompose(p,_,m),p.scaleAndAddToRef(h,e),_.scaleAndAddToRef(h,n),m.scaleAndAddToRef(h,t)}}}for(var u=0;u<o.additiveAnimations.length;u++){var f=o.additiveAnimations[u];if(f.weight!==0){var m=D.Vector3[2],p=D.Vector3[3],_=D.Quaternion[1];f.currentValue.decompose(p,_,m),p.multiplyToRef(e,p),L.LerpToRef(e,p,f.weight,e),n.multiplyToRef(_,_),F.SlerpToRef(n,_,f.weight,n),m.scaleAndAddToRef(f.weight,t)}}var P=a?a._animationState.workValue:D.Matrix[0].clone();return y.ComposeToRef(e,n,t,P),P};I.prototype._processLateAnimationBindingsForQuaternions=function(o,i){if(o.totalWeight===0&&o.totalAdditiveWeight===0)return i;var t=o.animations[0],e=o.originalValue,n=i;if(o.totalWeight===0&&o.totalAdditiveWeight>0)n.copyFrom(e);else if(o.animations.length===1){if(F.SlerpToRef(e,t.currentValue,Math.min(1,o.totalWeight),n),o.totalAdditiveWeight===0)return n}else if(o.animations.length>1){var r=1,a=void 0,s=void 0;if(o.totalWeight<1){var h=1-o.totalWeight;a=[],s=[],a.push(e),s.push(h)}else{if(o.animations.length===2&&(F.SlerpToRef(o.animations[0].currentValue,o.animations[1].currentValue,o.animations[1].weight/o.totalWeight,i),o.totalAdditiveWeight===0))return i;a=[],s=[],r=o.totalWeight}for(var l=0;l<o.animations.length;l++){var u=o.animations[l];a.push(u.currentValue),s.push(u.weight/r)}for(var f=0,m=0;m<a.length;){if(!m){F.SlerpToRef(a[m],a[m+1],s[m+1]/(s[m]+s[m+1]),i),n=i,f=s[m]+s[m+1],m+=2;continue}f+=s[m],F.SlerpToRef(n,a[m],s[m]/f,n),m++}}for(var l=0;l<o.additiveAnimations.length;l++){var u=o.additiveAnimations[l];u.weight!==0&&(n.multiplyToRef(u.currentValue,D.Quaternion[0]),F.SlerpToRef(n,D.Quaternion[0],u.weight,n))}return n};I.prototype._processLateAnimationBindings=function(){if(!!this._registeredForLateAnimationBindings.length){for(var o=0;o<this._registeredForLateAnimationBindings.length;o++){var i=this._registeredForLateAnimationBindings.data[o];for(var t in i._lateAnimationHolders){var e=i._lateAnimationHolders[t],n=e.animations[0],r=e.originalValue,a=T.AllowMatrixDecomposeForInterpolation&&r.m,s=i[t];if(a)s=this._processLateAnimationBindingsForMatrices(e);else{var h=r.w!==void 0;if(h)s=this._processLateAnimationBindingsForQuaternions(e,s||F.Identity());else{var l=0,u=1;if(e.totalWeight<1)n&&r.scale?s=r.scale(1-e.totalWeight):n?s=r*(1-e.totalWeight):r.clone?s=r.clone():s=r;else if(n){u=e.totalWeight;var f=n.weight/u;f!==1?n.currentValue.scale?s=n.currentValue.scale(f):s=n.currentValue*f:s=n.currentValue,l=1}for(var m=l;m<e.animations.length;m++){var p=e.animations[m],f=p.weight/u;if(f)p.currentValue.scaleAndAddToRef?p.currentValue.scaleAndAddToRef(f,s):s+=p.currentValue*f;else continue}for(var m=0;m<e.additiveAnimations.length;m++){var p=e.additiveAnimations[m],f=p.weight;if(f)p.currentValue.scaleAndAddToRef?p.currentValue.scaleAndAddToRef(f,s):s+=p.currentValue*f;else continue}}}i[t]=s}i._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}};gt.prototype.copyAnimationRange=function(o,i,t,e,n){e===void 0&&(e=!1),n===void 0&&(n=null),this.animations.length===0&&(this.animations.push(new T(this.name,"_matrix",o.animations[0].framePerSecond,T.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var r=o.animations[0].getRange(i);if(!r)return!1;for(var a=r.from,s=r.to,h=o.animations[0].getKeys(),l=o.length,u=o.getParent(),f=this.getParent(),m=e&&u&&l&&this.length&&l!==this.length,p=m&&f&&u?f.length/u.length:1,_=e&&!f&&n&&(n.x!==1||n.y!==1||n.z!==1),P=this.animations[0].getKeys(),g,A,d,C=0,v=h.length;C<v;C++)g=h[C],g.frame>=a&&g.frame<=s&&(e?(d=g.value.clone(),m?(A=d.getTranslation(),d.setTranslation(A.scaleInPlace(p))):_&&n?(A=d.getTranslation(),d.setTranslation(A.multiplyInPlace(n))):d=g.value):d=g.value,P.push({frame:g.frame+t,value:d}));return this.animations[0].createRange(i,a+t,s+t),!0};function Z(o){var i=6,t=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],e=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],n=[],r=[],a=o.width||o.size||1,s=o.height||o.size||1,h=o.depth||o.size||1,l=o.wrap||!1,u=o.topBaseAt===void 0?1:o.topBaseAt,f=o.bottomBaseAt===void 0?0:o.bottomBaseAt;u=(u+4)%4,f=(f+4)%4;var m=[2,0,3,1],p=[2,0,1,3],_=m[u],P=p[f],g=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(l){t=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],g=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var A=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],d=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],C=[17,18,19,16],v=[22,23,20,21];_>0;)A.unshift(A.pop()),C.unshift(C.pop()),_--;for(;P>0;)d.unshift(d.pop()),v.unshift(v.pop()),P--;A=A.flat(),d=d.flat(),g=g.concat(A).concat(d),t.push(C[0],C[2],C[3],C[0],C[1],C[2]),t.push(v[0],v[2],v[3],v[0],v[1],v[2])}var M=[a/2,s/2,h/2];r=g.reduce(function(J,G,X){return J.concat(G*M[X%3])},[]);for(var E=o.sideOrientation===0?0:o.sideOrientation||B.DEFAULTSIDE,b=o.faceUV||new Array(6),V=o.faceColors,W=[],S=0;S<6;S++)b[S]===void 0&&(b[S]=new et(0,0,1,1)),V&&V[S]===void 0&&(V[S]=new it(1,1,1,1));for(var O=0;O<i;O++)if(n.push(b[O].z,Q.UseOpenGLOrientationForUV?1-b[O].w:b[O].w),n.push(b[O].x,Q.UseOpenGLOrientationForUV?1-b[O].w:b[O].w),n.push(b[O].x,Q.UseOpenGLOrientationForUV?1-b[O].y:b[O].y),n.push(b[O].z,Q.UseOpenGLOrientationForUV?1-b[O].y:b[O].y),V)for(var Y=0;Y<4;Y++)W.push(V[O].r,V[O].g,V[O].b,V[O].a);B._ComputeSides(E,r,t,e,n,o.frontUVs,o.backUVs);var w=new B;if(w.indices=t,w.positions=r,w.normals=e,w.uvs=n,V){var K=E===B.DOUBLESIDE?W.concat(W):W;w.colors=K}return w}function H(o,i,t){i===void 0&&(i={}),t===void 0&&(t=null);var e=new j(o,t);i.sideOrientation=j._GetDefaultSideOrientation(i.sideOrientation),e._originalBuilderSideOrientation=i.sideOrientation;var n=Z(i);return n.applyToMesh(e,i.updatable),e}B.CreateBox=Z;j.CreateBox=function(o,i,t,e,n){t===void 0&&(t=null);var r={size:i,sideOrientation:n,updatable:e};return H(o,r,t)};const yt={CreateBox:H},R={Color3:z,Vector3:L,StandardMaterial:nt,MeshBuilder:yt,Animation:T,CubicEase:rt,PhysicsImpostor:ot,Texture:at};class Gt{constructor(i,t="CustomObj",e){k(this,"scene");k(this,"mesh");k(this,"material");k(this,"isLockedPosition",!1);k(this,"options");this.options=e,this.scene=i,this.mesh=R.MeshBuilder.CreateBox(t,{size:2},this.scene),this.mesh.isPickable=!0,this.useMaterial(),this.initAnimation(),this.mesh.scaling=R.Vector3.Zero()}initAnimation(){let i=new R.Animation("showOn","scaling",60,R.Animation.ANIMATIONTYPE_VECTOR3,R.Animation.ANIMATIONLOOPMODE_CONSTANT);i.setKeys([{frame:0,value:R.Vector3.Zero()},{frame:10,value:new R.Vector3(1,1,1)}]),this.mesh.animations.push(i)}show(){return new Promise(i=>{this.scene.beginAnimation(this.mesh,0,10,!1,1,i)})}useMaterial(){var i,t,e,n;this.mesh.material||(t=(i=this.options)==null?void 0:i.materialOpt)!=null&&t.textureUrl&&(this.material=new R.StandardMaterial("textMaterial",this.scene),this.material.diffuseTexture=new R.Texture((n=(e=this.options)==null?void 0:e.materialOpt)==null?void 0:n.textureUrl),this.material.emissiveColor=new R.Color3(1,1,1),this.material.specularColor=new R.Color3(.05,.05,.05),this.mesh.material=this.material)}usePhysicsImpostor(){this.mesh.physicsImpostor&&!this.mesh.physicsImpostor.isDisposed||(this.mesh.physicsImpostor=new R.PhysicsImpostor(this.mesh,R.PhysicsImpostor.BoxImpostor,{mass:1,restitution:0,friction:1},this.scene))}lockObj(i){var t;if(this.isLockedPosition=!!i,this.isLockedPosition){(t=this.mesh.physicsImpostor)==null||t.dispose();const e=10,n=1.5,r=new R.Animation("lockPosition","position",e,R.Animation.ANIMATIONTYPE_VECTOR3);r.setKeys([{frame:0,value:this.mesh.position},{frame:e*n,value:new R.Vector3(...(i==null?void 0:i.position)||[])}]),this.mesh.animations.push(r);const a=new R.Animation("lockRotation","rotation",e,R.Animation.ANIMATIONTYPE_VECTOR3);a.setKeys([{frame:0,value:this.mesh.rotation},{frame:e*n,value:new R.Vector3(...(i==null?void 0:i.rotation)||[])}]),this.mesh.animations.push(a),this.scene.beginAnimation(this.mesh,0,e*n,!1,4)}else this.usePhysicsImpostor()}}export{Gt as default};
