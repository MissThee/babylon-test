var E=Object.defineProperty;var N=(e,a,i)=>a in e?E(e,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[a]=i;var O=(e,a,i)=>(N(e,typeof a!="symbol"?a+"":a,i),i);import{Color3 as R}from"./math.color.d29cb8ed.js";import{S as W}from"./standardMaterial.114db29c.js";import{P as K}from"./physicsImpostor.c9d13e49.js";import{TmpVectors as w,Vector3 as b,Vector2 as k,Vector4 as B}from"./math.vector.560c6bc4.js";import{M as X}from"./mesh.51493cf6.js";import{V as L}from"./abstractMesh.d4d5c19c.js";import{_ as J}from"./precisionDate.1704d4c6.js";import{V as $}from"./math.plane.7ea68d04.js";import{T as j}from"./decorators.5af14a95.js";import{E as q}from"./performanceConfigurator.ee04355d.js";import{E as ii}from"./arrayTools.49279cc5.js";import{C as G}from"./thinMaterialHelper.ab1f33f5.js";import"./scene.7f90ce88.js";import"./lightConstants.176abcb0.js";import"./perfCounter.4442bbd7.js";import"./material.ddd1f5e1.js";import"./boundingInfo.26e5828d.js";import"./math.functions.3c8565ae.js";import"./materialHelper.8edca65e.js";import"./node.3cceef8b.js";import"./clipPlaneVertex.1e772c5b.js";import"./math.size.64d00435.js";import"./engine.535c373a.js";import"./engine.dynamicBuffer.fe9de623.js";import"./effectFallbacks.3405025b.js";import"./imageProcessingFunctions.3c9d02ee.js";import"./instancesDeclaration.03c72576.js";import"./physicsJoint.0bac1769.js";import"./math.axis.43721c0c.js";X._GroundMeshParser=function(e,a){return z.Parse(e,a)};var z=function(e){J(a,e);function a(i,t){var r=e.call(this,i,t)||this;return r.generateOctree=!1,r}return a.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(a.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!1,configurable:!0}),a.prototype.optimize=function(i,t){t===void 0&&(t=32),this._subdivisionsX=i,this._subdivisionsY=i,this.subdivide(i);var r=this;r.createOrUpdateSubmeshesOctree&&r.createOrUpdateSubmeshesOctree(t)},a.prototype.getHeightAtCoordinates=function(i,t){var r=this.getWorldMatrix(),h=w.Matrix[5];r.invertToRef(h);var s=w.Vector3[8];if(b.TransformCoordinatesFromFloatsToRef(i,0,t,h,s),i=s.x,t=s.z,i<this._minX||i>this._maxX||t<this._minZ||t>this._maxZ)return this.position.y;(!this._heightQuads||this._heightQuads.length==0)&&(this._initHeightQuads(),this._computeHeightQuads());var o=this._getFacetAt(i,t),l=-(o.x*i+o.z*t+o.w)/o.y;return b.TransformCoordinatesFromFloatsToRef(0,l,0,r,s),s.y},a.prototype.getNormalAtCoordinates=function(i,t){var r=new b(0,1,0);return this.getNormalAtCoordinatesToRef(i,t,r),r},a.prototype.getNormalAtCoordinatesToRef=function(i,t,r){var h=this.getWorldMatrix(),s=w.Matrix[5];h.invertToRef(s);var o=w.Vector3[8];if(b.TransformCoordinatesFromFloatsToRef(i,0,t,s,o),i=o.x,t=o.z,i<this._minX||i>this._maxX||t<this._minZ||t>this._maxZ)return this;(!this._heightQuads||this._heightQuads.length==0)&&(this._initHeightQuads(),this._computeHeightQuads());var l=this._getFacetAt(i,t);return b.TransformNormalFromFloatsToRef(l.x,l.y,l.z,h,r),this},a.prototype.updateCoordinateHeights=function(){return(!this._heightQuads||this._heightQuads.length==0)&&this._initHeightQuads(),this._computeHeightQuads(),this},a.prototype._getFacetAt=function(i,t){var r=Math.floor((i+this._maxX)*this._subdivisionsX/this._width),h=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),s=this._heightQuads[h*this._subdivisionsX+r],o;return t<s.slope.x*i+s.slope.y?o=s.facet1:o=s.facet2,o},a.prototype._initHeightQuads=function(){var i=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(var r=0;r<t;r++)for(var h=0;h<i;h++){var s={slope:k.Zero(),facet1:new B(0,0,0,0),facet2:new B(0,0,0,0)};this._heightQuads[r*i+h]=s}return this},a.prototype._computeHeightQuads=function(){var i=this.getVerticesData($.PositionKind);if(!i)return this;for(var t=w.Vector3[3],r=w.Vector3[2],h=w.Vector3[1],s=w.Vector3[0],o=w.Vector3[4],l=w.Vector3[5],v=w.Vector3[6],m=w.Vector3[7],u=w.Vector3[8],d=0,n=0,g=0,c=0,y=0,p=0,V=0,x=this._subdivisionsX,M=this._subdivisionsY,C=0;C<M;C++)for(var _=0;_<x;_++){d=_*3,n=C*(x+1)*3,g=(C+1)*(x+1)*3,t.x=i[n+d],t.y=i[n+d+1],t.z=i[n+d+2],r.x=i[n+d+3],r.y=i[n+d+4],r.z=i[n+d+5],h.x=i[g+d],h.y=i[g+d+1],h.z=i[g+d+2],s.x=i[g+d+3],s.y=i[g+d+4],s.z=i[g+d+5],c=(s.z-t.z)/(s.x-t.x),y=t.z-c*t.x,r.subtractToRef(t,o),h.subtractToRef(t,l),s.subtractToRef(t,v),b.CrossToRef(v,l,m),b.CrossToRef(o,v,u),m.normalize(),u.normalize(),p=-(m.x*t.x+m.y*t.y+m.z*t.z),V=-(u.x*r.x+u.y*r.y+u.z*r.z);var H=this._heightQuads[C*x+_];H.slope.copyFromFloats(c,y),H.facet1.copyFromFloats(m.x,m.y,m.z,p),H.facet2.copyFromFloats(u.x,u.y,u.z,V)}return this},a.prototype.serialize=function(i){e.prototype.serialize.call(this,i),i.subdivisionsX=this._subdivisionsX,i.subdivisionsY=this._subdivisionsY,i.minX=this._minX,i.maxX=this._maxX,i.minZ=this._minZ,i.maxZ=this._maxZ,i.width=this._width,i.height=this._height},a.Parse=function(i,t){var r=new a(i.name,t);return r._subdivisionsX=i.subdivisionsX||1,r._subdivisionsY=i.subdivisionsY||1,r._minX=i.minX,r._maxX=i.maxX,r._minZ=i.minZ,r._maxZ=i.maxZ,r._width=i.width,r._height=i.height,r},a}(X);function Z(e){var a=[],i=[],t=[],r=[],h,s,o=e.width||1,l=e.height||1,v=e.subdivisionsX||e.subdivisions||1,m=e.subdivisionsY||e.subdivisions||1;for(h=0;h<=m;h++)for(s=0;s<=v;s++){var u=new b(s*o/v-o/2,0,(m-h)*l/m-l/2),d=new b(0,1,0);i.push(u.x,u.y,u.z),t.push(d.x,d.y,d.z),r.push(s/v,G.UseOpenGLOrientationForUV?h/m:1-h/m)}for(h=0;h<m;h++)for(s=0;s<v;s++)a.push(s+1+(h+1)*(v+1)),a.push(s+1+h*(v+1)),a.push(s+h*(v+1)),a.push(s+(h+1)*(v+1)),a.push(s+1+(h+1)*(v+1)),a.push(s+h*(v+1));var n=new L;return n.indices=a,n.positions=i,n.normals=t,n.uvs=r,n}function Y(e){var a=e.xmin!==void 0&&e.xmin!==null?e.xmin:-1,i=e.zmin!==void 0&&e.zmin!==null?e.zmin:-1,t=e.xmax!==void 0&&e.xmax!==null?e.xmax:1,r=e.zmax!==void 0&&e.zmax!==null?e.zmax:1,h=e.subdivisions||{w:1,h:1},s=e.precision||{w:1,h:1},o=new Array,l=new Array,v=new Array,m=new Array,u,d,n,g;h.h=h.h<1?1:h.h,h.w=h.w<1?1:h.w,s.w=s.w<1?1:s.w,s.h=s.h<1?1:s.h;var c={w:(t-a)/h.w,h:(r-i)/h.h};function y(V,x,M,C){var _=l.length/3,H=s.w+1;for(u=0;u<s.h;u++)for(d=0;d<s.w;d++){var P=[_+d+u*H,_+(d+1)+u*H,_+(d+1)+(u+1)*H,_+d+(u+1)*H];o.push(P[1]),o.push(P[2]),o.push(P[3]),o.push(P[0]),o.push(P[1]),o.push(P[3])}var F=b.Zero(),T=new b(0,1,0);for(u=0;u<=s.h;u++)for(F.z=u*(C-x)/s.h+x,d=0;d<=s.w;d++)F.x=d*(M-V)/s.w+V,F.y=0,l.push(F.x,F.y,F.z),v.push(T.x,T.y,T.z),m.push(d/s.w,u/s.h)}for(n=0;n<h.h;n++)for(g=0;g<h.w;g++)y(a+g*c.w,i+n*c.h,a+(g+1)*c.w,i+(n+1)*c.h);var p=new L;return p.indices=o,p.positions=l,p.normals=v,p.uvs=m,p}function D(e){var a=[],i=[],t=[],r=[],h,s,o=e.colorFilter||new R(.3,.59,.11),l=e.alphaFilter||0,v=!1;if(e.minHeight>e.maxHeight){v=!0;var m=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=m}for(h=0;h<=e.subdivisions;h++)for(s=0;s<=e.subdivisions;s++){var u=new b(s*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-h)*e.height/e.subdivisions-e.height/2),d=(u.x+e.width/2)/e.width*(e.bufferWidth-1)|0,n=(1-(u.z+e.height/2)/e.height)*(e.bufferHeight-1)|0,g=(d+n*e.bufferWidth)*4,c=e.buffer[g]/255,y=e.buffer[g+1]/255,p=e.buffer[g+2]/255,V=e.buffer[g+3]/255;v&&(c=1-c,y=1-y,p=1-p);var x=c*o.r+y*o.g+p*o.b;V>=l?u.y=e.minHeight+(e.maxHeight-e.minHeight)*x:u.y=e.minHeight-ii,i.push(u.x,u.y,u.z),t.push(0,0,0),r.push(s/e.subdivisions,1-h/e.subdivisions)}for(h=0;h<e.subdivisions;h++)for(s=0;s<e.subdivisions;s++){var M=s+1+(h+1)*(e.subdivisions+1),C=s+1+h*(e.subdivisions+1),_=s+h*(e.subdivisions+1),H=s+(h+1)*(e.subdivisions+1),P=i[M*3+1]>=e.minHeight,F=i[C*3+1]>=e.minHeight,T=i[_*3+1]>=e.minHeight;P&&F&&T&&(a.push(M),a.push(C),a.push(_));var U=i[H*3+1]>=e.minHeight;U&&P&&T&&(a.push(H),a.push(M),a.push(_))}L.ComputeNormals(i,a,t);var I=new L;return I.indices=a,I.positions=i,I.normals=t,I.uvs=r,I}function Q(e,a,i){a===void 0&&(a={});var t=new z(e,i);t._setReady(!1),t._subdivisionsX=a.subdivisionsX||a.subdivisions||1,t._subdivisionsY=a.subdivisionsY||a.subdivisions||1,t._width=a.width||1,t._height=a.height||1,t._maxX=t._width/2,t._maxZ=t._height/2,t._minX=-t._maxX,t._minZ=-t._maxZ;var r=Z(a);return r.applyToMesh(t,a.updatable),t._setReady(!0),t}function ti(e,a,i){i===void 0&&(i=null);var t=new X(e,i),r=Y(a);return r.applyToMesh(t,a.updatable),t}function ei(e,a,i,t){i===void 0&&(i={}),t===void 0&&(t=null);var r=i.width||10,h=i.height||10,s=i.subdivisions||1,o=i.minHeight||0,l=i.maxHeight||1,v=i.colorFilter||new R(.3,.59,.11),m=i.alphaFilter||0,u=i.updatable,d=i.onReady;t=t||q.LastCreatedScene;var n=new z(e,t);n._subdivisionsX=s,n._subdivisionsY=s,n._width=r,n._height=h,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ,n._setReady(!1);var g=function(c){var y=c.width,p=c.height;if(!t.isDisposed){var V=t==null?void 0:t.getEngine().resizeImageBitmap(c,y,p),x=D({width:r,height:h,subdivisions:s,minHeight:o,maxHeight:l,colorFilter:v,buffer:V,bufferWidth:y,bufferHeight:p,alphaFilter:m});x.applyToMesh(n,u),d&&d(n),n._setReady(!0)}};return j.LoadImage(a,g,function(){},t.offlineProvider),n}L.CreateGround=Z;L.CreateTiledGround=Y;L.CreateGroundFromHeightMap=D;X.CreateGround=function(e,a,i,t,r,h){var s={width:a,height:i,subdivisions:t,updatable:h};return Q(e,s,r)};X.CreateTiledGround=function(e,a,i,t,r,h,s,o,l){var v={xmin:a,zmin:i,xmax:t,zmax:r,subdivisions:h,precision:s,updatable:l};return ti(e,v,o)};X.CreateGroundFromHeightMap=function(e,a,i,t,r,h,s,o,l,v,m){var u={width:i,height:t,subdivisions:r,minHeight:h,maxHeight:s,updatable:l,onReady:v,alphaFilter:m};return ei(e,a,u,o)};function A(e){var a=[],i=[],t=[],r=[],h=e.width||e.size||1,s=e.height||e.size||1,o=e.sideOrientation===0?0:e.sideOrientation||L.DEFAULTSIDE,l=h/2,v=s/2;i.push(-l,-v,0),t.push(0,0,-1),r.push(0,G.UseOpenGLOrientationForUV?1:0),i.push(l,-v,0),t.push(0,0,-1),r.push(1,G.UseOpenGLOrientationForUV?1:0),i.push(l,v,0),t.push(0,0,-1),r.push(1,G.UseOpenGLOrientationForUV?0:1),i.push(-l,v,0),t.push(0,0,-1),r.push(0,G.UseOpenGLOrientationForUV?0:1),a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),L._ComputeSides(o,i,a,t,r,e.frontUVs,e.backUVs);var m=new L;return m.indices=a,m.positions=i,m.normals=t,m.uvs=r,m}function S(e,a,i){a===void 0&&(a={}),i===void 0&&(i=null);var t=new X(e,i);a.sideOrientation=X._GetDefaultSideOrientation(a.sideOrientation),t._originalBuilderSideOrientation=a.sideOrientation;var r=A(a);return r.applyToMesh(t,a.updatable),a.sourcePlane&&(t.translate(a.sourcePlane.normal,-a.sourcePlane.d),t.setDirection(a.sourcePlane.normal.scale(-1))),t}L.CreatePlane=A;X.CreatePlane=function(e,a,i,t,r){var h={size:a,width:a,height:a,sideOrientation:r,updatable:t};return S(e,h,i)};const ri={CreateGround:Q,CreatePlane:S},f={Color3:R,StandardMaterial:W,MeshBuilder:ri,PhysicsImpostor:K};class Gi{constructor(a,i){O(this,"scene");O(this,"sideVerticalLength",40);O(this,"sideHorizontalLength",40);O(this,"deepLength",10);this.scene=a,this.sideVerticalLength=(i==null?void 0:i.v)||this.sideVerticalLength,this.sideHorizontalLength=(i==null?void 0:i.h)||this.sideHorizontalLength,this.deepLength=(i==null?void 0:i.d)||this.deepLength;{const r=new f.StandardMaterial("SceneBoardMaterial");r.emissiveColor=new f.Color3(.87,.71,.73);let h=f.MeshBuilder.CreateGround("ground",{width:this.deepLength,height:this.sideVerticalLength});h.physicsImpostor=new f.PhysicsImpostor(h,f.PhysicsImpostor.BoxImpostor,{mass:0,restitution:1,friction:1}),h.material=r,h.receiveShadows=!0}const t=new f.StandardMaterial("SceneBoardMaterial");t.emissiveColor=new f.Color3(247/255,207/255,212/255);{let r=f.MeshBuilder.CreatePlane("wallRight",{width:this.deepLength,height:this.sideHorizontalLength,sideOrientation:0});r.position.y=this.sideHorizontalLength/2,r.position.z=this.sideVerticalLength/2,r.physicsImpostor=new f.PhysicsImpostor(r,f.PhysicsImpostor.BoxImpostor,{mass:0,restitution:1,friction:1}),r.material=t}{let r=f.MeshBuilder.CreatePlane("wallLeft",{width:this.deepLength,height:this.sideHorizontalLength,sideOrientation:1});r.position.y=this.sideHorizontalLength/2,r.position.z=-this.sideVerticalLength/2,r.physicsImpostor=new f.PhysicsImpostor(r,f.PhysicsImpostor.BoxImpostor,{mass:0,restitution:1,friction:1}),r.material=t}{let r=f.MeshBuilder.CreatePlane("wallBack",{width:this.sideVerticalLength,height:this.sideHorizontalLength,sideOrientation:1});r.position.y=this.sideHorizontalLength/2,r.position.x=-this.deepLength/2,r.rotation.y=Math.PI/2,r.physicsImpostor=new f.PhysicsImpostor(r,f.PhysicsImpostor.BoxImpostor,{mass:0,restitution:1,friction:1}),r.material=t}{let r=f.MeshBuilder.CreatePlane("wallLimit",{width:this.sideVerticalLength,height:this.sideHorizontalLength,sideOrientation:0});r.position.y=this.sideHorizontalLength/2,r.rotation.y=Math.PI/2,r.physicsImpostor=new f.PhysicsImpostor(r,f.PhysicsImpostor.BoxImpostor,{mass:0,restitution:1,friction:1}),r.isVisible=!1,r.position.x=this.deepLength/2}{let r=f.MeshBuilder.CreatePlane("wallLimitTop",{width:this.deepLength,height:this.sideVerticalLength,sideOrientation:1});r.position.y=this.sideHorizontalLength,r.rotation.x=Math.PI/2,r.physicsImpostor=new f.PhysicsImpostor(r,f.PhysicsImpostor.BoxImpostor,{mass:0,restitution:1,friction:1}),r.material=t}}}export{Gi as default};
