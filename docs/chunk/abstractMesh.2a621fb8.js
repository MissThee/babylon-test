import{L as Pt,h as at,a as B,j as V,_ as lt,O as q}from"./precisionDate.911053b8.js";import{TmpVectors as c,Vector3 as g,Vector4 as $,Matrix as C,Quaternion as E}from"./math.vector.dbc48609.js";import{Engine as At}from"./engine.030dae1e.js";import{V as o}from"./math.plane.3df9f77f.js";import{Color4 as ft,Color3 as st}from"./math.color.a4c793a9.js";import{f as Rt,E as Tt,n as G,S as tt,g as et,h as St,s as H}from"./decorators.033fe02c.js";import{N as Ct}from"./node.c2e9b9af.js";import{S as U,A as Bt}from"./math.axis.99d5e86d.js";import{P as Ft}from"./scene.600fc970.js";import{B as it}from"./boundingInfo.536615f6.js";import{U as Et}from"./lightConstants.3b1d6040.js";import{e as Ot}from"./math.functions.8d0abdec.js";import{E as Q,R as Vt}from"./arrayTools.49f8ffa1.js";function rt(f,e,t){try{var r=f.next();r.done?e(r):r.value?r.value.then(function(){r.value=void 0,e(r)},t):e(r)}catch(i){t(i)}}function te(f){f===void 0&&(f=25);var e;return function(t,r,i){var n=performance.now();e===void 0||n-e>f?(e=n,setTimeout(function(){rt(t,r,i)},0)):rt(t,r,i)}}function ut(f,e,t,r,i){var n=function(){var a,s=function(l){l.done?t(l.value):a===void 0?a=!0:n()};do a=void 0,!i||!i.aborted?e(f,s,r):r(new Error("Aborted")),a===void 0&&(a=!1);while(a)};n()}function ht(f,e){var t;return ut(f,rt,function(r){return t=r},function(r){throw r},e),t}function ee(f,e,t){return new Promise(function(r,i){ut(f,e,r,i,t)})}function Lt(f,e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return ht(f.apply(void 0,t),e)}}var ot=function(){function f(){this._applyTo=Lt(this._applyToCoroutine.bind(this))}return f.prototype.set=function(e,t){switch(e.length||Pt.Warn("Setting vertex data kind '".concat(t,"' with an empty array")),t){case o.PositionKind:this.positions=e;break;case o.NormalKind:this.normals=e;break;case o.TangentKind:this.tangents=e;break;case o.UVKind:this.uvs=e;break;case o.UV2Kind:this.uvs2=e;break;case o.UV3Kind:this.uvs3=e;break;case o.UV4Kind:this.uvs4=e;break;case o.UV5Kind:this.uvs5=e;break;case o.UV6Kind:this.uvs6=e;break;case o.ColorKind:this.colors=e;break;case o.MatricesIndicesKind:this.matricesIndices=e;break;case o.MatricesWeightsKind:this.matricesWeights=e;break;case o.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case o.MatricesWeightsExtraKind:this.matricesWeightsExtra=e;break}},f.prototype.applyToMesh=function(e,t){return this._applyTo(e,t,!1),this},f.prototype.applyToGeometry=function(e,t){return this._applyTo(e,t,!1),this},f.prototype.updateMesh=function(e){return this._update(e),this},f.prototype.updateGeometry=function(e){return this._update(e),this},f.prototype._applyToCoroutine=function(e,t,r){return t===void 0&&(t=!1),at(this,function(i){switch(i.label){case 0:return this.positions?(e.setVerticesData(o.PositionKind,this.positions,t),r?[4]:[3,2]):[3,2];case 1:i.sent(),i.label=2;case 2:return this.normals?(e.setVerticesData(o.NormalKind,this.normals,t),r?[4]:[3,4]):[3,4];case 3:i.sent(),i.label=4;case 4:return this.tangents?(e.setVerticesData(o.TangentKind,this.tangents,t),r?[4]:[3,6]):[3,6];case 5:i.sent(),i.label=6;case 6:return this.uvs?(e.setVerticesData(o.UVKind,this.uvs,t),r?[4]:[3,8]):[3,8];case 7:i.sent(),i.label=8;case 8:return this.uvs2?(e.setVerticesData(o.UV2Kind,this.uvs2,t),r?[4]:[3,10]):[3,10];case 9:i.sent(),i.label=10;case 10:return this.uvs3?(e.setVerticesData(o.UV3Kind,this.uvs3,t),r?[4]:[3,12]):[3,12];case 11:i.sent(),i.label=12;case 12:return this.uvs4?(e.setVerticesData(o.UV4Kind,this.uvs4,t),r?[4]:[3,14]):[3,14];case 13:i.sent(),i.label=14;case 14:return this.uvs5?(e.setVerticesData(o.UV5Kind,this.uvs5,t),r?[4]:[3,16]):[3,16];case 15:i.sent(),i.label=16;case 16:return this.uvs6?(e.setVerticesData(o.UV6Kind,this.uvs6,t),r?[4]:[3,18]):[3,18];case 17:i.sent(),i.label=18;case 18:return this.colors?(e.setVerticesData(o.ColorKind,this.colors,t),r?[4]:[3,20]):[3,20];case 19:i.sent(),i.label=20;case 20:return this.matricesIndices?(e.setVerticesData(o.MatricesIndicesKind,this.matricesIndices,t),r?[4]:[3,22]):[3,22];case 21:i.sent(),i.label=22;case 22:return this.matricesWeights?(e.setVerticesData(o.MatricesWeightsKind,this.matricesWeights,t),r?[4]:[3,24]):[3,24];case 23:i.sent(),i.label=24;case 24:return this.matricesIndicesExtra?(e.setVerticesData(o.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),r?[4]:[3,26]):[3,26];case 25:i.sent(),i.label=26;case 26:return this.matricesWeightsExtra?(e.setVerticesData(o.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),r?[4]:[3,28]):[3,28];case 27:i.sent(),i.label=28;case 28:return this.indices?(e.setIndices(this.indices,null,t),r?[4]:[3,30]):[3,31];case 29:i.sent(),i.label=30;case 30:return[3,32];case 31:e.setIndices([],null),i.label=32;case 32:return[2,this]}})},f.prototype._update=function(e,t,r){return this.positions&&e.updateVerticesData(o.PositionKind,this.positions,t,r),this.normals&&e.updateVerticesData(o.NormalKind,this.normals,t,r),this.tangents&&e.updateVerticesData(o.TangentKind,this.tangents,t,r),this.uvs&&e.updateVerticesData(o.UVKind,this.uvs,t,r),this.uvs2&&e.updateVerticesData(o.UV2Kind,this.uvs2,t,r),this.uvs3&&e.updateVerticesData(o.UV3Kind,this.uvs3,t,r),this.uvs4&&e.updateVerticesData(o.UV4Kind,this.uvs4,t,r),this.uvs5&&e.updateVerticesData(o.UV5Kind,this.uvs5,t,r),this.uvs6&&e.updateVerticesData(o.UV6Kind,this.uvs6,t,r),this.colors&&e.updateVerticesData(o.ColorKind,this.colors,t,r),this.matricesIndices&&e.updateVerticesData(o.MatricesIndicesKind,this.matricesIndices,t,r),this.matricesWeights&&e.updateVerticesData(o.MatricesWeightsKind,this.matricesWeights,t,r),this.matricesIndicesExtra&&e.updateVerticesData(o.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,r),this.matricesWeightsExtra&&e.updateVerticesData(o.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,r),this.indices&&e.setIndices(this.indices,null),this},f._TransformVector3Coordinates=function(e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=e.length);for(var n=c.Vector3[0],a=c.Vector3[1],s=r;s<r+i;s+=3)g.FromArrayToRef(e,s,n),g.TransformCoordinatesToRef(n,t,a),e[s]=a.x,e[s+1]=a.y,e[s+2]=a.z},f._TransformVector3Normals=function(e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=e.length);for(var n=c.Vector3[0],a=c.Vector3[1],s=r;s<r+i;s+=3)g.FromArrayToRef(e,s,n),g.TransformNormalToRef(n,t,a),e[s]=a.x,e[s+1]=a.y,e[s+2]=a.z},f._TransformVector4Normals=function(e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=e.length);for(var n=c.Vector4[0],a=c.Vector4[1],s=r;s<r+i;s+=4)$.FromArrayToRef(e,s,n),$.TransformNormalToRef(n,t,a),e[s]=a.x,e[s+1]=a.y,e[s+2]=a.z,e[s+3]=a.w},f._FlipFaces=function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=e.length);for(var i=t;i<t+r;i+=3){var n=e[i+1];e[i+1]=e[i+2],e[i+2]=n}},f.prototype.transform=function(e){var t=e.determinant()<0;return this.positions&&f._TransformVector3Coordinates(this.positions,e),this.normals&&f._TransformVector3Normals(this.normals,e),this.tangents&&f._TransformVector4Normals(this.tangents,e),t&&this.indices&&f._FlipFaces(this.indices),this},f.prototype.merge=function(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var i=Array.isArray(e)?e.map(function(n){return[n,void 0]}):[[e,void 0]];return ht(this._mergeCoroutine(void 0,i,t,!1,r))},f.prototype._mergeCoroutine=function(e,t,r,i,n){var a,s,l,D,h,u,d,v,p,m,b,M,I,D,T,y,S=this,P,x,R,O;return r===void 0&&(r=!1),at(this,function(A){switch(A.label){case 0:for(this._validate(),a=t.map(function(_){return _[0]}),s=0,l=a;s<l.length;s++)if(D=l[s],D._validate(),!this.normals!=!D.normals||!this.tangents!=!D.tangents||!this.uvs!=!D.uvs||!this.uvs2!=!D.uvs2||!this.uvs3!=!D.uvs3||!this.uvs4!=!D.uvs4||!this.uvs5!=!D.uvs5||!this.uvs6!=!D.uvs6||!this.colors!=!D.colors||!this.matricesIndices!=!D.matricesIndices||!this.matricesWeights!=!D.matricesWeights||!this.matricesIndicesExtra!=!D.matricesIndicesExtra||!this.matricesWeightsExtra!=!D.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(h=a.reduce(function(_,j){var N,F;return _+((F=(N=j.indices)===null||N===void 0?void 0:N.length)!==null&&F!==void 0?F:0)},(x=(P=this.indices)===null||P===void 0?void 0:P.length)!==null&&x!==void 0?x:0),u=n||a.some(function(_){return _.indices===S.indices}),d=u?(R=this.indices)===null||R===void 0?void 0:R.slice():this.indices,!(h>0))return[3,4];v=(O=d==null?void 0:d.length)!==null&&O!==void 0?O:0,d||(d=new Array(h)),d.length!==h&&(Array.isArray(d)?d.length=h:(p=r||d instanceof Uint32Array?new Uint32Array(h):new Uint16Array(h),p.set(d),d=p),e&&e.determinant()<0&&f._FlipFaces(d,0,v)),m=this.positions?this.positions.length/3:0,b=0,M=t,A.label=1;case 1:if(!(b<M.length))return[3,4];if(I=M[b],D=I[0],T=I[1],!D.indices)return[3,3];for(y=0;y<D.indices.length;y++)d[v+y]=D.indices[y]+m;return T&&T.determinant()<0&&f._FlipFaces(d,v,D.indices.length),m+=D.positions.length/3,v+=D.indices.length,i?[4]:[3,3];case 2:A.sent(),A.label=3;case 3:return b++,[3,1];case 4:return this.indices=d,this.positions=f._MergeElement(o.PositionKind,this.positions,e,t.map(function(_){return[_[0].positions,_[1]]})),i?[4]:[3,6];case 5:A.sent(),A.label=6;case 6:return this.normals=f._MergeElement(o.NormalKind,this.normals,e,t.map(function(_){return[_[0].normals,_[1]]})),i?[4]:[3,8];case 7:A.sent(),A.label=8;case 8:return this.tangents=f._MergeElement(o.TangentKind,this.tangents,e,t.map(function(_){return[_[0].tangents,_[1]]})),i?[4]:[3,10];case 9:A.sent(),A.label=10;case 10:return this.uvs=f._MergeElement(o.UVKind,this.uvs,e,t.map(function(_){return[_[0].uvs,_[1]]})),i?[4]:[3,12];case 11:A.sent(),A.label=12;case 12:return this.uvs2=f._MergeElement(o.UV2Kind,this.uvs2,e,t.map(function(_){return[_[0].uvs2,_[1]]})),i?[4]:[3,14];case 13:A.sent(),A.label=14;case 14:return this.uvs3=f._MergeElement(o.UV3Kind,this.uvs3,e,t.map(function(_){return[_[0].uvs3,_[1]]})),i?[4]:[3,16];case 15:A.sent(),A.label=16;case 16:return this.uvs4=f._MergeElement(o.UV4Kind,this.uvs4,e,t.map(function(_){return[_[0].uvs4,_[1]]})),i?[4]:[3,18];case 17:A.sent(),A.label=18;case 18:return this.uvs5=f._MergeElement(o.UV5Kind,this.uvs5,e,t.map(function(_){return[_[0].uvs5,_[1]]})),i?[4]:[3,20];case 19:A.sent(),A.label=20;case 20:return this.uvs6=f._MergeElement(o.UV6Kind,this.uvs6,e,t.map(function(_){return[_[0].uvs6,_[1]]})),i?[4]:[3,22];case 21:A.sent(),A.label=22;case 22:return this.colors=f._MergeElement(o.ColorKind,this.colors,e,t.map(function(_){return[_[0].colors,_[1]]})),i?[4]:[3,24];case 23:A.sent(),A.label=24;case 24:return this.matricesIndices=f._MergeElement(o.MatricesIndicesKind,this.matricesIndices,e,t.map(function(_){return[_[0].matricesIndices,_[1]]})),i?[4]:[3,26];case 25:A.sent(),A.label=26;case 26:return this.matricesWeights=f._MergeElement(o.MatricesWeightsKind,this.matricesWeights,e,t.map(function(_){return[_[0].matricesWeights,_[1]]})),i?[4]:[3,28];case 27:A.sent(),A.label=28;case 28:return this.matricesIndicesExtra=f._MergeElement(o.MatricesIndicesExtraKind,this.matricesIndicesExtra,e,t.map(function(_){return[_[0].matricesIndicesExtra,_[1]]})),i?[4]:[3,30];case 29:A.sent(),A.label=30;case 30:return this.matricesWeightsExtra=f._MergeElement(o.MatricesWeightsExtraKind,this.matricesWeightsExtra,e,t.map(function(_){return[_[0].matricesWeightsExtra,_[1]]})),[2,this]}})},f._MergeElement=function(e,t,r,i){var n=i.filter(function(S){return S[0]!==null&&S[0]!==void 0});if(!t&&n.length==0)return t;if(!t)return this._MergeElement(e,n[0][0],n[0][1],n.slice(1));var a=n.reduce(function(S,P){return S+P[0].length},t.length),s=e===o.PositionKind?f._TransformVector3Coordinates:e===o.NormalKind?f._TransformVector3Normals:e===o.TangentKind?f._TransformVector4Normals:function(){};if(t instanceof Float32Array){var l=new Float32Array(a);l.set(t),r&&s(l,r,0,t.length);for(var h=t.length,u=0,d=n;u<d.length;u++){var v=d[u],p=v[0],m=v[1];l.set(p,h),m&&s(l,m,h,p.length),h+=p.length}return l}else{for(var b=new Array(a),M=0;M<t.length;M++)b[M]=t[M];r&&s(b,r,0,t.length);for(var h=t.length,I=0,D=n;I<D.length;I++){for(var T=D[I],p=T[0],y=T[1],M=0;M<p.length;M++)b[h+M]=p[M];y&&s(b,y,h,p.length),h+=p.length}return b}},f.prototype._validate=function(){if(!this.positions)throw new Rt("Positions are required",Tt.MeshInvalidPositionsError);var e=function(i,n){var a=o.DeduceStride(i);if(n.length%a!==0)throw new Error("The "+i+"s array count must be a multiple of "+a);return n.length/a},t=e(o.PositionKind,this.positions),r=function(i,n){var a=e(i,n);if(a!==t)throw new Error("The "+i+"s element count ("+a+") does not match the positions count ("+t+")")};this.normals&&r(o.NormalKind,this.normals),this.tangents&&r(o.TangentKind,this.tangents),this.uvs&&r(o.UVKind,this.uvs),this.uvs2&&r(o.UV2Kind,this.uvs2),this.uvs3&&r(o.UV3Kind,this.uvs3),this.uvs4&&r(o.UV4Kind,this.uvs4),this.uvs5&&r(o.UV5Kind,this.uvs5),this.uvs6&&r(o.UV6Kind,this.uvs6),this.colors&&r(o.ColorKind,this.colors),this.matricesIndices&&r(o.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&r(o.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&r(o.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&r(o.MatricesWeightsExtraKind,this.matricesWeightsExtra)},f.prototype.serialize=function(){var e={};return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},f.ExtractFromMesh=function(e,t,r){return f._ExtractFrom(e,t,r)},f.ExtractFromGeometry=function(e,t,r){return f._ExtractFrom(e,t,r)},f._ExtractFrom=function(e,t,r){var i=new f;return e.isVerticesDataPresent(o.PositionKind)&&(i.positions=e.getVerticesData(o.PositionKind,t,r)),e.isVerticesDataPresent(o.NormalKind)&&(i.normals=e.getVerticesData(o.NormalKind,t,r)),e.isVerticesDataPresent(o.TangentKind)&&(i.tangents=e.getVerticesData(o.TangentKind,t,r)),e.isVerticesDataPresent(o.UVKind)&&(i.uvs=e.getVerticesData(o.UVKind,t,r)),e.isVerticesDataPresent(o.UV2Kind)&&(i.uvs2=e.getVerticesData(o.UV2Kind,t,r)),e.isVerticesDataPresent(o.UV3Kind)&&(i.uvs3=e.getVerticesData(o.UV3Kind,t,r)),e.isVerticesDataPresent(o.UV4Kind)&&(i.uvs4=e.getVerticesData(o.UV4Kind,t,r)),e.isVerticesDataPresent(o.UV5Kind)&&(i.uvs5=e.getVerticesData(o.UV5Kind,t,r)),e.isVerticesDataPresent(o.UV6Kind)&&(i.uvs6=e.getVerticesData(o.UV6Kind,t,r)),e.isVerticesDataPresent(o.ColorKind)&&(i.colors=e.getVerticesData(o.ColorKind,t,r)),e.isVerticesDataPresent(o.MatricesIndicesKind)&&(i.matricesIndices=e.getVerticesData(o.MatricesIndicesKind,t,r)),e.isVerticesDataPresent(o.MatricesWeightsKind)&&(i.matricesWeights=e.getVerticesData(o.MatricesWeightsKind,t,r)),e.isVerticesDataPresent(o.MatricesIndicesExtraKind)&&(i.matricesIndicesExtra=e.getVerticesData(o.MatricesIndicesExtraKind,t,r)),e.isVerticesDataPresent(o.MatricesWeightsExtraKind)&&(i.matricesWeightsExtra=e.getVerticesData(o.MatricesWeightsExtraKind,t,r)),i.indices=e.getIndices(t,r),i},f.CreateRibbon=function(e){throw B("ribbonBuilder")},f.CreateBox=function(e){throw B("boxBuilder")},f.CreateTiledBox=function(e){throw B("tiledBoxBuilder")},f.CreateTiledPlane=function(e){throw B("tiledPlaneBuilder")},f.CreateSphere=function(e){throw B("sphereBuilder")},f.CreateCylinder=function(e){throw B("cylinderBuilder")},f.CreateTorus=function(e){throw B("torusBuilder")},f.CreateLineSystem=function(e){throw B("linesBuilder")},f.CreateDashedLines=function(e){throw B("linesBuilder")},f.CreateGround=function(e){throw B("groundBuilder")},f.CreateTiledGround=function(e){throw B("groundBuilder")},f.CreateGroundFromHeightMap=function(e){throw B("groundBuilder")},f.CreatePlane=function(e){throw B("planeBuilder")},f.CreateDisc=function(e){throw B("discBuilder")},f.CreatePolygon=function(e,t,r,i,n,a,s){throw B("polygonBuilder")},f.CreateIcoSphere=function(e){throw B("icoSphereBuilder")},f.CreatePolyhedron=function(e){throw B("polyhedronBuilder")},f.CreateCapsule=function(e){throw e===void 0&&(e={orientation:g.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),B("capsuleBuilder")},f.CreateTorusKnot=function(e){throw B("torusKnotBuilder")},f.ComputeNormals=function(e,t,r,i){var n=0,a=0,s=0,l=0,h=0,u=0,d=0,v=0,p=0,m=0,b=0,M=0,I=0,D=0,T=0,y=0,S=0,P=0,x=0,R=0,O=!1,A=!1,_=!1,j=!1,N=1,F=0,J=null;i&&(O=!!i.facetNormals,A=!!i.facetPositions,_=!!i.facetPartitioning,N=i.useRightHandedSystem===!0?-1:1,F=i.ratio||0,j=!!i.depthSort,J=i.distanceTo,j&&J===void 0&&(J=g.Zero()));var Y=0,k=0,Z=0,X=0;for(_&&i&&i.bbSize&&(Y=i.subDiv.X*F/i.bbSize.x,k=i.subDiv.Y*F/i.bbSize.y,Z=i.subDiv.Z*F/i.bbSize.z,X=i.subDiv.max*i.subDiv.max,i.facetPartitioning.length=0),n=0;n<e.length;n++)r[n]=0;var ct=t.length/3|0;for(n=0;n<ct;n++){if(M=t[n*3]*3,I=M+1,D=M+2,T=t[n*3+1]*3,y=T+1,S=T+2,P=t[n*3+2]*3,x=P+1,R=P+2,a=e[M]-e[T],s=e[I]-e[y],l=e[D]-e[S],h=e[P]-e[T],u=e[x]-e[y],d=e[R]-e[S],v=N*(s*d-l*u),p=N*(l*h-a*d),m=N*(a*u-s*h),b=Math.sqrt(v*v+p*p+m*m),b=b===0?1:b,v/=b,p/=b,m/=b,O&&i&&(i.facetNormals[n].x=v,i.facetNormals[n].y=p,i.facetNormals[n].z=m),A&&i&&(i.facetPositions[n].x=(e[M]+e[T]+e[P])/3,i.facetPositions[n].y=(e[I]+e[y]+e[x])/3,i.facetPositions[n].z=(e[D]+e[S]+e[R])/3),_&&i){var dt=Math.floor((i.facetPositions[n].x-i.bInfo.minimum.x*F)*Y),pt=Math.floor((i.facetPositions[n].y-i.bInfo.minimum.y*F)*k),gt=Math.floor((i.facetPositions[n].z-i.bInfo.minimum.z*F)*Z),vt=Math.floor((e[M]-i.bInfo.minimum.x*F)*Y),bt=Math.floor((e[I]-i.bInfo.minimum.y*F)*k),_t=Math.floor((e[D]-i.bInfo.minimum.z*F)*Z),mt=Math.floor((e[T]-i.bInfo.minimum.x*F)*Y),Mt=Math.floor((e[y]-i.bInfo.minimum.y*F)*k),Dt=Math.floor((e[S]-i.bInfo.minimum.z*F)*Z),yt=Math.floor((e[P]-i.bInfo.minimum.x*F)*Y),It=Math.floor((e[x]-i.bInfo.minimum.y*F)*k),xt=Math.floor((e[R]-i.bInfo.minimum.z*F)*Z),w=vt+i.subDiv.max*bt+X*_t,K=mt+i.subDiv.max*Mt+X*Dt,z=yt+i.subDiv.max*It+X*xt,W=dt+i.subDiv.max*pt+X*gt;i.facetPartitioning[W]=i.facetPartitioning[W]?i.facetPartitioning[W]:new Array,i.facetPartitioning[w]=i.facetPartitioning[w]?i.facetPartitioning[w]:new Array,i.facetPartitioning[K]=i.facetPartitioning[K]?i.facetPartitioning[K]:new Array,i.facetPartitioning[z]=i.facetPartitioning[z]?i.facetPartitioning[z]:new Array,i.facetPartitioning[w].push(n),K!=w&&i.facetPartitioning[K].push(n),z==K||z==w||i.facetPartitioning[z].push(n),W==w||W==K||W==z||i.facetPartitioning[W].push(n)}if(j&&i&&i.facetPositions){var nt=i.depthSortedFacets[n];nt.ind=n*3,nt.sqDistance=g.DistanceSquared(i.facetPositions[n],J)}r[M]+=v,r[I]+=p,r[D]+=m,r[T]+=v,r[y]+=p,r[S]+=m,r[P]+=v,r[x]+=p,r[R]+=m}for(n=0;n<r.length/3;n++)v=r[n*3],p=r[n*3+1],m=r[n*3+2],b=Math.sqrt(v*v+p*p+m*m),b=b===0?1:b,v/=b,p/=b,m/=b,r[n*3]=v,r[n*3+1]=p,r[n*3+2]=m},f._ComputeSides=function(e,t,r,i,n,a,s){var l=r.length,h=i.length,u,d;switch(e=e||f.DEFAULTSIDE,e){case f.FRONTSIDE:break;case f.BACKSIDE:for(u=0;u<l;u+=3){var v=r[u];r[u]=r[u+2],r[u+2]=v}for(d=0;d<h;d++)i[d]=-i[d];break;case f.DOUBLESIDE:{for(var p=t.length,m=p/3,b=0;b<p;b++)t[p+b]=t[b];for(u=0;u<l;u+=3)r[u+l]=r[u+2]+m,r[u+1+l]=r[u+1]+m,r[u+2+l]=r[u]+m;for(d=0;d<h;d++)i[h+d]=-i[d];var M=n.length,I=0;for(I=0;I<M;I++)n[I+M]=n[I];for(a=a||new $(0,0,1,1),s=s||new $(0,0,1,1),I=0,u=0;u<M/2;u++)n[I]=a.x+(a.z-a.x)*n[I],n[I+1]=a.y+(a.w-a.y)*n[I+1],n[I+M]=s.x+(s.z-s.x)*n[I+M],n[I+M+1]=s.y+(s.w-s.y)*n[I+M+1],I+=2;break}}},f.ImportVertexData=function(e,t){var r=new f,i=e.positions;i&&r.set(i,o.PositionKind);var n=e.normals;n&&r.set(n,o.NormalKind);var a=e.tangents;a&&r.set(a,o.TangentKind);var s=e.uvs;s&&r.set(s,o.UVKind);var l=e.uv2s;l&&r.set(l,o.UV2Kind);var h=e.uv3s;h&&r.set(h,o.UV3Kind);var u=e.uv4s;u&&r.set(u,o.UV4Kind);var d=e.uv5s;d&&r.set(d,o.UV5Kind);var v=e.uv6s;v&&r.set(v,o.UV6Kind);var p=e.colors;p&&r.set(ft.CheckColors4(p,i.length/3),o.ColorKind);var m=e.matricesIndices;m&&r.set(m,o.MatricesIndicesKind);var b=e.matricesWeights;b&&r.set(b,o.MatricesWeightsKind);var M=e.indices;M&&(r.indices=M),t.setAllVerticesData(r,e.updatable)},f.FRONTSIDE=0,f.BACKSIDE=1,f.DOUBLESIDE=2,f.DEFAULTSIDE=0,V([G.filter(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0];return!Array.isArray(r)})],f,"_TransformVector3Coordinates",null),V([G.filter(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0];return!Array.isArray(r)})],f,"_TransformVector3Normals",null),V([G.filter(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0];return!Array.isArray(r)})],f,"_TransformVector4Normals",null),V([G.filter(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0];return!Array.isArray(r)})],f,"_FlipFaces",null),f}(),L=function(f){lt(e,f);function e(t,r,i){r===void 0&&(r=null),i===void 0&&(i=!0);var n=f.call(this,t,r)||this;return n._forward=new g(0,0,1),n._up=new g(0,1,0),n._right=new g(1,0,0),n._position=g.Zero(),n._rotation=g.Zero(),n._rotationQuaternion=null,n._scaling=g.One(),n._transformToBoneReferal=null,n._isAbsoluteSynced=!1,n._billboardMode=e.BILLBOARDMODE_NONE,n._preserveParentRotationForBillboard=!1,n.scalingDeterminant=1,n._infiniteDistance=!1,n.ignoreNonUniformScaling=!1,n.reIntegrateRotationIntoRotationQuaternion=!1,n._poseMatrix=null,n._localMatrix=C.Zero(),n._usePivotMatrix=!1,n._absolutePosition=g.Zero(),n._absoluteScaling=g.Zero(),n._absoluteRotationQuaternion=E.Identity(),n._pivotMatrix=C.Identity(),n._postMultiplyPivotMatrix=!1,n._isWorldMatrixFrozen=!1,n._indexInSceneTransformNodesArray=-1,n.onAfterWorldMatrixUpdateObservable=new q,n._nonUniformScaling=!1,i&&n.getScene().addTransformNode(n),n}return Object.defineProperty(e.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(t){this._billboardMode!==t&&(this._billboardMode=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(t){t!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(t){this._infiniteDistance!==t&&(this._infiniteDistance=t)},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._isDirty=!0},enumerable:!1,configurable:!0}),e.prototype.isUsingPivotMatrix=function(){return this._usePivotMatrix},Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaling",{get:function(){return this._scaling},set:function(t){this._scaling=t,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(t){this._rotationQuaternion=t,t&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"forward",{get:function(){return g.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return g.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return g.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()},enumerable:!1,configurable:!0}),e.prototype.updatePoseMatrix=function(t){return this._poseMatrix?(this._poseMatrix.copyFrom(t),this):(this._poseMatrix=t.clone(),this)},e.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=C.Identity()),this._poseMatrix},e.prototype._isSynchronized=function(){var t=this._cache;return!(this._billboardMode!==t.billboardMode||this._billboardMode!==e.BILLBOARDMODE_NONE||t.pivotMatrixUpdated||this._infiniteDistance||this._position._isDirty||this._scaling._isDirty||this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)},e.prototype._initCache=function(){f.prototype._initCache.call(this);var t=this._cache;t.localMatrixUpdated=!1,t.billboardMode=-1,t.infiniteDistance=!1},Object.defineProperty(e.prototype,"absolutePosition",{get:function(){return this.getAbsolutePosition()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!1,configurable:!0}),e.prototype.setPreTransformMatrix=function(t){return this.setPivotMatrix(t,!1)},e.prototype.setPivotMatrix=function(t,r){return r===void 0&&(r=!0),this._pivotMatrix.copyFrom(t),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=r,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=C.Invert(this._pivotMatrix)),this},e.prototype.getPivotMatrix=function(){return this._pivotMatrix},e.prototype.instantiateHierarchy=function(t,r,i){t===void 0&&(t=null);var n=this.clone("Clone of "+(this.name||this.id),t||this.parent,!0);n&&i&&i(this,n);for(var a=0,s=this.getChildTransformNodes(!0);a<s.length;a++){var l=s[a];l.instantiateHierarchy(n,r,i)}return n},e.prototype.freezeWorldMatrix=function(t,r){return t===void 0&&(t=null),r===void 0&&(r=!1),t?r?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||E.Identity(),t.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=t,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},e.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(e.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0}),e.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},e.prototype.setAbsolutePosition=function(t){if(!t)return this;var r,i,n;if(t.x===void 0){if(arguments.length<3)return this;r=arguments[0],i=arguments[1],n=arguments[2]}else r=t.x,i=t.y,n=t.z;if(this.parent){var a=c.Matrix[0];this.parent.getWorldMatrix().invertToRef(a),g.TransformCoordinatesFromFloatsToRef(r,i,n,a,this.position)}else this.position.x=r,this.position.y=i,this.position.z=n;return this._absolutePosition.copyFrom(t),this},e.prototype.setPositionWithLocalVector=function(t){return this.computeWorldMatrix(),this.position=g.TransformNormal(t,this._localMatrix),this},e.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=c.Matrix[0];return this._localMatrix.invertToRef(t),g.TransformNormal(this.position,t)},e.prototype.locallyTranslate=function(t){return this.computeWorldMatrix(!0),this.position=g.TransformCoordinates(t,this._localMatrix),this},e.prototype.lookAt=function(t,r,i,n,a){r===void 0&&(r=0),i===void 0&&(i=0),n===void 0&&(n=0),a===void 0&&(a=U.LOCAL);var s=e._LookAtVectorCache,l=a===U.LOCAL?this.position:this.getAbsolutePosition();if(t.subtractToRef(l,s),this.setDirection(s,r,i,n),a===U.WORLD&&this.parent)if(this.rotationQuaternion){var h=c.Matrix[0];this.rotationQuaternion.toRotationMatrix(h);var u=c.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(u),u.invert(),h.multiplyToRef(u,h),this.rotationQuaternion.fromRotationMatrix(h)}else{var d=c.Quaternion[0];E.FromEulerVectorToRef(this.rotation,d);var h=c.Matrix[0];d.toRotationMatrix(h);var u=c.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(u),u.invert(),h.multiplyToRef(u,h),d.fromRotationMatrix(h),d.toEulerAnglesToRef(this.rotation)}return this},e.prototype.getDirection=function(t){var r=g.Zero();return this.getDirectionToRef(t,r),r},e.prototype.getDirectionToRef=function(t,r){return g.TransformNormalToRef(t,this.getWorldMatrix(),r),this},e.prototype.setDirection=function(t,r,i,n){r===void 0&&(r=0),i===void 0&&(i=0),n===void 0&&(n=0);var a=-Math.atan2(t.z,t.x)+Math.PI/2,s=Math.sqrt(t.x*t.x+t.z*t.z),l=-Math.atan2(t.y,s);return this.rotationQuaternion?E.RotationYawPitchRollToRef(a+r,l+i,n,this.rotationQuaternion):(this.rotation.x=l+i,this.rotation.y=a+r,this.rotation.z=n),this},e.prototype.setPivotPoint=function(t,r){r===void 0&&(r=U.LOCAL),this.getScene().getRenderId()==0&&this.computeWorldMatrix(!0);var i=this.getWorldMatrix();if(r==U.WORLD){var n=c.Matrix[0];i.invertToRef(n),t=g.TransformCoordinates(t,n)}return this.setPivotMatrix(C.Translation(-t.x,-t.y,-t.z),!0)},e.prototype.getPivotPoint=function(){var t=g.Zero();return this.getPivotPointToRef(t),t},e.prototype.getPivotPointToRef=function(t){return t.x=-this._pivotMatrix.m[12],t.y=-this._pivotMatrix.m[13],t.z=-this._pivotMatrix.m[14],this},e.prototype.getAbsolutePivotPoint=function(){var t=g.Zero();return this.getAbsolutePivotPointToRef(t),t},e.prototype.getAbsolutePivotPointToRef=function(t){return this.getPivotPointToRef(t),g.TransformCoordinatesToRef(t,this.getWorldMatrix(),t),this},e.prototype.markAsDirty=function(t){if(this._children)for(var r=0,i=this._children;r<i.length;r++){var n=i[r];n.markAsDirty(t)}return f.prototype.markAsDirty.call(this,t)},e.prototype.setParent=function(t,r){if(r===void 0&&(r=!1),!t&&!this.parent)return this;var i=c.Quaternion[0],n=c.Vector3[0],a=c.Vector3[1],s=c.Matrix[1];C.IdentityToRef(s);var l=c.Matrix[0];this.computeWorldMatrix(!0);var h=this.rotationQuaternion;return h||(h=e._TmpRotation,E.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,h)),C.ComposeToRef(this.scaling,h,this.position,l),this.parent&&l.multiplyToRef(this.parent.computeWorldMatrix(!0),l),t&&(t.computeWorldMatrix(!0).invertToRef(s),l.multiplyToRef(s,l)),l.decompose(a,i,n,r?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(i):i.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(a),this.position.copyFrom(n),this.parent=t,this},Object.defineProperty(e.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0}),e.prototype._updateNonUniformScalingState=function(t){return this._nonUniformScaling===t?!1:(this._nonUniformScaling=t,!0)},e.prototype.attachToBone=function(t,r){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=r,this.parent=t,t.getSkeleton().prepare(),t.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},e.prototype.detachFromBone=function(t){return t===void 0&&(t=!1),this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,t?this.parent=this._currentParentWhenAttachingToBone:this.parent=null,this):(t&&(this.parent=this._currentParentWhenAttachingToBone),this)},e.prototype.rotate=function(t,r,i){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0));var n;if(!i||i===U.LOCAL)n=E.RotationAxisToRef(t,r,e._RotationAxisCache),this.rotationQuaternion.multiplyToRef(n,this.rotationQuaternion);else{if(this.parent){var a=c.Matrix[0];this.parent.getWorldMatrix().invertToRef(a),t=g.TransformNormal(t,a)}n=E.RotationAxisToRef(t,r,e._RotationAxisCache),n.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}return this},e.prototype.rotateAround=function(t,r,i){r.normalize(),this.rotationQuaternion||(this.rotationQuaternion=E.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var n=c.Vector3[0],a=c.Vector3[1],s=c.Vector3[2],l=c.Quaternion[0],h=c.Matrix[0],u=c.Matrix[1],d=c.Matrix[2],v=c.Matrix[3];return t.subtractToRef(this.position,n),C.TranslationToRef(n.x,n.y,n.z,h),C.TranslationToRef(-n.x,-n.y,-n.z,u),C.RotationAxisToRef(r,i,d),u.multiplyToRef(d,v),v.multiplyToRef(h,v),v.decompose(a,l,s),this.position.addInPlace(s),l.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},e.prototype.translate=function(t,r,i){var n=t.scale(r);if(!i||i===U.LOCAL){var a=this.getPositionExpressedInLocalSpace().add(n);this.setPositionWithLocalVector(a)}else this.setAbsolutePosition(this.getAbsolutePosition().add(n));return this},e.prototype.addRotation=function(t,r,i){var n;this.rotationQuaternion?n=this.rotationQuaternion:(n=c.Quaternion[1],E.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,n));var a=c.Quaternion[0];return E.RotationYawPitchRollToRef(r,t,i,a),n.multiplyInPlace(a),this.rotationQuaternion||n.toEulerAnglesToRef(this.rotation),this},e.prototype._getEffectiveParent=function(){return this.parent},e.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var r=this.getScene().getRenderId();if(!this._isDirty&&!t&&(this._currentRenderId===r||this.isSynchronized()))return this._currentRenderId=r,this._worldMatrix;var i=this.getScene().activeCamera,n=(this._billboardMode&e.BILLBOARDMODE_USE_POSITION)!==0,a=this._billboardMode!==e.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;this._updateCache();var s=this._cache;s.pivotMatrixUpdated=!1,s.billboardMode=this.billboardMode,s.infiniteDistance=this.infiniteDistance,s.parent=this._parentNode,this._currentRenderId=r,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var l=this._getEffectiveParent(),h=e._TmpScaling,u=this._position;if(this._infiniteDistance&&!this.parent&&i){var d=i.getWorldMatrix(),v=new g(d.m[12],d.m[13],d.m[14]);u=e._TmpTranslation,u.copyFromFloats(this._position.x+v.x,this._position.y+v.y,this._position.z+v.z)}h.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var p;if(this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,p=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){var m=this.rotation.lengthSquared();m&&(this._rotationQuaternion.multiplyInPlace(E.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))}}else p=e._TmpRotation,E.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,p);if(this._usePivotMatrix){var b=c.Matrix[1];C.ScalingToRef(h.x,h.y,h.z,b);var M=c.Matrix[0];p.toRotationMatrix(M),this._pivotMatrix.multiplyToRef(b,c.Matrix[4]),c.Matrix[4].multiplyToRef(M,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(u.x,u.y,u.z)}else C.ComposeToRef(h,p,u,this._localMatrix);if(l&&l.getWorldMatrix){if(t&&l.computeWorldMatrix(t),a){this._transformToBoneReferal?l.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),c.Matrix[7]):c.Matrix[7].copyFrom(l.getWorldMatrix());var I=c.Vector3[5],D=c.Vector3[6];c.Matrix[7].decompose(D,void 0,I),C.ScalingToRef(D.x,D.y,D.z,c.Matrix[7]),c.Matrix[7].setTranslation(I),this._localMatrix.multiplyToRef(c.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(l.getWorldMatrix(),c.Matrix[6]),c.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(l.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(a&&i&&this.billboardMode&&!n){var T=c.Vector3[0];if(this._worldMatrix.getTranslationToRef(T),c.Matrix[1].copyFrom(i.getViewMatrix()),c.Matrix[1].setTranslationFromFloats(0,0,0),c.Matrix[1].invertToRef(c.Matrix[0]),(this.billboardMode&e.BILLBOARDMODE_ALL)!==e.BILLBOARDMODE_ALL){c.Matrix[0].decompose(void 0,c.Quaternion[0],void 0);var y=c.Vector3[1];c.Quaternion[0].toEulerAnglesToRef(y),(this.billboardMode&e.BILLBOARDMODE_X)!==e.BILLBOARDMODE_X&&(y.x=0),(this.billboardMode&e.BILLBOARDMODE_Y)!==e.BILLBOARDMODE_Y&&(y.y=0),(this.billboardMode&e.BILLBOARDMODE_Z)!==e.BILLBOARDMODE_Z&&(y.z=0),C.RotationYawPitchRollToRef(y.y,y.x,y.z,c.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(c.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(c.Vector3[0])}else if(a&&i&&this.billboardMode&&n){var T=c.Vector3[0];this._worldMatrix.getTranslationToRef(T);var S=i.globalPosition;this._worldMatrix.invertToRef(c.Matrix[1]);var P=c.Vector3[1];g.TransformCoordinatesToRef(S,c.Matrix[1],P),P.normalize();var x=-Math.atan2(P.z,P.x)+Math.PI/2,m=Math.sqrt(P.x*P.x+P.z*P.z),R=-Math.atan2(P.y,m);if(E.RotationYawPitchRollToRef(x,R,0,c.Quaternion[0]),(this.billboardMode&e.BILLBOARDMODE_ALL)!==e.BILLBOARDMODE_ALL){var y=c.Vector3[1];c.Quaternion[0].toEulerAnglesToRef(y),(this.billboardMode&e.BILLBOARDMODE_X)!==e.BILLBOARDMODE_X&&(y.x=0),(this.billboardMode&e.BILLBOARDMODE_Y)!==e.BILLBOARDMODE_Y&&(y.y=0),(this.billboardMode&e.BILLBOARDMODE_Z)!==e.BILLBOARDMODE_Z&&(y.z=0),C.RotationYawPitchRollToRef(y.y,y.x,y.z,c.Matrix[0])}else C.FromQuaternionToRef(c.Quaternion[0],c.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(c.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(c.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):l&&l._nonUniformScaling?this._updateNonUniformScalingState(l._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=C.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},e.prototype.resetLocalMatrix=function(t){if(t===void 0&&(t=!0),this.computeWorldMatrix(),t)for(var r=this.getChildren(),i=0;i<r.length;++i){var n=r[i];if(n){n.computeWorldMatrix();var a=c.Matrix[0];n._localMatrix.multiplyToRef(this._localMatrix,a);var s=c.Quaternion[0];a.decompose(n.scaling,s,n.position),n.rotationQuaternion?n.rotationQuaternion.copyFrom(s):s.toEulerAnglesToRef(n.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=E.Identity()),this._worldMatrix=C.Identity()},e.prototype._afterComputeWorldMatrix=function(){},e.prototype.registerAfterWorldMatrixUpdate=function(t){return this.onAfterWorldMatrixUpdateObservable.add(t),this},e.prototype.unregisterAfterWorldMatrixUpdate=function(t){return this.onAfterWorldMatrixUpdateObservable.removeCallback(t),this},e.prototype.getPositionInCameraSpace=function(t){return t===void 0&&(t=null),t||(t=this.getScene().activeCamera),g.TransformCoordinates(this.getAbsolutePosition(),t.getViewMatrix())},e.prototype.getDistanceToCamera=function(t){return t===void 0&&(t=null),t||(t=this.getScene().activeCamera),this.getAbsolutePosition().subtract(t.globalPosition).length()},e.prototype.clone=function(t,r,i){var n=this,a=tt.Clone(function(){return new e(t,n.getScene())},this);if(a.name=t,a.id=t,r&&(a.parent=r),!i)for(var s=this.getDescendants(!0),l=0;l<s.length;l++){var h=s[l];h.clone&&h.clone(t+"."+h.name,a)}return a},e.prototype.serialize=function(t){var r=tt.Serialize(this,t);return r.type=this.getClassName(),r.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(r),r.localMatrix=this.getPivotMatrix().asArray(),r.isEnabled=this.isEnabled(),r},e.Parse=function(t,r,i){var n=tt.Parse(function(){return new e(t.name,r)},t,r,i);return t.localMatrix?n.setPreTransformMatrix(C.FromArray(t.localMatrix)):t.pivotMatrix&&n.setPivotMatrix(C.FromArray(t.pivotMatrix)),n.setEnabled(t.isEnabled),t.parentId!==void 0&&(n._waitingParentId=t.parentId),t.parentInstanceIndex!==void 0&&(n._waitingParentInstanceIndex=t.parentInstanceIndex),n},e.prototype.getChildTransformNodes=function(t,r){var i=[];return this._getDescendants(i,t,function(n){return(!r||r(n))&&n instanceof e}),i},e.prototype.dispose=function(t,r){if(r===void 0&&(r=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){var i=this._parentContainer.transformNodes.indexOf(this);i>-1&&this._parentContainer.transformNodes.splice(i,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),t)for(var n=this.getChildTransformNodes(!0),a=0,s=n;a<s.length;a++){var l=s[a];l.parent=null,l.computeWorldMatrix(!0)}f.prototype.dispose.call(this,t,r)},e.prototype.normalizeToUnitCube=function(t,r,i){t===void 0&&(t=!0),r===void 0&&(r=!1);var n=null,a=null;r&&(this.rotationQuaternion?(a=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(n=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var s=this.getHierarchyBoundingVectors(t,i),l=s.max.subtract(s.min),h=Math.max(l.x,l.y,l.z);if(h===0)return this;var u=1/h;return this.scaling.scaleInPlace(u),r&&(this.rotationQuaternion&&a?this.rotationQuaternion.copyFrom(a):this.rotation&&n&&this.rotation.copyFrom(n)),this},e.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},e.BILLBOARDMODE_NONE=0,e.BILLBOARDMODE_X=1,e.BILLBOARDMODE_Y=2,e.BILLBOARDMODE_Z=4,e.BILLBOARDMODE_ALL=7,e.BILLBOARDMODE_USE_POSITION=128,e._TmpRotation=E.Zero(),e._TmpScaling=g.Zero(),e._TmpTranslation=g.Zero(),e._LookAtVectorCache=new g(0,0,0),e._RotationAxisCache=new E,V([et("position")],e.prototype,"_position",void 0),V([et("rotation")],e.prototype,"_rotation",void 0),V([St("rotationQuaternion")],e.prototype,"_rotationQuaternion",void 0),V([et("scaling")],e.prototype,"_scaling",void 0),V([H("billboardMode")],e.prototype,"_billboardMode",void 0),V([H()],e.prototype,"scalingDeterminant",void 0),V([H("infiniteDistance")],e.prototype,"_infiniteDistance",void 0),V([H()],e.prototype,"ignoreNonUniformScaling",void 0),V([H()],e.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),e}(Ct),Nt=function(){function f(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new g(0,0,0),this._diffPositionForCollisions=new g(0,0,0),this._collisionResponse=!0}return f}(),wt=function(){function f(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=g.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}return f}(),Kt=function(){function f(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new wt,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._meshCollisionData=new Nt,this._enableDistantPicking=!1}return f}(),zt=function(f){lt(e,f);function e(t,r){r===void 0&&(r=null);var i=f.call(this,t,r,!1)||this;return i._internalAbstractMeshDataInfo=new Kt,i._waitingMaterialId=null,i.cullingStrategy=e.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,i.onCollideObservable=new q,i.onCollisionPositionChangeObservable=new q,i.onMaterialChangedObservable=new q,i.definedFacingForward=!0,i._occlusionQuery=null,i._renderingGroup=null,i.alphaIndex=Number.MAX_VALUE,i.isVisible=!0,i.isPickable=!0,i.isNearPickable=!1,i.isNearGrabbable=!1,i.showSubMeshesBoundingBox=!1,i.isBlocker=!1,i.enablePointerMoveEvents=!1,i.outlineColor=st.Red(),i.outlineWidth=.02,i.overlayColor=st.Red(),i.overlayAlpha=.5,i.useOctreeForRenderingSelection=!0,i.useOctreeForPicking=!0,i.useOctreeForCollisions=!0,i.alwaysSelectAsActiveMesh=!1,i.doNotSyncBoundingInfo=!1,i.actionManager=null,i.ellipsoid=new g(.5,1,.5),i.ellipsoidOffset=new g(0,0,0),i.edgesWidth=1,i.edgesColor=new ft(1,0,0,1),i._edgesRenderer=null,i._masterMesh=null,i._boundingInfo=null,i._boundingInfoIsDirty=!0,i._renderId=0,i._intersectionsInProgress=new Array,i._unIndexed=!1,i._lightSources=new Array,i._waitingData={lods:null,actions:null,freezeWorldMatrix:null},i._bonesTransformMatrices=null,i._transformMatrixTexture=null,i.onRebuildObservable=new q,i._onCollisionPositionChange=function(n,a,s){s===void 0&&(s=null),a.subtractToRef(i._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,i._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),i._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>At.CollisionsEpsilon&&i.position.addInPlace(i._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),s&&i.onCollideObservable.notifyObservers(s),i.onCollisionPositionChangeObservable.notifyObservers(i.position)},i.getScene().addMesh(i),i._resyncLightSources(),i._uniformBuffer=new Et(i.getScene().getEngine(),void 0,void 0,t,!i.getScene().getEngine().isWebGPU),i._buildUniformLayout(),i}return Object.defineProperty(e,"BILLBOARDMODE_NONE",{get:function(){return L.BILLBOARDMODE_NONE},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BILLBOARDMODE_X",{get:function(){return L.BILLBOARDMODE_X},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BILLBOARDMODE_Y",{get:function(){return L.BILLBOARDMODE_Y},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BILLBOARDMODE_Z",{get:function(){return L.BILLBOARDMODE_Z},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BILLBOARDMODE_ALL",{get:function(){return L.BILLBOARDMODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BILLBOARDMODE_USE_POSITION",{get:function(){return L.BILLBOARDMODE_USE_POSITION},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(t){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(t){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collisionRetryCount",{get:function(){return this._internalAbstractMeshDataInfo._collisionRetryCount},set:function(t){this._internalAbstractMeshDataInfo._collisionRetryCount=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"morphTargetManager",{get:function(){return this._internalAbstractMeshDataInfo._morphTargetManager},set:function(t){this._internalAbstractMeshDataInfo._morphTargetManager!==t&&(this._internalAbstractMeshDataInfo._morphTargetManager=t,this._syncGeometryWithMorphTargetManager())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bakedVertexAnimationManager",{get:function(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager},set:function(t){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==t&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=t,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),e.prototype._syncGeometryWithMorphTargetManager=function(){},e.prototype._updateNonUniformScalingState=function(t){return f.prototype._updateNonUniformScalingState.call(this,t)?(this._markSubMeshesAsMiscDirty(),!0):!1},Object.defineProperty(e.prototype,"onCollide",{set:function(t){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onCollisionPositionChange",{set:function(t){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(t){if(this._internalAbstractMeshDataInfo._visibility!==t){var r=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=t,(r===1&&t!==1||r!==1&&t===1)&&this._markSubMeshesAsMiscDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderingGroupId",{get:function(){return this._internalAbstractMeshDataInfo._renderingGroupId},set:function(t){this._internalAbstractMeshDataInfo._renderingGroupId=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this._internalAbstractMeshDataInfo._material},set:function(t){this._internalAbstractMeshDataInfo._material!==t&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=t,t&&t.meshMap&&(t.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))},enumerable:!1,configurable:!0}),e.prototype.getMaterialForRenderPass=function(t){var r;return(r=this._internalAbstractMeshDataInfo._materialForRenderPass)===null||r===void 0?void 0:r[t]},e.prototype.setMaterialForRenderPass=function(t,r){this.resetDrawCache(t),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[t]=r},Object.defineProperty(e.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(t){this._internalAbstractMeshDataInfo._receiveShadows!==t&&(this._internalAbstractMeshDataInfo._receiveShadows=t,this._markSubMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(t){this._internalAbstractMeshDataInfo._hasVertexAlpha!==t&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=t,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(t){this._internalAbstractMeshDataInfo._useVertexColors!==t&&(this._internalAbstractMeshDataInfo._useVertexColors=t,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(t){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==t&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=t,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(t){this._internalAbstractMeshDataInfo._numBoneInfluencers!==t&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=t,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(t){this._internalAbstractMeshDataInfo._applyFog!==t&&(this._internalAbstractMeshDataInfo._applyFog=t,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enableDistantPicking",{get:function(){return this._internalAbstractMeshDataInfo._enableDistantPicking},set:function(t){this._internalAbstractMeshDataInfo._enableDistantPicking=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(t){t!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=t,this._resyncLightSources())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collisionMask",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask},set:function(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(t)?-1:t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collisionResponse",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse},set:function(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collisionGroup",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup},set:function(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(t)?-1:t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"surroundingMeshes",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes},set:function(t){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_positions",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(t){var r=this._internalAbstractMeshDataInfo._skeleton;r&&r.needInitialSkinMatrix&&r._unregisterMeshWithPoseMatrix(this),t&&t.needInitialSkinMatrix&&t._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=t,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!1,configurable:!0}),e.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()},e.prototype.transferToEffect=function(t){var r=this._uniformBuffer;r.updateMatrix("world",t),r.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),r.update()},e.prototype.getMeshUniformBuffer=function(){return this._uniformBuffer},e.prototype.getClassName=function(){return"AbstractMesh"},e.prototype.toString=function(t){var r="Name: "+this.name+", isInstance: "+(this.getClassName()!=="InstancedMesh"?"YES":"NO");r+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var i=this._internalAbstractMeshDataInfo._skeleton;return i&&(r+=", skeleton: "+i.name),t&&(r+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],r+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),r},e.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==L.BILLBOARDMODE_NONE?this._masterMesh:f.prototype._getEffectiveParent.call(this)},e.prototype._getActionManagerForTrigger=function(t,r){if(r===void 0&&(r=!0),this.actionManager&&(r||this.actionManager.isRecursive))if(t){if(this.actionManager.hasSpecificTrigger(t))return this.actionManager}else return this.actionManager;return this.parent?this.parent._getActionManagerForTrigger(t,!1):null},e.prototype._rebuild=function(t){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery!==null&&(this._occlusionQuery=null),!!this.subMeshes)for(var r=0,i=this.subMeshes;r<i.length;r++){var n=i[r];n._rebuild()}},e.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var t=0,r=this.getScene().lights;t<r.length;t++){var i=r[t];!i.isEnabled()||i.canAffectMesh(this)&&this._lightSources.push(i)}this._markSubMeshesAsLightDirty()},e.prototype._resyncLightSource=function(t){var r=t.isEnabled()&&t.canAffectMesh(this),i=this._lightSources.indexOf(t),n=!1;if(i===-1){if(!r)return;this._lightSources.push(t)}else{if(r)return;n=!0,this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty(n)},e.prototype._unBindEffect=function(){for(var t=0,r=this.subMeshes;t<r.length;t++){var i=r[t];i.setEffect(null)}},e.prototype._removeLightSource=function(t,r){var i=this._lightSources.indexOf(t);i!==-1&&(this._lightSources.splice(i,1),this._markSubMeshesAsLightDirty(r))},e.prototype._markSubMeshesAsDirty=function(t){if(!!this.subMeshes)for(var r=0,i=this.subMeshes;r<i.length;r++)for(var n=i[r],a=0;a<n._drawWrappers.length;++a){var s=n._drawWrappers[a];!s||!s.defines||!s.defines.markAllAsDirty||t(s.defines)}},e.prototype._markSubMeshesAsLightDirty=function(t){t===void 0&&(t=!1),this._markSubMeshesAsDirty(function(r){return r.markAsLightDirty(t)})},e.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(t){return t.markAsAttributesDirty()})},e.prototype._markSubMeshesAsMiscDirty=function(){this._markSubMeshesAsDirty(function(t){return t.markAsMiscDirty()})},e.prototype.markAsDirty=function(t){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},e.prototype.resetDrawCache=function(t){if(!!this.subMeshes)for(var r=0,i=this.subMeshes;r<i.length;r++){var n=i[r];n.resetDrawCache(t)}},Object.defineProperty(e.prototype,"isBlocked",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.getLOD=function(t){return this},e.prototype.getTotalVertices=function(){return 0},e.prototype.getTotalIndices=function(){return 0},e.prototype.getIndices=function(){return null},e.prototype.getVerticesData=function(t){return null},e.prototype.setVerticesData=function(t,r,i,n){return this},e.prototype.updateVerticesData=function(t,r,i,n){return this},e.prototype.setIndices=function(t,r){return this},e.prototype.isVerticesDataPresent=function(t){return!1},e.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)},e.prototype.setBoundingInfo=function(t){return this._boundingInfo=t,this},Object.defineProperty(e.prototype,"hasBoundingInfo",{get:function(){return this._boundingInfo!==null},enumerable:!1,configurable:!0}),e.prototype.buildBoundingInfo=function(t,r,i){return this._boundingInfo=new it(t,r,i),this._boundingInfo},e.prototype.normalizeToUnitCube=function(t,r,i){return t===void 0&&(t=!0),r===void 0&&(r=!1),f.prototype.normalizeToUnitCube.call(this,t,r,i)},Object.defineProperty(e.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(o.MatricesIndicesKind)&&this.isVerticesDataPresent(o.MatricesWeightsKind)},enumerable:!1,configurable:!0}),e.prototype._preActivate=function(){},e.prototype._preActivateForIntermediateRendering=function(t){},e.prototype._activate=function(t,r){return this._renderId=t,!0},e.prototype._postActivate=function(){},e.prototype._freeze=function(){},e.prototype._unFreeze=function(){},e.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===L.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():f.prototype.getWorldMatrix.call(this)},e.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():f.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(e.prototype,"isAnInstance",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasThinInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.movePOV=function(t,r,i){return this.position.addInPlace(this.calcMovePOV(t,r,i)),this},e.prototype.calcMovePOV=function(t,r,i){var n=new C,a=this.rotationQuaternion?this.rotationQuaternion:E.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);a.toRotationMatrix(n);var s=g.Zero(),l=this.definedFacingForward?-1:1;return g.TransformCoordinatesFromFloatsToRef(t*l,r,i*l,n,s),s},e.prototype.rotatePOV=function(t,r,i){return this.rotation.addInPlace(this.calcRotatePOV(t,r,i)),this},e.prototype.calcRotatePOV=function(t,r,i){var n=this.definedFacingForward?1:-1;return new g(t*n,r,i*n)},e.prototype.refreshBoundingInfo=function(t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this._boundingInfo&&this._boundingInfo.isLocked?this:(this._refreshBoundingInfo(this._getPositionData(t,r),null),this)},e.prototype._refreshBoundingInfo=function(t,r){if(t){var i=Ot(t,0,this.getTotalVertices(),r);this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new it(i.minimum,i.maximum)}if(this.subMeshes)for(var n=0;n<this.subMeshes.length;n++)this.subMeshes[n].refreshBoundingInfo(t);this._updateBoundingInfo()},e.prototype._getData=function(t,r,i,n){if(t===void 0&&(t=!1),r===void 0&&(r=!1),n===void 0&&(n=o.PositionKind),i=i!=null?i:this.getVerticesData(n).slice(),i&&r&&this.morphTargetManager)for(var a=0,s=0,l=0;l<i.length;l++){for(var h=0;h<this.morphTargetManager.numTargets;h++){var u=this.morphTargetManager.getTarget(h),d=u.influence;if(d>0){var v=u.getPositions();v&&(i[l]+=(v[l]-i[l])*d)}}if(a++,n===o.PositionKind&&this._positions&&a===3){a=0;var p=s*3;this._positions[s++].copyFromFloats(i[p],i[p+1],i[p+2])}}if(i&&t&&this.skeleton){var m=this.getVerticesData(o.MatricesIndicesKind),b=this.getVerticesData(o.MatricesWeightsKind);if(b&&m)for(var M=this.numBoneInfluencers>4,I=M?this.getVerticesData(o.MatricesIndicesExtraKind):null,D=M?this.getVerticesData(o.MatricesWeightsExtraKind):null,T=this.skeleton.getTransformMatrices(this),y=c.Vector3[0],S=c.Matrix[0],P=c.Matrix[1],x=0,p=0;p<i.length;p+=3,x+=4){S.reset();var R=void 0,O=void 0;for(R=0;R<4;R++)O=b[x+R],O>0&&(C.FromFloat32ArrayToRefScaled(T,Math.floor(m[x+R]*16),O,P),S.addToSelf(P));if(M)for(R=0;R<4;R++)O=D[x+R],O>0&&(C.FromFloat32ArrayToRefScaled(T,Math.floor(I[x+R]*16),O,P),S.addToSelf(P));n===o.NormalKind?g.TransformNormalFromFloatsToRef(i[p],i[p+1],i[p+2],S,y):g.TransformCoordinatesFromFloatsToRef(i[p],i[p+1],i[p+2],S,y),y.toArray(i,p),n===o.PositionKind&&this._positions&&this._positions[p/3].copyFrom(y)}}return i},e.prototype.getNormalsData=function(t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this._getData(t,r,null,o.NormalKind)},e.prototype.getPositionData=function(t,r,i){return t===void 0&&(t=!1),r===void 0&&(r=!1),this._getData(t,r,i,o.PositionKind)},e.prototype._getPositionData=function(t,r){var i,n=this.getVerticesData(o.PositionKind);if(this._internalAbstractMeshDataInfo._positions&&(this._internalAbstractMeshDataInfo._positions=null),n&&(t&&this.skeleton||r&&this.morphTargetManager)){if(n=n.slice(),this._generatePointsArray(),this._positions){var a=this._positions;this._internalAbstractMeshDataInfo._positions=new Array(a.length);for(var s=0;s<a.length;s++)this._internalAbstractMeshDataInfo._positions[s]=((i=a[s])===null||i===void 0?void 0:i.clone())||new g}return this.getPositionData(t,r,n)}return n},e.prototype._updateBoundingInfo=function(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new it(g.Zero(),g.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},e.prototype._updateSubMeshesBoundingInfo=function(t){if(!this.subMeshes)return this;for(var r=this.subMeshes.length,i=0;i<r;i++){var n=this.subMeshes[i];(r>1||!n.IsGlobal)&&n.updateBoundingInfo(t)}return this},e.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)},e.prototype.isInFrustum=function(t){return this.getBoundingInfo().isInFrustum(t,this.cullingStrategy)},e.prototype.isCompletelyInFrustum=function(t){return this.getBoundingInfo().isCompletelyInFrustum(t)},e.prototype.intersectsMesh=function(t,r,i){r===void 0&&(r=!1);var n=this.getBoundingInfo(),a=t.getBoundingInfo();if(n.intersects(a,r))return!0;if(i)for(var s=0,l=this.getChildMeshes();s<l.length;s++){var h=l[s];if(h.intersectsMesh(t,r,!0))return!0}return!1},e.prototype.intersectsPoint=function(t){return this.getBoundingInfo().intersectsPoint(t)},Object.defineProperty(e.prototype,"checkCollisions",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions},set:function(t){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collider",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider},enumerable:!1,configurable:!0}),e.prototype.moveWithCollisions=function(t){var r=this.getAbsolutePosition();r.addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);var i=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=i.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,i.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,t,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this},e.prototype._collideForSubMesh=function(t,r,i){var n;if(this._generatePointsArray(),!this._positions)return this;if(!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(r)){t._lastColliderTransformMatrix=r.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var a=t.verticesStart,s=t.verticesStart+t.verticesCount,l=a;l<s;l++)t._lastColliderWorldVertices.push(g.TransformCoordinates(this._positions[l],r))}return i._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial(),this,this._shouldConvertRHS(),((n=t.getMaterial())===null||n===void 0?void 0:n.fillMode)===7),this},e.prototype._processCollisionsForSubMeshes=function(t,r){for(var i=this._scene.getCollidingSubMeshCandidates(this,t),n=i.length,a=0;a<n;a++){var s=i.data[a];n>1&&!s._checkCollision(t)||this._collideForSubMesh(s,r,t)}return this},e.prototype._shouldConvertRHS=function(){return!1},e.prototype._checkCollision=function(t){if(!this.getBoundingInfo()._checkCollision(t))return this;var r=c.Matrix[0],i=c.Matrix[1];return C.ScalingToRef(1/t._radius.x,1/t._radius.y,1/t._radius.z,r),this.worldMatrixFromCache.multiplyToRef(r,i),this._processCollisionsForSubMeshes(t,i),this},e.prototype._generatePointsArray=function(){return!1},e.prototype.intersects=function(t,r,i,n,a,s){n===void 0&&(n=!1),s===void 0&&(s=!1);var l=new Ft,h=this.getClassName()==="InstancedLinesMesh"||this.getClassName()==="LinesMesh"?this.intersectionThreshold:0,u=this.getBoundingInfo();if(!this.subMeshes||!s&&(!t.intersectsSphere(u.boundingSphere,h)||!t.intersectsBox(u.boundingBox,h)))return l;if(n)return l.hit=!s,l.pickedMesh=s?null:this,l.distance=s?0:g.Distance(t.origin,u.boundingSphere.center),l.subMeshId=0,l;if(!this._generatePointsArray())return l;for(var d=null,v=this._scene.getIntersectingSubMeshCandidates(this,t),p=v.length,m=!1,b=0;b<p;b++){var M=v.data[b],I=M.getMaterial();if(!!I&&(I.fillMode==7||I.fillMode==0||I.fillMode==1||I.fillMode==2||I.fillMode==4)){m=!0;break}}if(!m)return l.hit=!0,l.pickedMesh=this,l.distance=g.Distance(t.origin,u.boundingSphere.center),l.subMeshId=-1,l;for(var b=0;b<p;b++){var M=v.data[b];if(!(p>1&&!M.canIntersects(t))){var D=M.intersects(t,this._positions,this.getIndices(),r,i);if(D&&(r||!d||D.distance<d.distance)&&(d=D,d.subMeshId=b,r))break}}if(d){var T=a!=null?a:this.getWorldMatrix(),y=c.Vector3[0],S=c.Vector3[1];g.TransformCoordinatesToRef(t.origin,T,y),t.direction.scaleToRef(d.distance,S);var P=g.TransformNormal(S,T),x=P.addInPlace(y);return l.hit=!0,l.distance=g.Distance(y,x),l.pickedPoint=x,l.pickedMesh=this,l.bu=d.bu||0,l.bv=d.bv||0,l.subMeshFaceId=d.faceId,l.faceId=d.faceId+v.data[d.subMeshId].indexStart/(this.getClassName().indexOf("LinesMesh")!==-1?2:3),l.subMeshId=d.subMeshId,l}return l},e.prototype.clone=function(t,r,i){return null},e.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},e.prototype.dispose=function(t,r){var i=this;r===void 0&&(r=!1);var n;for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),this.actionManager!==void 0&&this.actionManager!==null&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),n=0;n<this._intersectionsInProgress.length;n++){var a=this._intersectionsInProgress[n],s=a._intersectionsInProgress.indexOf(this);a._intersectionsInProgress.splice(s,1)}this._intersectionsInProgress=[];var l=this.getScene().lights;l.forEach(function(d){var v=d.includedOnlyMeshes.indexOf(i);v!==-1&&d.includedOnlyMeshes.splice(v,1),v=d.excludedMeshes.indexOf(i),v!==-1&&d.excludedMeshes.splice(v,1);var p=d.getShadowGenerator();if(p){var m=p.getShadowMap();m&&m.renderList&&(v=m.renderList.indexOf(i),v!==-1&&m.renderList.splice(v,1))}}),(this.getClassName()!=="InstancedMesh"||this.getClassName()!=="InstancedLinesMesh")&&this.releaseSubMeshes();var h=this.getScene().getEngine();if(this._occlusionQuery!==null&&(this.isOcclusionQueryInProgress=!1,h.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),h.wipeCaches(),this.getScene().removeMesh(this),this._parentContainer){var u=this._parentContainer.meshes.indexOf(this);u>-1&&this._parentContainer.meshes.splice(u,1),this._parentContainer=null}if(r&&this.material&&(this.material.getClassName()==="MultiMaterial"?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!t)for(n=0;n<this.getScene().particleSystems.length;n++)this.getScene().particleSystems[n].emitter===this&&(this.getScene().particleSystems[n].dispose(),n--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),f.prototype.dispose.call(this,t,r)},e.prototype.addChild=function(t,r){return r===void 0&&(r=!1),t.setParent(this,r),this},e.prototype.removeChild=function(t,r){return r===void 0&&(r=!1),t.setParent(null,r),this},e.prototype._initFacetData=function(){var t=this._internalAbstractMeshDataInfo._facetData;t.facetNormals||(t.facetNormals=new Array),t.facetPositions||(t.facetPositions=new Array),t.facetPartitioning||(t.facetPartitioning=new Array),t.facetNb=this.getIndices().length/3|0,t.partitioningSubdivisions=t.partitioningSubdivisions?t.partitioningSubdivisions:10,t.partitioningBBoxRatio=t.partitioningBBoxRatio?t.partitioningBBoxRatio:1.01;for(var r=0;r<t.facetNb;r++)t.facetNormals[r]=g.Zero(),t.facetPositions[r]=g.Zero();return t.facetDataEnabled=!0,this},e.prototype.updateFacetData=function(){var t=this._internalAbstractMeshDataInfo._facetData;t.facetDataEnabled||this._initFacetData();var r=this.getVerticesData(o.PositionKind),i=this.getIndices(),n=this.getVerticesData(o.NormalKind),a=this.getBoundingInfo();if(t.facetDepthSort&&!t.facetDepthSortEnabled){if(t.facetDepthSortEnabled=!0,i instanceof Uint16Array)t.depthSortedIndices=new Uint16Array(i);else if(i instanceof Uint32Array)t.depthSortedIndices=new Uint32Array(i);else{for(var s=!1,l=0;l<i.length;l++)if(i[l]>65535){s=!0;break}s?t.depthSortedIndices=new Uint32Array(i):t.depthSortedIndices=new Uint16Array(i)}if(t.facetDepthSortFunction=function(b,M){return M.sqDistance-b.sqDistance},!t.facetDepthSortFrom){var h=this.getScene().activeCamera;t.facetDepthSortFrom=h?h.position:g.Zero()}t.depthSortedFacets=[];for(var u=0;u<t.facetNb;u++){var d={ind:u*3,sqDistance:0};t.depthSortedFacets.push(d)}t.invertedMatrix=C.Identity(),t.facetDepthSortOrigin=g.Zero()}t.bbSize.x=a.maximum.x-a.minimum.x>Q?a.maximum.x-a.minimum.x:Q,t.bbSize.y=a.maximum.y-a.minimum.y>Q?a.maximum.y-a.minimum.y:Q,t.bbSize.z=a.maximum.z-a.minimum.z>Q?a.maximum.z-a.minimum.z:Q;var v=t.bbSize.x>t.bbSize.y?t.bbSize.x:t.bbSize.y;if(v=v>t.bbSize.z?v:t.bbSize.z,t.subDiv.max=t.partitioningSubdivisions,t.subDiv.X=Math.floor(t.subDiv.max*t.bbSize.x/v),t.subDiv.Y=Math.floor(t.subDiv.max*t.bbSize.y/v),t.subDiv.Z=Math.floor(t.subDiv.max*t.bbSize.z/v),t.subDiv.X=t.subDiv.X<1?1:t.subDiv.X,t.subDiv.Y=t.subDiv.Y<1?1:t.subDiv.Y,t.subDiv.Z=t.subDiv.Z<1?1:t.subDiv.Z,t.facetParameters.facetNormals=this.getFacetLocalNormals(),t.facetParameters.facetPositions=this.getFacetLocalPositions(),t.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),t.facetParameters.bInfo=a,t.facetParameters.bbSize=t.bbSize,t.facetParameters.subDiv=t.subDiv,t.facetParameters.ratio=this.partitioningBBoxRatio,t.facetParameters.depthSort=t.facetDepthSort,t.facetDepthSort&&t.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(t.invertedMatrix),g.TransformCoordinatesToRef(t.facetDepthSortFrom,t.invertedMatrix,t.facetDepthSortOrigin),t.facetParameters.distanceTo=t.facetDepthSortOrigin),t.facetParameters.depthSortedFacets=t.depthSortedFacets,n&&ot.ComputeNormals(r,i,n,t.facetParameters),t.facetDepthSort&&t.facetDepthSortEnabled){t.depthSortedFacets.sort(t.facetDepthSortFunction);for(var p=t.depthSortedIndices.length/3|0,u=0;u<p;u++){var m=t.depthSortedFacets[u].ind;t.depthSortedIndices[u*3]=i[m],t.depthSortedIndices[u*3+1]=i[m+1],t.depthSortedIndices[u*3+2]=i[m+2]}this.updateIndices(t.depthSortedIndices,void 0,!0)}return this},e.prototype.getFacetLocalNormals=function(){var t=this._internalAbstractMeshDataInfo._facetData;return t.facetNormals||this.updateFacetData(),t.facetNormals},e.prototype.getFacetLocalPositions=function(){var t=this._internalAbstractMeshDataInfo._facetData;return t.facetPositions||this.updateFacetData(),t.facetPositions},e.prototype.getFacetLocalPartitioning=function(){var t=this._internalAbstractMeshDataInfo._facetData;return t.facetPartitioning||this.updateFacetData(),t.facetPartitioning},e.prototype.getFacetPosition=function(t){var r=g.Zero();return this.getFacetPositionToRef(t,r),r},e.prototype.getFacetPositionToRef=function(t,r){var i=this.getFacetLocalPositions()[t],n=this.getWorldMatrix();return g.TransformCoordinatesToRef(i,n,r),this},e.prototype.getFacetNormal=function(t){var r=g.Zero();return this.getFacetNormalToRef(t,r),r},e.prototype.getFacetNormalToRef=function(t,r){var i=this.getFacetLocalNormals()[t];return g.TransformNormalToRef(i,this.getWorldMatrix(),r),this},e.prototype.getFacetsAtLocalCoordinates=function(t,r,i){var n=this.getBoundingInfo(),a=this._internalAbstractMeshDataInfo._facetData,s=Math.floor((t-n.minimum.x*a.partitioningBBoxRatio)*a.subDiv.X*a.partitioningBBoxRatio/a.bbSize.x),l=Math.floor((r-n.minimum.y*a.partitioningBBoxRatio)*a.subDiv.Y*a.partitioningBBoxRatio/a.bbSize.y),h=Math.floor((i-n.minimum.z*a.partitioningBBoxRatio)*a.subDiv.Z*a.partitioningBBoxRatio/a.bbSize.z);return s<0||s>a.subDiv.max||l<0||l>a.subDiv.max||h<0||h>a.subDiv.max?null:a.facetPartitioning[s+a.subDiv.max*l+a.subDiv.max*a.subDiv.max*h]},e.prototype.getClosestFacetAtCoordinates=function(t,r,i,n,a,s){a===void 0&&(a=!1),s===void 0&&(s=!0);var l=this.getWorldMatrix(),h=c.Matrix[5];l.invertToRef(h);var u=c.Vector3[8];g.TransformCoordinatesFromFloatsToRef(t,r,i,h,u);var d=this.getClosestFacetAtLocalCoordinates(u.x,u.y,u.z,n,a,s);return n&&g.TransformCoordinatesFromFloatsToRef(n.x,n.y,n.z,l,n),d},e.prototype.getClosestFacetAtLocalCoordinates=function(t,r,i,n,a,s){a===void 0&&(a=!1),s===void 0&&(s=!0);var l=null,h=0,u=0,d=0,v=0,p=0,m=0,b=0,M=0,I=this.getFacetLocalPositions(),D=this.getFacetLocalNormals(),T=this.getFacetsAtLocalCoordinates(t,r,i);if(!T)return null;for(var y=Number.MAX_VALUE,S=y,P,x,R,O=0;O<T.length;O++)P=T[O],x=D[P],R=I[P],v=(t-R.x)*x.x+(r-R.y)*x.y+(i-R.z)*x.z,(!a||a&&s&&v>=0||a&&!s&&v<=0)&&(v=x.x*R.x+x.y*R.y+x.z*R.z,p=-(x.x*t+x.y*r+x.z*i-v)/(x.x*x.x+x.y*x.y+x.z*x.z),m=t+x.x*p,b=r+x.y*p,M=i+x.z*p,h=m-t,u=b-r,d=M-i,S=h*h+u*u+d*d,S<y&&(y=S,l=P,n&&(n.x=m,n.y=b,n.z=M)));return l},e.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},e.prototype.disableFacetData=function(){var t=this._internalAbstractMeshDataInfo._facetData;return t.facetDataEnabled&&(t.facetDataEnabled=!1,t.facetPositions=new Array,t.facetNormals=new Array,t.facetPartitioning=new Array,t.facetParameters=null,t.depthSortedIndices=new Uint32Array(0)),this},e.prototype.updateIndices=function(t,r,i){return this},e.prototype.createNormals=function(t){var r=this.getVerticesData(o.PositionKind),i=this.getIndices(),n;return this.isVerticesDataPresent(o.NormalKind)?n=this.getVerticesData(o.NormalKind):n=[],ot.ComputeNormals(r,i,n,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(o.NormalKind,n,t),this},e.prototype.alignWithNormal=function(t,r){r||(r=Bt.Y);var i=c.Vector3[0],n=c.Vector3[1];return g.CrossToRef(r,t,n),g.CrossToRef(t,n,i),this.rotationQuaternion?E.RotationQuaternionFromAxisToRef(i,t,n,this.rotationQuaternion):g.RotationFromAxisToRef(i,t,n,this.rotation),this},e.prototype._checkOcclusionQuery=function(){return!1},e.prototype.disableEdgesRendering=function(){throw B("EdgesRenderer")},e.prototype.enableEdgesRendering=function(t,r,i){throw B("EdgesRenderer")},e.prototype.getConnectedParticleSystems=function(){var t=this;return this._scene.particleSystems.filter(function(r){return r.emitter===t})},e.OCCLUSION_TYPE_NONE=0,e.OCCLUSION_TYPE_OPTIMISTIC=1,e.OCCLUSION_TYPE_STRICT=2,e.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,e.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,e.CULLINGSTRATEGY_STANDARD=0,e.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,e.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,e.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,e}(L);Vt("BABYLON.AbstractMesh",zt);export{zt as A,ot as V,ee as a,te as c,ht as r};
