import{l as O,j as u,f as B,L as C,O as b}from"./precisionDate.911053b8.js";import{S as v,s as f,T as A}from"./decorators.033fe02c.js";import{E as P}from"./performanceConfigurator.3a0adc9f.js";import{V as T,P as I}from"./math.plane.3df9f77f.js";import{B as S}from"./boundingInfo.536615f6.js";import{a as F}from"./math.functions.8d0abdec.js";import{U as w}from"./lightConstants.3b1d6040.js";import{M as x}from"./materialHelper.532e5e98.js";var k=function(){function e(t,r,i){this.bu=t,this.bv=r,this.distance=i,this.faceId=0,this.subMeshId=0}return e}(),W=function(){function e(t,r,i,n,s,a,o,l,h){l===void 0&&(l=!0),h===void 0&&(h=!0),this.materialIndex=t,this.verticesStart=r,this.verticesCount=i,this.indexStart=n,this.indexCount=s,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=a,this._renderingMesh=o||a,h&&a.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=a.subMeshes.length-1,l&&(this.refreshBoundingInfo(),a.computeWorldMatrix(!0))}return Object.defineProperty(e.prototype,"materialDefines",{get:function(){var t;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:(t=this._getDrawWrapper())===null||t===void 0?void 0:t.defines},set:function(t){var r,i=(r=this._mainDrawWrapperOverride)!==null&&r!==void 0?r:this._getDrawWrapper(void 0,!0);i.defines=t},enumerable:!1,configurable:!0}),e.prototype._getDrawWrapper=function(t,r){r===void 0&&(r=!1),t=t!=null?t:this._engine.currentRenderPassId;var i=this._drawWrappers[t];return!i&&r&&(this._drawWrappers[t]=i=new O(this._mesh.getScene().getEngine())),i},e.prototype._removeDrawWrapper=function(t,r){var i;r===void 0&&(r=!0),r&&((i=this._drawWrappers[t])===null||i===void 0||i.dispose()),this._drawWrappers[t]=void 0},Object.defineProperty(e.prototype,"effect",{get:function(){var t,r;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(r=(t=this._getDrawWrapper())===null||t===void 0?void 0:t.effect)!==null&&r!==void 0?r:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_drawWrapper",{get:function(){var t;return(t=this._mainDrawWrapperOverride)!==null&&t!==void 0?t:this._getDrawWrapper(void 0,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_drawWrapperOverride",{get:function(){return this._mainDrawWrapperOverride},enumerable:!1,configurable:!0}),e.prototype._setMainDrawWrapperOverride=function(t){this._mainDrawWrapperOverride=t},e.prototype.setEffect=function(t,r,i,n){r===void 0&&(r=null),n===void 0&&(n=!0);var s=this._drawWrapper;s.setEffect(t,r,n),i!==void 0&&(s.materialContext=i),t||(s.defines=null,s.materialContext=void 0)},e.prototype.resetDrawCache=function(t){if(this._drawWrappers)if(t!==void 0){this._removeDrawWrapper(t);return}else for(var r=0,i=this._drawWrappers;r<i.length;r++){var n=i[r];n==null||n.dispose()}this._drawWrappers=[]},e.AddToMesh=function(t,r,i,n,s,a,o,l){return l===void 0&&(l=!0),new e(t,r,i,n,s,a,o,l)},Object.defineProperty(e.prototype,"IsGlobal",{get:function(){return this.verticesStart===0&&this.verticesCount===this._mesh.getTotalVertices()&&this.indexStart===0&&this.indexCount===this._mesh.getTotalIndices()},enumerable:!1,configurable:!0}),e.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},e.prototype.setBoundingInfo=function(t){return this._boundingInfo=t,this},e.prototype.getMesh=function(){return this._mesh},e.prototype.getRenderingMesh=function(){return this._renderingMesh},e.prototype.getReplacementMesh=function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null},e.prototype.getEffectiveMesh=function(){var t=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return t||this._renderingMesh},e.prototype.getMaterial=function(t){var r;t===void 0&&(t=!0);var i=(r=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId))!==null&&r!==void 0?r:this._renderingMesh.material;if(i){if(this._isMultiMaterial(i)){var n=i.getSubMaterial(this.materialIndex);return this._currentMaterial!==n&&(this._currentMaterial=n,this.resetDrawCache()),n}}else return t?this._mesh.getScene().defaultMaterial:null;return i},e.prototype._isMultiMaterial=function(t){return t.getSubMaterial!==void 0},e.prototype.refreshBoundingInfo=function(t){if(t===void 0&&(t=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(t||(t=this._renderingMesh.getVerticesData(T.PositionKind)),!t)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var r=this._renderingMesh.getIndices(),i;if(this.indexStart===0&&this.indexCount===r.length){var n=this._renderingMesh.getBoundingInfo();i={minimum:n.minimum.clone(),maximum:n.maximum.clone()}}else i=F(t,r,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new S(i.minimum,i.maximum),this},e.prototype._checkCollision=function(t){var r=this.getBoundingInfo();return r._checkCollision(t)},e.prototype.updateBoundingInfo=function(t){var r=this.getBoundingInfo();return r||(this.refreshBoundingInfo(),r=this.getBoundingInfo()),r&&r.update(t),this},e.prototype.isInFrustum=function(t){var r=this.getBoundingInfo();return r?r.isInFrustum(t,this._mesh.cullingStrategy):!1},e.prototype.isCompletelyInFrustum=function(t){var r=this.getBoundingInfo();return r?r.isCompletelyInFrustum(t):!1},e.prototype.render=function(t){return this._renderingMesh.render(this,t,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},e.prototype._getLinesIndexBuffer=function(t,r){if(!this._linesIndexBuffer){for(var i=[],n=this.indexStart;n<this.indexStart+this.indexCount;n+=3)i.push(t[n],t[n+1],t[n+1],t[n+2],t[n+2],t[n]);this._linesIndexBuffer=r.createIndexBuffer(i),this._linesIndexCount=i.length}return this._linesIndexBuffer},e.prototype.canIntersects=function(t){var r=this.getBoundingInfo();return r?t.intersectsBox(r.boundingBox):!1},e.prototype.intersects=function(t,r,i,n,s){var a=this.getMaterial();if(!a)return null;var o=3,l=!1;switch(a.fillMode){case 3:case 5:case 6:case 8:return null;case 7:o=1,l=!0;break}return a.fillMode===4?i.length?this._intersectLines(t,r,i,this._mesh.intersectionThreshold,n):this._intersectUnIndexedLines(t,r,i,this._mesh.intersectionThreshold,n):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(t,r,i,n,s):this._intersectTriangles(t,r,i,o,l,n,s)},e.prototype._intersectLines=function(t,r,i,n,s){for(var a=null,o=this.indexStart;o<this.indexStart+this.indexCount;o+=2){var l=r[i[o]],h=r[i[o+1]],c=t.intersectionSegment(l,h,n);if(!(c<0)&&(s||!a||c<a.distance)&&(a=new k(null,null,c),a.faceId=o/2,s))break}return a},e.prototype._intersectUnIndexedLines=function(t,r,i,n,s){for(var a=null,o=this.verticesStart;o<this.verticesStart+this.verticesCount;o+=2){var l=r[o],h=r[o+1],c=t.intersectionSegment(l,h,n);if(!(c<0)&&(s||!a||c<a.distance)&&(a=new k(null,null,c),a.faceId=o/2,s))break}return a},e.prototype._intersectTriangles=function(t,r,i,n,s,a,o){for(var l=null,h=-1,c=this.indexStart;c<this.indexStart+this.indexCount-(3-n);c+=n){h++;var p=i[c],d=i[c+1],_=i[c+2];if(s&&_===4294967295){c+=2;continue}var m=r[p],D=r[d],M=r[_];if(!(!m||!D||!M)&&!(o&&!o(m,D,M,t))){var g=t.intersectsTriangle(m,D,M);if(g){if(g.distance<0)continue;if((a||!l||g.distance<l.distance)&&(l=g,l.faceId=h,a))break}}}return l},e.prototype._intersectUnIndexedTriangles=function(t,r,i,n,s){for(var a=null,o=this.verticesStart;o<this.verticesStart+this.verticesCount;o+=3){var l=r[o],h=r[o+1],c=r[o+2];if(!(s&&!s(l,h,c,t))){var p=t.intersectsTriangle(l,h,c);if(p){if(p.distance<0)continue;if((n||!a||p.distance<a.distance)&&(a=p,a.faceId=o/3,n))break}}}return a},e.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},e.prototype.clone=function(t,r){var i=new e(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,r,!1);if(!this.IsGlobal){var n=this.getBoundingInfo();if(!n)return i;i._boundingInfo=new S(n.minimum,n.maximum)}return i},e.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var t=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(t,1),this.resetDrawCache()},e.prototype.getClassName=function(){return"SubMesh"},e.CreateFromIndices=function(t,r,i,n,s,a){a===void 0&&(a=!0);for(var o=Number.MAX_VALUE,l=-Number.MAX_VALUE,h=s||n,c=h.getIndices(),p=r;p<r+i;p++){var d=c[p];d<o&&(o=d),d>l&&(l=d)}return new e(t,o,l-o+1,r,i,n,s,a)},e}(),R=function(){function e(){this.reset()}return e.prototype.reset=function(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681},Object.defineProperty(e.prototype,"func",{get:function(){return this._func},set:function(t){this._func=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcRef",{get:function(){return this._funcRef},set:function(t){this._funcRef=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcMask",{get:function(){return this._funcMask},set:function(t){this._funcMask=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(t){this._opStencilFail=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(t){this._opDepthFail=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(t){this._opStencilDepthPass=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){this._mask=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"MaterialStencilState"},e.prototype.copyTo=function(t){v.Clone(function(){return t},this)},e.prototype.serialize=function(){return v.Serialize(this)},e.prototype.parse=function(t,r,i){var n=this;v.Parse(function(){return n},t,r,i)},u([f()],e.prototype,"func",null),u([f()],e.prototype,"funcRef",null),u([f()],e.prototype,"funcMask",null),u([f()],e.prototype,"opStencilFail",null),u([f()],e.prototype,"opDepthFail",null),u([f()],e.prototype,"opStencilDepthPass",null),u([f()],e.prototype,"mask",null),u([f()],e.prototype,"enabled",null),e}(),y;(function(e){e[e.Created=1]="Created",e[e.Disposed=2]="Disposed",e[e.GetDefineNames=4]="GetDefineNames",e[e.PrepareUniformBuffer=8]="PrepareUniformBuffer",e[e.IsReadyForSubMesh=16]="IsReadyForSubMesh",e[e.PrepareDefines=32]="PrepareDefines",e[e.BindForSubMesh=64]="BindForSubMesh",e[e.PrepareEffect=128]="PrepareEffect",e[e.GetAnimatables=256]="GetAnimatables",e[e.GetActiveTextures=512]="GetActiveTextures",e[e.HasTexture=1024]="HasTexture",e[e.FillRenderTargetTextures=2048]="FillRenderTargetTextures",e[e.HasRenderTargetTextures=4096]="HasRenderTargetTextures",e[e.HardBindForSubMesh=8192]="HardBindForSubMesh"})(y||(y={}));var G=function(){function e(t,r,i){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new R,this._useUBO=!1,this._fillMode=e.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=function(){},this._callbackPluginEventIsReadyForSubMesh=function(){},this._callbackPluginEventPrepareDefines=function(){},this._callbackPluginEventPrepareDefinesBeforeAttributes=function(){},this._callbackPluginEventHardBindForSubMesh=function(){},this._callbackPluginEventBindForSubMesh=function(){},this._callbackPluginEventHasRenderTargetTextures=function(){},this._callbackPluginEventFillRenderTargetTextures=function(){},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=t;var n=r||P.LastCreatedScene;!n||(this._scene=n,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=t||A.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new O(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._scene.useRightHandedSystem?this.sideOrientation=e.ClockWiseSideOrientation:this.sideOrientation=e.CounterClockWiseSideOrientation,this._uniformBuffer=new w(this._scene.getEngine(),void 0,void 0,t),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),e.OnEventObservable.notifyObservers(this,y.Created))}return Object.defineProperty(e.prototype,"canRenderToMRT",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){if(this._alpha!==t){var r=this._alpha;this._alpha=t,(r===1||t===1)&&this.markAsDirty(e.MiscDirtyFlag)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cullBackFaces",{get:function(){return this._cullBackFaces},set:function(t){this._cullBackFaces!==t&&(this._cullBackFaces=t,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRenderTargetTextures",{get:function(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new b),this._onBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBind",{set:function(t){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new b),this._onUnBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onEffectCreatedObservable",{get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new b),this._onEffectCreatedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(t){this._alphaMode!==t&&(this._alphaMode=t,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(t){this._needDepthPrePass!==t&&(this._needDepthPrePass=t,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPrePassCapable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wireframe",{get:function(){switch(this._fillMode){case e.WireFrameFillMode:case e.LineListDrawMode:case e.LineLoopDrawMode:case e.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(t){this.fillMode=t?e.WireFrameFillMode:e.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case e.PointFillMode:case e.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(t){this.fillMode=t?e.PointFillMode:e.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fillMode",{get:function(){return this._fillMode},set:function(t){this._fillMode!==t&&(this._fillMode=t,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!1,configurable:!0}),e.prototype._getDrawWrapper=function(){return this._drawWrapper},e.prototype._setDrawWrapper=function(t){this._drawWrapper=t},e.prototype.toString=function(t){var r="Name: "+this.name;return r},e.prototype.getClassName=function(){return"Material"},Object.defineProperty(e.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!1,configurable:!0}),e.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},e.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},e.prototype.isReady=function(t,r){return!0},e.prototype.isReadyForSubMesh=function(t,r,i){var n=r.materialDefines;return n?(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=n,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh):!1},e.prototype.getEffect=function(){return this._drawWrapper.effect},e.prototype.getScene=function(){return this._scene},Object.defineProperty(e.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._forceAlphaTest=t===e.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_disableAlphaBlending",{get:function(){return this._transparencyMode===e.MATERIAL_OPAQUE||this._transparencyMode===e.MATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),e.prototype.needAlphaBlending=function(){return this._disableAlphaBlending?!1:this.alpha<1},e.prototype.needAlphaBlendingForMesh=function(t){return this._disableAlphaBlending&&t.visibility>=1?!1:this.needAlphaBlending()||t.visibility<1||t.hasVertexAlpha},e.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest},e.prototype._shouldTurnAlphaTestOn=function(t){return!this.needAlphaBlendingForMesh(t)&&this.needAlphaTesting()},e.prototype.getAlphaTestTexture=function(){return null},e.prototype.markDirty=function(){for(var t=this.getScene().meshes,r=0,i=t;r<i.length;r++){var n=i[r];if(!!n.subMeshes)for(var s=0,a=n.subMeshes;s<a.length;s++){var o=a[s];o.getMaterial()===this&&(!o.effect||(o.effect._wasPreviouslyReady=!1,o.effect._wasPreviouslyUsingInstances=null))}}},e.prototype._preBind=function(t,r){r===void 0&&(r=null);var i=this._scene.getEngine(),n=r==null?this.sideOrientation:r,s=n===e.ClockWiseSideOrientation;return i.enableEffect(t||this._getDrawWrapper()),i.setState(this.backFaceCulling,this.zOffset,!1,s,this.cullBackFaces,this.stencil,this.zOffsetUnits),s},e.prototype.bind=function(t,r){},e.prototype.buildUniformLayout=function(){var t=this._uniformBuffer;this._eventInfo.ubo=t,this._callbackPluginEventGeneric(y.PrepareUniformBuffer,this._eventInfo),t.create(),this._uniformBufferLayoutBuilt=!0},e.prototype.bindForSubMesh=function(t,r,i){var n=i.effect;!n||(this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo))},e.prototype.bindOnlyWorldMatrix=function(t){},e.prototype.bindView=function(t){this._useUBO?this._needToBindSceneUbo=!0:t.setMatrix("view",this.getScene().getViewMatrix())},e.prototype.bindViewProjection=function(t){this._useUBO?this._needToBindSceneUbo=!0:(t.setMatrix("viewProjection",this.getScene().getTransformMatrix()),t.setMatrix("projection",this.getScene().getProjectionMatrix()))},e.prototype.bindEyePosition=function(t,r){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(t,r)},e.prototype._afterBind=function(t,r){if(r===void 0&&(r=null),this._scene._cachedMaterial=this,this._needToBindSceneUbo&&r&&(this._needToBindSceneUbo=!1,x.BindSceneUniformBuffer(r,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),t?this._scene._cachedVisibility=t.visibility:this._scene._cachedVisibility=1,this._onBindObservable&&t&&this._onBindObservable.notifyObservers(t),this.disableDepthWrite){var i=this._scene.getEngine();this._cachedDepthWriteState=i.getDepthWrite(),i.setDepthWrite(!1)}if(this.disableColorWrite){var i=this._scene.getEngine();this._cachedColorWriteState=i.getColorWrite(),i.setColorWrite(!1)}if(this.depthFunction!==0){var i=this._scene.getEngine();this._cachedDepthFunctionState=i.getDepthFunction()||0,i.setDepthFunction(this.depthFunction)}},e.prototype.unbind=function(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.depthFunction!==0){var t=this._scene.getEngine();t.setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){var t=this._scene.getEngine();t.setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){var t=this._scene.getEngine();t.setColorWrite(this._cachedColorWriteState)}},e.prototype.getAnimatables=function(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(y.GetAnimatables,this._eventInfo),this._eventInfo.animatables},e.prototype.getActiveTextures=function(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(y.GetActiveTextures,this._eventInfo),this._eventInfo.activeTextures},e.prototype.hasTexture=function(t){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=t,this._callbackPluginEventGeneric(y.HasTexture,this._eventInfo),this._eventInfo.hasTexture},e.prototype.clone=function(t){return null},e.prototype.getBindedMeshes=function(){var t=this;if(this.meshMap){var r=new Array;for(var i in this.meshMap){var n=this.meshMap[i];n&&r.push(n)}return r}else{var s=this._scene.meshes;return s.filter(function(a){return a.material===t})}},e.prototype.forceCompilation=function(t,r,i,n){var s=this,a=B({clipPlane:!1,useInstances:!1},i),o=this.getScene(),l=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;var h=function(){if(!(!s._scene||!s._scene.getEngine())){var c=o.clipPlane;if(a.clipPlane&&(o.clipPlane=new I(0,0,0,1)),s._storeEffectOnSubMeshes){var p=!0,d=null;if(t.subMeshes){var _=new W(0,0,0,0,0,t,void 0,!1,!1);_.materialDefines&&(_.materialDefines._renderId=-1),s.isReadyForSubMesh(t,_,a.useInstances)||(_.effect&&_.effect.getCompilationError()&&_.effect.allFallbacksProcessed()?d=_.effect.getCompilationError():(p=!1,setTimeout(h,16)))}p&&(s.allowShaderHotSwapping=l,d&&n&&n(d),r&&r(s))}else s.isReady()?(s.allowShaderHotSwapping=l,r&&r(s)):setTimeout(h,16);a.clipPlane&&(o.clipPlane=c)}};h()},e.prototype.forceCompilationAsync=function(t,r){var i=this;return new Promise(function(n,s){i.forceCompilation(t,function(){n()},r,function(a){s(a)})})},e.prototype.markAsDirty=function(t){this.getScene().blockMaterialDirtyMechanism||(e._DirtyCallbackArray.length=0,t&e.TextureDirtyFlag&&e._DirtyCallbackArray.push(e._TextureDirtyCallBack),t&e.LightDirtyFlag&&e._DirtyCallbackArray.push(e._LightsDirtyCallBack),t&e.FresnelDirtyFlag&&e._DirtyCallbackArray.push(e._FresnelDirtyCallBack),t&e.AttributesDirtyFlag&&e._DirtyCallbackArray.push(e._AttributeDirtyCallBack),t&e.MiscDirtyFlag&&e._DirtyCallbackArray.push(e._MiscDirtyCallBack),t&e.PrePassDirtyFlag&&e._DirtyCallbackArray.push(e._PrePassDirtyCallBack),e._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(e._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},e.prototype.resetDrawCache=function(){for(var t=this.getScene().meshes,r=0,i=t;r<i.length;r++){var n=i[r];if(!!n.subMeshes)for(var s=0,a=n.subMeshes;s<a.length;s++){var o=a[s];o.getMaterial()===this&&o.resetDrawCache()}}},e.prototype._markAllSubMeshesAsDirty=function(t){if(!this.getScene().blockMaterialDirtyMechanism)for(var r=this.getScene().meshes,i=0,n=r;i<n.length;i++){var s=n[i];if(!!s.subMeshes)for(var a=0,o=s.subMeshes;a<o.length;a++){var l=o[a];if(l.getMaterial(!1)===this)for(var h=0,c=l._drawWrappers;h<c.length;h++){var p=c[h];!p||!p.defines||!p.defines.markAllAsDirty||this._materialContext===p.materialContext&&t(p.defines)}}}},e.prototype._markScenePrePassDirty=function(){if(!this.getScene().blockMaterialDirtyMechanism){var t=this.getScene().enablePrePassRenderer();t&&t.markAsDirty()}},e.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(e._AllDirtyCallBack)},e.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(e._ImageProcessingDirtyCallBack)},e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(e._TextureDirtyCallBack)},e.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(e._FresnelDirtyCallBack)},e.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(e._FresnelAndMiscDirtyCallBack)},e.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(e._LightsDirtyCallBack)},e.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(e._AttributeDirtyCallBack)},e.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)},e.prototype._markAllSubMeshesAsPrePassDirty=function(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)},e.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(e._TextureAndMiscDirtyCallBack)},e.prototype.setPrePassRenderer=function(t){return!1},e.prototype.dispose=function(t,r,i){var n=this.getScene();if(n.stopAnimation(this),n.freeProcessedMaterials(),n.removeMaterial(this),this._eventInfo.forceDisposeTextures=r,this._callbackPluginEventGeneric(y.Disposed,this._eventInfo),this._parentContainer){var s=this._parentContainer.materials.indexOf(this);s>-1&&this._parentContainer.materials.splice(s,1),this._parentContainer=null}if(i!==!0)if(this.meshMap)for(var a in this.meshMap){var o=this.meshMap[a];o&&(o.material=null,this.releaseVertexArrayObject(o,t))}else for(var l=n.meshes,h=0,c=l;h<c.length;h++){var o=c[h];o.material===this&&!o.sourceMesh&&(o.material=null,this.releaseVertexArrayObject(o,t))}this._uniformBuffer.dispose(),t&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()},e.prototype.releaseVertexArrayObject=function(t,r){if(t.geometry){var i=t.geometry;if(this._storeEffectOnSubMeshes)for(var n=0,s=t.subMeshes;n<s.length;n++){var a=s[n];i._releaseVertexArrayObject(a.effect),r&&a.effect&&a.effect.dispose()}else i._releaseVertexArrayObject(this._drawWrapper.effect)}},e.prototype.serialize=function(){var t=v.Serialize(this);return t.stencil=this.stencil.serialize(),t.uniqueId=this.uniqueId,t},e.Parse=function(t,r,i){if(!t.customType)t.customType="BABYLON.StandardMaterial";else if(t.customType==="BABYLON.PBRMaterial"&&t.overloadedAlbedo&&(t.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return C.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null;var n=A.Instantiate(t.customType),s=n.Parse(t,r,i);return s._loadedUniqueId=t.uniqueId,s},e.TriangleFillMode=0,e.WireFrameFillMode=1,e.PointFillMode=2,e.PointListDrawMode=3,e.LineListDrawMode=4,e.LineLoopDrawMode=5,e.LineStripDrawMode=6,e.TriangleStripDrawMode=7,e.TriangleFanDrawMode=8,e.ClockWiseSideOrientation=0,e.CounterClockWiseSideOrientation=1,e.TextureDirtyFlag=1,e.LightDirtyFlag=2,e.FresnelDirtyFlag=4,e.AttributesDirtyFlag=8,e.MiscDirtyFlag=16,e.PrePassDirtyFlag=32,e.AllDirtyFlag=63,e.MATERIAL_OPAQUE=0,e.MATERIAL_ALPHATEST=1,e.MATERIAL_ALPHABLEND=2,e.MATERIAL_ALPHATESTANDBLEND=3,e.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,e.MATERIAL_NORMALBLENDMETHOD_RNM=1,e.OnEventObservable=new b,e._AllDirtyCallBack=function(t){return t.markAllAsDirty()},e._ImageProcessingDirtyCallBack=function(t){return t.markAsImageProcessingDirty()},e._TextureDirtyCallBack=function(t){return t.markAsTexturesDirty()},e._FresnelDirtyCallBack=function(t){return t.markAsFresnelDirty()},e._MiscDirtyCallBack=function(t){return t.markAsMiscDirty()},e._PrePassDirtyCallBack=function(t){return t.markAsPrePassDirty()},e._LightsDirtyCallBack=function(t){return t.markAsLightDirty()},e._AttributeDirtyCallBack=function(t){return t.markAsAttributesDirty()},e._FresnelAndMiscDirtyCallBack=function(t){e._FresnelDirtyCallBack(t),e._MiscDirtyCallBack(t)},e._TextureAndMiscDirtyCallBack=function(t){e._TextureDirtyCallBack(t),e._MiscDirtyCallBack(t)},e._DirtyCallbackArray=[],e._RunDirtyCallBacks=function(t){for(var r=0,i=e._DirtyCallbackArray;r<i.length;r++){var n=i[r];n(t)}},u([f()],e.prototype,"id",void 0),u([f()],e.prototype,"uniqueId",void 0),u([f()],e.prototype,"name",void 0),u([f()],e.prototype,"metadata",void 0),u([f()],e.prototype,"checkReadyOnEveryCall",void 0),u([f()],e.prototype,"checkReadyOnlyOnce",void 0),u([f()],e.prototype,"state",void 0),u([f("alpha")],e.prototype,"_alpha",void 0),u([f("backFaceCulling")],e.prototype,"_backFaceCulling",void 0),u([f("cullBackFaces")],e.prototype,"_cullBackFaces",void 0),u([f()],e.prototype,"sideOrientation",void 0),u([f("alphaMode")],e.prototype,"_alphaMode",void 0),u([f()],e.prototype,"_needDepthPrePass",void 0),u([f()],e.prototype,"disableDepthWrite",void 0),u([f()],e.prototype,"disableColorWrite",void 0),u([f()],e.prototype,"forceDepthWrite",void 0),u([f()],e.prototype,"depthFunction",void 0),u([f()],e.prototype,"separateCullingPass",void 0),u([f("fogEnabled")],e.prototype,"_fogEnabled",void 0),u([f()],e.prototype,"pointSize",void 0),u([f()],e.prototype,"zOffset",void 0),u([f()],e.prototype,"zOffsetUnits",void 0),u([f()],e.prototype,"pointsCloud",null),u([f()],e.prototype,"fillMode",null),u([f()],e.prototype,"transparencyMode",null),e}();export{k as I,G as M,W as S,y as a};
