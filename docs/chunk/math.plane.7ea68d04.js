import{j as h,_ as O,O as G,k as C}from"./precisionDate.1704d4c6.js";import{S as E,s as l,T as D,c as S,d as N,e as A}from"./decorators.5af14a95.js";import{Color4 as b}from"./math.color.d29cb8ed.js";import{Matrix as I,Vector3 as m}from"./math.vector.560c6bc4.js";var M=function(){function e(t){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=t,t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&this._setDefaultValue(i)}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),e.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},e.prototype.markAsUnprocessed=function(){this._isDirty=!0},e.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsLightDirty=function(t){t===void 0&&(t=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||t,this._isDirty=!0},e.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},e.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},e.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},e.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},e.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},e.prototype.rebuild=function(){this._keys.length=0;for(var t=0,i=Object.keys(this);t<i.length;t++){var r=i[t];r[0]!=="_"&&this._keys.push(r)}if(this._externalProperties)for(var n in this._externalProperties)this._keys.indexOf(n)===-1&&this._keys.push(n)},e.prototype.isEqual=function(t){if(this._keys.length!==t._keys.length)return!1;for(var i=0;i<this._keys.length;i++){var r=this._keys[i];if(this[r]!==t[r])return!1}return!0},e.prototype.cloneTo=function(t){this._keys.length!==t._keys.length&&(t._keys=this._keys.slice(0));for(var i=0;i<this._keys.length;i++){var r=this._keys[i];t[r]=this[r]}},e.prototype.reset=function(){var t=this;this._keys.forEach(function(i){return t._setDefaultValue(i)})},e.prototype._setDefaultValue=function(t){var i,r,n,s,a,o=(n=(r=(i=this._externalProperties)===null||i===void 0?void 0:i[t])===null||r===void 0?void 0:r.type)!==null&&n!==void 0?n:typeof this[t],u=(a=(s=this._externalProperties)===null||s===void 0?void 0:s[t])===null||a===void 0?void 0:a.default;switch(o){case"number":this[t]=u!=null?u:0;break;case"string":this[t]=u!=null?u:"";break;default:this[t]=u!=null?u:!1;break}},e.prototype.toString=function(){for(var t="",i=0;i<this._keys.length;i++){var r=this._keys[i],n=this[r],s=typeof n;switch(s){case"number":case"string":t+="#define "+r+" "+n+`
`;break;default:n&&(t+="#define "+r+`
`);break}}return t},e}(),P=function(){function e(){this._dirty=!0,this._tempColor=new b(0,0,0,0),this._globalCurve=new b(0,0,0,0),this._highlightsCurve=new b(0,0,0,0),this._midtonesCurve=new b(0,0,0,0),this._shadowsCurve=new b(0,0,0,0),this._positiveCurve=new b(0,0,0,0),this._negativeCurve=new b(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(e.prototype,"globalHue",{get:function(){return this._globalHue},set:function(t){this._globalHue=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(t){this._globalDensity=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(t){this._globalSaturation=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(t){this._globalExposure=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(t){this._highlightsHue=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(t){this._highlightsDensity=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(t){this._highlightsSaturation=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(t){this._highlightsExposure=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(t){this._midtonesHue=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(t){this._midtonesDensity=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(t){this._midtonesSaturation=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(t){this._midtonesExposure=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(t){this._shadowsHue=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(t){this._shadowsDensity=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(t){this._shadowsSaturation=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(t){this._shadowsExposure=t,this._dirty=!0},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"ColorCurves"},e.Bind=function(t,i,r,n,s){r===void 0&&(r="vCameraColorCurvePositive"),n===void 0&&(n="vCameraColorCurveNeutral"),s===void 0&&(s="vCameraColorCurveNegative"),t._dirty&&(t._dirty=!1,t._getColorGradingDataToRef(t._globalHue,t._globalDensity,t._globalSaturation,t._globalExposure,t._globalCurve),t._getColorGradingDataToRef(t._highlightsHue,t._highlightsDensity,t._highlightsSaturation,t._highlightsExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._highlightsCurve),t._getColorGradingDataToRef(t._midtonesHue,t._midtonesDensity,t._midtonesSaturation,t._midtonesExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._midtonesCurve),t._getColorGradingDataToRef(t._shadowsHue,t._shadowsDensity,t._shadowsSaturation,t._shadowsExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._shadowsCurve),t._highlightsCurve.subtractToRef(t._midtonesCurve,t._positiveCurve),t._midtonesCurve.subtractToRef(t._shadowsCurve,t._negativeCurve)),i&&(i.setFloat4(r,t._positiveCurve.r,t._positiveCurve.g,t._positiveCurve.b,t._positiveCurve.a),i.setFloat4(n,t._midtonesCurve.r,t._midtonesCurve.g,t._midtonesCurve.b,t._midtonesCurve.a),i.setFloat4(s,t._negativeCurve.r,t._negativeCurve.g,t._negativeCurve.b,t._negativeCurve.a))},e.PrepareUniforms=function(t){t.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},e.prototype._getColorGradingDataToRef=function(t,i,r,n,s){t!=null&&(t=e._Clamp(t,0,360),i=e._Clamp(i,-100,100),r=e._Clamp(r,-100,100),n=e._Clamp(n,-100,100),i=e._ApplyColorGradingSliderNonlinear(i),i*=.5,n=e._ApplyColorGradingSliderNonlinear(n),i<0&&(i*=-1,t=(t+180)%360),e._FromHSBToRef(t,i,50+.25*n,s),s.scaleToRef(2,s),s.a=1+.01*r)},e._ApplyColorGradingSliderNonlinear=function(t){t/=100;var i=Math.abs(t);return i=Math.pow(i,2),t<0&&(i*=-1),i*=100,i},e._FromHSBToRef=function(t,i,r,n){var s=e._Clamp(t,0,360),a=e._Clamp(i/100,0,1),o=e._Clamp(r/100,0,1);if(a===0)n.r=o,n.g=o,n.b=o;else{s/=60;var u=Math.floor(s),y=s-u,f=o*(1-a),p=o*(1-a*y),_=o*(1-a*(1-y));switch(u){case 0:n.r=o,n.g=_,n.b=f;break;case 1:n.r=p,n.g=o,n.b=f;break;case 2:n.r=f,n.g=o,n.b=_;break;case 3:n.r=f,n.g=p,n.b=o;break;case 4:n.r=_,n.g=f,n.b=o;break;default:n.r=o,n.g=f,n.b=p;break}}n.a=1},e._Clamp=function(t,i,r){return Math.min(Math.max(t,i),r)},e.prototype.clone=function(){return E.Clone(function(){return new e},this)},e.prototype.serialize=function(){return E.Serialize(this)},e.Parse=function(t){return E.Parse(function(){return new e},t,null,null)},h([l()],e.prototype,"_globalHue",void 0),h([l()],e.prototype,"_globalDensity",void 0),h([l()],e.prototype,"_globalSaturation",void 0),h([l()],e.prototype,"_globalExposure",void 0),h([l()],e.prototype,"_highlightsHue",void 0),h([l()],e.prototype,"_highlightsDensity",void 0),h([l()],e.prototype,"_highlightsSaturation",void 0),h([l()],e.prototype,"_highlightsExposure",void 0),h([l()],e.prototype,"_midtonesHue",void 0),h([l()],e.prototype,"_midtonesDensity",void 0),h([l()],e.prototype,"_midtonesSaturation",void 0),h([l()],e.prototype,"_midtonesExposure",void 0),e}();E._ColorCurvesParser=P.Parse;var U=function(e){O(t,e);function t(){var i=e.call(this)||this;return i.IMAGEPROCESSING=!1,i.VIGNETTE=!1,i.VIGNETTEBLENDMODEMULTIPLY=!1,i.VIGNETTEBLENDMODEOPAQUE=!1,i.TONEMAPPING=!1,i.TONEMAPPING_ACES=!1,i.CONTRAST=!1,i.COLORCURVES=!1,i.COLORGRADING=!1,i.COLORGRADING3D=!1,i.SAMPLER3DGREENDEPTH=!1,i.SAMPLER3DBGRMAP=!1,i.IMAGEPROCESSINGPOSTPROCESS=!1,i.EXPOSURE=!1,i.SKIPFINALCOLORCLAMP=!1,i.rebuild(),i}return t}(M),R=function(){function e(){this.colorCurves=new P,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=e.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new b(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=e.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new G}return Object.defineProperty(e.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(t){this._colorCurvesEnabled!==t&&(this._colorCurvesEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(t){this._colorGradingTexture!==t&&(this._colorGradingTexture=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(t){this._colorGradingEnabled!==t&&(this._colorGradingEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(t){this._colorGradingWithGreenDepth!==t&&(this._colorGradingWithGreenDepth=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(t){this._colorGradingBGR!==t&&(this._colorGradingBGR=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exposure",{get:function(){return this._exposure},set:function(t){this._exposure!==t&&(this._exposure=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(t){this._toneMappingEnabled!==t&&(this._toneMappingEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(t){this._toneMappingType!==t&&(this._toneMappingType=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contrast",{get:function(){return this._contrast},set:function(t){this._contrast!==t&&(this._contrast=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(t){this._vignetteBlendMode!==t&&(this._vignetteBlendMode=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(t){this._vignetteEnabled!==t&&(this._vignetteEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skipFinalColorClamp",{get:function(){return this._skipFinalColorClamp},set:function(t){this._skipFinalColorClamp!==t&&(this._skipFinalColorClamp=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(t){this._applyByPostProcess!==t&&(this._applyByPostProcess=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled!==t&&(this._isEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),e.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},e.prototype.getClassName=function(){return"ImageProcessingConfiguration"},e.PrepareUniforms=function(t,i){i.EXPOSURE&&t.push("exposureLinear"),i.CONTRAST&&t.push("contrast"),i.COLORGRADING&&t.push("colorTransformSettings"),i.VIGNETTE&&(t.push("vInverseScreenSize"),t.push("vignetteSettings1"),t.push("vignetteSettings2")),i.COLORCURVES&&P.PrepareUniforms(t)},e.PrepareSamplers=function(t,i){i.COLORGRADING&&t.push("txColorTransform")},e.prototype.prepareDefines=function(t,i){if(i===void 0&&(i=!1),i!==this.applyByPostProcess||!this._isEnabled){t.VIGNETTE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.IMAGEPROCESSING=!1,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled;return}switch(t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===e._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,t.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case e.TONEMAPPING_ACES:t.TONEMAPPING_ACES=!0;break;default:t.TONEMAPPING_ACES=!1;break}t.CONTRAST=this.contrast!==1,t.EXPOSURE=this.exposure!==1,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING?t.COLORGRADING3D=this.colorGradingTexture.is3D:t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,t.IMAGEPROCESSING=t.VIGNETTE||t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING},e.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},e.prototype.bind=function(t,i){if(this._colorCurvesEnabled&&this.colorCurves&&P.Bind(this.colorCurves,t),this._vignetteEnabled){var r=1/t.getEngine().getRenderWidth(),n=1/t.getEngine().getRenderHeight();t.setFloat2("vInverseScreenSize",r,n);var s=i!=null?i:n/r,a=Math.tan(this.vignetteCameraFov*.5),o=a*s,u=Math.sqrt(o*a);o=D.Mix(o,u,this.vignetteStretch),a=D.Mix(a,u,this.vignetteStretch),t.setFloat4("vignetteSettings1",o,a,-o*this.vignetteCentreX,-a*this.vignetteCentreY);var y=-2*this.vignetteWeight;t.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,y)}if(t.setFloat("exposureLinear",this.exposure),t.setFloat("contrast",this.contrast),this.colorGradingTexture){t.setTexture("txColorTransform",this.colorGradingTexture);var f=this.colorGradingTexture.getSize().height;t.setFloat4("colorTransformSettings",(f-1)/f,.5/f,f,this.colorGradingTexture.level)}},e.prototype.clone=function(){return E.Clone(function(){return new e},this)},e.prototype.serialize=function(){return E.Serialize(this)},e.Parse=function(t){return E.Parse(function(){return new e},t,null,null)},Object.defineProperty(e,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(e,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),e.TONEMAPPING_STANDARD=0,e.TONEMAPPING_ACES=1,e._VIGNETTEMODE_MULTIPLY=0,e._VIGNETTEMODE_OPAQUE=1,h([S()],e.prototype,"colorCurves",void 0),h([l()],e.prototype,"_colorCurvesEnabled",void 0),h([N("colorGradingTexture")],e.prototype,"_colorGradingTexture",void 0),h([l()],e.prototype,"_colorGradingEnabled",void 0),h([l()],e.prototype,"_colorGradingWithGreenDepth",void 0),h([l()],e.prototype,"_colorGradingBGR",void 0),h([l()],e.prototype,"_exposure",void 0),h([l()],e.prototype,"_toneMappingEnabled",void 0),h([l()],e.prototype,"_toneMappingType",void 0),h([l()],e.prototype,"_contrast",void 0),h([l()],e.prototype,"vignetteStretch",void 0),h([l()],e.prototype,"vignetteCentreX",void 0),h([l()],e.prototype,"vignetteCentreY",void 0),h([l()],e.prototype,"vignetteWeight",void 0),h([A()],e.prototype,"vignetteColor",void 0),h([l()],e.prototype,"vignetteCameraFov",void 0),h([l()],e.prototype,"_vignetteBlendMode",void 0),h([l()],e.prototype,"_vignetteEnabled",void 0),h([l()],e.prototype,"_skipFinalColorClamp",void 0),h([l()],e.prototype,"_applyByPostProcess",void 0),h([l()],e.prototype,"_isEnabled",void 0),e}();E._ImageProcessingConfigurationParser=R.Parse;var T=function(){function e(t,i,r,n,s,a,o,u){n===void 0&&(n=0),s===void 0&&(s=!1),a===void 0&&(a=!1),o===void 0&&(o=!1),this._isAlreadyOwned=!1,t.getScene?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=r,this._instanced=a,this._divisor=u||1,i instanceof C?(this._data=null,this._buffer=i):(this._data=i,this._buffer=null),this.byteStride=o?n:n*Float32Array.BYTES_PER_ELEMENT,s||this.create()}return e.prototype.createVertexBuffer=function(t,i,r,n,s,a,o){a===void 0&&(a=!1);var u=a?i:i*Float32Array.BYTES_PER_ELEMENT,y=n?a?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new x(this._engine,this,t,this._updatable,!0,y,s===void 0?this._instanced:s,u,r,void 0,void 0,!0,this._divisor||o)},e.prototype.isUpdatable=function(){return this._updatable},e.prototype.getData=function(){return this._data},e.prototype.getBuffer=function(){return this._buffer},e.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},e.prototype.create=function(t){t===void 0&&(t=null),!(!t&&this._buffer)&&(t=t||this._data,t&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t),this._data=t):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(t),this._data=t):this._buffer=this._engine.createVertexBuffer(t)))},e.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},e.prototype.update=function(t){this.create(t)},e.prototype.updateDirectly=function(t,i,r,n){n===void 0&&(n=!1),!!this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t,n?i:i*Float32Array.BYTES_PER_ELEMENT,r?r*this.byteStride:void 0),i===0&&r===void 0?this._data=t:this._data=null)},e.prototype._increaseReferences=function(){if(!!this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}},e.prototype.dispose=function(){!this._buffer||this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)},e}(),x=function(){function e(t,i,r,n,s,a,o,u,y,f,p,_,d,c){if(p===void 0&&(p=!1),_===void 0&&(_=!1),d===void 0&&(d=1),c===void 0&&(c=!1),i instanceof T?(this._buffer=i,this._ownsBuffer=c):(this._buffer=new T(t,i,n,a,s,o,_),this._ownsBuffer=!0),this.uniqueId=e._Counter++,this._kind=r,f==null){var g=this.getData();this.type=e.FLOAT,g instanceof Int8Array?this.type=e.BYTE:g instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:g instanceof Int16Array?this.type=e.SHORT:g instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:g instanceof Int32Array?this.type=e.INT:g instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)}else this.type=f;var v=e.GetTypeByteLength(this.type);_?(this._size=y||(a?a/v:e.DeduceStride(r)),this.byteStride=a||this._buffer.byteStride||this._size*v,this.byteOffset=u||0):(this._size=y||a||e.DeduceStride(r),this.byteStride=a?a*v:this._buffer.byteStride||this._size*v,this.byteOffset=(u||0)*v),this.normalized=p,this._instanced=o!==void 0?o:!1,this._instanceDivisor=o?d:0,this._computeHashCode()}return Object.defineProperty(e.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(t){this._instanceDivisor=t,t==0?this._instanced=!1:this._instanced=!0,this._computeHashCode()},enumerable:!1,configurable:!0}),e.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},e.prototype._rebuild=function(){!this._buffer||this._buffer._rebuild()},e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getFloatData=function(t,i){var r=this.getData();if(!r)return null;var n=this.getSize()*e.GetTypeByteLength(this.type),s=t*this.getSize();if(this.type!==e.FLOAT||this.byteStride!==n){var a=new Float32Array(s);return this.forEach(s,function(p,_){return a[_]=p}),a}if(!(r instanceof Array||r instanceof Float32Array)||this.byteOffset!==0||r.length!==s)if(r instanceof Array){var o=this.byteOffset/4;return r.slice(o,o+s)}else{if(r instanceof ArrayBuffer)return new Float32Array(r,this.byteOffset,s);var o=r.byteOffset+this.byteOffset;if(i){var u=new Float32Array(s),y=new Float32Array(r.buffer,o,s);return u.set(y),u}var f=o%4;return f&&(o=Math.max(0,o-f)),new Float32Array(r.buffer,o,s)}return i?r.slice():r},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this.byteStride/e.GetTypeByteLength(this.type)},e.prototype.getOffset=function(){return this.byteOffset/e.GetTypeByteLength(this.type)},e.prototype.getSize=function(t){return t===void 0&&(t=!1),t?this._size*e.GetTypeByteLength(this.type):this._size},e.prototype.getIsInstanced=function(){return this._instanced},e.prototype.getInstanceDivisor=function(){return this._instanceDivisor},e.prototype.create=function(t){this._buffer.create(t)},e.prototype.update=function(t){this._buffer.update(t)},e.prototype.updateDirectly=function(t,i,r){r===void 0&&(r=!1),this._buffer.updateDirectly(t,i,void 0,r)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},e.prototype.forEach=function(t,i){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,i)},e.DeduceStride=function(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}},e.GetTypeByteLength=function(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.UNSIGNED_INT:case e.FLOAT:return 4;default:throw new Error("Invalid type '".concat(t,"'"))}},e.ForEach=function(t,i,r,n,s,a,o,u){if(t instanceof Array)for(var y=i/4,f=r/4,p=0;p<a;p+=n){for(var _=0;_<n;_++)u(t[y+_],p+_);y+=f}else for(var d=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),c=e.GetTypeByteLength(s),p=0;p<a;p+=n){for(var g=i,_=0;_<n;_++){var v=e._GetFloatValue(d,s,g,o);u(v,p+_),g+=c}i+=r}},e._GetFloatValue=function(t,i,r,n){switch(i){case e.BYTE:{var s=t.getInt8(r);return n&&(s=Math.max(s/127,-1)),s}case e.UNSIGNED_BYTE:{var s=t.getUint8(r);return n&&(s=s/255),s}case e.SHORT:{var s=t.getInt16(r,!0);return n&&(s=Math.max(s/32767,-1)),s}case e.UNSIGNED_SHORT:{var s=t.getUint16(r,!0);return n&&(s=s/65535),s}case e.INT:return t.getInt32(r,!0);case e.UNSIGNED_INT:return t.getUint32(r,!0);case e.FLOAT:return t.getFloat32(r,!0);default:throw new Error("Invalid component type ".concat(i))}},e._Counter=0,e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.ColorInstanceKind="instanceColor",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e}(),k=function(){function e(t,i,r,n){this.normal=new m(t,i,r),this.d=n}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.getClassName=function(){return"Plane"},e.prototype.getHashCode=function(){var t=this.normal.getHashCode();return t=t*397^(this.d|0),t},e.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return t!==0&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},e.prototype.transform=function(t){var i=e._TmpMatrix;t.invertToRef(i);var r=i.m,n=this.normal.x,s=this.normal.y,a=this.normal.z,o=this.d,u=n*r[0]+s*r[1]+a*r[2]+o*r[3],y=n*r[4]+s*r[5]+a*r[6]+o*r[7],f=n*r[8]+s*r[9]+a*r[10]+o*r[11],p=n*r[12]+s*r[13]+a*r[14]+o*r[15];return new e(u,y,f,p)},e.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},e.prototype.copyFromPoints=function(t,i,r){var n=i.x-t.x,s=i.y-t.y,a=i.z-t.z,o=r.x-t.x,u=r.y-t.y,y=r.z-t.z,f=s*y-a*u,p=a*o-n*y,_=n*u-s*o,d=Math.sqrt(f*f+p*p+_*_),c;return d!==0?c=1/d:c=0,this.normal.x=f*c,this.normal.y=p*c,this.normal.z=_*c,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},e.prototype.isFrontFacingTo=function(t,i){var r=m.Dot(this.normal,t);return r<=i},e.prototype.signedDistanceTo=function(t){return m.Dot(t,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,i,r){var n=new e(0,0,0,0);return n.copyFromPoints(t,i,r),n},e.FromPositionAndNormal=function(t,i){var r=new e(0,0,0,0);return i.normalize(),r.normal=i,r.d=-(i.x*t.x+i.y*t.y+i.z*t.z),r},e.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,r){var n=-(i.x*t.x+i.y*t.y+i.z*t.z);return m.Dot(r,i)+n},e._TmpMatrix=I.Identity(),e}();export{T as B,R as I,M,k as P,x as V,U as a};
