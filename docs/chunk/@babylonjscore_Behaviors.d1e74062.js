import{E as I,a as n,V as w,Q as u,T as l,M as D,e as F,d as N}from"./@babylonjscore_Maths.4b8bfdd1.js";import{P as v}from"./@babylonjscore_Events.25582a49.js";import{P as M,O as P,c as O}from"./@babylonjscore_Misc.5aaba58d.js";import{A as m,B as z,E as V,a as U}from"./@babylonjscore_Animations.f48af9b8.js";import{C as W,M as G,A as T,T as j}from"./@babylonjscore_Meshes.9ddea1c8.js";import{S as Q}from"./@babylonjscore_scene.c0faa314.js";import{R as S}from"./@babylonjscore_Culling.bdb6ff26.js";import{_ as H}from"./tslibtslib.b6e59fa7.js";import{C as E}from"./@babylonjscore_Cameras.05e2a1ea.js";import{X as C,W as x}from"./@babylonjscore_XR.06738b8c.js";var at=function(){function i(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(i.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(e){this._idleRotationSpeed=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(e){this._idleRotationWaitTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(e){this._idleRotationSpinupTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(e){var t=this;this._attachedCamera=e;var a=this._attachedCamera.getScene();this._onPrePointerObservableObserver=a.onPrePointerObservable.add(function(r){if(r.type===v.POINTERDOWN){t._isPointerDown=!0;return}r.type===v.POINTERUP&&(t._isPointerDown=!1)}),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){if(!t._reachTargetAlpha()){var r=M.Now,o=0;t._lastFrameTime!=null&&(o=r-t._lastFrameTime),t._lastFrameTime=r,t._applyUserInteraction();var s=r-t._lastInteractionTime-t._idleRotationWaitTime,c=Math.max(Math.min(s/t._idleRotationSpinupTime,1),0);t._cameraRotationSpeed=t._idleRotationSpeed*c,t._attachedCamera&&(t._attachedCamera.alpha-=t._cameraRotationSpeed*(o/1e3))}})},i.prototype.detach=function(){if(!!this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},i.prototype.resetLastInteractionTime=function(e){this._lastInteractionTime=e!=null?e:M.Now},i.prototype._reachTargetAlpha=function(){return this._attachedCamera&&this.targetAlpha?Math.abs(this._attachedCamera.alpha-this.targetAlpha)<I:!1},i.prototype._userIsZooming=function(){return this._attachedCamera?this._attachedCamera.inertialRadiusOffset!==0:!1},i.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&this._attachedCamera.inertialRadiusOffset!==0&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()},i.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=M.Now)},i.prototype._userIsMoving=function(){return this._attachedCamera?this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown:!1},i}(),rt=function(){function i(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(i.prototype,"name",{get:function(){return"Bouncing"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(e){var t=this;if(this._autoTransitionRange!==e){this._autoTransitionRange=e;var a=this._attachedCamera;!a||(e?this._onMeshTargetChangedObserver=a.onMeshTargetChangedObservable.add(function(r){if(!!r){r.computeWorldMatrix(!0);var o=r.getBoundingInfo().diagonalLength;t.lowerRadiusTransitionRange=o*.05,t.upperRadiusTransitionRange=o*.05}}):this._onMeshTargetChangedObserver&&a.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(e){var t=this;this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){!t._attachedCamera||(t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit)&&t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange),t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit)&&t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))})},i.prototype.detach=function(){!this._attachedCamera||(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},i.prototype._isRadiusAtLimit=function(e){return this._attachedCamera?this._attachedCamera.radius===e&&!this._radiusIsAnimating:!1},i.prototype._applyBoundRadiusAnimation=function(e){var t=this;if(!!this._attachedCamera){this._radiusBounceTransition||(i.EasingFunction.setEasingMode(i.EasingMode),this._radiusBounceTransition=m.CreateAnimation("radius",m.ANIMATIONTYPE_FLOAT,60,i.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var a=m.TransitionTo("radius",this._attachedCamera.radius+e,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return t._clearAnimationLocks()});a&&this._animatables.push(a)}},i.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},i.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},i.EasingFunction=new z(.3),i.EasingMode=V.EASINGMODE_EASEOUT,i}(),ot=function(){function i(){this.onTargetFramingAnimationEndObservable=new P,this._mode=i.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(i.prototype,"name",{get:function(){return"Framing"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(e){this._radiusScale=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"positionScale",{get:function(){return this._positionScale},set:function(e){this._positionScale=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(e){this._defaultElevation=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(e){this._elevationReturnTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(e){this._elevationReturnWaitTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"framingTime",{get:function(){return this._framingTime},set:function(e){this._framingTime=e},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(e){var t=this;this._attachedCamera=e;var a=this._attachedCamera.getScene();i.EasingFunction.setEasingMode(i.EasingMode),this._onPrePointerObservableObserver=a.onPrePointerObservable.add(function(r){if(r.type===v.POINTERDOWN){t._isPointerDown=!0;return}r.type===v.POINTERUP&&(t._isPointerDown=!1)}),this._onMeshTargetChangedObserver=e.onMeshTargetChangedObservable.add(function(r){r&&t.zoomOnMesh(r,void 0,function(){t.onTargetFramingAnimationEndObservable.notifyObservers()})}),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){t._applyUserInteraction(),t._maintainCameraAboveGround()})},i.prototype.detach=function(){if(!!this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},i.prototype.zoomOnMesh=function(e,t,a){t===void 0&&(t=!1),a===void 0&&(a=null),e.computeWorldMatrix(!0);var r=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(r.minimumWorld,r.maximumWorld,t,a)},i.prototype.zoomOnMeshHierarchy=function(e,t,a){t===void 0&&(t=!1),a===void 0&&(a=null),e.computeWorldMatrix(!0);var r=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(r.min,r.max,t,a)},i.prototype.zoomOnMeshesHierarchy=function(e,t,a){t===void 0&&(t=!1),a===void 0&&(a=null);for(var r=new n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=0;s<e.length;s++){var c=e[s].getHierarchyBoundingVectors(!0);n.CheckExtends(c.min,r,o),n.CheckExtends(c.max,r,o)}this.zoomOnBoundingInfo(r,o,t,a)},i.prototype.zoomOnBoundingInfo=function(e,t,a,r){var o=this;a===void 0&&(a=!1),r===void 0&&(r=null);var s;if(!!this._attachedCamera){var c=e.y,h=t.y,_=c+(h-c)*this._positionScale,d=t.subtract(e).scale(.5);if(a)s=new n(0,_,0);else{var g=e.add(d);s=new n(g.x,_,g.z)}this._vectorTransition||(this._vectorTransition=m.CreateAnimation("target",m.ANIMATIONTYPE_VECTOR3,60,i.EasingFunction)),this._betaIsAnimating=!0;var p=m.TransitionTo("target",s,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);p&&this._animatables.push(p);var f=0;if(this._mode===i.FitFrustumSidesMode){var A=this._calculateLowerRadiusFromModelBoundingSphere(e,t);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=d.length()+this._attachedCamera.minZ),f=A}else this._mode===i.IgnoreBoundsSizeMode&&(f=this._calculateLowerRadiusFromModelBoundingSphere(e,t),this.autoCorrectCameraLimitsAndSensibility&&this._attachedCamera.lowerRadiusLimit===null&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var L=t.subtract(e).length();this._attachedCamera.panningSensibility=5e3/L,this._attachedCamera.wheelPrecision=100/f}this._radiusTransition||(this._radiusTransition=m.CreateAnimation("radius",m.ANIMATIONTYPE_FLOAT,60,i.EasingFunction)),p=m.TransitionTo("radius",f,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){o.stopAllAnimations(),r&&r(),o._attachedCamera&&o._attachedCamera.useInputToRestoreState&&o._attachedCamera.storeState()}),p&&this._animatables.push(p)}},i.prototype._calculateLowerRadiusFromModelBoundingSphere=function(e,t){var a=t.subtract(e),r=a.length(),o=this._getFrustumSlope(),s=r*.5,c=s*this._radiusScale,h=c*Math.sqrt(1+1/(o.x*o.x)),_=c*Math.sqrt(1+1/(o.y*o.y)),d=Math.max(h,_),g=this._attachedCamera;return g?(g.lowerRadiusLimit&&this._mode===i.IgnoreBoundsSizeMode&&(d=d<g.lowerRadiusLimit?g.lowerRadiusLimit:d),g.upperRadiusLimit&&(d=d>g.upperRadiusLimit?g.upperRadiusLimit:d),d):0},i.prototype._maintainCameraAboveGround=function(){var e=this;if(!(this._elevationReturnTime<0)){var t=M.Now-this._lastInteractionTime,a=Math.PI*.5-this._defaultElevation,r=Math.PI*.5;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>r&&t>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=m.CreateAnimation("beta",m.ANIMATIONTYPE_FLOAT,60,i.EasingFunction));var o=m.TransitionTo("beta",a,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){e._clearAnimationLocks(),e.stopAllAnimations()});o&&this._animatables.push(o)}}},i.prototype._getFrustumSlope=function(){var e=this._attachedCamera;if(!e)return w.Zero();var t=e.getScene().getEngine(),a=t.getAspectRatio(e),r=Math.tan(e.fov/2),o=r*a;return new w(o,r)},i.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},i.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=M.Now,this.stopAllAnimations(),this._clearAnimationLocks())},i.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(i.prototype,"isUserIsMoving",{get:function(){return this._attachedCamera?this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown:!1},enumerable:!1,configurable:!0}),i.EasingFunction=new U,i.EasingMode=V.EASINGMODE_EASEINOUT,i.IgnoreBoundsSizeMode=0,i.FitFrustumSidesMode=1,i}();(function(){function i(){var e=this;this.delay=0,this.fadeInTime=300,this._millisecondsPerFrame=1e3/60,this._hovered=!1,this._hoverValue=0,this._ownerNode=null,this._update=function(){if(e._ownerNode){if(e._hoverValue+=e._hovered?e._millisecondsPerFrame:-e._millisecondsPerFrame,e._setAllVisibility(e._ownerNode,(e._hoverValue-e.delay)/e.fadeInTime),e._ownerNode.visibility>1){e._setAllVisibility(e._ownerNode,1),e._hoverValue=e.fadeInTime+e.delay;return}else if(e._ownerNode.visibility<0&&(e._setAllVisibility(e._ownerNode,0),e._hoverValue<0)){e._hoverValue=0;return}setTimeout(e._update,e._millisecondsPerFrame)}}}return Object.defineProperty(i.prototype,"name",{get:function(){return"FadeInOut"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(e){this._ownerNode=e,this._setAllVisibility(this._ownerNode,0)},i.prototype.detach=function(){this._ownerNode=null},i.prototype.fadeIn=function(e){this._hovered=e,this._update()},i.prototype._setAllVisibility=function(e,t){var a=this;e.visibility=t,e.getChildMeshes().forEach(function(r){a._setAllVisibility(r,t)})},i})();var k=function(){function i(e){this._useAlternatePickedPointAboveMaxDragAngleDragSpeed=-1.1,this._activeDragButton=-1,this.maxDragAngle=0,this.dragButtons=[0,1,2],this._useAlternatePickedPointAboveMaxDragAngle=!1,this.currentDraggingPointerId=-1,this.dragging=!1,this.dragDeltaRatio=.2,this.updateDragPlane=!0,this._debugMode=!1,this._moving=!1,this.onDragObservable=new P,this.onDragStartObservable=new P,this.onDragEndObservable=new P,this.onEnabledObservable=new P,this.moveAttached=!0,this._enabled=!0,this.startAndReleaseDragOnPointerEvents=!0,this.detachCameraControls=!0,this.useObjectOrientationForDragging=!0,this.validateDrag=function(a){return!0},this._tmpVector=new n(0,0,0),this._alternatePickedPoint=new n(0,0,0),this._worldDragAxis=new n(0,0,0),this._targetPosition=new n(0,0,0),this._attachedToElement=!1,this._startDragRay=new S(new n,new n),this._lastPointerRay={},this._dragDelta=new n,this._pointA=new n(0,0,0),this._pointC=new n(0,0,0),this._localAxis=new n(0,0,0),this._lookAt=new n(0,0,0),this._options=e||{};var t=0;if(this._options.dragAxis&&t++,this._options.dragPlaneNormal&&t++,t>1)throw"Multiple drag modes specified in dragBehavior options. Only one expected"}return Object.defineProperty(i.prototype,"currentDraggingPointerID",{get:function(){return this.currentDraggingPointerId},set:function(e){this.currentDraggingPointerId=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e!=this._enabled&&this.onEnabledObservable.notifyObservers(e),this._enabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"options",{get:function(){return this._options},set:function(e){this._options=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return"PointerDrag"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(e,t){var a=this;this._scene=e.getScene(),e.isNearGrabbable=!0,this.attachedNode=e,i._PlaneScene||(this._debugMode?i._PlaneScene=this._scene:(i._PlaneScene=new Q(this._scene.getEngine(),{virtual:!0}),i._PlaneScene.detachControl(),this._scene.onDisposeObservable.addOnce(function(){i._PlaneScene.dispose(),i._PlaneScene=null}))),this._dragPlane=W("pointerDragPlane",{size:this._debugMode?1:1e4,updatable:!1,sideOrientation:G.DOUBLESIDE},i._PlaneScene),this.lastDragPosition=new n(0,0,0);var r=t||function(o){return a.attachedNode==o||o.isDescendantOf(a.attachedNode)};this._pointerObserver=this._scene.onPointerObservable.add(function(o){if(!a.enabled){a._attachedToElement&&(a.releaseDrag(),a._activeDragButton=-1);return}if(o.type==v.POINTERDOWN)a.startAndReleaseDragOnPointerEvents&&!a.dragging&&o.pickInfo&&o.pickInfo.hit&&o.pickInfo.pickedMesh&&o.pickInfo.pickedPoint&&o.pickInfo.ray&&r(o.pickInfo.pickedMesh)&&a._activeDragButton===-1&&a.dragButtons.indexOf(o.event.button)!==-1&&(a._activeDragButton=o.event.button,a._startDrag(o.event.pointerId,o.pickInfo.ray,o.pickInfo.pickedPoint));else if(o.type==v.POINTERUP)a.startAndReleaseDragOnPointerEvents&&a.currentDraggingPointerId==o.event.pointerId&&a._activeDragButton===o.event.button&&(a.releaseDrag(),a._activeDragButton=-1);else if(o.type==v.POINTERMOVE){var s=o.event.pointerId;if(a.currentDraggingPointerId===i._AnyMouseId&&s!==i._AnyMouseId){var c=o.event,h=c.pointerType==="mouse"||!a._scene.getEngine().hostInformation.isMobile&&c instanceof MouseEvent;h&&(a._lastPointerRay[a.currentDraggingPointerId]&&(a._lastPointerRay[s]=a._lastPointerRay[a.currentDraggingPointerId],delete a._lastPointerRay[a.currentDraggingPointerId]),a.currentDraggingPointerId=s)}a._lastPointerRay[s]||(a._lastPointerRay[s]=new S(new n,new n)),o.pickInfo&&o.pickInfo.ray&&(a._lastPointerRay[s].origin.copyFrom(o.pickInfo.ray.origin),a._lastPointerRay[s].direction.copyFrom(o.pickInfo.ray.direction),a.currentDraggingPointerId==s&&a.dragging&&a._moveDrag(o.pickInfo.ray))}}),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(){if(a._moving&&a.moveAttached){var o=!1;O._RemoveAndStorePivotPoint(a.attachedNode),a._targetPosition.subtractToRef(a.attachedNode.absolutePosition,a._tmpVector),a._tmpVector.scaleInPlace(a.dragDeltaRatio),a.attachedNode.getAbsolutePosition().addToRef(a._tmpVector,a._tmpVector),a.validateDrag(a._tmpVector)&&(a.attachedNode.setAbsolutePosition(a._tmpVector),o=!0),O._RestorePivotPoint(a.attachedNode),o&&a.attachedNode.computeWorldMatrix()}})},i.prototype.releaseDrag=function(){if(this.dragging&&(this.dragging=!1,this.onDragEndObservable.notifyObservers({dragPlanePoint:this.lastDragPosition,pointerId:this.currentDraggingPointerId})),this.currentDraggingPointerId=-1,this._moving=!1,this.detachCameraControls&&this._attachedToElement&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera){if(this._scene.activeCamera.getClassName()==="ArcRotateCamera"){var e=this._scene.activeCamera;e.attachControl(e.inputs?e.inputs.noPreventDefault:!0,e._useCtrlForPanning,e._panningMouseButton)}else this._scene.activeCamera.attachControl(this._scene.activeCamera.inputs?this._scene.activeCamera.inputs.noPreventDefault:!0);this._attachedToElement=!1}},i.prototype.startDrag=function(e,t,a){e===void 0&&(e=i._AnyMouseId),this._startDrag(e,t,a);var r=this._lastPointerRay[e];e===i._AnyMouseId&&(r=this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]),r&&this._moveDrag(r)},i.prototype._startDrag=function(e,t,a){if(!(!this._scene.activeCamera||this.dragging||!this.attachedNode)){O._RemoveAndStorePivotPoint(this.attachedNode),t?(this._startDragRay.direction.copyFrom(t.direction),this._startDragRay.origin.copyFrom(t.origin)):(this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),this.attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),this._tmpVector.subtractToRef(this._scene.activeCamera.position,this._startDragRay.direction)),this._updateDragPlanePosition(this._startDragRay,a||this._tmpVector);var r=this._pickWithRayOnDragPlane(this._startDragRay);r&&(this.dragging=!0,this.currentDraggingPointerId=e,this.lastDragPosition.copyFrom(r),this.onDragStartObservable.notifyObservers({dragPlanePoint:r,pointerId:this.currentDraggingPointerId}),this._targetPosition.copyFrom(this.attachedNode.getAbsolutePosition()),this.detachCameraControls&&this._scene.activeCamera&&this._scene.activeCamera.inputs&&!this._scene.activeCamera.leftCamera&&(this._scene.activeCamera.inputs.attachedToElement?(this._scene.activeCamera.detachControl(),this._attachedToElement=!0):this._attachedToElement=!1)),O._RestorePivotPoint(this.attachedNode)}},i.prototype._moveDrag=function(e){this._moving=!0;var t=this._pickWithRayOnDragPlane(e);if(t){O._RemoveAndStorePivotPoint(this.attachedNode),this.updateDragPlane&&this._updateDragPlanePosition(e,t);var a=0;this._options.dragAxis?(this.useObjectOrientationForDragging?n.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._worldDragAxis):this._worldDragAxis.copyFrom(this._options.dragAxis),t.subtractToRef(this.lastDragPosition,this._tmpVector),a=n.Dot(this._tmpVector,this._worldDragAxis),this._worldDragAxis.scaleToRef(a,this._dragDelta)):(a=this._dragDelta.length(),t.subtractToRef(this.lastDragPosition,this._dragDelta)),this._targetPosition.addInPlace(this._dragDelta),this.onDragObservable.notifyObservers({dragDistance:a,delta:this._dragDelta,dragPlanePoint:t,dragPlaneNormal:this._dragPlane.forward,pointerId:this.currentDraggingPointerId}),this.lastDragPosition.copyFrom(t),O._RestorePivotPoint(this.attachedNode)}},i.prototype._pickWithRayOnDragPlane=function(e){var t=this;if(!e)return null;var a=Math.acos(n.Dot(this._dragPlane.forward,e.direction));if(a>Math.PI/2&&(a=Math.PI-a),this.maxDragAngle>0&&a>this.maxDragAngle)if(this._useAlternatePickedPointAboveMaxDragAngle){this._tmpVector.copyFrom(e.direction),this.attachedNode.absolutePosition.subtractToRef(e.origin,this._alternatePickedPoint),this._alternatePickedPoint.normalize(),this._alternatePickedPoint.scaleInPlace(this._useAlternatePickedPointAboveMaxDragAngleDragSpeed*n.Dot(this._alternatePickedPoint,this._tmpVector)),this._tmpVector.addInPlace(this._alternatePickedPoint);var r=n.Dot(this._dragPlane.forward,this._tmpVector);return this._dragPlane.forward.scaleToRef(-r,this._alternatePickedPoint),this._alternatePickedPoint.addInPlace(this._tmpVector),this._alternatePickedPoint.addInPlace(this.attachedNode.absolutePosition),this._alternatePickedPoint}else return null;var o=i._PlaneScene.pickWithRay(e,function(s){return s==t._dragPlane});return o&&o.hit&&o.pickedMesh&&o.pickedPoint?o.pickedPoint:null},i.prototype._updateDragPlanePosition=function(e,t){this._pointA.copyFrom(t),this._options.dragAxis?(this.useObjectOrientationForDragging?n.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragAxis),e.origin.subtractToRef(this._pointA,this._pointC),this._pointC.normalize(),Math.abs(n.Dot(this._localAxis,this._pointC))>.999?Math.abs(n.Dot(n.UpReadOnly,this._pointC))>.999?this._lookAt.copyFrom(n.Right()):this._lookAt.copyFrom(n.UpReadOnly):(n.CrossToRef(this._localAxis,this._pointC,this._lookAt),n.CrossToRef(this._localAxis,this._lookAt,this._lookAt),this._lookAt.normalize()),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._lookAt,this._lookAt),this._dragPlane.lookAt(this._lookAt)):this._options.dragPlaneNormal?(this.useObjectOrientationForDragging?n.TransformCoordinatesToRef(this._options.dragPlaneNormal,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragPlaneNormal),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._localAxis,this._lookAt),this._dragPlane.lookAt(this._lookAt)):(this._dragPlane.position.copyFrom(this._pointA),this._dragPlane.lookAt(e.origin)),this._dragPlane.position.copyFrom(this.attachedNode.getAbsolutePosition()),this._dragPlane.computeWorldMatrix(!0)},i.prototype.detach=function(){this._lastPointerRay={},this.attachedNode&&(this.attachedNode.isNearGrabbable=!1),this._pointerObserver&&this._scene.onPointerObservable.remove(this._pointerObserver),this._beforeRenderObserver&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this._dragPlane&&this._dragPlane.dispose(),this.releaseDrag(),this._activeDragButton=-1},i._AnyMouseId=-2,i}();(function(){function i(){this._startDistance=0,this._initialScale=new n(0,0,0),this._targetScale=new n(0,0,0),this._sceneRenderObserver=null,this._dragBehaviorA=new k({}),this._dragBehaviorA.moveAttached=!1,this._dragBehaviorB=new k({}),this._dragBehaviorB.moveAttached=!1}return Object.defineProperty(i.prototype,"name",{get:function(){return"MultiPointerScale"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype._getCurrentDistance=function(){return this._dragBehaviorA.lastDragPosition.subtract(this._dragBehaviorB.lastDragPosition).length()},i.prototype.attach=function(e){var t=this;this._ownerNode=e,this._dragBehaviorA.onDragStartObservable.add(function(){t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging&&(t._dragBehaviorA.currentDraggingPointerId==t._dragBehaviorB.currentDraggingPointerId?t._dragBehaviorA.releaseDrag():(t._initialScale.copyFrom(e.scaling),t._startDistance=t._getCurrentDistance()))}),this._dragBehaviorB.onDragStartObservable.add(function(){t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging&&(t._dragBehaviorA.currentDraggingPointerId==t._dragBehaviorB.currentDraggingPointerId?t._dragBehaviorB.releaseDrag():(t._initialScale.copyFrom(e.scaling),t._startDistance=t._getCurrentDistance()))}),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(a){a.onDragObservable.add(function(){if(t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging){var r=t._getCurrentDistance()/t._startDistance;t._initialScale.scaleToRef(r,t._targetScale)}})}),e.addBehavior(this._dragBehaviorA),e.addBehavior(this._dragBehaviorB),this._sceneRenderObserver=e.getScene().onBeforeRenderObservable.add(function(){if(t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging){var a=t._targetScale.subtract(e.scaling).scaleInPlace(.1);a.length()>.01&&e.scaling.addInPlace(a)}})},i.prototype.detach=function(){var e=this;this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(t){t.onDragStartObservable.clear(),t.onDragObservable.clear(),e._ownerNode.removeBehavior(t)})},i})();var B=function(){function i(){this._attachedToElement=!1,this._virtualMeshesInfo={},this._tmpVector=new n,this._tmpQuaternion=new u,this._dragType={NONE:0,DRAG:1,DRAG_WITH_CONTROLLER:2,NEAR_DRAG:3},this._moving=!1,this._dragging=this._dragType.NONE,this.draggableMeshes=null,this.zDragFactor=3,this.currentDraggingPointerIds=[],this.detachCameraControls=!0,this.onDragStartObservable=new P,this.onDragObservable=new P,this.onDragEndObservable=new P,this.allowMultiPointer=!0}return Object.defineProperty(i.prototype,"currentDraggingPointerId",{get:function(){return this.currentDraggingPointerIds[0]!==void 0?this.currentDraggingPointerIds[0]:-1},set:function(e){this.currentDraggingPointerIds[0]=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentDraggingPointerID",{get:function(){return this.currentDraggingPointerId},set:function(e){this.currentDraggingPointerId=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return"BaseSixDofDrag"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isMoving",{get:function(){return this._moving},enumerable:!1,configurable:!0}),i.prototype.init=function(){},Object.defineProperty(i.prototype,"_pointerCamera",{get:function(){return this._scene.cameraToUseForPointers?this._scene.cameraToUseForPointers:this._scene.activeCamera},enumerable:!1,configurable:!0}),i.prototype._createVirtualMeshInfo=function(){var e=new T("",i._virtualScene);e.rotationQuaternion=new u;var t=new T("",i._virtualScene);t.rotationQuaternion=new u;var a=new T("",i._virtualScene);return a.rotationQuaternion=new u,{dragging:!1,moving:!1,dragMesh:e,originMesh:t,pivotMesh:a,startingPivotPosition:new n,startingPivotOrientation:new u,startingPosition:new n,startingOrientation:new u,lastOriginPosition:new n,lastDragPosition:new n}},i.prototype._resetVirtualMeshesPosition=function(){for(var e=0;e<this.currentDraggingPointerIds.length;e++)this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].pivotMesh.position.copyFrom(this._ownerNode.getAbsolutePivotPoint()),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].pivotMesh.rotationQuaternion.copyFrom(this._ownerNode.rotationQuaternion),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].startingPivotPosition.copyFrom(this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].pivotMesh.position),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].startingPivotOrientation.copyFrom(this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].pivotMesh.rotationQuaternion),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].startingPosition.copyFrom(this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].dragMesh.position),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].startingOrientation.copyFrom(this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].dragMesh.rotationQuaternion)},i.prototype._pointerUpdate2D=function(e,t,a){this._pointerCamera&&this._pointerCamera.cameraRigMode==E.RIG_MODE_NONE&&!this._pointerCamera._isLeftCamera&&!this._pointerCamera._isRightCamera&&(e.origin.copyFrom(this._pointerCamera.globalPosition),a=0);var r=this._virtualMeshesInfo[t],o=l.Vector3[0];e.origin.subtractToRef(r.lastOriginPosition,o),r.lastOriginPosition.copyFrom(e.origin);var s=-n.Dot(o,e.direction);r.originMesh.addChild(r.dragMesh),r.originMesh.addChild(r.pivotMesh),this._applyZOffset(r.dragMesh,s,a),this._applyZOffset(r.pivotMesh,s,a),r.originMesh.position.copyFrom(e.origin);var c=l.Vector3[0];e.origin.addToRef(e.direction,c),r.originMesh.lookAt(c),r.originMesh.removeChild(r.dragMesh),r.originMesh.removeChild(r.pivotMesh)},i.prototype._pointerUpdateXR=function(e,t,a,r){var o=this._virtualMeshesInfo[a];if(o.originMesh.position.copyFrom(e.position),this._dragging===this._dragType.NEAR_DRAG&&t?o.originMesh.rotationQuaternion.copyFrom(t.rotationQuaternion):o.originMesh.rotationQuaternion.copyFrom(e.rotationQuaternion),o.pivotMesh.computeWorldMatrix(!0),o.dragMesh.computeWorldMatrix(!0),r!==0){var s=l.Vector3[0],c=l.Vector3[1];s.copyFrom(this._pointerCamera.getForwardRay().direction),o.originMesh.position.subtractToRef(o.lastOriginPosition,c),o.lastOriginPosition.copyFrom(o.originMesh.position);var h=c.length();c.normalize();var _=l.Vector3[2],d=l.Vector3[3];o.dragMesh.absolutePosition.subtractToRef(this._pointerCamera.globalPosition,_),o.dragMesh.absolutePosition.subtractToRef(o.originMesh.position,d);var g=d.length();_.normalize(),d.normalize();var p=Math.abs(n.Dot(c,d))*n.Dot(c,s),f=p*r*h*g,A=.01;f<0&&A-g>f&&(f=Math.min(A-g,0)),d.scaleInPlace(f),d.addToRef(o.pivotMesh.absolutePosition,this._tmpVector),o.pivotMesh.setAbsolutePosition(this._tmpVector),d.addToRef(o.dragMesh.absolutePosition,this._tmpVector),o.dragMesh.setAbsolutePosition(this._tmpVector)}},i.prototype.attach=function(e){var t=this;this._ownerNode=e,this._scene=this._ownerNode.getScene(),i._virtualScene||(i._virtualScene=new Q(this._scene.getEngine(),{virtual:!0}),i._virtualScene.detachControl());var a=function(r){return t._ownerNode===r||r.isDescendantOf(t._ownerNode)&&(!t.draggableMeshes||t.draggableMeshes.indexOf(r)!==-1)};this._pointerObserver=this._scene.onPointerObservable.add(function(r){var o=r.event.pointerId;t._virtualMeshesInfo[o]||(t._virtualMeshesInfo[o]=t._createVirtualMeshInfo());var s=t._virtualMeshesInfo[o],c=r.event.pointerType==="xr";if(r.type==v.POINTERDOWN){if(!s.dragging&&r.pickInfo&&r.pickInfo.hit&&r.pickInfo.pickedMesh&&r.pickInfo.pickedPoint&&r.pickInfo.ray&&(!c||r.pickInfo.aimTransform)&&a(r.pickInfo.pickedMesh)){if(!t.allowMultiPointer&&t.currentDraggingPointerIds.length>0)return;t._pointerCamera&&t._pointerCamera.cameraRigMode===E.RIG_MODE_NONE&&!t._pointerCamera._isLeftCamera&&!t._pointerCamera._isRightCamera&&r.pickInfo.ray.origin.copyFrom(t._pointerCamera.globalPosition),t._ownerNode.computeWorldMatrix(!0);var h=t._virtualMeshesInfo[o];c?(t._dragging=r.pickInfo.originMesh?t._dragType.NEAR_DRAG:t._dragType.DRAG_WITH_CONTROLLER,h.originMesh.position.copyFrom(r.pickInfo.aimTransform.position),t._dragging===t._dragType.NEAR_DRAG&&r.pickInfo.gripTransform?h.originMesh.rotationQuaternion.copyFrom(r.pickInfo.gripTransform.rotationQuaternion):h.originMesh.rotationQuaternion.copyFrom(r.pickInfo.aimTransform.rotationQuaternion)):(t._dragging=t._dragType.DRAG,h.originMesh.position.copyFrom(r.pickInfo.ray.origin)),h.lastOriginPosition.copyFrom(h.originMesh.position),h.dragMesh.position.copyFrom(r.pickInfo.pickedPoint),h.lastDragPosition.copyFrom(r.pickInfo.pickedPoint),h.pivotMesh.position.copyFrom(t._ownerNode.getAbsolutePivotPoint()),h.pivotMesh.rotationQuaternion.copyFrom(t._ownerNode.absoluteRotationQuaternion),h.startingPosition.copyFrom(h.dragMesh.position),h.startingPivotPosition.copyFrom(h.pivotMesh.position),h.startingOrientation.copyFrom(h.dragMesh.rotationQuaternion),h.startingPivotOrientation.copyFrom(h.pivotMesh.rotationQuaternion),c?(h.originMesh.addChild(h.dragMesh),h.originMesh.addChild(h.pivotMesh)):h.originMesh.lookAt(h.dragMesh.position),h.dragging=!0,t.currentDraggingPointerIds.indexOf(o)===-1&&t.currentDraggingPointerIds.push(o),t.detachCameraControls&&t._pointerCamera&&!t._pointerCamera.leftCamera&&(t._pointerCamera.inputs&&t._pointerCamera.inputs.attachedToElement?(t._pointerCamera.detachControl(),t._attachedToElement=!0):t._attachedToElement=!1),t._targetDragStart(h.pivotMesh.position,h.pivotMesh.rotationQuaternion,o),t.onDragStartObservable.notifyObservers({position:h.pivotMesh.position})}}else if(r.type==v.POINTERUP||r.type==v.POINTERDOUBLETAP){var _=t.currentDraggingPointerIds.indexOf(o);s.dragging=!1,_!==-1&&(t.currentDraggingPointerIds.splice(_,1),t.currentDraggingPointerIds.length===0&&(t._moving=!1,t._dragging=t._dragType.NONE,t.detachCameraControls&&t._attachedToElement&&t._pointerCamera&&!t._pointerCamera.leftCamera&&(t._pointerCamera.attachControl(!0),t._attachedToElement=!1)),s.originMesh.removeChild(s.dragMesh),s.originMesh.removeChild(s.pivotMesh),t._targetDragEnd(o),t.onDragEndObservable.notifyObservers({}))}else if(r.type==v.POINTERMOVE){var _=t.currentDraggingPointerIds.indexOf(o);if(_!==-1&&s.dragging&&r.pickInfo&&(r.pickInfo.ray||r.pickInfo.aimTransform)){var d=t.zDragFactor;(t.currentDraggingPointerIds.length>1||r.pickInfo.originMesh)&&(d=0),t._ownerNode.computeWorldMatrix(!0),c?t._pointerUpdateXR(r.pickInfo.aimTransform,r.pickInfo.gripTransform,o,d):t._pointerUpdate2D(r.pickInfo.ray,o,d),t._tmpQuaternion.copyFrom(s.startingPivotOrientation),t._tmpQuaternion.x=-t._tmpQuaternion.x,t._tmpQuaternion.y=-t._tmpQuaternion.y,t._tmpQuaternion.z=-t._tmpQuaternion.z,s.pivotMesh.absoluteRotationQuaternion.multiplyToRef(t._tmpQuaternion,t._tmpQuaternion),s.pivotMesh.absolutePosition.subtractToRef(s.startingPivotPosition,t._tmpVector),t.onDragObservable.notifyObservers({delta:t._tmpVector,position:s.pivotMesh.position,pickInfo:r.pickInfo}),t._targetDrag(t._tmpVector,t._tmpQuaternion,o),s.lastDragPosition.copyFrom(s.dragMesh.absolutePosition),t._moving=!0}}})},i.prototype._applyZOffset=function(e,t,a){e.position.z-=e.position.z<1?t*a:t*a*e.position.z,e.position.z<0&&(e.position.z=0)},i.prototype._targetDragStart=function(e,t,a){},i.prototype._targetDrag=function(e,t,a){},i.prototype._targetDragEnd=function(e){},i.prototype.detach=function(){this._scene&&(this.detachCameraControls&&this._attachedToElement&&this._pointerCamera&&!this._pointerCamera.leftCamera&&(this._pointerCamera.attachControl(!0),this._attachedToElement=!1),this._scene.onPointerObservable.remove(this._pointerObserver));for(var e in this._virtualMeshesInfo)this._virtualMeshesInfo[e].originMesh.dispose(),this._virtualMeshesInfo[e].dragMesh.dispose();this.onDragEndObservable.clear(),this.onDragObservable.clear(),this.onDragStartObservable.clear()},i}(),nt=function(i){H(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t._sceneRenderObserver=null,t._targetPosition=new n(0,0,0),t._targetOrientation=new u,t._targetScaling=new n(1,1,1),t._startingPosition=new n(0,0,0),t._startingOrientation=new u,t._startingScaling=new n(1,1,1),t.onPositionChangedObservable=new P,t.dragDeltaRatio=.2,t.rotateDraggedObject=!0,t.rotateAroundYOnly=!1,t.rotateWithMotionController=!0,t.disableMovement=!1,t.faceCameraOnDragStart=!1,t}return Object.defineProperty(e.prototype,"name",{get:function(){return"SixDofDrag"},enumerable:!1,configurable:!0}),e.prototype.attach=function(t){var a=this;i.prototype.attach.call(this,t),t.isNearGrabbable=!0,this._virtualTransformNode=new j("virtual_sixDof",B._virtualScene),this._virtualTransformNode.rotationQuaternion=u.Identity(),this._sceneRenderObserver=t.getScene().onBeforeRenderObservable.add(function(){if(a.currentDraggingPointerIds.length===1&&a._moving&&!a.disableMovement){var r=t.parent;t.setParent(null),t.position.addInPlace(a._targetPosition.subtract(t.position).scale(a.dragDeltaRatio)),a.onPositionChangedObservable.notifyObservers({position:t.absolutePosition}),(!r||r.scaling&&!r.scaling.isNonUniformWithinEpsilon(.001))&&u.SlerpToRef(t.rotationQuaternion,a._targetOrientation,a.dragDeltaRatio,t.rotationQuaternion),t.setParent(r)}})},e.prototype._getPositionOffsetAround=function(t,a,r){var o=l.Matrix[0],s=l.Matrix[1],c=l.Matrix[2],h=l.Matrix[3],_=l.Matrix[4];return D.TranslationToRef(t.x,t.y,t.z,o),D.TranslationToRef(-t.x,-t.y,-t.z,s),D.FromQuaternionToRef(r,c),D.ScalingToRef(a,a,a,h),s.multiplyToRef(c,_),_.multiplyToRef(h,_),_.multiplyToRef(o,_),_.getTranslation()},e.prototype._onePointerPositionUpdated=function(t,a){var r=l.Vector3[0];r.setAll(0),this._dragging===this._dragType.DRAG?this.rotateDraggedObject&&(this.rotateAroundYOnly?u.RotationYawPitchRollToRef(a.toEulerAngles().y,0,0,l.Quaternion[0]):l.Quaternion[0].copyFrom(a),l.Quaternion[0].multiplyToRef(this._startingOrientation,this._targetOrientation)):(this._dragging===this._dragType.NEAR_DRAG||this._dragging===this._dragType.DRAG_WITH_CONTROLLER&&this.rotateWithMotionController)&&a.multiplyToRef(this._startingOrientation,this._targetOrientation),this._targetPosition.copyFrom(this._startingPosition).addInPlace(t)},e.prototype._twoPointersPositionUpdated=function(){var t=this._virtualMeshesInfo[this.currentDraggingPointerIds[0]].startingPosition,a=this._virtualMeshesInfo[this.currentDraggingPointerIds[1]].startingPosition,r=l.Vector3[0];t.addToRef(a,r),r.scaleInPlace(.5);var o=l.Vector3[1];a.subtractToRef(t,o);var s=this._virtualMeshesInfo[this.currentDraggingPointerIds[0]].dragMesh.absolutePosition,c=this._virtualMeshesInfo[this.currentDraggingPointerIds[1]].dragMesh.absolutePosition,h=l.Vector3[2];s.addToRef(c,h),h.scaleInPlace(.5);var _=l.Vector3[3];c.subtractToRef(s,_);var d=_.length()/o.length(),g=h.subtract(r),p=u.FromEulerAngles(0,n.GetAngleBetweenVectorsOnPlane(o.normalize(),_.normalize(),n.UpReadOnly),0),f=this._ownerNode.parent;this._ownerNode.setParent(null);var A=this._getPositionOffsetAround(r.subtract(this._virtualTransformNode.getAbsolutePivotPoint()),d,p);this._virtualTransformNode.rotationQuaternion.multiplyToRef(p,this._ownerNode.rotationQuaternion),this._virtualTransformNode.scaling.scaleToRef(d,this._ownerNode.scaling),this._virtualTransformNode.position.addToRef(g.addInPlace(A),this._ownerNode.position),this.onPositionChangedObservable.notifyObservers({position:this._ownerNode.position}),this._ownerNode.setParent(f)},e.prototype._targetDragStart=function(){var t=this.currentDraggingPointerIds.length,a=this._ownerNode.parent;this._ownerNode.rotationQuaternion||(this._ownerNode.rotationQuaternion=u.RotationYawPitchRoll(this._ownerNode.rotation.y,this._ownerNode.rotation.x,this._ownerNode.rotation.z));var r=this._ownerNode.getAbsolutePivotPoint();if(this._ownerNode.setParent(null),t===1){if(this._targetPosition.copyFrom(this._ownerNode.position),this._targetOrientation.copyFrom(this._ownerNode.rotationQuaternion),this._targetScaling.copyFrom(this._ownerNode.scaling),this.faceCameraOnDragStart&&this._scene.activeCamera){var o=l.Vector3[0];this._scene.activeCamera.position.subtractToRef(r,o),o.normalize();var s=l.Quaternion[0];this._scene.useRightHandedSystem?u.FromLookDirectionRHToRef(o,new n(0,1,0),s):u.FromLookDirectionLHToRef(o,new n(0,1,0),s),s.normalize(),u.RotationYawPitchRollToRef(s.toEulerAngles().y,0,0,l.Quaternion[0]),this._targetOrientation.copyFrom(l.Quaternion[0])}this._startingPosition.copyFrom(this._targetPosition),this._startingOrientation.copyFrom(this._targetOrientation),this._startingScaling.copyFrom(this._targetScaling)}else t===2&&(this._virtualTransformNode.setPivotPoint(new n(0,0,0),F.LOCAL),this._virtualTransformNode.position.copyFrom(this._ownerNode.position),this._virtualTransformNode.scaling.copyFrom(this._ownerNode.scaling),this._virtualTransformNode.rotationQuaternion.copyFrom(this._ownerNode.rotationQuaternion),this._virtualTransformNode.setPivotPoint(r,F.WORLD),this._resetVirtualMeshesPosition());this._ownerNode.setParent(a)},e.prototype._targetDrag=function(t,a){this.currentDraggingPointerIds.length===1?this._onePointerPositionUpdated(t,a):this.currentDraggingPointerIds.length===2&&this._twoPointersPositionUpdated()},e.prototype._targetDragEnd=function(){if(this.currentDraggingPointerIds.length===1){this._resetVirtualMeshesPosition();var t=this.faceCameraOnDragStart;this.faceCameraOnDragStart=!1,this._targetDragStart(),this.faceCameraOnDragStart=t}},e.prototype.detach=function(){i.prototype.detach.call(this),this._ownerNode&&(this._ownerNode.isNearGrabbable=!1,this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver)),this._virtualTransformNode&&this._virtualTransformNode.dispose()},e}(B);(function(){function i(){this._attachPointLocalOffset=new n,this._workingPosition=new n,this._workingQuaternion=new u,this._lastTick=-1,this._hit=!1,this.hitNormalOffset=.05,this.meshes=[],this.interpolatePose=!0,this.lerpTime=250,this.keepOrientationVertical=!0,this.enabled=!0,this.maxStickingDistance=.8}return Object.defineProperty(i.prototype,"name",{get:function(){return"SurfaceMagnetism"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(e,t){this._attachedMesh=e,this._scene=t||e.getScene(),this._attachedMesh.rotationQuaternion||(this._attachedMesh.rotationQuaternion=u.RotationYawPitchRoll(this._attachedMesh.rotation.y,this._attachedMesh.rotation.x,this._attachedMesh.rotation.z)),this.updateAttachPoint(),this._workingPosition.copyFrom(this._attachedMesh.position),this._workingQuaternion.copyFrom(this._attachedMesh.rotationQuaternion),this._addObservables()},i.prototype.detach=function(){this._attachedMesh=null,this._removeObservables()},i.prototype._getTargetPose=function(e){if(!this._attachedMesh)return null;if(e&&e.hit){var t=e.getNormal(!0,!0),a=e.pickedPoint;if(!t||!a)return null;t.normalize();var r=l.Vector3[0];return r.copyFrom(t),r.scaleInPlace(this.hitNormalOffset),r.addInPlace(a),this._attachedMesh.parent&&(l.Matrix[0].copyFrom(this._attachedMesh.parent.getWorldMatrix()).invert(),n.TransformNormalToRef(r,l.Matrix[0],r)),{position:r,quaternion:u.RotationYawPitchRoll(-Math.atan2(t.x,-t.z),this.keepOrientationVertical?0:Math.atan2(t.y,Math.sqrt(t.z*t.z+t.x*t.x)),0)}}return null},i.prototype.updateAttachPoint=function(){this._getAttachPointOffsetToRef(this._attachPointLocalOffset)},i.prototype.findAndUpdateTarget=function(e){if(this._hit=!1,!e.ray)return!1;var t=e.ray.intersectsMeshes(this.meshes)[0];if(this._attachedMesh&&t&&t.hit&&t.pickedMesh){var a=this._getTargetPose(t);a&&n.Distance(this._attachedMesh.position,a.position)<this.maxStickingDistance&&(this._workingPosition.copyFrom(a.position),this._workingQuaternion.copyFrom(a.quaternion),this._hit=!0)}return this._hit},i.prototype._getAttachPointOffsetToRef=function(e){if(!this._attachedMesh){e.setAll(0);return}var t=l.Quaternion[0];t.copyFrom(this._attachedMesh.rotationQuaternion),this._attachedMesh.rotationQuaternion.copyFromFloats(0,0,0,1),this._attachedMesh.computeWorldMatrix();var a=this._attachedMesh.getHierarchyBoundingVectors(),r=l.Vector3[0];a.max.addToRef(a.min,r),r.scaleInPlace(.5),r.z=a.max.z;var o=l.Matrix[0];this._attachedMesh.getWorldMatrix().invertToRef(o),n.TransformCoordinatesToRef(r,o,e),this._attachedMesh.rotationQuaternion.copyFrom(t)},i.prototype._updateTransformToGoal=function(e){if(!(!this._attachedMesh||!this._hit)){var t=this._attachedMesh.parent;this._attachedMesh.setParent(null);var a=l.Vector3[0];if(n.TransformNormalToRef(this._attachPointLocalOffset,this._attachedMesh.getWorldMatrix(),a),!this.interpolatePose){this._attachedMesh.position.copyFrom(this._workingPosition).subtractInPlace(a),this._attachedMesh.rotationQuaternion.copyFrom(this._workingQuaternion);return}var r=new n;n.SmoothToRef(this._attachedMesh.position,this._workingPosition,e,this.lerpTime,r),this._attachedMesh.position.copyFrom(r);var o=new u;o.copyFrom(this._attachedMesh.rotationQuaternion),u.SmoothToRef(o,this._workingQuaternion,e,this.lerpTime,this._attachedMesh.rotationQuaternion),this._attachedMesh.setParent(t)}},i.prototype._addObservables=function(){var e=this;this._pointerObserver=this._scene.onPointerObservable.add(function(t){e.enabled&&t.type==v.POINTERMOVE&&t.pickInfo&&e.findAndUpdateTarget(t.pickInfo)}),this._lastTick=Date.now(),this._onBeforeRender=this._scene.onBeforeRenderObservable.add(function(){var t=Date.now();e._updateTransformToGoal(t-e._lastTick),e._lastTick=t})},i.prototype._removeObservables=function(){this._scene.onPointerObservable.remove(this._pointerObserver),this._scene.onBeforeRenderObservable.remove(this._onBeforeRender),this._pointerObserver=null,this._onBeforeRender=null},i})();(function(){function i(){this._tmpQuaternion=new u,this._tmpVectors=[new n,new n,new n,new n,new n,new n,new n],this._tmpMatrix=new D,this._tmpInvertView=new D,this._tmpForward=new n,this._tmpNodeForward=new n,this._tmpPosition=new n,this._workingPosition=new n,this._workingQuaternion=new u,this._lastTick=-1,this._recenterNextUpdate=!0,this.interpolatePose=!0,this.lerpTime=500,this.ignoreCameraPitchAndRoll=!1,this.pitchOffset=15,this.maxViewVerticalDegrees=30,this.maxViewHorizontalDegrees=30,this.orientToCameraDeadzoneDegrees=60,this.ignoreDistanceClamp=!1,this.ignoreAngleClamp=!1,this.verticalMaxDistance=0,this.defaultDistance=.8,this.maximumDistance=2,this.minimumDistance=.3,this.useFixedVerticalOffset=!1,this.fixedVerticalOffset=0,this._enabled=!0}return Object.defineProperty(i.prototype,"followedCamera",{get:function(){return this._followedCamera||this._scene.activeCamera},set:function(e){this._followedCamera=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return"Follow"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(e,t){this._scene=e.getScene(),this.attachedNode=e,t&&(this.followedCamera=t),this._addObservables()},i.prototype.detach=function(){this.attachedNode=null,this._removeObservables()},i.prototype.recenter=function(){this._recenterNextUpdate=!0},i.prototype._angleBetweenVectorAndPlane=function(e,t){return this._tmpVectors[0].copyFrom(e),e=this._tmpVectors[0],this._tmpVectors[1].copyFrom(t),t=this._tmpVectors[1],e.normalize(),t.normalize(),Math.PI/2-Math.acos(n.Dot(e,t))},i.prototype._length2D=function(e){return Math.sqrt(e.x*e.x+e.z*e.z)},i.prototype._distanceClamp=function(e,t){t===void 0&&(t=!1);var a=this.minimumDistance,r=this.maximumDistance,o=this.defaultDistance,s=this._tmpVectors[0];s.copyFrom(e);var c=s.length();if(s.normalizeFromLength(c),this.ignoreCameraPitchAndRoll){a=this._length2D(s)*a,r=this._length2D(s)*r;var h=this._length2D(e);s.scaleInPlace(c/h),c=h}var _=c;return t?_=o:_=N.Clamp(c,a,r),e.copyFrom(s).scaleInPlace(_),c!==_},i.prototype._applyVerticalClamp=function(e){this.verticalMaxDistance!==0&&(e.y=N.Clamp(e.y,-this.verticalMaxDistance,this.verticalMaxDistance))},i.prototype._toOrientationQuatToRef=function(e,t){u.RotationYawPitchRollToRef(Math.atan2(e.x,e.z),Math.atan2(e.y,Math.sqrt(e.z*e.z+e.x*e.x)),0,t)},i.prototype._applyPitchOffset=function(e){var t=this._tmpVectors[0],a=this._tmpVectors[1];t.copyFromFloats(0,0,this._scene.useRightHandedSystem?-1:1),a.copyFromFloats(1,0,0),n.TransformNormalToRef(t,e,t),t.y=0,t.normalize(),n.TransformNormalToRef(a,e,a),u.RotationAxisToRef(a,this.pitchOffset*Math.PI/180,this._tmpQuaternion),t.rotateByQuaternionToRef(this._tmpQuaternion,t),this._toOrientationQuatToRef(t,this._tmpQuaternion),this._tmpQuaternion.toRotationMatrix(this._tmpMatrix),e.copyFrom(this._tmpMatrix)},i.prototype._angularClamp=function(e,t){var a=this._tmpVectors[5];a.copyFromFloats(0,0,this._scene.useRightHandedSystem?-1:1);var r=this._tmpVectors[6];r.copyFromFloats(1,0,0),n.TransformNormalToRef(a,e,a),n.TransformNormalToRef(r,e,r);var o=n.UpReadOnly,s=t.length();if(s<I)return!1;var c=!1,h=this._tmpQuaternion;if(this.ignoreCameraPitchAndRoll){var _=n.GetAngleBetweenVectorsOnPlane(t,a,r);u.RotationAxisToRef(r,_,h),t.rotateByQuaternionToRef(h,t)}else{var d=-n.GetAngleBetweenVectorsOnPlane(t,a,r),g=this.maxViewVerticalDegrees*Math.PI/180*.5;d<-g?(u.RotationAxisToRef(r,-d-g,h),t.rotateByQuaternionToRef(h,t),c=!0):d>g&&(u.RotationAxisToRef(r,-d+g,h),t.rotateByQuaternionToRef(h,t),c=!0)}var p=this._angleBetweenVectorAndPlane(t,r)*(this._scene.useRightHandedSystem?-1:1),f=this.maxViewHorizontalDegrees*Math.PI/180*.5;return p<-f?(u.RotationAxisToRef(o,-p-f,h),t.rotateByQuaternionToRef(h,t),c=!0):p>f&&(u.RotationAxisToRef(o,-p+f,h),t.rotateByQuaternionToRef(h,t),c=!0),c},i.prototype._orientationClamp=function(e,t){var a,r=this._tmpVectors[0];r.copyFrom(e).scaleInPlace(-1).normalize();var o=this._tmpVectors[1],s=this._tmpVectors[2];o.copyFromFloats(0,1,0),n.CrossToRef(r,o,s);var c=s.length();c<I||(s.normalizeFromLength(c),n.CrossToRef(s,r,o),!((a=this.attachedNode)===null||a===void 0)&&a.getScene().useRightHandedSystem?u.FromLookDirectionRHToRef(r,o,t):u.FromLookDirectionLHToRef(r,o,t))},i.prototype._passedOrientationDeadzone=function(e,t){var a=this._tmpVectors[5];a.copyFrom(e),a.normalize();var r=Math.abs(n.GetAngleBetweenVectorsOnPlane(t,a,n.UpReadOnly));return r*180/Math.PI>this.orientToCameraDeadzoneDegrees},i.prototype._updateLeashing=function(e){if(this.attachedNode&&this._enabled){var t=this.attachedNode.parent;this.attachedNode.setParent(null);var a=this.attachedNode.getWorldMatrix(),r=this._workingPosition,o=this._workingQuaternion,s=this.attachedNode.getPivotPoint(),c=this._tmpInvertView;c.copyFrom(e.getViewMatrix()),c.invert(),n.TransformCoordinatesToRef(s,a,r);var h=this._tmpPosition;h.copyFromFloats(0,0,0),n.TransformCoordinatesToRef(h,a,h),h.scaleInPlace(-1).subtractInPlace(s),r.subtractInPlace(e.globalPosition),this.ignoreCameraPitchAndRoll&&this._applyPitchOffset(c);var _=!1,d=this._tmpForward;d.copyFromFloats(0,0,this._scene.useRightHandedSystem?-1:1),n.TransformNormalToRef(d,c,d);var g=this._tmpNodeForward;if(g.copyFromFloats(0,0,this._scene.useRightHandedSystem?-1:1),n.TransformNormalToRef(g,a,g),this._recenterNextUpdate)r.copyFrom(d).scaleInPlace(this.defaultDistance);else if(this.ignoreAngleClamp){var p=r.length();r.copyFrom(d).scaleInPlace(p)}else _=this._angularClamp(c,r);var f=!1;this.ignoreDistanceClamp||(f=this._distanceClamp(r,_),this._applyVerticalClamp(r)),this.useFixedVerticalOffset&&(r.y=h.y-e.globalPosition.y+this.fixedVerticalOffset),(_||f||this._passedOrientationDeadzone(r,g)||this._recenterNextUpdate)&&this._orientationClamp(r,o),this._workingPosition.subtractInPlace(s),this._recenterNextUpdate=!1,this.attachedNode.setParent(t)}},i.prototype._updateTransformToGoal=function(e){if(!(!this.attachedNode||!this.followedCamera||!this._enabled)){this.attachedNode.rotationQuaternion||(this.attachedNode.rotationQuaternion=u.Identity());var t=this.attachedNode.parent;if(this.attachedNode.setParent(null),!this.interpolatePose){this.attachedNode.position.copyFrom(this.followedCamera.globalPosition).addInPlace(this._workingPosition),this.attachedNode.rotationQuaternion.copyFrom(this._workingQuaternion);return}var a=new n;a.copyFrom(this.attachedNode.position).subtractInPlace(this.followedCamera.globalPosition),n.SmoothToRef(a,this._workingPosition,e,this.lerpTime,a),a.addInPlace(this.followedCamera.globalPosition),this.attachedNode.position.copyFrom(a);var r=new u;r.copyFrom(this.attachedNode.rotationQuaternion),u.SmoothToRef(r,this._workingQuaternion,e,this.lerpTime,this.attachedNode.rotationQuaternion),this.attachedNode.setParent(t)}},i.prototype._addObservables=function(){var e=this;this._lastTick=Date.now(),this._onBeforeRender=this._scene.onBeforeRenderObservable.add(function(){if(!!e.followedCamera){var t=Date.now();e._updateLeashing(e.followedCamera),e._updateTransformToGoal(t-e._lastTick),e._lastTick=t}})},i.prototype._removeObservables=function(){this._onBeforeRender&&this._scene.onBeforeRenderObservable.remove(this._onBeforeRender)},i})();var y;(function(i){i[i.ABOVE_FINGER_TIPS=0]="ABOVE_FINGER_TIPS",i[i.RADIAL_SIDE=1]="RADIAL_SIDE",i[i.ULNAR_SIDE=2]="ULNAR_SIDE",i[i.BELOW_WRIST=3]="BELOW_WRIST"})(y||(y={}));var b;(function(i){i[i.LOOK_AT_CAMERA=0]="LOOK_AT_CAMERA",i[i.HAND_ROTATION=1]="HAND_ROTATION"})(b||(b={}));var R;(function(i){i[i.ALWAYS_VISIBLE=0]="ALWAYS_VISIBLE",i[i.PALM_UP=1]="PALM_UP",i[i.GAZE_FOCUS=2]="GAZE_FOCUS",i[i.PALM_AND_GAZE=3]="PALM_AND_GAZE"})(R||(R={}));(function(){function i(){this._sceneRenderObserver=null,this._zoneAxis={},this.handConstraintVisibility=R.PALM_AND_GAZE,this.palmUpStrictness=.95,this.gazeProximityRadius=.15,this.targetOffset=.1,this.targetZone=y.ULNAR_SIDE,this.zoneOrientationMode=b.HAND_ROTATION,this.nodeOrientationMode=b.HAND_ROTATION,this.handedness="none",this.lerpTime=100,this._zoneAxis[y.ABOVE_FINGER_TIPS]=new n(0,1,0),this._zoneAxis[y.RADIAL_SIDE]=new n(-1,0,0),this._zoneAxis[y.ULNAR_SIDE]=new n(1,0,0),this._zoneAxis[y.BELOW_WRIST]=new n(0,-1,0)}return Object.defineProperty(i.prototype,"name",{get:function(){return"HandConstraint"},enumerable:!1,configurable:!0}),i.prototype.enable=function(){this._node.setEnabled(!0)},i.prototype.disable=function(){this._node.setEnabled(!1)},i.prototype._getHandPose=function(){if(!this._handTracking)return null;var e;if(this.handedness==="none"?e=this._handTracking.getHandByHandedness("left")||this._handTracking.getHandByHandedness("right"):e=this._handTracking.getHandByHandedness(this.handedness),e){var t=e.getJointMesh(C.PINKY_FINGER_METACARPAL),a=e.getJointMesh(C.MIDDLE_FINGER_METACARPAL),r=e.getJointMesh(C.WRIST);if(r&&a&&t){var o={position:a.absolutePosition,quaternion:new u,id:e.xrController.uniqueId},s=l.Vector3[0],c=l.Vector3[1],h=l.Vector3[2];return s.copyFrom(a.absolutePosition).subtractInPlace(r.absolutePosition).normalize(),c.copyFrom(t.absolutePosition).subtractInPlace(a.absolutePosition).normalize(),n.CrossToRef(s,c,c),n.CrossToRef(c,s,h),u.FromLookDirectionLHToRef(c,s,o.quaternion),o}}return null},i.prototype.init=function(){},i.prototype.attach=function(e){var t=this;this._node=e,this._scene=e.getScene(),this._node.rotationQuaternion||(this._node.rotationQuaternion=u.RotationYawPitchRoll(this._node.rotation.y,this._node.rotation.x,this._node.rotation.z));var a=Date.now();this._sceneRenderObserver=this._scene.onBeforeRenderObservable.add(function(){var r=t._getHandPose();if(t._node.reservedDataStore=t._node.reservedDataStore||{},t._node.reservedDataStore.nearInteraction=t._node.reservedDataStore.nearInteraction||{},t._node.reservedDataStore.nearInteraction.excludedControllerId=null,r){var o=l.Vector3[0],s=t._scene.activeCamera;o.copyFrom(t._zoneAxis[t.targetZone]);var c=l.Quaternion[0];if(s&&(t.zoneOrientationMode===b.LOOK_AT_CAMERA||t.nodeOrientationMode===b.LOOK_AT_CAMERA)){var h=l.Vector3[1];h.copyFrom(s.position).subtractInPlace(r.position).normalize(),t._scene.useRightHandedSystem?u.FromLookDirectionRHToRef(h,n.UpReadOnly,c):u.FromLookDirectionLHToRef(h,n.UpReadOnly,c)}t.zoneOrientationMode===b.HAND_ROTATION?r.quaternion.toRotationMatrix(l.Matrix[0]):c.toRotationMatrix(l.Matrix[0]),n.TransformNormalToRef(o,l.Matrix[0],o),o.scaleInPlace(t.targetOffset);var _=l.Vector3[2],d=l.Quaternion[1];_.copyFrom(r.position).addInPlace(o),t.nodeOrientationMode===b.HAND_ROTATION?d.copyFrom(r.quaternion):d.copyFrom(c);var g=Date.now()-a;n.SmoothToRef(t._node.position,_,g,t.lerpTime,t._node.position),u.SmoothToRef(t._node.rotationQuaternion,d,g,t.lerpTime,t._node.rotationQuaternion),t._node.reservedDataStore.nearInteraction.excludedControllerId=r.id}t._setVisibility(r),a=Date.now()})},i.prototype._setVisibility=function(e){var t=!0,a=!0,r=this._scene.activeCamera;if(r){var o=r.getForwardRay();if(this.handConstraintVisibility===R.GAZE_FOCUS||this.handConstraintVisibility===R.PALM_AND_GAZE){a=!1;var s=void 0;this._eyeTracking&&(s=this._eyeTracking.getEyeGaze()),s=s||o;var c=l.Vector3[0];e?e.position.subtractToRef(s.origin,c):this._node.getAbsolutePosition().subtractToRef(s.origin,c);var h=n.Dot(c,s.direction),_=h*h;if(h>0){var d=c.lengthSquared()-_;d<this.gazeProximityRadius*this.gazeProximityRadius&&(a=!0)}}if((this.handConstraintVisibility===R.PALM_UP||this.handConstraintVisibility===R.PALM_AND_GAZE)&&(t=!1,e)){var g=l.Vector3[0];n.LeftHandedForwardReadOnly.rotateByQuaternionToRef(e.quaternion,g),n.Dot(g,o.direction)>this.palmUpStrictness*2-1&&(t=!0)}}this._node.setEnabled(t&&a)},i.prototype.detach=function(){this._scene.onBeforeRenderObservable.remove(this._sceneRenderObserver)},i.prototype.linkToXRExperience=function(e){try{this._eyeTracking=e.featuresManager.getEnabledFeature(x.EYE_TRACKING)}catch{}try{this._handTracking=e.featuresManager.getEnabledFeature(x.HAND_TRACKING)}catch{alert("Hand tracking must be enabled for the Hand Menu to work")}},i})();export{at as A,rt as B,ot as F,k as P,nt as S};
