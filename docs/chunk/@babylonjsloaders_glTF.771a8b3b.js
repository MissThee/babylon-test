import{a as G,L as N,O as R,aA as pe,aB as tt,v as ct,w as lt,aC as Z,N as ut,aD as ft}from"./@babylonjscore_Misc.d81f49ec.js";import{a as L,Q as q,M as j,C as I,T as B,q as dt,i as ht,S as pt}from"./@babylonjscore_Maths.f3ef132c.js";import{d as _t,C as mt}from"./@babylonjscore_Cameras.db49b33d.js";import{c as nt,A as g,d as vt,e as yt}from"./@babylonjscore_Animations.615099a9.js";import{S as gt,B as At}from"./@babylonjscore_Bones.4bdc5845.js";import{M as V,P as w,b as P,z as Tt,k as Et}from"./@babylonjscore_Materials.00e32dae.js";import{M as _e,T as $e,G as rt,o as bt,D as Je}from"./@babylonjscore_Meshes.307935b5.js";import{V as T,B as Ot}from"./@babylonjscore_Buffers.f937a5fd.js";import{M as wt,a as Ct}from"./@babylonjscore_Morph.df37bd75.js";import{S as Qe}from"./@babylonjscore_Loading.6509a8cd.js";import{A as Pt}from"./@babylonjscore_assetContainer.cba3bd62.js";import{B as Lt}from"./@babylonjscore_Culling.457ad209.js";import{S as St,P as It,D as xt,L as Rt}from"./@babylonjscore_Lights.ab2a2b54.js";import{b as se,_ as ne}from"./tslibtslib.b6e59fa7.js";import{c as Mt}from"./@babylonjscore_Engines.7287f97a.js";import{W as Nt,S as Ft}from"./@babylonjscore_Audio.4b8bc6d9.js";function me(a,t,e,n){var r={externalResourceFunction:function(o){return n(o).then(function(s){return new Uint8Array(s)})}};return e&&(r.uri=t==="file:"?e:t+e),a instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(a),r):GLTFValidator.validateString(a,r)}function Dt(){var a=[];onmessage=function(t){var e=t.data;switch(e.id){case"init":{importScripts(e.url);break}case"validate":{me(e.data,e.rootUrl,e.fileName,function(n){return new Promise(function(r,o){var s=a.length;a.push({resolve:r,reject:o}),postMessage({id:"getExternalResource",index:s,uri:n})})}).then(function(n){postMessage({id:"validate.resolve",value:n})},function(n){postMessage({id:"validate.reject",reason:n})});break}case"getExternalResource.resolve":{a[e.index].resolve(e.value);break}case"getExternalResource.reject":{a[e.index].reject(e.reason);break}}}}var Bt=function(){function a(){}return a.ValidateAsync=function(t,e,n,r){var o=this;return typeof Worker=="function"?new Promise(function(s,i){var c="".concat(me,"(").concat(Dt,")()"),u=URL.createObjectURL(new Blob([c],{type:"application/javascript"})),l=new Worker(u),f=function(h){l.removeEventListener("error",f),l.removeEventListener("message",d),i(h)},d=function(h){var p=h.data;switch(p.id){case"getExternalResource":{r(p.uri).then(function(m){l.postMessage({id:"getExternalResource.resolve",index:p.index,value:m},[m])},function(m){l.postMessage({id:"getExternalResource.reject",index:p.index,reason:m})});break}case"validate.resolve":{l.removeEventListener("error",f),l.removeEventListener("message",d),s(p.value),l.terminate();break}case"validate.reject":l.removeEventListener("error",f),l.removeEventListener("message",d),i(p.reason),l.terminate()}};l.addEventListener("error",f),l.addEventListener("message",d),l.postMessage({id:"init",url:o.Configuration.url}),l.postMessage({id:"validate",data:t,rootUrl:e,fileName:n})}):(this._LoadScriptPromise||(this._LoadScriptPromise=G.LoadScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then(function(){return me(t,e,n,r)}))},a.Configuration={url:"https://preview.babylonjs.com/gltf_validator.js"},a}();function Ze(a,t,e){try{return Promise.resolve(new Uint8Array(a,t,e))}catch(n){return Promise.reject(n)}}var te;(function(a){a[a.AUTO=0]="AUTO",a[a.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"})(te||(te={}));var $;(function(a){a[a.NONE=0]="NONE",a[a.FIRST=1]="FIRST",a[a.ALL=2]="ALL"})($||($={}));var F;(function(a){a[a.LOADING=0]="LOADING",a[a.READY=1]="READY",a[a.COMPLETE=2]="COMPLETE"})(F||(F={}));var ot=function(){function a(){this.onParsedObservable=new R,this.coordinateSystemMode=te.AUTO,this.animationStartMode=$.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.preprocessUrlAsync=function(t){return Promise.resolve(t)},this.onMeshLoadedObservable=new R,this.onSkinLoadedObservable=new R,this.onTextureLoadedObservable=new R,this.onMaterialLoadedObservable=new R,this.onCameraLoadedObservable=new R,this.onCompleteObservable=new R,this.onErrorObservable=new R,this.onDisposeObservable=new R,this.onExtensionLoadedObservable=new R,this.validate=!1,this.onValidatedObservable=new R,this._loader=null,this._state=null,this._requests=new Array,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this.onLoaderStateChangedObservable=new R,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(a.prototype,"onParsed",{set:function(t){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onMeshLoaded",{set:function(t){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onTextureLoaded",{set:function(t){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onMaterialLoaded",{set:function(t){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onCameraLoaded",{set:function(t){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onComplete",{set:function(t){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onError",{set:function(t){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onExtensionLoaded",{set:function(t){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(t){this._loggingEnabled!==t&&(this._loggingEnabled=t,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(t){this._capturePerformanceCounters!==t&&(this._capturePerformanceCounters=t,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onValidated",{set:function(t){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(t)},enumerable:!1,configurable:!0}),a.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null);for(var t=0,e=this._requests;t<e.length;t++){var n=e[t];n.abort()}this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=function(r){return Promise.resolve(r)},this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},a.prototype.loadFile=function(t,e,n,r,o,s){var i=this;this._progressCallback=r;var c=e.name?"file:":G.GetFolderPath(e),u=e.name||G.GetFilename(e);if(o){if(this.useRangeRequests){this.validate&&N.Warn("glTF validation is not supported when range requests are enabled");var l={abort:function(){},onCompleteObservable:new R},f={readAsync:function(d,h){return new Promise(function(p,m){i._loadFile(t,e,function(y){p(new Uint8Array(y))},!0,function(y){m(y)},function(y){y.setRequestHeader("Range","bytes=".concat(d,"-").concat(d+h-1))})})},byteLength:0};return this._unpackBinaryAsync(new pe(f)).then(function(d){l.onCompleteObservable.notifyObservers(l),n(d)},s?function(d){return s(void 0,d)}:void 0),l}return this._loadFile(t,e,function(d){i._validate(t,d,c,u),i._unpackBinaryAsync(new pe({readAsync:function(h,p){return Ze(d,h,p)},byteLength:d.byteLength})).then(function(h){n(h)},s?function(h){return s(void 0,h)}:void 0)},!0,s)}return this._loadFile(t,e,function(d){i._validate(t,d,c,u),n({json:i._parseJson(d)})},o,s)},a.prototype.importMeshAsync=function(t,e,n,r,o,s){var i=this;return Promise.resolve().then(function(){return i.onParsedObservable.notifyObservers(n),i.onParsedObservable.clear(),i._log("Loading ".concat(s||"")),i._loader=i._getLoader(n),i._loader.importMeshAsync(t,e,null,n,r,o,s)})},a.prototype.loadAsync=function(t,e,n,r,o){var s=this;return Promise.resolve().then(function(){return s.onParsedObservable.notifyObservers(e),s.onParsedObservable.clear(),s._log("Loading ".concat(o||"")),s._loader=s._getLoader(e),s._loader.loadAsync(t,e,n,r,o)})},a.prototype.loadAssetContainerAsync=function(t,e,n,r,o){var s=this;return Promise.resolve().then(function(){s.onParsedObservable.notifyObservers(e),s.onParsedObservable.clear(),s._log("Loading ".concat(o||"")),s._loader=s._getLoader(e);var i=new Pt(t),c=[];s.onMaterialLoadedObservable.add(function(f){c.push(f)});var u=[];s.onTextureLoadedObservable.add(function(f){u.push(f)});var l=[];return s.onCameraLoadedObservable.add(function(f){l.push(f)}),s._loader.importMeshAsync(null,t,i,e,n,r,o).then(function(f){return Array.prototype.push.apply(i.geometries,f.geometries),Array.prototype.push.apply(i.meshes,f.meshes),Array.prototype.push.apply(i.particleSystems,f.particleSystems),Array.prototype.push.apply(i.skeletons,f.skeletons),Array.prototype.push.apply(i.animationGroups,f.animationGroups),Array.prototype.push.apply(i.materials,c),Array.prototype.push.apply(i.textures,u),Array.prototype.push.apply(i.lights,f.lights),Array.prototype.push.apply(i.transformNodes,f.transformNodes),Array.prototype.push.apply(i.cameras,l),i})})},a.prototype.canDirectLoad=function(t){return t.indexOf("asset")!==-1&&t.indexOf("version")!==-1||t.startsWith("data:base64,"+a._MagicBase64Encoded)||t.startsWith("data:;base64,"+a._MagicBase64Encoded)||t.startsWith("data:application/octet-stream;base64,"+a._MagicBase64Encoded)||t.startsWith("data:model/gltf-binary;base64,"+a._MagicBase64Encoded)},a.prototype.directLoad=function(t,e){if(e.startsWith("base64,"+a._MagicBase64Encoded)||e.startsWith(";base64,"+a._MagicBase64Encoded)||e.startsWith("application/octet-stream;base64,"+a._MagicBase64Encoded)||e.startsWith("model/gltf-binary;base64,"+a._MagicBase64Encoded)){var n=tt(e);return this._validate(t,n),this._unpackBinaryAsync(new pe({readAsync:function(r,o){return Ze(n,r,o)},byteLength:n.byteLength}))}return this._validate(t,e),Promise.resolve({json:this._parseJson(e)})},a.prototype.createPlugin=function(){return new a},Object.defineProperty(a.prototype,"loaderState",{get:function(){return this._state},enumerable:!1,configurable:!0}),a.prototype.whenCompleteAsync=function(){var t=this;return new Promise(function(e,n){t.onCompleteObservable.addOnce(function(){e()}),t.onErrorObservable.addOnce(function(r){n(r)})})},a.prototype._setState=function(t){this._state!==t&&(this._state=t,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(F[this._state]))},a.prototype._loadFile=function(t,e,n,r,o,s){var i=this,c=t._loadFile(e,n,function(u){i._onProgress(u,c)},!0,r,o,s);return c.onCompleteObservable.add(function(u){i._requests.splice(i._requests.indexOf(u),1)}),this._requests.push(c),c},a.prototype._onProgress=function(t,e){if(!!this._progressCallback){e._lengthComputable=t.lengthComputable,e._loaded=t.loaded,e._total=t.total;for(var n=!0,r=0,o=0,s=0,i=this._requests;s<i.length;s++){var c=i[s];if(c._lengthComputable===void 0||c._loaded===void 0||c._total===void 0)return;n=n&&c._lengthComputable,r+=c._loaded,o+=c._total}this._progressCallback({lengthComputable:n,loaded:r,total:n?o:0})}},a.prototype._validate=function(t,e,n,r){var o=this;n===void 0&&(n=""),r===void 0&&(r=""),this.validate&&(this._startPerformanceCounter("Validate JSON"),Bt.ValidateAsync(e,n,r,function(s){return o.preprocessUrlAsync(n+s).then(function(i){return t._loadFileAsync(i,void 0,!0,!0)})}).then(function(s){o._endPerformanceCounter("Validate JSON"),o.onValidatedObservable.notifyObservers(s),o.onValidatedObservable.clear()},function(s){o._endPerformanceCounter("Validate JSON"),G.Warn("Failed to validate: ".concat(s.message)),o.onValidatedObservable.clear()}))},a.prototype._getLoader=function(t){var e=t.json.asset||{};this._log("Asset version: ".concat(e.version)),e.minVersion&&this._log("Asset minimum version: ".concat(e.minVersion)),e.generator&&this._log("Asset generator: ".concat(e.generator));var n=a._parseVersion(e.version);if(!n)throw new Error("Invalid version: "+e.version);if(e.minVersion!==void 0){var r=a._parseVersion(e.minVersion);if(!r)throw new Error("Invalid minimum version: "+e.minVersion);if(a._compareVersion(r,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+e.minVersion)}var o={1:a._CreateGLTF1Loader,2:a._CreateGLTF2Loader},s=o[n.major];if(!s)throw new Error("Unsupported version: "+e.version);return s(this)},a.prototype._parseJson=function(t){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: ".concat(t.length));var e=JSON.parse(t);return this._endPerformanceCounter("Parse JSON"),e},a.prototype._unpackBinaryAsync=function(t){var e=this;return this._startPerformanceCounter("Unpack Binary"),t.loadAsync(20).then(function(){var n={Magic:1179937895},r=t.readUint32();if(r!==n.Magic)throw new ct("Unexpected magic: "+r,lt.GLTFLoaderUnexpectedMagicError);var o=t.readUint32();e.loggingEnabled&&e._log("Binary version: ".concat(o));var s=t.readUint32();if(t.buffer.byteLength!==0&&s!==t.buffer.byteLength)throw new Error("Length in header does not match actual data length: ".concat(s," != ").concat(t.buffer.byteLength));var i;switch(o){case 1:{i=e._unpackBinaryV1Async(t,s);break}case 2:{i=e._unpackBinaryV2Async(t,s);break}default:throw new Error("Unsupported version: "+o)}return e._endPerformanceCounter("Unpack Binary"),i})},a.prototype._unpackBinaryV1Async=function(t,e){var n={JSON:0},r=t.readUint32(),o=t.readUint32();if(o!==n.JSON)throw new Error("Unexpected content format: ".concat(o));var s=e-t.byteOffset,i={json:this._parseJson(t.readString(r)),bin:null};if(s!==0){var c=t.byteOffset;i.bin={readAsync:function(u,l){return t.buffer.readAsync(c+u,l)},byteLength:s}}return Promise.resolve(i)},a.prototype._unpackBinaryV2Async=function(t,e){var n=this,r={JSON:1313821514,BIN:5130562},o=t.readUint32(),s=t.readUint32();if(s!==r.JSON)throw new Error("First chunk format is not JSON");return t.byteOffset+o===e?t.loadAsync(o).then(function(){return{json:n._parseJson(t.readString(o)),bin:null}}):t.loadAsync(o+8).then(function(){var i={json:n._parseJson(t.readString(o)),bin:null},c=function(){var u=t.readUint32(),l=t.readUint32();switch(l){case r.JSON:throw new Error("Unexpected JSON chunk");case r.BIN:{var f=t.byteOffset;i.bin={readAsync:function(d,h){return t.buffer.readAsync(f+d,h)},byteLength:u},t.skipBytes(u);break}default:{t.skipBytes(u);break}}return t.byteOffset!==e?t.loadAsync(8).then(c):Promise.resolve(i)};return c()})},a._parseVersion=function(t){if(t==="1.0"||t==="1.0.1")return{major:1,minor:0};var e=(t+"").match(/^(\d+)\.(\d+)/);return e?{major:parseInt(e[1]),minor:parseInt(e[2])}:null},a._compareVersion=function(t,e){return t.major>e.major?1:t.major<e.major?-1:t.minor>e.minor?1:t.minor<e.minor?-1:0},a.prototype._logOpen=function(t){this._log(t),this._logIndentLevel++},a.prototype._logClose=function(){--this._logIndentLevel},a.prototype._logEnabled=function(t){var e=a._logSpaces.substr(0,this._logIndentLevel*2);N.Log("".concat(e).concat(t))},a.prototype._logDisabled=function(t){},a.prototype._startPerformanceCounterEnabled=function(t){G.StartPerformanceCounter(t)},a.prototype._startPerformanceCounterDisabled=function(t){},a.prototype._endPerformanceCounterEnabled=function(t){G.EndPerformanceCounter(t)},a.prototype._endPerformanceCounterDisabled=function(t){},a.IncrementalLoading=!0,a.HomogeneousCoordinates=!1,a._MagicBase64Encoded="Z2xURg",a._logSpaces="                                ",a}();Qe&&Qe.RegisterPlugin(new ot);var _=function(){function a(){}return a.Get=function(t,e,n){if(!e||n==null||!e[n])throw new Error("".concat(t,": Failed to find index (").concat(n,")"));return e[n]},a.Assign=function(t){if(t)for(var e=0;e<t.length;e++)t[e].index=e},a}();function at(){for(var a=[],t=0;t<arguments.length;t++)a[t]=arguments[t];var e=function(n){return n&&typeof n=="object"};return a.reduce(function(n,r){return Object.keys(r).forEach(function(o){var s=n[o],i=r[o];Array.isArray(s)&&Array.isArray(i)?n[o]=s.concat.apply(s,i):e(s)&&e(i)?n[o]=at(s,i):n[o]=i}),n},{})}var v=function(){function a(t){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=t}return a.RegisterExtension=function(t,e){a.UnregisterExtension(t)&&N.Warn("Extension with the name '".concat(t,"' already exists")),a._RegisteredExtensions[t]={factory:e}},a.UnregisterExtension=function(t){return a._RegisteredExtensions[t]?(delete a._RegisteredExtensions[t],!0):!1},Object.defineProperty(a.prototype,"gltf",{get:function(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bin",{get:function(){return this._bin},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"babylonScene",{get:function(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!1,configurable:!0}),a.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach(function(t){return t.dispose&&t.dispose()}),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())},a.prototype.importMeshAsync=function(t,e,n,r,o,s,i){var c=this;return i===void 0&&(i=""),Promise.resolve().then(function(){c._babylonScene=e,c._assetContainer=n,c._loadData(r);var u=null;if(t){var l={};if(c._gltf.nodes)for(var f=0,d=c._gltf.nodes;f<d.length;f++){var h=d[f];h.name&&(l[h.name]=h.index)}var p=t instanceof Array?t:[t];u=p.map(function(m){var y=l[m];if(y===void 0)throw new Error("Failed to find node '".concat(m,"'"));return y})}return c._loadAsync(o,i,u,function(){return{meshes:c._getMeshes(),particleSystems:[],skeletons:c._getSkeletons(),animationGroups:c._getAnimationGroups(),lights:c._babylonLights,transformNodes:c._getTransformNodes(),geometries:c._getGeometries()}})})},a.prototype.loadAsync=function(t,e,n,r,o){var s=this;return o===void 0&&(o=""),Promise.resolve().then(function(){return s._babylonScene=t,s._loadData(e),s._loadAsync(n,o,null,function(){})})},a.prototype._loadAsync=function(t,e,n,r){var o=this;return Promise.resolve().then(function(){o._rootUrl=t,o._uniqueRootUrl=!t.startsWith("file:")&&e?t:"".concat(t).concat(Date.now(),"/"),o._fileName=e,o._loadExtensions(),o._checkExtensions();var s="".concat(F[F.LOADING]," => ").concat(F[F.READY]),i="".concat(F[F.LOADING]," => ").concat(F[F.COMPLETE]);o._parent._startPerformanceCounter(s),o._parent._startPerformanceCounter(i),o._parent._setState(F.LOADING),o._extensionsOnLoading();var c=new Array,u=o._babylonScene.blockMaterialDirtyMechanism;if(o._babylonScene.blockMaterialDirtyMechanism=!0,!o.parent.loadOnlyMaterials){if(n)c.push(o.loadSceneAsync("/nodes",{nodes:n,index:-1}));else if(o._gltf.scene!=null||o._gltf.scenes&&o._gltf.scenes[0]){var l=_.Get("/scene",o._gltf.scenes,o._gltf.scene||0);c.push(o.loadSceneAsync("/scenes/".concat(l.index),l))}}if(!o.parent.skipMaterials&&o.parent.loadAllMaterials&&o._gltf.materials)for(var f=0;f<o._gltf.materials.length;++f){var d=o._gltf.materials[f],h="/materials/"+f,p=V.TriangleFillMode;c.push(o._loadMaterialAsync(h,d,null,p,function(){}))}o._babylonScene.blockMaterialDirtyMechanism=u,o._parent.compileMaterials&&c.push(o._compileMaterialsAsync()),o._parent.compileShadowGenerators&&c.push(o._compileShadowGeneratorsAsync());var m=Promise.all(c).then(function(){return o._rootBabylonMesh&&o._rootBabylonMesh.setEnabled(!0),o._extensionsOnReady(),o._parent._setState(F.READY),o._startAnimations(),r()});return m.then(function(y){return o._parent._endPerformanceCounter(s),G.SetImmediate(function(){o._disposed||Promise.all(o._completePromises).then(function(){o._parent._endPerformanceCounter(i),o._parent._setState(F.COMPLETE),o._parent.onCompleteObservable.notifyObservers(void 0),o._parent.onCompleteObservable.clear(),o.dispose()},function(A){o._parent.onErrorObservable.notifyObservers(A),o._parent.onErrorObservable.clear(),o.dispose()})}),y})}).catch(function(s){throw o._disposed||(o._parent.onErrorObservable.notifyObservers(s),o._parent.onErrorObservable.clear(),o.dispose()),s})},a.prototype._loadData=function(t){if(this._gltf=t.json,this._setupData(),t.bin){var e=this._gltf.buffers;if(e&&e[0]&&!e[0].uri){var n=e[0];(n.byteLength<t.bin.byteLength-3||n.byteLength>t.bin.byteLength)&&N.Warn("Binary buffer length (".concat(n.byteLength,") from JSON does not match chunk length (").concat(t.bin.byteLength,")")),this._bin=t.bin}else N.Warn("Unexpected BIN chunk")}},a.prototype._setupData=function(){if(_.Assign(this._gltf.accessors),_.Assign(this._gltf.animations),_.Assign(this._gltf.buffers),_.Assign(this._gltf.bufferViews),_.Assign(this._gltf.cameras),_.Assign(this._gltf.images),_.Assign(this._gltf.materials),_.Assign(this._gltf.meshes),_.Assign(this._gltf.nodes),_.Assign(this._gltf.samplers),_.Assign(this._gltf.scenes),_.Assign(this._gltf.skins),_.Assign(this._gltf.textures),this._gltf.nodes){for(var t={},e=0,n=this._gltf.nodes;e<n.length;e++){var r=n[e];if(r.children)for(var o=0,s=r.children;o<s.length;o++){var i=s[o];t[i]=r.index}}for(var c=this._createRootNode(),u=0,l=this._gltf.nodes;u<l.length;u++){var r=l[u],f=t[r.index];r.parent=f===void 0?c:this._gltf.nodes[f]}}},a.prototype._loadExtensions=function(){for(var t in a._RegisteredExtensions){var e=a._RegisteredExtensions[t].factory(this);e.name!==t&&N.Warn("The name of the glTF loader extension instance does not match the registered name: ".concat(e.name," !== ").concat(t)),this._extensions.push(e),this._parent.onExtensionLoadedObservable.notifyObservers(e)}this._extensions.sort(function(n,r){return(n.order||Number.MAX_VALUE)-(r.order||Number.MAX_VALUE)}),this._parent.onExtensionLoadedObservable.clear()},a.prototype._checkExtensions=function(){if(this._gltf.extensionsRequired)for(var t=function(s){var i=e._extensions.some(function(c){return c.name===s&&c.enabled});if(!i)throw new Error("Require extension ".concat(s," is not available"))},e=this,n=0,r=this._gltf.extensionsRequired;n<r.length;n++){var o=r[n];t(o)}},a.prototype._createRootNode=function(){this._babylonScene._blockEntityCollection=!!this._assetContainer,this._rootBabylonMesh=new _e("__root__",this._babylonScene),this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);var t={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case te.AUTO:{this._babylonScene.useRightHandedSystem||(t.rotation=[0,1,0,0],t.scale=[1,1,-1],a._LoadTransform(t,this._rootBabylonMesh));break}case te.FORCE_RIGHT_HANDED:{this._babylonScene.useRightHandedSystem=!0;break}default:throw new Error("Invalid coordinate system mode (".concat(this._parent.coordinateSystemMode,")"))}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),t},a.prototype.loadSceneAsync=function(t,e){var n=this,r=this._extensionsLoadSceneAsync(t,e);if(r)return r;var o=new Array;if(this.logOpen("".concat(t," ").concat(e.name||"")),e.nodes)for(var s=0,i=e.nodes;s<i.length;s++){var c=i[s],u=_.Get("".concat(t,"/nodes/").concat(c),this._gltf.nodes,c);o.push(this.loadNodeAsync("/nodes/".concat(u.index),u,function(h){h.parent=n._rootBabylonMesh}))}for(var l=0,f=this._postSceneLoadActions;l<f.length;l++){var d=f[l];d()}return o.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(o).then(function(){})},a.prototype._forEachPrimitive=function(t,e){if(t._primitiveBabylonMeshes)for(var n=0,r=t._primitiveBabylonMeshes;n<r.length;n++){var o=r[n];e(o)}},a.prototype._getGeometries=function(){var t=new Array,e=this._gltf.nodes;if(e)for(var n=0,r=e;n<r.length;n++){var o=r[n];this._forEachPrimitive(o,function(s){var i=s.geometry;i&&t.indexOf(i)===-1&&t.push(i)})}return t},a.prototype._getMeshes=function(){var t=new Array;this._rootBabylonMesh&&t.push(this._rootBabylonMesh);var e=this._gltf.nodes;if(e)for(var n=0,r=e;n<r.length;n++){var o=r[n];this._forEachPrimitive(o,function(s){t.push(s)})}return t},a.prototype._getTransformNodes=function(){var t=new Array,e=this._gltf.nodes;if(e)for(var n=0,r=e;n<r.length;n++){var o=r[n];o._babylonTransformNode&&o._babylonTransformNode.getClassName()==="TransformNode"&&t.push(o._babylonTransformNode),o._babylonTransformNodeForSkin&&t.push(o._babylonTransformNodeForSkin)}return t},a.prototype._getSkeletons=function(){var t=new Array,e=this._gltf.skins;if(e)for(var n=0,r=e;n<r.length;n++){var o=r[n];o._data&&t.push(o._data.babylonSkeleton)}return t},a.prototype._getAnimationGroups=function(){var t=new Array,e=this._gltf.animations;if(e)for(var n=0,r=e;n<r.length;n++){var o=r[n];o._babylonAnimationGroup&&t.push(o._babylonAnimationGroup)}return t},a.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case $.NONE:break;case $.FIRST:{var t=this._getAnimationGroups();t.length!==0&&t[0].start(!0);break}case $.ALL:{for(var t=this._getAnimationGroups(),e=0,n=t;e<n.length;e++){var r=n[e];r.start(!0)}break}default:{N.Error("Invalid animation start mode (".concat(this._parent.animationStartMode,")"));return}}},a.prototype.loadNodeAsync=function(t,e,n){var r=this;n===void 0&&(n=function(){});var o=this._extensionsLoadNodeAsync(t,e,n);if(o)return o;if(e._babylonTransformNode)throw new Error("".concat(t,": Invalid recursive node hierarchy"));var s=new Array;this.logOpen("".concat(t," ").concat(e.name||""));var i=function(f){if(a.AddPointerMetadata(f,t),a._LoadTransform(e,f),e.camera!=null){var d=_.Get("".concat(t,"/camera"),r._gltf.cameras,e.camera);s.push(r.loadCameraAsync("/cameras/".concat(d.index),d,function(A){A.parent=f}))}if(e.children)for(var h=0,p=e.children;h<p.length;h++){var m=p[h],y=_.Get("".concat(t,"/children/").concat(m),r._gltf.nodes,m);s.push(r.loadNodeAsync("/nodes/".concat(y.index),y,function(A){A.parent=f}))}n(f)};if(e.mesh==null||e.skin!=null){var c=e.name||"node".concat(e.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var u=new $e(c,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e.mesh==null?e._babylonTransformNode=u:e._babylonTransformNodeForSkin=u,i(u)}if(e.mesh!=null)if(e.skin==null){var l=_.Get("".concat(t,"/mesh"),this._gltf.meshes,e.mesh);s.push(this._loadMeshAsync("/meshes/".concat(l.index),e,l,i))}else{var l=_.Get("".concat(t,"/mesh"),this._gltf.meshes,e.mesh);s.push(this._loadMeshAsync("/meshes/".concat(l.index),e,l,function(d){var h=e._babylonTransformNodeForSkin;d.metadata=at(h.metadata,d.metadata||{});var p=_.Get("".concat(t,"/skin"),r._gltf.skins,e.skin);s.push(r._loadSkinAsync("/skins/".concat(p.index),e,p,function(m){r._forEachPrimitive(e,function(y){y.skeleton=m}),r._postSceneLoadActions.push(function(){if(p.skeleton!=null){var y=_.Get("/skins/".concat(p.index,"/skeleton"),r._gltf.nodes,p.skeleton).parent;e.index===y.index?d.parent=h.parent:d.parent=y._babylonTransformNode}else d.parent=r._rootBabylonMesh;r._parent.onSkinLoadedObservable.notifyObservers({node:h,skinnedNode:d})})}))}))}return this.logClose(),Promise.all(s).then(function(){return r._forEachPrimitive(e,function(f){f.geometry&&f.geometry.useBoundingInfoFromGeometry?f._updateBoundingInfo():f.refreshBoundingInfo(!0)}),e._babylonTransformNode})},a.prototype._loadMeshAsync=function(t,e,n,r){var o=n.primitives;if(!o||!o.length)throw new Error("".concat(t,": Primitives are missing"));o[0].index==null&&_.Assign(o);var s=new Array;this.logOpen("".concat(t," ").concat(n.name||""));var i=e.name||"node".concat(e.index);if(o.length===1){var c=n.primitives[0];s.push(this._loadMeshPrimitiveAsync("".concat(t,"/primitives/").concat(c.index),i,e,n,c,function(f){e._babylonTransformNode=f,e._primitiveBabylonMeshes=[f]}))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,e._babylonTransformNode=new $e(i,this._babylonScene),e._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e._primitiveBabylonMeshes=[];for(var u=0,l=o;u<l.length;u++){var c=l[u];s.push(this._loadMeshPrimitiveAsync("".concat(t,"/primitives/").concat(c.index),"".concat(i,"_primitive").concat(c.index),e,n,c,function(d){d.parent=e._babylonTransformNode,e._primitiveBabylonMeshes.push(d)}))}}return r(e._babylonTransformNode),this.logClose(),Promise.all(s).then(function(){return e._babylonTransformNode})},a.prototype._loadMeshPrimitiveAsync=function(t,e,n,r,o,s){var i=this,c=this._extensionsLoadMeshPrimitiveAsync(t,e,n,r,o,s);if(c)return c;this.logOpen("".concat(t));var u=this._disableInstancedMesh===0&&this._parent.createInstances&&n.skin==null&&!r.primitives[0].targets,l,f;if(u&&o._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,l=o._instanceData.babylonSourceMesh.createInstance(e),l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f=o._instanceData.promise;else{var d=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;var h=new _e(e,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.overrideMaterialSideOrientation=this._babylonScene.useRightHandedSystem?V.CounterClockWiseSideOrientation:V.ClockWiseSideOrientation,this._createMorphTargets(t,n,r,o,h),d.push(this._loadVertexDataAsync(t,o,h).then(function(A){return i._loadMorphTargetsAsync(t,o,h,A).then(function(){i._disposed||(i._babylonScene._blockEntityCollection=!!i._assetContainer,A.applyToMesh(h),A._parentContainer=i._assetContainer,i._babylonScene._blockEntityCollection=!1)})}));var p=a._GetDrawMode(t,o.mode);if(o.material==null){var m=this._defaultBabylonMaterialData[p];m||(m=this._createDefaultMaterial("__GLTFLoader._default",p),this._parent.onMaterialLoadedObservable.notifyObservers(m),this._defaultBabylonMaterialData[p]=m),h.material=m}else if(!this.parent.skipMaterials){var y=_.Get("".concat(t,"/material"),this._gltf.materials,o.material);d.push(this._loadMaterialAsync("/materials/".concat(y.index),y,h,p,function(A){h.material=A}))}f=Promise.all(d),u&&(o._instanceData={babylonSourceMesh:h,promise:f}),l=h}return a.AddPointerMetadata(l,t),this._parent.onMeshLoadedObservable.notifyObservers(l),s(l),this.logClose(),f.then(function(){return l})},a.prototype._loadVertexDataAsync=function(t,e,n){var r=this,o=this._extensionsLoadVertexDataAsync(t,e,n);if(o)return o;var s=e.attributes;if(!s)throw new Error("".concat(t,": Attributes are missing"));var i=new Array,c=new rt(n.name,this._babylonScene);if(e.indices==null)n.isUnIndexed=!0;else{var u=_.Get("".concat(t,"/indices"),this._gltf.accessors,e.indices);i.push(this._loadIndicesAccessorAsync("/accessors/".concat(u.index),u).then(function(f){c.setIndices(f)}))}var l=function(f,d,h){if(s[f]!=null){n._delayInfo=n._delayInfo||[],n._delayInfo.indexOf(d)===-1&&n._delayInfo.push(d);var p=_.Get("".concat(t,"/attributes/").concat(f),r._gltf.accessors,s[f]);i.push(r._loadVertexAccessorAsync("/accessors/".concat(p.index),p,d).then(function(m){if(m.getKind()===T.PositionKind&&!r.parent.alwaysComputeBoundingBox&&!n.skeleton){var y=p.min,A=p.max;if(y!==void 0&&A!==void 0){if(p.normalized&&p.componentType!==5126){var O=1;switch(p.componentType){case 5120:O=127;break;case 5121:O=255;break;case 5122:O=32767;break;case 5123:O=65535;break}for(var b=0;b<3;++b)y[b]=Math.max(y[b]/O,-1),A[b]=Math.max(A[b]/O,-1)}var C=B.Vector3[0],k=B.Vector3[1];C.copyFromFloats.apply(C,y),k.copyFromFloats.apply(k,A),c._boundingInfo=new Lt(C,k),c.useBoundingInfoFromGeometry=!0}}c.setVerticesBuffer(m,p.count)})),d==T.MatricesIndicesExtraKind&&(n.numBoneInfluencers=8),h&&h(p)}};return l("POSITION",T.PositionKind),l("NORMAL",T.NormalKind),l("TANGENT",T.TangentKind),l("TEXCOORD_0",T.UVKind),l("TEXCOORD_1",T.UV2Kind),l("TEXCOORD_2",T.UV3Kind),l("TEXCOORD_3",T.UV4Kind),l("TEXCOORD_4",T.UV5Kind),l("TEXCOORD_5",T.UV6Kind),l("JOINTS_0",T.MatricesIndicesKind),l("WEIGHTS_0",T.MatricesWeightsKind),l("JOINTS_1",T.MatricesIndicesExtraKind),l("WEIGHTS_1",T.MatricesWeightsExtraKind),l("COLOR_0",T.ColorKind,function(f){f.type==="VEC4"&&(n.hasVertexAlpha=!0)}),Promise.all(i).then(function(){return c})},a.prototype._createMorphTargets=function(t,e,n,r,o){if(!!r.targets){if(e._numMorphTargets==null)e._numMorphTargets=r.targets.length;else if(r.targets.length!==e._numMorphTargets)throw new Error("".concat(t,": Primitives do not have the same number of targets"));var s=n.extras?n.extras.targetNames:null;o.morphTargetManager=new wt(o.getScene()),o.morphTargetManager.areUpdatesFrozen=!0;for(var i=0;i<r.targets.length;i++){var c=e.weights?e.weights[i]:n.weights?n.weights[i]:0,u=s?s[i]:"morphTarget".concat(i);o.morphTargetManager.addTarget(new Ct(u,c,o.getScene()))}}},a.prototype._loadMorphTargetsAsync=function(t,e,n,r){if(!e.targets)return Promise.resolve();for(var o=new Array,s=n.morphTargetManager,i=0;i<s.numTargets;i++){var c=s.getTarget(i);o.push(this._loadMorphTargetVertexDataAsync("".concat(t,"/targets/").concat(i),r,e.targets[i],c))}return Promise.all(o).then(function(){s.areUpdatesFrozen=!1})},a.prototype._loadMorphTargetVertexDataAsync=function(t,e,n,r){var o=this,s=new Array,i=function(c,u,l){if(n[c]!=null){var f=e.getVertexBuffer(u);if(!!f){var d=_.Get("".concat(t,"/").concat(c),o._gltf.accessors,n[c]);s.push(o._loadFloatAccessorAsync("/accessors/".concat(d.index),d).then(function(h){l(f,h)}))}}};return i("POSITION",T.PositionKind,function(c,u){var l=new Float32Array(u.length);c.forEach(u.length,function(f,d){l[d]=u[d]+f}),r.setPositions(l)}),i("NORMAL",T.NormalKind,function(c,u){var l=new Float32Array(u.length);c.forEach(l.length,function(f,d){l[d]=u[d]+f}),r.setNormals(l)}),i("TANGENT",T.TangentKind,function(c,u){var l=new Float32Array(u.length/3*4),f=0;c.forEach(u.length/3*4,function(d,h){(h+1)%4!==0&&(l[f]=u[f]+d,f++)}),r.setTangents(l)}),Promise.all(s).then(function(){})},a._LoadTransform=function(t,e){if(t.skin==null){var n=L.Zero(),r=q.Identity(),o=L.One();if(t.matrix){var s=j.FromArray(t.matrix);s.decompose(o,r,n)}else t.translation&&(n=L.FromArray(t.translation)),t.rotation&&(r=q.FromArray(t.rotation)),t.scale&&(o=L.FromArray(t.scale));e.position=n,e.rotationQuaternion=r,e.scaling=o}},a.prototype._loadSkinAsync=function(t,e,n,r){var o=this,s=this._extensionsLoadSkinAsync(t,e,n);if(s)return s;if(n._data)return r(n._data.babylonSkeleton),n._data.promise;var i="skeleton".concat(n.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var c=new gt(n.name||i,i,this._babylonScene);c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(t,n,c);var u=this._loadSkinInverseBindMatricesDataAsync(t,n).then(function(l){o._updateBoneMatrices(c,l)});return n._data={babylonSkeleton:c,promise:u},r(c),u},a.prototype._loadBones=function(t,e,n){if(e.skeleton==null||this._parent.alwaysComputeSkeletonRootNode){var r=this._findSkeletonRootNode("".concat(t,"/joints"),e.joints);if(r)if(e.skeleton===void 0)e.skeleton=r.index;else{var o=function(d,h){for(;h.parent;h=h.parent)if(h.parent===d)return!0;return!1},s=_.Get("".concat(t,"/skeleton"),this._gltf.nodes,e.skeleton);s!==r&&!o(s,r)&&(N.Warn("".concat(t,"/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root")),e.skeleton=r.index)}else N.Warn("".concat(t,": Failed to find common root"))}for(var i={},c=0,u=e.joints;c<u.length;c++){var l=u[c],f=_.Get("".concat(t,"/joints/").concat(l),this._gltf.nodes,l);this._loadBone(f,e,n,i)}},a.prototype._findSkeletonRootNode=function(t,e){if(e.length===0)return null;for(var n={},r=0,o=e;r<o.length;r++){for(var s=o[r],i=new Array,c=_.Get("".concat(t,"/").concat(s),this._gltf.nodes,s);c.index!==-1;)i.unshift(c),c=c.parent;n[s]=i}for(var u=null,l=0;;++l){var i=n[e[0]];if(l>=i.length)return u;for(var c=i[l],f=1;f<e.length;++f)if(i=n[e[f]],l>=i.length||c!==i[l])return u;u=c}},a.prototype._loadBone=function(t,e,n,r){var o=r[t.index];if(o)return o;var s=null;t.index!==e.skeleton&&(t.parent&&t.parent.index!==-1?s=this._loadBone(t.parent,e,n,r):e.skeleton!==void 0&&N.Warn("/skins/".concat(e.index,"/skeleton: Skeleton node is not a common root")));var i=e.joints.indexOf(t.index);return o=new At(t.name||"joint".concat(t.index),n,s,this._getNodeMatrix(t),null,null,i),r[t.index]=o,this._postSceneLoadActions.push(function(){o.linkTransformNode(t._babylonTransformNode)}),o},a.prototype._loadSkinInverseBindMatricesDataAsync=function(t,e){if(e.inverseBindMatrices==null)return Promise.resolve(null);var n=_.Get("".concat(t,"/inverseBindMatrices"),this._gltf.accessors,e.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/".concat(n.index),n)},a.prototype._updateBoneMatrices=function(t,e){for(var n=0,r=t.bones;n<r.length;n++){var o=r[n],s=j.Identity(),i=o._index;e&&i!==-1&&(j.FromArrayToRef(e,i*16,s),s.invertToRef(s));var c=o.getParent();c&&s.multiplyToRef(c.getInvertedAbsoluteTransform(),s),o.updateMatrix(s,!1,!1),o._updateDifferenceMatrix(void 0,!1)}},a.prototype._getNodeMatrix=function(t){return t.matrix?j.FromArray(t.matrix):j.Compose(t.scale?L.FromArray(t.scale):L.One(),t.rotation?q.FromArray(t.rotation):q.Identity(),t.translation?L.FromArray(t.translation):L.Zero())},a.prototype.loadCameraAsync=function(t,e,n){n===void 0&&(n=function(){});var r=this._extensionsLoadCameraAsync(t,e,n);if(r)return r;var o=new Array;this.logOpen("".concat(t," ").concat(e.name||"")),this._babylonScene._blockEntityCollection=!!this._assetContainer;var s=new _t(e.name||"camera".concat(e.index),L.Zero(),this._babylonScene,!1);switch(s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s.ignoreParentScaling=!0,s.rotation=new L(0,Math.PI,0),e.type){case"perspective":{var i=e.perspective;if(!i)throw new Error("".concat(t,": Camera perspective properties are missing"));s.fov=i.yfov,s.minZ=i.znear,s.maxZ=i.zfar||0;break}case"orthographic":{if(!e.orthographic)throw new Error("".concat(t,": Camera orthographic properties are missing"));s.mode=mt.ORTHOGRAPHIC_CAMERA,s.orthoLeft=-e.orthographic.xmag,s.orthoRight=e.orthographic.xmag,s.orthoBottom=-e.orthographic.ymag,s.orthoTop=e.orthographic.ymag,s.minZ=e.orthographic.znear,s.maxZ=e.orthographic.zfar;break}default:throw new Error("".concat(t,": Invalid camera type (").concat(e.type,")"))}return a.AddPointerMetadata(s,t),this._parent.onCameraLoadedObservable.notifyObservers(s),n(s),e._babylonCamera=s,this.logClose(),Promise.all(o).then(function(){return s})},a.prototype._loadAnimationsAsync=function(){var t=this._gltf.animations;if(!t)return Promise.resolve();for(var e=new Array,n=0;n<t.length;n++){var r=t[n];e.push(this.loadAnimationAsync("/animations/".concat(r.index),r).then(function(o){o.targetedAnimations.length===0&&o.dispose()}))}return Promise.all(e).then(function(){})},a.prototype.loadAnimationAsync=function(t,e){for(var n=0,r=e.channels;n<r.length;n++){var o=r[n];o.target.path!="pointer"&&(o.target.extensions=o.target.extensions||{},o.target.extensions.KHR_animation_pointer={pointer:"/nodes/".concat(o.target.node,"/").concat(o.target.path)},o.target.path="pointer",delete o.target.node,this._gltf.extensionsUsed=this._gltf.extensionsUsed||[],this._gltf.extensionsUsed.indexOf(a._KHRAnimationPointerName)===-1&&this._gltf.extensionsUsed.push(a._KHRAnimationPointerName))}this._babylonScene._blockEntityCollection=!!this._assetContainer;var s=new nt(e.name||"animation".concat(e.index),this._babylonScene);s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e._babylonAnimationGroup=s;var i=this._extensionsLoadAnimationAsync(t,e);return i!=null?i:Promise.resolve(e._babylonAnimationGroup)},a.prototype.loadBufferAsync=function(t,e,n,r){var o=this._extensionsLoadBufferAsync(t,e,n,r);if(o)return o;if(!e._data)if(e.uri)e._data=this.loadUriAsync("".concat(t,"/uri"),e,e.uri);else{if(!this._bin)throw new Error("".concat(t,": Uri is missing or the binary glTF is missing its binary chunk"));e._data=this._bin.readAsync(0,e.byteLength)}return e._data.then(function(s){try{return new Uint8Array(s.buffer,s.byteOffset+n,r)}catch(i){throw new Error("".concat(t,": ").concat(i.message))}})},a.prototype.loadBufferViewAsync=function(t,e){var n=this._extensionsLoadBufferViewAsync(t,e);if(n)return n;if(e._data)return e._data;var r=_.Get("".concat(t,"/buffer"),this._gltf.buffers,e.buffer);return e._data=this.loadBufferAsync("/buffers/".concat(r.index),r,e.byteOffset||0,e.byteLength),e._data},a.prototype._loadAccessorAsync=function(t,e,n){var r=this;if(e._data)return e._data;var o=a._GetNumComponents(t,e.type),s=o*T.GetTypeByteLength(e.componentType),i=o*e.count;if(e.bufferView==null)e._data=Promise.resolve(new n(i));else{var c=_.Get("".concat(t,"/bufferView"),this._gltf.bufferViews,e.bufferView);e._data=this.loadBufferViewAsync("/bufferViews/".concat(c.index),c).then(function(l){if(e.componentType===5126&&!e.normalized&&(!c.byteStride||c.byteStride===s))return a._GetTypedArray(t,e.componentType,l,e.byteOffset,i);var f=new n(i);return T.ForEach(l,e.byteOffset||0,c.byteStride||s,o,e.componentType,f.length,e.normalized||!1,function(d,h){f[h]=d}),f})}if(e.sparse){var u=e.sparse;e._data=e._data.then(function(l){var f=l,d=_.Get("".concat(t,"/sparse/indices/bufferView"),r._gltf.bufferViews,u.indices.bufferView),h=_.Get("".concat(t,"/sparse/values/bufferView"),r._gltf.bufferViews,u.values.bufferView);return Promise.all([r.loadBufferViewAsync("/bufferViews/".concat(d.index),d),r.loadBufferViewAsync("/bufferViews/".concat(h.index),h)]).then(function(p){var m=p[0],y=p[1],A=a._GetTypedArray("".concat(t,"/sparse/indices"),u.indices.componentType,m,u.indices.byteOffset,u.count),O=o*u.count,b;if(e.componentType===5126&&!e.normalized)b=a._GetTypedArray("".concat(t,"/sparse/values"),e.componentType,y,u.values.byteOffset,O);else{var C=a._GetTypedArray("".concat(t,"/sparse/values"),e.componentType,y,u.values.byteOffset,O);b=new n(O),T.ForEach(C,0,s,o,e.componentType,b.length,e.normalized||!1,function(W,oe){b[oe]=W})}for(var k=0,x=0;x<A.length;x++)for(var S=A[x]*o,H=0;H<o;H++)f[S++]=b[k++];return f})})}return e._data},a.prototype._loadFloatAccessorAsync=function(t,e){return this._loadAccessorAsync(t,e,Float32Array)},a.prototype._loadIndicesAccessorAsync=function(t,e){if(e.type!=="SCALAR")throw new Error("".concat(t,"/type: Invalid value ").concat(e.type));if(e.componentType!==5121&&e.componentType!==5123&&e.componentType!==5125)throw new Error("".concat(t,"/componentType: Invalid value ").concat(e.componentType));if(e._data)return e._data;if(e.sparse){var n=a._GetTypedArrayConstructor("".concat(t,"/componentType"),e.componentType);e._data=this._loadAccessorAsync(t,e,n)}else{var r=_.Get("".concat(t,"/bufferView"),this._gltf.bufferViews,e.bufferView);e._data=this.loadBufferViewAsync("/bufferViews/".concat(r.index),r).then(function(o){return a._GetTypedArray(t,e.componentType,o,e.byteOffset,e.count)})}return e._data},a.prototype._loadVertexBufferViewAsync=function(t){if(t._babylonBuffer)return t._babylonBuffer;var e=this._babylonScene.getEngine();return t._babylonBuffer=this.loadBufferViewAsync("/bufferViews/".concat(t.index),t).then(function(n){return new Ot(e,n,!1)}),t._babylonBuffer},a.prototype._loadVertexAccessorAsync=function(t,e,n){var r;if(!((r=e._babylonVertexBuffer)===null||r===void 0)&&r[n])return e._babylonVertexBuffer[n];e._babylonVertexBuffer||(e._babylonVertexBuffer={});var o=this._babylonScene.getEngine();if(e.sparse)e._babylonVertexBuffer[n]=this._loadFloatAccessorAsync(t,e).then(function(i){return new T(o,i,n,!1)});else if(n===T.MatricesIndicesKind||n===T.MatricesIndicesExtraKind)e._babylonVertexBuffer[n]=this._loadFloatAccessorAsync(t,e).then(function(i){return new T(o,i,n,!1)});else{var s=_.Get("".concat(t,"/bufferView"),this._gltf.bufferViews,e.bufferView);e._babylonVertexBuffer[n]=this._loadVertexBufferViewAsync(s).then(function(i){var c=a._GetNumComponents(t,e.type);return new T(o,i,n,!1,!1,s.byteStride,!1,e.byteOffset,c,e.componentType,e.normalized,!0,1,!0)})}return e._babylonVertexBuffer[n]},a.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(t,e,n){if(!(n instanceof w))throw new Error("".concat(t,": Material type not supported"));var r=new Array;return e&&(e.baseColorFactor?(n.albedoColor=I.FromArray(e.baseColorFactor),n.alpha=e.baseColorFactor[3]):n.albedoColor=I.White(),n.metallic=e.metallicFactor==null?1:e.metallicFactor,n.roughness=e.roughnessFactor==null?1:e.roughnessFactor,e.baseColorTexture&&r.push(this.loadTextureInfoAsync("".concat(t,"/baseColorTexture"),e.baseColorTexture,function(o){o.name="".concat(n.name," (Base Color)"),n.albedoTexture=o})),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture.nonColorData=!0,r.push(this.loadTextureInfoAsync("".concat(t,"/metallicRoughnessTexture"),e.metallicRoughnessTexture,function(o){o.name="".concat(n.name," (Metallic Roughness)"),n.metallicTexture=o})),n.useMetallnessFromMetallicTextureBlue=!0,n.useRoughnessFromMetallicTextureGreen=!0,n.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(r).then(function(){})},a.prototype._loadMaterialAsync=function(t,e,n,r,o){o===void 0&&(o=function(){});var s=this._extensionsLoadMaterialAsync(t,e,n,r,o);if(s)return s;e._data=e._data||{};var i=e._data[r];if(!i){this.logOpen("".concat(t," ").concat(e.name||""));var c=this.createMaterial(t,e,r);i={babylonMaterial:c,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,e,c)},e._data[r]=i,a.AddPointerMetadata(c,t),this._parent.onMaterialLoadedObservable.notifyObservers(c),this.logClose()}return n&&(i.babylonMeshes.push(n),n.onDisposeObservable.addOnce(function(){var u=i.babylonMeshes.indexOf(n);u!==-1&&i.babylonMeshes.splice(u,1)})),o(i.babylonMaterial),i.promise.then(function(){return i.babylonMaterial})},a.prototype._createDefaultMaterial=function(t,e){this._babylonScene._blockEntityCollection=!!this._assetContainer;var n=new w(t,this._babylonScene);return n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.fillMode=e,n.enableSpecularAntiAliasing=!0,n.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,n.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,n.transparencyMode=w.PBRMATERIAL_OPAQUE,n.metallic=1,n.roughness=1,n},a.prototype.createMaterial=function(t,e,n){var r=this._extensionsCreateMaterial(t,e,n);if(r)return r;var o=e.name||"material".concat(e.index),s=this._createDefaultMaterial(o,n);return s},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this._extensionsLoadMaterialPropertiesAsync(t,e,n);if(r)return r;var o=new Array;return o.push(this.loadMaterialBasePropertiesAsync(t,e,n)),e.pbrMetallicRoughness&&o.push(this._loadMaterialMetallicRoughnessPropertiesAsync("".concat(t,"/pbrMetallicRoughness"),e.pbrMetallicRoughness,n)),this.loadMaterialAlphaProperties(t,e,n),Promise.all(o).then(function(){})},a.prototype.loadMaterialBasePropertiesAsync=function(t,e,n){if(!(n instanceof w))throw new Error("".concat(t,": Material type not supported"));var r=new Array;return n.emissiveColor=e.emissiveFactor?I.FromArray(e.emissiveFactor):new I(0,0,0),e.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),e.normalTexture&&(e.normalTexture.nonColorData=!0,r.push(this.loadTextureInfoAsync("".concat(t,"/normalTexture"),e.normalTexture,function(o){o.name="".concat(n.name," (Normal)"),n.bumpTexture=o})),n.invertNormalMapX=!this._babylonScene.useRightHandedSystem,n.invertNormalMapY=this._babylonScene.useRightHandedSystem,e.normalTexture.scale!=null&&n.bumpTexture&&(n.bumpTexture.level=e.normalTexture.scale),n.forceIrradianceInFragment=!0),e.occlusionTexture&&(e.occlusionTexture.nonColorData=!0,r.push(this.loadTextureInfoAsync("".concat(t,"/occlusionTexture"),e.occlusionTexture,function(o){o.name="".concat(n.name," (Occlusion)"),n.ambientTexture=o})),n.useAmbientInGrayScale=!0,e.occlusionTexture.strength!=null&&(n.ambientTextureStrength=e.occlusionTexture.strength)),e.emissiveTexture&&r.push(this.loadTextureInfoAsync("".concat(t,"/emissiveTexture"),e.emissiveTexture,function(o){o.name="".concat(n.name," (Emissive)"),n.emissiveTexture=o})),Promise.all(r).then(function(){})},a.prototype.loadMaterialAlphaProperties=function(t,e,n){if(!(n instanceof w))throw new Error("".concat(t,": Material type not supported"));var r=e.alphaMode||"OPAQUE";switch(r){case"OPAQUE":{n.transparencyMode=w.PBRMATERIAL_OPAQUE;break}case"MASK":{n.transparencyMode=w.PBRMATERIAL_ALPHATEST,n.alphaCutOff=e.alphaCutoff==null?.5:e.alphaCutoff,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0);break}case"BLEND":{n.transparencyMode=w.PBRMATERIAL_ALPHABLEND,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0,n.useAlphaFromAlbedoTexture=!0);break}default:throw new Error("".concat(t,"/alphaMode: Invalid value (").concat(e.alphaMode,")"))}},a.prototype.loadTextureInfoAsync=function(t,e,n){var r=this;n===void 0&&(n=function(){});var o=this._extensionsLoadTextureInfoAsync(t,e,n);if(o)return o;if(this.logOpen("".concat(t)),e.texCoord>=6)throw new Error("".concat(t,"/texCoord: Invalid value (").concat(e.texCoord,")"));var s=_.Get("".concat(t,"/index"),this._gltf.textures,e.index);s._textureInfo=e;var i=this._loadTextureAsync("/textures/".concat(e.index),s,function(c){c.coordinatesIndex=e.texCoord||0,a.AddPointerMetadata(c,t),r._parent.onTextureLoadedObservable.notifyObservers(c),n(c)});return this.logClose(),i},a.prototype._loadTextureAsync=function(t,e,n){n===void 0&&(n=function(){});var r=this._extensionsLoadTextureAsync(t,e,n);if(r)return r;this.logOpen("".concat(t," ").concat(e.name||""));var o=e.sampler==null?a.DefaultSampler:_.Get("".concat(t,"/sampler"),this._gltf.samplers,e.sampler),s=_.Get("".concat(t,"/source"),this._gltf.images,e.source),i=this._createTextureAsync(t,o,s,n,void 0,!e._textureInfo.nonColorData);return this.logClose(),i},a.prototype._createTextureAsync=function(t,e,n,r,o,s){var i=this;r===void 0&&(r=function(){});var c=this._loadSampler("/samplers/".concat(e.index),e),u=new Array,l=new Z;this._babylonScene._blockEntityCollection=!!this._assetContainer;var f={noMipmap:c.noMipMaps,invertY:!1,samplingMode:c.samplingMode,onLoad:function(){i._disposed||l.resolve()},onError:function(h,p){i._disposed||l.reject(new Error("".concat(t,": ").concat(p&&p.message?p.message:h||"Failed to load texture")))},mimeType:n.mimeType,loaderOptions:o,useSRGBBuffer:!!s&&this._parent.useSRGBBuffers},d=new P(null,this._babylonScene,f);return d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.push(l.promise),u.push(this.loadImageAsync("/images/".concat(n.index),n).then(function(h){var p=n.uri||"".concat(i._fileName,"#image").concat(n.index),m="data:".concat(i._uniqueRootUrl).concat(p);d.updateURL(m,h)})),d.wrapU=c.wrapU,d.wrapV=c.wrapV,r(d),Promise.all(u).then(function(){return d})},a.prototype._loadSampler=function(t,e){return e._data||(e._data={noMipMaps:e.minFilter===9728||e.minFilter===9729,samplingMode:a._GetTextureSamplingMode(t,e),wrapU:a._GetTextureWrapMode("".concat(t,"/wrapS"),e.wrapS),wrapV:a._GetTextureWrapMode("".concat(t,"/wrapT"),e.wrapT)}),e._data},a.prototype.loadImageAsync=function(t,e){if(!e._data){if(this.logOpen("".concat(t," ").concat(e.name||"")),e.uri)e._data=this.loadUriAsync("".concat(t,"/uri"),e,e.uri);else{var n=_.Get("".concat(t,"/bufferView"),this._gltf.bufferViews,e.bufferView);e._data=this.loadBufferViewAsync("/bufferViews/".concat(n.index),n)}this.logClose()}return e._data},a.prototype.loadUriAsync=function(t,e,n){var r=this,o=this._extensionsLoadUriAsync(t,e,n);if(o)return o;if(!a._ValidateUri(n))throw new Error("".concat(t,": '").concat(n,"' is invalid"));if(ut(n)){var s=new Uint8Array(tt(n));return this.log("".concat(t,": Decoded ").concat(n.substr(0,64),"... (").concat(s.length," bytes)")),Promise.resolve(s)}return this.log("".concat(t,": Loading ").concat(n)),this._parent.preprocessUrlAsync(this._rootUrl+n).then(function(i){return new Promise(function(c,u){r._parent._loadFile(r._babylonScene,i,function(l){r._disposed||(r.log("".concat(t,": Loaded ").concat(n," (").concat(l.byteLength," bytes)")),c(new Uint8Array(l)))},!0,function(l){u(new ft("".concat(t,": Failed to load '").concat(n,"'").concat(l?": "+l.status+" "+l.statusText:""),l))})})})},a.AddPointerMetadata=function(t,e){var n=t.metadata=t.metadata||{},r=n.gltf=n.gltf||{},o=r.pointers=r.pointers||[];o.push(e)},a._GetTextureWrapMode=function(t,e){switch(e=e==null?10497:e,e){case 33071:return P.CLAMP_ADDRESSMODE;case 33648:return P.MIRROR_ADDRESSMODE;case 10497:return P.WRAP_ADDRESSMODE;default:return N.Warn("".concat(t,": Invalid value (").concat(e,")")),P.WRAP_ADDRESSMODE}},a._GetTextureSamplingMode=function(t,e){var n=e.magFilter==null?9729:e.magFilter,r=e.minFilter==null?9987:e.minFilter;if(n===9729)switch(r){case 9728:return P.LINEAR_NEAREST;case 9729:return P.LINEAR_LINEAR;case 9984:return P.LINEAR_NEAREST_MIPNEAREST;case 9985:return P.LINEAR_LINEAR_MIPNEAREST;case 9986:return P.LINEAR_NEAREST_MIPLINEAR;case 9987:return P.LINEAR_LINEAR_MIPLINEAR;default:return N.Warn("".concat(t,"/minFilter: Invalid value (").concat(r,")")),P.LINEAR_LINEAR_MIPLINEAR}else switch(n!==9728&&N.Warn("".concat(t,"/magFilter: Invalid value (").concat(n,")")),r){case 9728:return P.NEAREST_NEAREST;case 9729:return P.NEAREST_LINEAR;case 9984:return P.NEAREST_NEAREST_MIPNEAREST;case 9985:return P.NEAREST_LINEAR_MIPNEAREST;case 9986:return P.NEAREST_NEAREST_MIPLINEAR;case 9987:return P.NEAREST_LINEAR_MIPLINEAR;default:return N.Warn("".concat(t,"/minFilter: Invalid value (").concat(r,")")),P.NEAREST_NEAREST_MIPNEAREST}},a._GetTypedArrayConstructor=function(t,e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error("".concat(t,": Invalid component type ").concat(e))}},a._GetTypedArray=function(t,e,n,r,o){var s=n.buffer;r=n.byteOffset+(r||0);var i=a._GetTypedArrayConstructor("".concat(t,"/componentType"),e),c=T.GetTypeByteLength(e);return r%c!==0?(N.Warn("".concat(t,": Copying buffer as byte offset (").concat(r,") is not a multiple of component type byte length (").concat(c,")")),new i(s.slice(r,r+o*c),0)):new i(s,r,o)},a._GetNumComponents=function(t,e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error("".concat(t,": Invalid type (").concat(e,")"))},a._ValidateUri=function(t){return G.IsBase64(t)||t.indexOf("..")===-1},a._GetDrawMode=function(t,e){switch(e==null&&(e=4),e){case 0:return V.PointListDrawMode;case 1:return V.LineListDrawMode;case 2:return V.LineLoopDrawMode;case 3:return V.LineStripDrawMode;case 4:return V.TriangleFillMode;case 5:return V.TriangleStripDrawMode;case 6:return V.TriangleFanDrawMode}throw new Error("".concat(t,": Invalid mesh primitive mode (").concat(e,")"))},a.prototype._compileMaterialsAsync=function(){var t=this;this._parent._startPerformanceCounter("Compile materials");var e=new Array;if(this._gltf.materials)for(var n=0,r=this._gltf.materials;n<r.length;n++){var o=r[n];if(o._data)for(var s in o._data)for(var i=o._data[s],c=0,u=i.babylonMeshes;c<u.length;c++){var l=u[c];l.computeWorldMatrix(!0);var f=i.babylonMaterial;e.push(f.forceCompilationAsync(l)),e.push(f.forceCompilationAsync(l,{useInstances:!0})),this._parent.useClipPlane&&(e.push(f.forceCompilationAsync(l,{clipPlane:!0})),e.push(f.forceCompilationAsync(l,{clipPlane:!0,useInstances:!0})))}}return Promise.all(e).then(function(){t._parent._endPerformanceCounter("Compile materials")})},a.prototype._compileShadowGeneratorsAsync=function(){var t=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var e=new Array,n=this._babylonScene.lights,r=0,o=n;r<o.length;r++){var s=o[r],i=s.getShadowGenerator();i&&e.push(i.forceCompilationAsync())}return Promise.all(e).then(function(){t._parent._endPerformanceCounter("Compile shadow generators")})},a.prototype._forEachExtensions=function(t){for(var e=0,n=this._extensions;e<n.length;e++){var r=n[e];r.enabled&&t(r)}},a.prototype._applyExtensions=function(t,e,n){for(var r=0,o=this._extensions;r<o.length;r++){var s=o[r];if(s.enabled){var i="".concat(s.name,".").concat(e),c=t;c._activeLoaderExtensionFunctions=c._activeLoaderExtensionFunctions||{};var u=c._activeLoaderExtensionFunctions;if(!u[i]){u[i]=!0;try{var l=n(s);if(l)return l}finally{delete u[i]}}}}return null},a.prototype._extensionsOnLoading=function(){this._forEachExtensions(function(t){return t.onLoading&&t.onLoading()})},a.prototype._extensionsOnReady=function(){this._forEachExtensions(function(t){return t.onReady&&t.onReady()})},a.prototype._extensionsLoadSceneAsync=function(t,e){return this._applyExtensions(e,"loadScene",function(n){return n.loadSceneAsync&&n.loadSceneAsync(t,e)})},a.prototype._extensionsLoadNodeAsync=function(t,e,n){return this._applyExtensions(e,"loadNode",function(r){return r.loadNodeAsync&&r.loadNodeAsync(t,e,n)})},a.prototype._extensionsLoadCameraAsync=function(t,e,n){return this._applyExtensions(e,"loadCamera",function(r){return r.loadCameraAsync&&r.loadCameraAsync(t,e,n)})},a.prototype._extensionsLoadVertexDataAsync=function(t,e,n){return this._applyExtensions(e,"loadVertexData",function(r){return r._loadVertexDataAsync&&r._loadVertexDataAsync(t,e,n)})},a.prototype._extensionsLoadMeshPrimitiveAsync=function(t,e,n,r,o,s){return this._applyExtensions(o,"loadMeshPrimitive",function(i){return i._loadMeshPrimitiveAsync&&i._loadMeshPrimitiveAsync(t,e,n,r,o,s)})},a.prototype._extensionsLoadMaterialAsync=function(t,e,n,r,o){return this._applyExtensions(e,"loadMaterial",function(s){return s._loadMaterialAsync&&s._loadMaterialAsync(t,e,n,r,o)})},a.prototype._extensionsCreateMaterial=function(t,e,n){return this._applyExtensions(e,"createMaterial",function(r){return r.createMaterial&&r.createMaterial(t,e,n)})},a.prototype._extensionsLoadMaterialPropertiesAsync=function(t,e,n){return this._applyExtensions(e,"loadMaterialProperties",function(r){return r.loadMaterialPropertiesAsync&&r.loadMaterialPropertiesAsync(t,e,n)})},a.prototype._extensionsLoadTextureInfoAsync=function(t,e,n){return this._applyExtensions(e,"loadTextureInfo",function(r){return r.loadTextureInfoAsync&&r.loadTextureInfoAsync(t,e,n)})},a.prototype._extensionsLoadTextureAsync=function(t,e,n){return this._applyExtensions(e,"loadTexture",function(r){return r._loadTextureAsync&&r._loadTextureAsync(t,e,n)})},a.prototype._extensionsLoadAnimationAsync=function(t,e){return this._applyExtensions(e,"loadAnimation",function(n){return n.loadAnimationAsync&&n.loadAnimationAsync(t,e)})},a.prototype._extensionsLoadSkinAsync=function(t,e,n){return this._applyExtensions(n,"loadSkin",function(r){return r._loadSkinAsync&&r._loadSkinAsync(t,e,n)})},a.prototype._extensionsLoadUriAsync=function(t,e,n){return this._applyExtensions(e,"loadUri",function(r){return r._loadUriAsync&&r._loadUriAsync(t,e,n)})},a.prototype._extensionsLoadBufferViewAsync=function(t,e){return this._applyExtensions(e,"loadBufferView",function(n){return n.loadBufferViewAsync&&n.loadBufferViewAsync(t,e)})},a.prototype._extensionsLoadBufferAsync=function(t,e,n,r){return this._applyExtensions(e,"loadBuffer",function(o){return o.loadBufferAsync&&o.loadBufferAsync(t,e,n,r)})},a.LoadExtensionAsync=function(t,e,n,r){if(!e.extensions)return null;var o=e.extensions,s=o[n];return s?r("".concat(t,"/extensions/").concat(n),s):null},a.LoadExtraAsync=function(t,e,n,r){if(!e.extras)return null;var o=e.extras,s=o[n];return s?r("".concat(t,"/extras/").concat(n),s):null},a.prototype.isExtensionUsed=function(t){return!!this._gltf.extensionsUsed&&this._gltf.extensionsUsed.indexOf(t)!==-1},a.prototype.logOpen=function(t){this._parent._logOpen(t)},a.prototype.logClose=function(){this._parent._logClose()},a.prototype.log=function(t){this._parent._log(t)},a.prototype.startPerformanceCounter=function(t){this._parent._startPerformanceCounter(t)},a.prototype.endPerformanceCounter=function(t){this._parent._endPerformanceCounter(t)},a._KHRAnimationPointerName="KHR_animation_pointer",a._RegisteredExtensions={},a.DefaultSampler={index:-1},a}();ot._CreateGLTF2Loader=function(a){return new v(a)};var ve="EXT_lights_image_based",Gt=function(){function a(t){this.name=ve,this._loader=t,this.enabled=this._loader.isExtensionUsed(ve)}return a.prototype.dispose=function(){this._loader=null,delete this._lights},a.prototype.onLoading=function(){var t=this._loader.gltf.extensions;if(t&&t[this.name]){var e=t[this.name];this._lights=e.lights}},a.prototype.loadSceneAsync=function(t,e){var n=this;return v.LoadExtensionAsync(t,e,this.name,function(r,o){var s=new Array;s.push(n._loader.loadSceneAsync(t,e)),n._loader.logOpen("".concat(r));var i=_.Get("".concat(r,"/light"),n._lights,o.light);return s.push(n._loadLightAsync("/extensions/".concat(n.name,"/lights/").concat(o.light),i).then(function(c){n._loader.babylonScene.environmentTexture=c})),n._loader.logClose(),Promise.all(s).then(function(){})})},a.prototype._loadLightAsync=function(t,e){var n=this;if(!e._loaded){var r=new Array;this._loader.logOpen("".concat(t));for(var o=new Array(e.specularImages.length),s=function(u){var l=e.specularImages[u];o[u]=new Array(l.length);for(var f=function(h){var p="".concat(t,"/specularImages/").concat(u,"/").concat(h);i._loader.logOpen("".concat(p));var m=l[h],y=_.Get(p,i._loader.gltf.images,m);r.push(i._loader.loadImageAsync("/images/".concat(m),y).then(function(A){o[u][h]=A})),i._loader.logClose()},d=0;d<l.length;d++)f(d)},i=this,c=0;c<e.specularImages.length;c++)s(c);this._loader.logClose(),e._loaded=Promise.all(r).then(function(){var u=new Tt(n._loader.babylonScene,null,e.specularImageSize);if(u.name=e.name||"environment",e._babylonTexture=u,e.intensity!=null&&(u.level=e.intensity),e.rotation){var l=q.FromArray(e.rotation);n._loader.babylonScene.useRightHandedSystem||(l=q.Inverse(l)),j.FromQuaternionToRef(l,u.getReflectionTextureMatrix())}if(!e.irradianceCoefficients)throw new Error("".concat(t,": Irradiance coefficients are missing"));var f=dt.FromArray(e.irradianceCoefficients);f.scaleInPlace(e.intensity),f.convertIrradianceToLambertianRadiance();var d=ht.FromHarmonics(f),h=(o.length-1)/pt.Log2(e.specularImageSize);return u.updateRGBDAsync(o,d,h)})}return e._loaded.then(function(){return e._babylonTexture})},a}();v.RegisterExtension(ve,function(a){return new Gt(a)});var ye="EXT_mesh_gpu_instancing",kt=function(){function a(t){this.name=ye,this._loader=t,this.enabled=this._loader.isExtensionUsed(ye)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadNodeAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){r._loader._disableInstancedMesh++;var i=r._loader.loadNodeAsync("/nodes/".concat(e.index),e,n);if(r._loader._disableInstancedMesh--,!e._primitiveBabylonMeshes)return i;var c=new Array,u=0,l=function(f){if(s.attributes[f]==null){c.push(Promise.resolve(null));return}var d=_.Get("".concat(o,"/attributes/").concat(f),r._loader.gltf.accessors,s.attributes[f]);if(c.push(r._loader._loadFloatAccessorAsync("/accessors/".concat(d.bufferView),d)),u===0)u=d.count;else if(u!==d.count)throw new Error("".concat(o,"/attributes: Instance buffer accessors do not have the same count."))};return l("TRANSLATION"),l("ROTATION"),l("SCALE"),i.then(function(f){return Promise.all(c).then(function(d){var h=d[0],p=d[1],m=d[2],y=new Float32Array(u*16);B.Vector3[0].copyFromFloats(0,0,0),B.Quaternion[0].copyFromFloats(0,0,0,1),B.Vector3[1].copyFromFloats(1,1,1);for(var A=0;A<u;++A)h&&L.FromArrayToRef(h,A*3,B.Vector3[0]),p&&q.FromArrayToRef(p,A*4,B.Quaternion[0]),m&&L.FromArrayToRef(m,A*3,B.Vector3[1]),j.ComposeToRef(B.Vector3[1],B.Quaternion[0],B.Vector3[0],B.Matrix[0]),B.Matrix[0].copyToArray(y,A*16);for(var O=0,b=e._primitiveBabylonMeshes;O<b.length;O++){var C=b[O];C.thinInstanceSetBuffer("matrix",y,16,!0)}return f})})})},a}();v.RegisterExtension(ye,function(a){return new kt(a)});var ge="EXT_meshopt_compression",Vt=function(){function a(t){this.name=ge,this.enabled=t.isExtensionUsed(ge),this._loader=t}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadBufferViewAsync=function(t,e){var n=this;return v.LoadExtensionAsync(t,e,this.name,function(r,o){var s=e;if(s._meshOptData)return s._meshOptData;var i=_.Get("".concat(t,"/buffer"),n._loader.gltf.buffers,o.buffer);return s._meshOptData=n._loader.loadBufferAsync("/buffers/".concat(i.index),i,o.byteOffset||0,o.byteLength).then(function(c){return bt.Default.decodeGltfBufferAsync(c,o.count,o.byteStride,o.mode,o.filter)}),s._meshOptData})},a}();v.RegisterExtension(ge,function(a){return new Vt(a)});var Ae="EXT_texture_webp",Ut=function(){function a(t){this.name=Ae,this._loader=t,this.enabled=t.isExtensionUsed(Ae)}return a.prototype.dispose=function(){this._loader=null},a.prototype._loadTextureAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){var i=e.sampler==null?v.DefaultSampler:_.Get("".concat(t,"/sampler"),r._loader.gltf.samplers,e.sampler),c=_.Get("".concat(o,"/source"),r._loader.gltf.images,s.source);return r._loader._createTextureAsync(t,i,c,function(u){n(u)},void 0,!e._textureInfo.nonColorData)})},a}();v.RegisterExtension(Ae,function(a){return new Ut(a)});var Te="KHR_draco_mesh_compression",Kt=function(){function a(t){this.name=Te,this._loader=t,this.enabled=Je.DecoderAvailable&&this._loader.isExtensionUsed(Te)}return a.prototype.dispose=function(){delete this.dracoCompression,this._loader=null},a.prototype._loadVertexDataAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){if(e.mode!=null){if(e.mode!==5&&e.mode!==4)throw new Error("".concat(t,": Unsupported mode ").concat(e.mode));if(e.mode===5)throw new Error("".concat(t,": Mode ").concat(e.mode," is not currently supported"))}var i={},c={},u=function(f,d){var h=s.attributes[f];if(!(h===void 0||e.attributes[f]===void 0)){i[d]=h;var p=_.Get("".concat(t,"/attributes/").concat(f),r._loader.gltf.accessors,e.attributes[f]);if(p.normalized&&p.componentType!==5126){var m=1;switch(p.componentType){case 5120:m=127;break;case 5121:m=255;break;case 5122:m=32767;break;case 5123:m=65535;break}c[d]=m}n._delayInfo=n._delayInfo||[],n._delayInfo.indexOf(d)===-1&&n._delayInfo.push(d)}};u("POSITION",T.PositionKind),u("NORMAL",T.NormalKind),u("TANGENT",T.TangentKind),u("TEXCOORD_0",T.UVKind),u("TEXCOORD_1",T.UV2Kind),u("TEXCOORD_2",T.UV3Kind),u("TEXCOORD_3",T.UV4Kind),u("TEXCOORD_4",T.UV5Kind),u("TEXCOORD_5",T.UV6Kind),u("JOINTS_0",T.MatricesIndicesKind),u("WEIGHTS_0",T.MatricesWeightsKind),u("COLOR_0",T.ColorKind);var l=_.Get(o,r._loader.gltf.bufferViews,s.bufferView);return l._dracoBabylonGeometry||(l._dracoBabylonGeometry=r._loader.loadBufferViewAsync("/bufferViews/".concat(l.index),l).then(function(f){var d=r.dracoCompression||Je.Default;return d.decodeMeshAsync(f,i,c).then(function(h){var p=new rt(n.name,r._loader.babylonScene);return h.applyToGeometry(p),p}).catch(function(h){throw new Error("".concat(t,": ").concat(h.message))})})),l._dracoBabylonGeometry})},a}();v.RegisterExtension(Te,function(a){return new Kt(a)});var Ee="KHR_lights_punctual",Ht=function(){function a(t){this.name=Ee,this._loader=t,this.enabled=this._loader.isExtensionUsed(Ee)}return a.prototype.dispose=function(){this._loader=null,delete this._lights},a.prototype.onLoading=function(){var t=this._loader.gltf.extensions;if(t&&t[this.name]){var e=t[this.name];this._lights=e.lights}},a.prototype.loadNodeAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){return r._loader.loadNodeAsync(t,e,function(i){var c,u=_.Get(o,r._lights,s.light),l=u.name||i.name;switch(r._loader.babylonScene._blockEntityCollection=!!r._loader._assetContainer,u.type){case"directional":{c=new xt(l,L.Backward(),r._loader.babylonScene);break}case"point":{c=new It(l,L.Zero(),r._loader.babylonScene);break}case"spot":{var f=new St(l,L.Zero(),L.Backward(),0,1,r._loader.babylonScene);f.angle=(u.spot&&u.spot.outerConeAngle||Math.PI/4)*2,f.innerAngle=(u.spot&&u.spot.innerConeAngle||0)*2,c=f;break}default:throw r._loader.babylonScene._blockEntityCollection=!1,new Error("".concat(o,": Invalid light type (").concat(u.type,")"))}c._parentContainer=r._loader._assetContainer,r._loader.babylonScene._blockEntityCollection=!1,c.falloffType=Rt.FALLOFF_GLTF,c.diffuse=u.color?I.FromArray(u.color):I.White(),c.intensity=u.intensity==null?1:u.intensity,c.range=u.range==null?Number.MAX_VALUE:u.range,c.parent=i,r._loader._babylonLights.push(c),u._babylonLight=c,v.AddPointerMetadata(c,o),n(i)})})},a}();v.RegisterExtension(Ee,function(a){return new Ht(a)});var be="KHR_materials_pbrSpecularGlossiness",Yt=function(){function a(t){this.name=be,this.order=200,this._loader=t,this.enabled=this._loader.isExtensionUsed(be)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){var i=new Array;return i.push(r._loader.loadMaterialBasePropertiesAsync(t,e,n)),i.push(r._loadSpecularGlossinessPropertiesAsync(o,e,s,n)),r._loader.loadMaterialAlphaProperties(t,e,n),Promise.all(i).then(function(){})})},a.prototype._loadSpecularGlossinessPropertiesAsync=function(t,e,n,r){if(!(r instanceof w))throw new Error("".concat(t,": Material type not supported"));var o=new Array;return r.metallic=null,r.roughness=null,n.diffuseFactor?(r.albedoColor=I.FromArray(n.diffuseFactor),r.alpha=n.diffuseFactor[3]):r.albedoColor=I.White(),r.reflectivityColor=n.specularFactor?I.FromArray(n.specularFactor):I.White(),r.microSurface=n.glossinessFactor==null?1:n.glossinessFactor,n.diffuseTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(t,"/diffuseTexture"),n.diffuseTexture,function(s){s.name="".concat(r.name," (Diffuse)"),r.albedoTexture=s})),n.specularGlossinessTexture&&(o.push(this._loader.loadTextureInfoAsync("".concat(t,"/specularGlossinessTexture"),n.specularGlossinessTexture,function(s){s.name="".concat(r.name," (Specular Glossiness)"),r.reflectivityTexture=s,r.reflectivityTexture.hasAlpha=!0})),r.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(o).then(function(){})},a}();v.RegisterExtension(be,function(a){return new Yt(a)});var Oe="KHR_materials_unlit",jt=function(){function a(t){this.name=Oe,this.order=210,this._loader=t,this.enabled=this._loader.isExtensionUsed(Oe)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(){return r._loadUnlitPropertiesAsync(t,e,n)})},a.prototype._loadUnlitPropertiesAsync=function(t,e,n){if(!(n instanceof w))throw new Error("".concat(t,": Material type not supported"));var r=new Array;n.unlit=!0;var o=e.pbrMetallicRoughness;return o&&(o.baseColorFactor?(n.albedoColor=I.FromArray(o.baseColorFactor),n.alpha=o.baseColorFactor[3]):n.albedoColor=I.White(),o.baseColorTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(t,"/baseColorTexture"),o.baseColorTexture,function(s){s.name="".concat(n.name," (Base Color)"),n.albedoTexture=s}))),e.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(t,e,n),Promise.all(r).then(function(){})},a}();v.RegisterExtension(Oe,function(a){return new jt(a)});var we="KHR_materials_clearcoat",qt=function(){function a(t){this.name=we,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(we)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){var i=new Array;return i.push(r._loader.loadMaterialPropertiesAsync(t,e,n)),i.push(r._loadClearCoatPropertiesAsync(o,s,n)),Promise.all(i).then(function(){})})},a.prototype._loadClearCoatPropertiesAsync=function(t,e,n){if(!(n instanceof w))throw new Error("".concat(t,": Material type not supported"));var r=new Array;return n.clearCoat.isEnabled=!0,n.clearCoat.useRoughnessFromMainTexture=!1,n.clearCoat.remapF0OnInterfaceChange=!1,e.clearcoatFactor!=null?n.clearCoat.intensity=e.clearcoatFactor:n.clearCoat.intensity=0,e.clearcoatTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(t,"/clearcoatTexture"),e.clearcoatTexture,function(o){o.name="".concat(n.name," (ClearCoat Intensity)"),n.clearCoat.texture=o})),e.clearcoatRoughnessFactor!=null?n.clearCoat.roughness=e.clearcoatRoughnessFactor:n.clearCoat.roughness=0,e.clearcoatRoughnessTexture&&(e.clearcoatRoughnessTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync("".concat(t,"/clearcoatRoughnessTexture"),e.clearcoatRoughnessTexture,function(o){o.name="".concat(n.name," (ClearCoat Roughness)"),n.clearCoat.textureRoughness=o}))),e.clearcoatNormalTexture&&(e.clearcoatNormalTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync("".concat(t,"/clearcoatNormalTexture"),e.clearcoatNormalTexture,function(o){o.name="".concat(n.name," (ClearCoat Normal)"),n.clearCoat.bumpTexture=o})),n.invertNormalMapX=!n.getScene().useRightHandedSystem,n.invertNormalMapY=n.getScene().useRightHandedSystem,e.clearcoatNormalTexture.scale!=null&&(n.clearCoat.bumpTexture.level=e.clearcoatNormalTexture.scale)),Promise.all(r).then(function(){})},a}();v.RegisterExtension(we,function(a){return new qt(a)});var Ce="KHR_materials_iridescence",Wt=function(){function a(t){this.name=Ce,this.order=195,this._loader=t,this.enabled=this._loader.isExtensionUsed(Ce)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){var i=new Array;return i.push(r._loader.loadMaterialPropertiesAsync(t,e,n)),i.push(r._loadIridescencePropertiesAsync(o,s,n)),Promise.all(i).then(function(){})})},a.prototype._loadIridescencePropertiesAsync=function(t,e,n){var r,o,s,i,c;if(!(n instanceof w))throw new Error("".concat(t,": Material type not supported"));var u=new Array;return n.iridescence.isEnabled=!0,n.iridescence.intensity=(r=e.iridescenceFactor)!==null&&r!==void 0?r:0,n.iridescence.indexOfRefraction=(s=(o=e.iridescenceIor)!==null&&o!==void 0?o:e.iridescenceIOR)!==null&&s!==void 0?s:1.3,n.iridescence.minimumThickness=(i=e.iridescenceThicknessMinimum)!==null&&i!==void 0?i:100,n.iridescence.maximumThickness=(c=e.iridescenceThicknessMaximum)!==null&&c!==void 0?c:400,e.iridescenceTexture&&u.push(this._loader.loadTextureInfoAsync("".concat(t,"/iridescenceTexture"),e.iridescenceTexture,function(l){l.name="".concat(n.name," (Iridescence Intensity)"),n.iridescence.texture=l})),e.iridescenceThicknessTexture&&u.push(this._loader.loadTextureInfoAsync("".concat(t,"/iridescenceThicknessTexture"),e.iridescenceThicknessTexture,function(l){l.name="".concat(n.name," (Iridescence Thickness)"),n.iridescence.thicknessTexture=l})),Promise.all(u).then(function(){})},a}();v.RegisterExtension(Ce,function(a){return new Wt(a)});var Pe="KHR_materials_emissive_strength",Xt=function(){function a(t){this.name=Pe,this.order=170,this._loader=t,this.enabled=this._loader.isExtensionUsed(Pe)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){return r._loader.loadMaterialPropertiesAsync(t,e,n).then(function(){r._loadEmissiveProperties(o,s,n)})})},a.prototype._loadEmissiveProperties=function(t,e,n){if(!(n instanceof w))throw new Error("".concat(t,": Material type not supported"));e.emissiveStrength!==void 0&&n.emissiveColor.scaleToRef(e.emissiveStrength,n.emissiveColor)},a}();v.RegisterExtension(Pe,function(a){return new Xt(a)});var Le="KHR_materials_sheen",zt=function(){function a(t){this.name=Le,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(Le)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){var i=new Array;return i.push(r._loader.loadMaterialPropertiesAsync(t,e,n)),i.push(r._loadSheenPropertiesAsync(o,s,n)),Promise.all(i).then(function(){})})},a.prototype._loadSheenPropertiesAsync=function(t,e,n){if(!(n instanceof w))throw new Error("".concat(t,": Material type not supported"));var r=new Array;return n.sheen.isEnabled=!0,n.sheen.intensity=1,e.sheenColorFactor!=null?n.sheen.color=I.FromArray(e.sheenColorFactor):n.sheen.color=I.Black(),e.sheenColorTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(t,"/sheenColorTexture"),e.sheenColorTexture,function(o){o.name="".concat(n.name," (Sheen Color)"),n.sheen.texture=o})),e.sheenRoughnessFactor!==void 0?n.sheen.roughness=e.sheenRoughnessFactor:n.sheen.roughness=0,e.sheenRoughnessTexture&&(e.sheenRoughnessTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync("".concat(t,"/sheenRoughnessTexture"),e.sheenRoughnessTexture,function(o){o.name="".concat(n.name," (Sheen Roughness)"),n.sheen.textureRoughness=o}))),n.sheen.albedoScaling=!0,n.sheen.useRoughnessFromMainTexture=!1,Promise.all(r).then(function(){})},a}();v.RegisterExtension(Le,function(a){return new zt(a)});var Se="KHR_materials_specular",$t=function(){function a(t){this.name=Se,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(Se)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){var i=new Array;return i.push(r._loader.loadMaterialPropertiesAsync(t,e,n)),i.push(r._loadSpecularPropertiesAsync(o,s,n)),Promise.all(i).then(function(){})})},a.prototype._loadSpecularPropertiesAsync=function(t,e,n){if(!(n instanceof w))throw new Error("".concat(t,": Material type not supported"));var r=new Array;return e.specularFactor!==void 0&&(n.metallicF0Factor=e.specularFactor),e.specularColorFactor!==void 0&&(n.metallicReflectanceColor=I.FromArray(e.specularColorFactor)),e.specularTexture&&(e.specularTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync("".concat(t,"/specularTexture"),e.specularTexture,function(o){o.name="".concat(n.name," (Specular F0 Strength)"),n.metallicReflectanceTexture=o,n.useOnlyMetallicFromMetallicReflectanceTexture=!0}))),e.specularColorTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(t,"/specularColorTexture"),e.specularColorTexture,function(o){o.name="".concat(n.name," (Specular F0 Color)"),n.reflectanceTexture=o})),Promise.all(r).then(function(){})},a}();v.RegisterExtension(Se,function(a){return new $t(a)});var Ie="KHR_materials_ior",Jt=function(){function a(t){this.name=Ie,this.order=180,this._loader=t,this.enabled=this._loader.isExtensionUsed(Ie)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){var i=new Array;return i.push(r._loader.loadMaterialPropertiesAsync(t,e,n)),i.push(r._loadIorPropertiesAsync(o,s,n)),Promise.all(i).then(function(){})})},a.prototype._loadIorPropertiesAsync=function(t,e,n){if(!(n instanceof w))throw new Error("".concat(t,": Material type not supported"));return e.ior!==void 0?n.indexOfRefraction=e.ior:n.indexOfRefraction=a._DEFAULT_IOR,Promise.resolve()},a._DEFAULT_IOR=1.5,a}();v.RegisterExtension(Ie,function(a){return new Jt(a)});var M="KHR_materials_variants",Qt=function(){function a(t){this.name=M,this._loader=t,this.enabled=this._loader.isExtensionUsed(M)}return a.prototype.dispose=function(){this._loader=null},a.GetAvailableVariants=function(t){var e=this._GetExtensionMetadata(t);return e?Object.keys(e.variants):[]},a.prototype.getAvailableVariants=function(t){return a.GetAvailableVariants(t)},a.SelectVariant=function(t,e){var n=this._GetExtensionMetadata(t);if(!n)throw new Error("Cannot select variant on a glTF mesh that does not have the ".concat(M," extension"));var r=function(c){var u=n.variants[c];if(u)for(var l=0,f=u;l<f.length;l++){var d=f[l];d.mesh.material=d.material}};if(e instanceof Array)for(var o=0,s=e;o<s.length;o++){var i=s[o];r(i)}else r(e);n.lastSelected=e},a.prototype.selectVariant=function(t,e){return a.SelectVariant(t,e)},a.Reset=function(t){var e=this._GetExtensionMetadata(t);if(!e)throw new Error("Cannot reset on a glTF mesh that does not have the ".concat(M," extension"));for(var n=0,r=e.original;n<r.length;n++){var o=r[n];o.mesh.material=o.material}e.lastSelected=null},a.prototype.reset=function(t){return a.Reset(t)},a.GetLastSelectedVariant=function(t){var e=this._GetExtensionMetadata(t);if(!e)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the ".concat(M," extension"));return e.lastSelected},a.prototype.getLastSelectedVariant=function(t){return a.GetLastSelectedVariant(t)},a._GetExtensionMetadata=function(t){var e,n;return((n=(e=t==null?void 0:t.metadata)===null||e===void 0?void 0:e.gltf)===null||n===void 0?void 0:n[M])||null},a.prototype.onLoading=function(){var t=this._loader.gltf.extensions;if(t&&t[this.name]){var e=t[this.name];this._variants=e.variants}},a.prototype._loadMeshPrimitiveAsync=function(t,e,n,r,o,s){var i=this;return v.LoadExtensionAsync(t,o,this.name,function(c,u){var l=new Array;return l.push(i._loader._loadMeshPrimitiveAsync(t,e,n,r,o,function(f){if(s(f),f instanceof _e){var d=v._GetDrawMode(t,o.mode),h=i._loader.rootBabylonMesh,p=h?h.metadata=h.metadata||{}:{},m=p.gltf=p.gltf||{},y=m[M]=m[M]||{lastSelected:null,original:[],variants:{}};y.original.push({mesh:f,material:f.material});for(var A=function(b){var C=u.mappings[b],k=_.Get("".concat(c,"/mappings/").concat(b,"/material"),i._loader.gltf.materials,C.material);l.push(i._loader._loadMaterialAsync("#/materials/".concat(C.material),k,f,d,function(x){for(var S=function(W){var oe=C.variants[W],ae=_.Get("/extensions/".concat(M,"/variants/").concat(oe),i._variants,oe);y.variants[ae.name]=y.variants[ae.name]||[],y.variants[ae.name].push({mesh:f,material:x}),f.onClonedObservable.add(function(it){var le=it,U=null,D=le;do{if(D=D.parent,!D)return;U=a._GetExtensionMetadata(D)}while(U===null);if(h&&U===a._GetExtensionMetadata(h)){D.metadata={};for(var K in h.metadata)D.metadata[K]=h.metadata[K];D.metadata.gltf=[];for(var K in h.metadata.gltf)D.metadata.gltf[K]=h.metadata.gltf[K];D.metadata.gltf[M]={lastSelected:null,original:[],variants:{}};for(var ue=0,Ye=U.original;ue<Ye.length;ue++){var je=Ye[ue];D.metadata.gltf[M].original.push({mesh:je.mesh,material:je.material})}for(var K in U.variants)if(Object.prototype.hasOwnProperty.call(U.variants,K)){D.metadata.gltf[M].variants[K]=[];for(var fe=0,qe=U.variants[K];fe<qe.length;fe++){var We=qe[fe];D.metadata.gltf[M].variants[K].push({mesh:We.mesh,material:We.material})}}U=D.metadata.gltf[M]}for(var de=0,Xe=U.original;de<Xe.length;de++){var J=Xe[de];J.mesh===f&&(J.mesh=le)}for(var he=0,ze=U.variants[ae.name];he<ze.length;he++){var J=ze[he];J.mesh===f&&(J.mesh=le)}})},H=0;H<C.variants.length;++H)S(H)}))},O=0;O<u.mappings.length;++O)A(O)}})),Promise.all(l).then(function(f){var d=f[0];return d})})},a}();v.RegisterExtension(M,function(a){return new Qt(a)});var Zt=function(){function a(t,e){var n=this;this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options=se(se({},a._GetDefaultOptions()),t),this._scene=e,this._scene._transmissionHelper=this,this.onErrorObservable=new R,this._scene.onDisposeObservable.addOnce(function(){n.dispose()}),this._parseScene(),this._setupRenderTargets()}return a._GetDefaultOptions=function(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Mt.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}},a.prototype.updateOptions=function(t){var e=this,n=Object.keys(t).filter(function(s){return e._options[s]!==t[s]});if(!!n.length){var r=se(se({},this._options),t),o=this._options;this._options=r,r.renderSize!==o.renderSize||r.renderTargetTextureType!==o.renderTargetTextureType||r.generateMipmaps!==o.generateMipmaps||!this._opaqueRenderTarget?this._setupRenderTargets():(this._opaqueRenderTarget.samples=r.samples,this._opaqueRenderTarget.lodGenerationScale=r.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=r.lodGenerationOffset)}},a.prototype.getOpaqueTarget=function(){return this._opaqueRenderTarget},a.prototype._shouldRenderAsTransmission=function(t){return t?!!(t instanceof w&&t.subSurface.isRefractionEnabled):!1},a.prototype._addMesh=function(t){var e=this;this._materialObservers[t.uniqueId]=t.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),G.SetImmediate(function(){e._shouldRenderAsTransmission(t.material)?(t.material.refractionTexture=e._opaqueRenderTarget,e._transparentMeshesCache.push(t)):e._opaqueMeshesCache.push(t)})},a.prototype._removeMesh=function(t){t.onMaterialChangedObservable.remove(this._materialObservers[t.uniqueId]),delete this._materialObservers[t.uniqueId];var e=this._transparentMeshesCache.indexOf(t);e!==-1&&this._transparentMeshesCache.splice(e,1),e=this._opaqueMeshesCache.indexOf(t),e!==-1&&this._opaqueMeshesCache.splice(e,1)},a.prototype._parseScene=function(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))},a.prototype._onMeshMaterialChanged=function(t){var e=this._transparentMeshesCache.indexOf(t),n=this._opaqueMeshesCache.indexOf(t),r=this._shouldRenderAsTransmission(t.material);r?(t.material instanceof w&&(t.material.subSurface.refractionTexture=this._opaqueRenderTarget),n!==-1?(this._opaqueMeshesCache.splice(n,1),this._transparentMeshesCache.push(t)):e===-1&&this._transparentMeshesCache.push(t)):e!==-1?(this._transparentMeshesCache.splice(e,1),this._opaqueMeshesCache.push(t)):n===-1&&this._opaqueMeshesCache.push(t)},a.prototype._setupRenderTargets=function(){var t=this,e,n;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Et("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(n=(e=this._options.clearColor)===null||e===void 0?void 0:e.clone())!==null&&n!==void 0?n:this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples;var r,o;this._opaqueRenderTarget.onBeforeBindObservable.add(function(s){o=t._scene.environmentIntensity,t._scene.environmentIntensity=1,r=t._scene.imageProcessingConfiguration.applyByPostProcess,t._options.clearColor?s.clearColor.copyFrom(t._options.clearColor):t._scene.clearColor.toLinearSpaceToRef(s.clearColor),t._scene.imageProcessingConfiguration._applyByPostProcess=!0}),this._opaqueRenderTarget.onAfterUnbindObservable.add(function(){t._scene.environmentIntensity=o,t._scene.imageProcessingConfiguration._applyByPostProcess=r}),this._transparentMeshesCache.forEach(function(s){t._shouldRenderAsTransmission(s.material)&&(s.material.refractionTexture=t._opaqueRenderTarget)})},a.prototype.dispose=function(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]},a}(),xe="KHR_materials_transmission",en=function(){function a(t){this.name=xe,this.order=175,this._loader=t,this.enabled=this._loader.isExtensionUsed(xe),this.enabled&&(t.parent.transparencyAsCoverage=!0)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){var i=new Array;return i.push(r._loader.loadMaterialBasePropertiesAsync(t,e,n)),i.push(r._loader.loadMaterialPropertiesAsync(t,e,n)),i.push(r._loadTransparentPropertiesAsync(o,e,n,s)),Promise.all(i).then(function(){})})},a.prototype._loadTransparentPropertiesAsync=function(t,e,n,r){if(!(n instanceof w))throw new Error("".concat(t,": Material type not supported"));var o=n;if(o.subSurface.isRefractionEnabled=!0,o.subSurface.volumeIndexOfRefraction=1,o.subSurface.useAlbedoToTintRefraction=!0,r.transmissionFactor!==void 0){o.subSurface.refractionIntensity=r.transmissionFactor;var s=o.getScene();o.subSurface.refractionIntensity&&!s._transmissionHelper&&new Zt({},o.getScene())}else return o.subSurface.refractionIntensity=0,o.subSurface.isRefractionEnabled=!1,Promise.resolve();return o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=0,r.transmissionTexture?(r.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(t,"/transmissionTexture"),r.transmissionTexture,void 0).then(function(i){o.subSurface.refractionIntensityTexture=i,o.subSurface.useGltfStyleTextures=!0})):Promise.resolve()},a}();v.RegisterExtension(xe,function(a){return new en(a)});var Re="KHR_materials_translucency",tn=function(){function a(t){this.name=Re,this.order=174,this._loader=t,this.enabled=this._loader.isExtensionUsed(Re),this.enabled&&(t.parent.transparencyAsCoverage=!0)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){var i=new Array;return i.push(r._loader.loadMaterialBasePropertiesAsync(t,e,n)),i.push(r._loader.loadMaterialPropertiesAsync(t,e,n)),i.push(r._loadTranslucentPropertiesAsync(o,e,n,s)),Promise.all(i).then(function(){})})},a.prototype._loadTranslucentPropertiesAsync=function(t,e,n,r){if(!(n instanceof w))throw new Error("".concat(t,": Material type not supported"));var o=n;if(o.subSurface.isTranslucencyEnabled=!0,o.subSurface.volumeIndexOfRefraction=1,o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=0,o.subSurface.useAlbedoToTintTranslucency=!0,r.translucencyFactor!==void 0)o.subSurface.translucencyIntensity=r.translucencyFactor;else return o.subSurface.translucencyIntensity=0,o.subSurface.isTranslucencyEnabled=!1,Promise.resolve();return r.translucencyTexture?(r.translucencyTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(t,"/translucencyTexture"),r.translucencyTexture).then(function(s){o.subSurface.translucencyIntensityTexture=s})):Promise.resolve()},a}();v.RegisterExtension(Re,function(a){return new tn(a)});var Me="KHR_materials_volume",nn=function(){function a(t){this.name=Me,this.order=173,this._loader=t,this.enabled=this._loader.isExtensionUsed(Me),this.enabled&&this._loader._disableInstancedMesh++}return a.prototype.dispose=function(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){var i=new Array;return i.push(r._loader.loadMaterialBasePropertiesAsync(t,e,n)),i.push(r._loader.loadMaterialPropertiesAsync(t,e,n)),i.push(r._loadVolumePropertiesAsync(o,e,n,s)),Promise.all(i).then(function(){})})},a.prototype._loadVolumePropertiesAsync=function(t,e,n,r){if(!(n instanceof w))throw new Error("".concat(t,": Material type not supported"));if(!n.subSurface.isRefractionEnabled&&!n.subSurface.isTranslucencyEnabled||!r.thicknessFactor)return Promise.resolve();n.subSurface.volumeIndexOfRefraction=n.indexOfRefraction;var o=r.attenuationDistance!==void 0?r.attenuationDistance:Number.MAX_VALUE;return n.subSurface.tintColorAtDistance=o,r.attenuationColor!==void 0&&r.attenuationColor.length==3&&n.subSurface.tintColor.copyFromFloats(r.attenuationColor[0],r.attenuationColor[1],r.attenuationColor[2]),n.subSurface.minimumThickness=0,n.subSurface.maximumThickness=r.thicknessFactor,n.subSurface.useThicknessAsDepth=!0,r.thicknessTexture?(r.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(t,"/thicknessTexture"),r.thicknessTexture).then(function(s){n.subSurface.thicknessTexture=s,n.subSurface.useGltfStyleTextures=!0})):Promise.resolve()},a}();v.RegisterExtension(Me,function(a){return new nn(a)});var Ne="KHR_mesh_quantization",rn=function(){function a(t){this.name=Ne,this.enabled=t.isExtensionUsed(Ne)}return a.prototype.dispose=function(){},a}();v.RegisterExtension(Ne,function(a){return new rn(a)});var Fe="KHR_texture_basisu",on=function(){function a(t){this.name=Fe,this._loader=t,this.enabled=t.isExtensionUsed(Fe)}return a.prototype.dispose=function(){this._loader=null},a.prototype._loadTextureAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){var i=e.sampler==null?v.DefaultSampler:_.Get("".concat(t,"/sampler"),r._loader.gltf.samplers,e.sampler),c=_.Get("".concat(o,"/source"),r._loader.gltf.images,s.source);return r._loader._createTextureAsync(t,i,c,function(u){n(u)},e._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!e._textureInfo.nonColorData)})},a}();v.RegisterExtension(Fe,function(a){return new on(a)});var De="KHR_texture_transform",an=function(){function a(t){this.name=De,this._loader=t,this.enabled=this._loader.isExtensionUsed(De)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadTextureInfoAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){return r._loader.loadTextureInfoAsync(t,e,function(i){if(!(i instanceof P))throw new Error("".concat(o,": Texture type not supported"));s.offset&&(i.uOffset=s.offset[0],i.vOffset=s.offset[1]),i.uRotationCenter=0,i.vRotationCenter=0,s.rotation&&(i.wAng=-s.rotation),s.scale&&(i.uScale=s.scale[0],i.vScale=s.scale[1]),s.texCoord!=null&&(i.coordinatesIndex=s.texCoord),n(i)})})},a}();v.RegisterExtension(De,function(a){return new an(a)});var Be="KHR_xmp_json_ld",sn=function(){function a(t){this.name=Be,this.order=100,this._loader=t,this.enabled=this._loader.isExtensionUsed(Be)}return a.prototype.dispose=function(){this._loader=null},a.prototype.onLoading=function(){var t,e,n;if(this._loader.rootBabylonMesh!==null){var r=(t=this._loader.gltf.extensions)===null||t===void 0?void 0:t.KHR_xmp_json_ld,o=(n=(e=this._loader.gltf.asset)===null||e===void 0?void 0:e.extensions)===null||n===void 0?void 0:n.KHR_xmp_json_ld;if(r&&o){var s=+o.packet;r.packets&&s<r.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=r.packets[s])}}},a}();v.RegisterExtension(Be,function(a){return new sn(a)});var ce=function(a){var t=parseInt(a);return isNaN(t)?-1:t},cn=function(a,t){if(a.nodes){var e=ce(t);if(e!=-1)return a.nodes[e]}return null},ln=function(a,t){if(a.materials){var e=ce(t);if(e!=-1)return a.materials[e]}return null},un=function(a,t){if(a.cameras){var e=ce(t);if(e!=-1)return a.cameras[e]}return null},fn=function(a,t){return a.extensions&&t?a.extensions[t]:null},dn=function(a,t,e,n){return n?j.FromArray(t,e).scale(n):j.FromArray(t,e)},hn=function(a,t,e,n){return n?L.FromArray(t,e).scaleInPlace(n):L.FromArray(t,e)},pn=function(a,t,e,n){return n?q.FromArray(t,e).scaleInPlace(n):q.FromArray(t,e)},z=function(a,t,e,n){return n?I.FromArray(t,e).scale(n):I.FromArray(t,e)},_n=function(a,t,e,n){return n?t[e+3]*n:t[e+3]},He=function(a,t,e,n){return n?t[e]*n:t[e]},ee=function(a,t,e,n){return-(n?t[e]*n:t[e])},X=function(a,t,e,n){return n?t[e+1]*n:t[e+1]},et=function(a,t,e,n){return(n?t[e]*n:t[e])*2},mn=function(a,t,e,n){if(a._numMorphTargets){for(var r=new Array(a._numMorphTargets),o=0;o<a._numMorphTargets;o++)r[o]=n?t[e++]*n:t[e++];return r}return null},re=function(){function a(t,e,n){this.type=t,this.name=e,this.get=n}return a.prototype._buildAnimation=function(t,e,n,r,o){if(o===void 0&&(o=null),t||o){var s="".concat(r.name,"_channel").concat(r.targetedAnimations.length,"_").concat(this.name),i=new g(s,this.name,e,this.type);i.setKeys(n),o!=null&&o.animations!=null?(o.animations.push(i),r.addTargetedAnimation(i,o)):t&&(t.animations=t.animations||Array(1),t.animations.push(i),r.addTargetedAnimation(i,t))}},a.prototype.isValid=function(t){return!0},a}(),ie=function(a){ne(t,a);function t(e,n,r){return r===void 0&&(r=hn),a.call(this,e,n,r)||this}return t.prototype.isValid=function(e){return e._babylonTransformNode!==null&&e._babylonTransformNode!==void 0},t.prototype.buildAnimations=function(e,n,r,o,s){return s===void 0&&(s=null),this._buildAnimation(e._babylonTransformNode,n,r,o,s)},t}(re),Y=function(a){ne(t,a);function t(e,n,r){return r===void 0&&(r=He),a.call(this,e,n,r)||this}return t.prototype.isValid=function(e){return e._babylonCamera!=null&&e._babylonCamera!==void 0},t.prototype.buildAnimations=function(e,n,r,o,s){return s===void 0&&(s=null),this._buildAnimation(e._babylonCamera,n,r,o,s)},t}(re),E=function(a){ne(t,a);function t(e,n,r,o){r===void 0&&(r=He),o===void 0&&(o=V.TriangleFillMode);var s=a.call(this,e,n,r)||this;return s.fillMode=o,s}return t.prototype.isValid=function(e){var n=e._data;if(n){var r=n[this.fillMode];if(r)return r.babylonMaterial!==null&&r.babylonMaterial!==void 0}return!1},t.prototype.buildAnimations=function(e,n,r,o,s){return s===void 0&&(s=null),this._buildAnimation(e._data[this.fillMode].babylonMaterial,n,r,o,s)},t}(re),Q=function(a){ne(t,a);function t(e,n,r){return r===void 0&&(r=He),a.call(this,e,n,r)||this}return t.prototype.isValid=function(e){return e&&e.length!=0},t.prototype.buildAnimations=function(e,n,r,o,s,i){s===void 0&&(s=null);var c=ce(i[1]),u=c>=0&&c<e.lights.length?e.lights[c]:null;return this._buildAnimation(u._babylonLight,n,r,o,s)},t}(re),vn=function(a){ne(t,a);function t(e,n,r){return r===void 0&&(r=mn),a.call(this,e,n,r)||this}return t.prototype.isValid=function(e){return e._numMorphTargets},t.prototype.buildAnimations=function(e,n,r,o,s){if(e._numMorphTargets)for(var i=function(l){var f="".concat(o.name,"_channel").concat(o.targetedAnimations.length),d=new g(f,c.name,n,c.type);if(d.setKeys(r.map(function(b){return{frame:b.frame,inTangent:b.inTangent?b.inTangent[l]:void 0,value:b.value[l],outTangent:b.outTangent?b.outTangent[l]:void 0,interpolation:b.interpolation}})),e._primitiveBabylonMeshes)for(var h=0,p=e._primitiveBabylonMeshes;h<p.length;h++){var m=p[h],y=m;if(y.morphTargetManager){var A=y.morphTargetManager.getTarget(l),O=d.clone();A.animations.push(O),o.addTargetedAnimation(O,A)}}},c=this,u=0;u<e._numMorphTargets;u++)i(u)},t}(re),yn={getTarget:cn,hasIndex:!0,matrix:{properties:[new ie(g.ANIMATIONTYPE_MATRIX,"matrix",dn)]},translation:{properties:[new ie(g.ANIMATIONTYPE_VECTOR3,"position")]},rotation:{properties:[new ie(g.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",pn)]},scale:{properties:[new ie(g.ANIMATIONTYPE_VECTOR3,"scaling")]},weights:{getStride:function(a){return a._numMorphTargets},properties:[new vn(g.ANIMATIONTYPE_FLOAT,"influence")]}},gn={hasIndex:!0,getTarget:un,orthographic:{xmag:{properties:[new Y(g.ANIMATIONTYPE_FLOAT,"orthoLeft",ee),new Y(g.ANIMATIONTYPE_FLOAT,"orthoRight",X)]},ymag:{properties:[new Y(g.ANIMATIONTYPE_FLOAT,"orthoBottom",ee),new Y(g.ANIMATIONTYPE_FLOAT,"orthoTop",X)]},zfar:{properties:[new Y(g.ANIMATIONTYPE_FLOAT,"maxZ")]},znear:{properties:[new Y(g.ANIMATIONTYPE_FLOAT,"minZ")]}},perspective:{aspectRatio:{},yfov:{properties:[new Y(g.ANIMATIONTYPE_FLOAT,"fov")]},zfar:{properties:[new Y(g.ANIMATIONTYPE_FLOAT,"maxZ")]},znear:{properties:[new Y(g.ANIMATIONTYPE_FLOAT,"minZ")]}}},An={hasIndex:!0,getTarget:ln,pbrMetallicRoughness:{baseColorFactor:{properties:[new E(g.ANIMATIONTYPE_COLOR3,"albedoColor",z),new E(g.ANIMATIONTYPE_FLOAT,"alpha",_n)]},metallicFactor:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"metallic")]},roughnessFactor:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"roughness")]},baseColorTexture:{extensions:{KHR_texture_transform:{scale:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"albedoTexture.uScale"),new E(g.ANIMATIONTYPE_FLOAT,"albedoTexture.vScale",X)]},offset:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"albedoTexture.uOffset"),new E(g.ANIMATIONTYPE_FLOAT,"albedoTexture.vOffset",X)]},rotation:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"albedoTexture.wAng",ee)]}}}}},emissiveFactor:{properties:[new E(g.ANIMATIONTYPE_COLOR3,"emissiveColor",z)]},normalTexture:{scale:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"bumpTexture.level")]}},occlusionTexture:{strength:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"ambientTextureStrength")]},extensions:{KHR_texture_transform:{scale:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"ambientTexture.uScale"),new E(g.ANIMATIONTYPE_FLOAT,"ambientTexture.vScale",X)]},offset:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"ambientTexture.uOffset"),new E(g.ANIMATIONTYPE_FLOAT,"ambientTexture.vOffset",X)]},rotation:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"ambientTexture.wAng",ee)]}}}},emissiveTexture:{extensions:{KHR_texture_transform:{scale:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"emissiveTexture.uScale"),new E(g.ANIMATIONTYPE_FLOAT,"emissiveTexture.vScale",X)]},offset:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"emissiveTexture.uOffset"),new E(g.ANIMATIONTYPE_FLOAT,"emissiveTexture.vOffset",X)]},rotation:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"emissiveTexture.wAng",ee)]}}}},extensions:{KHR_materials_ior:{ior:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"indexOfRefraction")]}},KHR_materials_clearcoat:{clearcoatFactor:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"clearCoat.intensity")]},clearcoatRoughnessFactor:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"clearCoat.roughness")]}},KHR_materials_sheen:{sheenColorFactor:{properties:[new E(g.ANIMATIONTYPE_COLOR3,"sheen.color",z)]},sheenRoughnessFactor:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"sheen.roughness")]}},KHR_materials_specular:{specularFactor:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"metallicF0Factor")]},specularColorFactor:{properties:[new E(g.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",z)]}},KHR_materials_emissive_strength:{emissiveStrength:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"emissiveIntensity")]}},KHR_materials_transmission:{transmissionFactor:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity")]}},KHR_materials_volume:{attenuationColor:{properties:[new E(g.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",z)]},attenuationDistance:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance")]},thicknessFactor:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness")]}},KHR_materials_iridescence:{iridescenceFactor:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"iridescence.intensity")]},iridescenceIor:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction")]},iridescenceThicknessMinimum:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness")]},iridescenceThicknessMaximum:{properties:[new E(g.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness")]}}}},Tn={getTarget:fn,KHR_lights_punctual:{isIndex:!0,lights:{hasIndex:!0,color:{properties:[new Q(g.ANIMATIONTYPE_COLOR3,"diffuse",z)]},intensity:{properties:[new Q(g.ANIMATIONTYPE_FLOAT,"intensity")]},range:{properties:[new Q(g.ANIMATIONTYPE_FLOAT,"range")]},spot:{innerConeAngle:{properties:[new Q(g.ANIMATIONTYPE_FLOAT,"innerAngle",et)]},outerConeAngle:{properties:[new Q(g.ANIMATIONTYPE_FLOAT,"angle",et)]}}}}},En={nodes:yn,materials:An,cameras:gn,extensions:Tn};function bn(a){switch(a){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}}var Ge=v._KHRAnimationPointerName,On=function(){function a(t){this.ignoreInvalidPointer=!0,this.name=Ge,this._loader=t}return Object.defineProperty(a.prototype,"enabled",{get:function(){return this._loader.isExtensionUsed(Ge)},enumerable:!1,configurable:!0}),a.prototype.dispose=function(){this._loader=null},a.prototype.accept=function(t){return t!="name"},a.prototype.loadAnimationAsync=function(t,e){if(!e._babylonAnimationGroup){this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer;var n=new nt(e.name||"animation".concat(e.index),this._loader.babylonScene);n._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,e._babylonAnimationGroup=n}var r=e._babylonAnimationGroup,o=new Array;_.Assign(e.channels),_.Assign(e.samplers);for(var s=0,i=e.channels;s<i.length;s++){var c=i[s];o.push(this._loadAnimationChannelAsync("".concat(t,"/channels/").concat(c.index),t,e,c))}return Promise.all(o).then(function(){return r.normalize(0),r})},a.prototype._loadAnimationChannelAsync=function(t,e,n,r,o){var s=this,i,c;if(o===void 0&&(o=null),r.target.path!="pointer")throw new Error("".concat(t,"/target/path: Invalid value (").concat(r.target.path,")"));if(r.target.node!=null)return Promise.resolve();var u=(c=(i=r.target.extensions)===null||i===void 0?void 0:i.KHR_animation_pointer)===null||c===void 0?void 0:c.pointer;if(!u)throw new Error("".concat(t,"/target/extensions/").concat(this.name,": Pointer is missing"));var l=_.Get("".concat(t,"/sampler"),n.samplers,r.sampler);return this._loadAnimationSamplerAsync("".concat(t,"/samplers/").concat(r.sampler),l).then(function(f){var d,h=s._parseAnimationPointer("".concat(t,"/extensions/").concat(s.name,"/pointer"),u);if(!!h){var p=n._babylonAnimationGroup;if(!!p)for(var m=_.Get("".concat(t,"/output"),s._loader.gltf.accessors,l.output),y=(d=h.stride)!==null&&d!==void 0?d:bn(m.type),A=s._loader.parent.targetFps,O=0,b=h.properties;O<b.length;O++){var C=b[O];if(!C.isValid(h.target))return;var k=new Array(f.input.length),x=0;switch(f.interpolation){case"STEP":{for(var S=0;S<f.input.length;S++)k[S]={frame:f.input[S]*A,value:C.get(h.target,f.output,x),interpolation:vt.STEP},x+=y;break}case"CUBICSPLINE":{for(var H=1/A,S=0;S<f.input.length;S++){var W={frame:f.input[S]*A};W.inTangent=C.get(h.target,f.output,x,H),x+=y,W.value=C.get(h.target,f.output,x),x+=y,W.outTangent=C.get(h.target,f.output,x,H),x+=y,k[S]=W}break}case"LINEAR":default:{for(var S=0;S<f.input.length;S++)k[S]={frame:f.input[S]*A,value:C.get(h.target,f.output,x)},x+=y;break}}C.buildAnimations(h.target,A,k,p,o,h.params)}}})},a.prototype._loadAnimationSamplerAsync=function(t,e){if(e._data)return e._data;var n=e.interpolation||"LINEAR";switch(n){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error("".concat(t,"/interpolation: Invalid value (").concat(e.interpolation,")"))}var r=_.Get("".concat(t,"/input"),this._loader.gltf.accessors,e.input),o=_.Get("".concat(t,"/output"),this._loader.gltf.accessors,e.output);return e._data=Promise.all([this._loader._loadFloatAccessorAsync("/accessors/".concat(r.index),r),this._loader._loadFloatAccessorAsync("/accessors/".concat(o.index),o)]).then(function(s){var i=s[0],c=s[1];return{input:i,interpolation:n,output:c}}),e._data},a.prototype._parseAnimationPointer=function(t,e){var n="/";e.charAt(0)==n&&(e=e.substring(1));var r=e.split(n);if(r.length>=3)for(var o=En,s=[],i=null,c=0;c<r.length;c++){var u=r[c];if(o=o[u],!o)break;if(o.getTarget&&(i=o.getTarget),o.hasIndex){s.push(r[++c]);continue}if(o.isIndex){s.push(u);continue}if(o.properties&&i){var l=i(this._loader.gltf,s[0]);if(l!=null)return{target:l,stride:o.getStride?o.getStride(l):void 0,properties:o.properties,params:s}}}if(this.ignoreInvalidPointer)return null;throw new Error("".concat(t," invalid pointer. ").concat(e))},a}();v.RegisterExtension(Ge,function(a){return new On(a)});var ke="MSFT_audio_emitter",wn=function(){function a(t){this.name=ke,this._loader=t,this.enabled=this._loader.isExtensionUsed(ke)}return a.prototype.dispose=function(){this._loader=null,this._clips=null,this._emitters=null},a.prototype.onLoading=function(){var t=this._loader.gltf.extensions;if(t&&t[this.name]){var e=t[this.name];this._clips=e.clips,this._emitters=e.emitters,_.Assign(this._clips),_.Assign(this._emitters)}},a.prototype.loadSceneAsync=function(t,e){var n=this;return v.LoadExtensionAsync(t,e,this.name,function(r,o){var s=new Array;s.push(n._loader.loadSceneAsync(t,e));for(var i=0,c=o.emitters;i<c.length;i++){var u=c[i],l=_.Get("".concat(r,"/emitters"),n._emitters,u);if(l.refDistance!=null||l.maxDistance!=null||l.rolloffFactor!=null||l.distanceModel!=null||l.innerAngle!=null||l.outerAngle!=null)throw new Error("".concat(r,": Direction or Distance properties are not allowed on emitters attached to a scene"));s.push(n._loadEmitterAsync("".concat(r,"/emitters/").concat(l.index),l))}return Promise.all(s).then(function(){})})},a.prototype.loadNodeAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){var i=new Array;return r._loader.loadNodeAsync(o,e,function(c){for(var u=function(h){var p=_.Get("".concat(o,"/emitters"),r._emitters,h);i.push(r._loadEmitterAsync("".concat(o,"/emitters/").concat(p.index),p).then(function(){for(var m=0,y=p._babylonSounds;m<y.length;m++){var A=y[m];A.attachToMesh(c),(p.innerAngle!=null||p.outerAngle!=null)&&(A.setLocalDirectionToMesh(L.Forward()),A.setDirectionalCone(2*G.ToDegrees(p.innerAngle==null?Math.PI:p.innerAngle),2*G.ToDegrees(p.outerAngle==null?Math.PI:p.outerAngle),0))}}))},l=0,f=s.emitters;l<f.length;l++){var d=f[l];u(d)}n(c)}).then(function(c){return Promise.all(i).then(function(){return c})})})},a.prototype.loadAnimationAsync=function(t,e){var n=this;return v.LoadExtensionAsync(t,e,this.name,function(r,o){return n._loader.loadAnimationAsync(t,e).then(function(s){var i=new Array;_.Assign(o.events);for(var c=0,u=o.events;c<u.length;c++){var l=u[c];i.push(n._loadAnimationEventAsync("".concat(r,"/events/").concat(l.index),t,e,l,s))}return Promise.all(i).then(function(){return s})})})},a.prototype._loadClipAsync=function(t,e){if(e._objectURL)return e._objectURL;var n;if(e.uri)n=this._loader.loadUriAsync(t,e,e.uri);else{var r=_.Get("".concat(t,"/bufferView"),this._loader.gltf.bufferViews,e.bufferView);n=this._loader.loadBufferViewAsync("/bufferViews/".concat(r.index),r)}return e._objectURL=n.then(function(o){return URL.createObjectURL(new Blob([o],{type:e.mimeType}))}),e._objectURL},a.prototype._loadEmitterAsync=function(t,e){var n=this;if(e._babylonSounds=e._babylonSounds||[],!e._babylonData){for(var r=new Array,o=e.name||"emitter".concat(e.index),s={loop:!1,autoplay:!1,volume:e.volume==null?1:e.volume},i=function(f){var d="/extensions/".concat(c.name,"/clips"),h=_.Get(d,c._clips,e.clips[f].clip);r.push(c._loadClipAsync("".concat(d,"/").concat(e.clips[f].clip),h).then(function(p){var m=e._babylonSounds[f]=new Ft(o,p,n._loader.babylonScene,null,s);m.refDistance=e.refDistance||1,m.maxDistance=e.maxDistance||256,m.rolloffFactor=e.rolloffFactor||1,m.distanceModel=e.distanceModel||"exponential"}))},c=this,u=0;u<e.clips.length;u++)i(u);var l=Promise.all(r).then(function(){var f=e.clips.map(function(h){return h.weight||1}),d=new Nt(e.loop||!1,e._babylonSounds,f);e.innerAngle&&(d.directionalConeInnerAngle=2*G.ToDegrees(e.innerAngle)),e.outerAngle&&(d.directionalConeOuterAngle=2*G.ToDegrees(e.outerAngle)),e.volume&&(d.volume=e.volume),e._babylonData.sound=d});e._babylonData={loaded:l}}return e._babylonData.loaded},a.prototype._getEventAction=function(t,e,n,r,o){switch(n){case"play":return function(s){var i=(o||0)+(s-r);e.play(i)};case"stop":return function(){e.stop()};case"pause":return function(){e.pause()};default:throw new Error("".concat(t,": Unsupported action ").concat(n))}},a.prototype._loadAnimationEventAsync=function(t,e,n,r,o){var s=this;if(o.targetedAnimations.length==0)return Promise.resolve();var i=o.targetedAnimations[0],c=r.emitter,u=_.Get("/extensions/".concat(this.name,"/emitters"),this._emitters,c);return this._loadEmitterAsync(t,u).then(function(){var l=u._babylonData.sound;if(l){var f=new yt(r.time,s._getEventAction(t,l,r.action,r.time,r.startOffset));i.animation.addEvent(f),o.onAnimationGroupEndObservable.add(function(){l.stop()}),o.onAnimationGroupPauseObservable.add(function(){l.pause()})}})},a}();v.RegisterExtension(ke,function(a){return new wn(a)});var Ve="MSFT_lod",Cn=function(){function a(t){this.name=Ve,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new R,this.onMaterialLODsLoadedObservable=new R,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=t,this.enabled=this._loader.isExtensionUsed(Ve)}return a.prototype.dispose=function(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},a.prototype.onReady=function(){for(var t=this,e=function(i){var c=Promise.all(n._nodePromiseLODs[i]).then(function(){i!==0&&(t._loader.endPerformanceCounter("Node LOD ".concat(i)),t._loader.log("Loaded node LOD ".concat(i))),t.onNodeLODsLoadedObservable.notifyObservers(i),i!==t._nodePromiseLODs.length-1&&(t._loader.startPerformanceCounter("Node LOD ".concat(i+1)),t._loadBufferLOD(t._nodeBufferLODs,i+1),t._nodeSignalLODs[i]&&t._nodeSignalLODs[i].resolve())});n._loader._completePromises.push(c)},n=this,r=0;r<this._nodePromiseLODs.length;r++)e(r);for(var o=function(i){var c=Promise.all(s._materialPromiseLODs[i]).then(function(){i!==0&&(t._loader.endPerformanceCounter("Material LOD ".concat(i)),t._loader.log("Loaded material LOD ".concat(i))),t.onMaterialLODsLoadedObservable.notifyObservers(i),i!==t._materialPromiseLODs.length-1&&(t._loader.startPerformanceCounter("Material LOD ".concat(i+1)),t._loadBufferLOD(t._materialBufferLODs,i+1),t._materialSignalLODs[i]&&t._materialSignalLODs[i].resolve())});s._loader._completePromises.push(c)},s=this,r=0;r<this._materialPromiseLODs.length;r++)o(r)},a.prototype.loadSceneAsync=function(t,e){var n=this._loader.loadSceneAsync(t,e);return this._loadBufferLOD(this._bufferLODs,0),n},a.prototype.loadNodeAsync=function(t,e,n){var r=this;return v.LoadExtensionAsync(t,e,this.name,function(o,s){var i,c=r._getLODs(o,e,r._loader.gltf.nodes,s.ids);r._loader.logOpen("".concat(o));for(var u=function(f){var d=c[f];f!==0&&(r._nodeIndexLOD=f,r._nodeSignalLODs[f]=r._nodeSignalLODs[f]||new Z);var h=function(m){n(m),m.setEnabled(!1)},p=r._loader.loadNodeAsync("/nodes/".concat(d.index),d,h).then(function(m){if(f!==0){var y=c[f-1];y._babylonTransformNode&&(r._disposeTransformNode(y._babylonTransformNode),delete y._babylonTransformNode)}return m.setEnabled(!0),m});r._nodePromiseLODs[f]=r._nodePromiseLODs[f]||[],f===0?i=p:(r._nodeIndexLOD=null,r._nodePromiseLODs[f].push(p))},l=0;l<c.length;l++)u(l);return r._loader.logClose(),i})},a.prototype._loadMaterialAsync=function(t,e,n,r,o){var s=this;return this._nodeIndexLOD?null:v.LoadExtensionAsync(t,e,this.name,function(i,c){var u,l=s._getLODs(i,e,s._loader.gltf.materials,c.ids);s._loader.logOpen("".concat(i));for(var f=function(h){var p=l[h];h!==0&&(s._materialIndexLOD=h);var m=s._loader._loadMaterialAsync("/materials/".concat(p.index),p,n,r,function(y){h===0&&o(y)}).then(function(y){if(h!==0){o(y);var A=l[h-1]._data;A[r]&&(s._disposeMaterials([A[r].babylonMaterial]),delete A[r])}return y});s._materialPromiseLODs[h]=s._materialPromiseLODs[h]||[],h===0?u=m:(s._materialIndexLOD=null,s._materialPromiseLODs[h].push(m))},d=0;d<l.length;d++)f(d);return s._loader.logClose(),u})},a.prototype._loadUriAsync=function(t,e,n){var r=this;if(this._nodeIndexLOD!==null){this._loader.log("deferred");var o=this._nodeIndexLOD-1;return this._nodeSignalLODs[o]=this._nodeSignalLODs[o]||new Z,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(function(){return r._loader.loadUriAsync(t,e,n)})}else if(this._materialIndexLOD!==null){this._loader.log("deferred");var o=this._materialIndexLOD-1;return this._materialSignalLODs[o]=this._materialSignalLODs[o]||new Z,this._materialSignalLODs[o].promise.then(function(){return r._loader.loadUriAsync(t,e,n)})}return null},a.prototype.loadBufferAsync=function(t,e,n,r){if(this._loader.parent.useRangeRequests&&!e.uri){if(!this._loader.bin)throw new Error("".concat(t,": Uri is missing or the binary glTF is missing its binary chunk"));var o=function(s,i){var c=n,u=c+r-1,l=s[i];return l?(l.start=Math.min(l.start,c),l.end=Math.max(l.end,u)):(l={start:c,end:u,loaded:new Z},s[i]=l),l.loaded.promise.then(function(f){return new Uint8Array(f.buffer,f.byteOffset+n-l.start,r)})};return this._loader.log("deferred"),this._nodeIndexLOD!==null?o(this._nodeBufferLODs,this._nodeIndexLOD):this._materialIndexLOD!==null?o(this._materialBufferLODs,this._materialIndexLOD):o(this._bufferLODs,0)}return null},a.prototype._loadBufferLOD=function(t,e){var n=t[e];n&&(this._loader.log("Loading buffer range [".concat(n.start,"-").concat(n.end,"]")),this._loader.bin.readAsync(n.start,n.end-n.start+1).then(function(r){n.loaded.resolve(r)},function(r){n.loaded.reject(r)}))},a.prototype._getLODs=function(t,e,n,r){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var o=new Array,s=r.length-1;s>=0;s--)if(o.push(_.Get("".concat(t,"/ids/").concat(r[s]),n,r[s])),o.length===this.maxLODsToLoad)return o;return o.push(e),o},a.prototype._disposeTransformNode=function(t){var e=this,n=new Array,r=t.material;r&&n.push(r);for(var o=0,s=t.getChildMeshes();o<s.length;o++){var i=s[o];i.material&&n.push(i.material)}t.dispose();var c=n.filter(function(u){return e._loader.babylonScene.meshes.every(function(l){return l.material!=u})});this._disposeMaterials(c)},a.prototype._disposeMaterials=function(t){for(var e={},n=0,r=t;n<r.length;n++){for(var o=r[n],s=0,i=o.getActiveTextures();s<i.length;s++){var c=i[s];e[c.uniqueId]=c}o.dispose()}for(var u in e)for(var l=0,f=this._loader.babylonScene.materials;l<f.length;l++){var o=f[l];o.hasTexture(e[u])&&delete e[u]}for(var u in e)e[u].dispose()},a}();v.RegisterExtension(Ve,function(a){return new Cn(a)});var Ue="MSFT_minecraftMesh",Pn=function(){function a(t){this.name=Ue,this._loader=t,this.enabled=this._loader.isExtensionUsed(Ue)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this;return v.LoadExtraAsync(t,e,this.name,function(o,s){if(s){if(!(n instanceof w))throw new Error("".concat(o,": Material type not supported"));var i=r._loader.loadMaterialPropertiesAsync(t,e,n);return n.needAlphaBlending()&&(n.forceDepthWrite=!0,n.separateCullingPass=!0),n.backFaceCulling=n.forceDepthWrite,n.twoSidedLighting=!0,i}return null})},a}();v.RegisterExtension(Ue,function(a){return new Pn(a)});var Ke="MSFT_sRGBFactors",Ln=function(){function a(t){this.name=Ke,this._loader=t,this.enabled=this._loader.isExtensionUsed(Ke)}return a.prototype.dispose=function(){this._loader=null},a.prototype.loadMaterialPropertiesAsync=function(t,e,n){var r=this;return v.LoadExtraAsync(t,e,this.name,function(o,s){if(s){if(!(n instanceof w))throw new Error("".concat(o,": Material type not supported"));var i=r._loader.loadMaterialPropertiesAsync(t,e,n);return n.albedoTexture||n.albedoColor.toLinearSpaceToRef(n.albedoColor),n.reflectivityTexture||n.reflectivityColor.toLinearSpaceToRef(n.reflectivityColor),i}return null})},a}();v.RegisterExtension(Ke,function(a){return new Ln(a)});var st="ExtrasAsMetadata",Sn=function(){function a(t){this.name=st,this.enabled=!0,this._loader=t}return a.prototype._assignExtras=function(t,e){if(e.extras&&Object.keys(e.extras).length>0){var n=t.metadata=t.metadata||{},r=n.gltf=n.gltf||{};r.extras=e.extras}},a.prototype.dispose=function(){this._loader=null},a.prototype.loadNodeAsync=function(t,e,n){var r=this;return this._loader.loadNodeAsync(t,e,function(o){r._assignExtras(o,e),n(o)})},a.prototype.loadCameraAsync=function(t,e,n){var r=this;return this._loader.loadCameraAsync(t,e,function(o){r._assignExtras(o,e),n(o)})},a.prototype.createMaterial=function(t,e,n){var r=this._loader.createMaterial(t,e,n);return this._assignExtras(r,e),r},a}();v.RegisterExtension(st,function(a){return new Sn(a)});
