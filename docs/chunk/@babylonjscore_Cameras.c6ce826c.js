import{P as ve,A as Ze,S as Xe,V as Ce,a as fe,I as je}from"./@babylonjscore_PostProcesses.028f5b5f.js";import{a as f,M as p,F as pe,f as F,Q as v,d as Ue,P as Qe,T as H,E as S,A,g as X,V as U,b as Ke,C as B}from"./@babylonjscore_Maths.42afce42.js";import{L as E,_ as ie,a as b,S as z,d as L,b as c,O as w,f as qe,G as Je,V as de,J as K,g as oe,h as $e}from"./@babylonjscore_Misc.329df4d9.js";import{_ as C,a as l}from"./tslibtslib.b6e59fa7.js";import{P as g,E as be,K as q}from"./@babylonjscore_Events.9219334a.js";import{N as P}from"./@babylonjscore_node.43bedde8.js";import{G as D,P as Re,a as _e,X as me,W as et}from"./@babylonjscore_Gamepads.ed4be94a.js";import{a as Pe}from"./@babylonjscore_Engines.a7c830c0.js";import{M as j,T as tt,a as it,b as Oe,c as ot}from"./@babylonjscore_Meshes.896ebf22.js";import{B as rt,F as nt,A as at}from"./@babylonjscore_Behaviors.d1a939c8.js";import{H as st}from"./@babylonjscore_Lights.ab9a75bc.js";import{R as re}from"./@babylonjscore_Culling.f738e368.js";import{I as ht,D as lt,S as ne}from"./@babylonjscore_Materials.49fd589a.js";import{C as ct,E as ge,A as M,S as ut}from"./@babylonjscore_Animations.ea9e461f.js";import{a as Y,b as ft}from"./@babylonjscore_XR.48ea8f9c.js";var m=function(o){C(t,o);function t(e,i,n,a){a===void 0&&(a=!0);var r=o.call(this,e,n)||this;return r._position=f.Zero(),r._upVector=f.Up(),r._orthoLeft=null,r._orthoRight=null,r._orthoBottom=null,r._orthoTop=null,r.fov=.8,r.projectionPlaneTilt=0,r.minZ=1,r.maxZ=1e4,r.inertia=.9,r._mode=t.PERSPECTIVE_CAMERA,r.isIntermediate=!1,r.viewport=new F(0,0,1,1),r.layerMask=268435455,r.fovMode=t.FOVMODE_VERTICAL_FIXED,r.cameraRigMode=t.RIG_MODE_NONE,r.customRenderTargets=new Array,r.outputRenderTarget=null,r.onViewMatrixChangedObservable=new w,r.onProjectionMatrixChangedObservable=new w,r.onAfterCheckInputsObservable=new w,r.onRestoreStateObservable=new w,r.isRigCamera=!1,r._rigCameras=new Array,r._webvrViewMatrix=p.Identity(),r._skipRendering=!1,r._projectionMatrix=new p,r._postProcesses=new Array,r._activeMeshes=new qe(256),r._globalPosition=f.Zero(),r._computedViewMatrix=p.Identity(),r._doNotComputeProjectionMatrix=!1,r._transformMatrix=p.Zero(),r._refreshFrustumPlanes=!0,r._absoluteRotation=v.Identity(),r._isCamera=!0,r._isLeftCamera=!1,r._isRightCamera=!1,r.getScene().addCamera(r),a&&!r.getScene().activeCamera&&(r.getScene().activeCamera=r),r.position=i,r.renderPassId=r.getScene().getEngine().createRenderPassId("Camera ".concat(e)),r}return Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upVector",{get:function(){return this._upVector},set:function(e){this._upVector=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screenArea",{get:function(){var e,i,n,a,r=0,h=0;if(this.mode===t.PERSPECTIVE_CAMERA)this.fovMode===t.FOVMODE_VERTICAL_FIXED?(h=this.minZ*2*Math.tan(this.fov/2),r=this.getEngine().getAspectRatio(this)*h):(r=this.minZ*2*Math.tan(this.fov/2),h=r/this.getEngine().getAspectRatio(this));else{var u=this.getEngine().getRenderWidth()/2,s=this.getEngine().getRenderHeight()/2;r=((e=this.orthoRight)!==null&&e!==void 0?e:u)-((i=this.orthoLeft)!==null&&i!==void 0?i:-u),h=((n=this.orthoTop)!==null&&n!==void 0?n:s)-((a=this.orthoBottom)!==null&&a!==void 0?a:-s)}return r*h},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"orthoLeft",{get:function(){return this._orthoLeft},set:function(e){this._orthoLeft=e;for(var i=0,n=this._rigCameras;i<n.length;i++){var a=n[i];a.orthoLeft=e}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"orthoRight",{get:function(){return this._orthoRight},set:function(e){this._orthoRight=e;for(var i=0,n=this._rigCameras;i<n.length;i++){var a=n[i];a.orthoRight=e}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"orthoBottom",{get:function(){return this._orthoBottom},set:function(e){this._orthoBottom=e;for(var i=0,n=this._rigCameras;i<n.length;i++){var a=n[i];a.orthoBottom=e}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"orthoTop",{get:function(){return this._orthoTop},set:function(e){this._orthoTop=e;for(var i=0,n=this._rigCameras;i<n.length;i++){var a=n[i];a.orthoTop=e}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode=e;for(var i=0,n=this._rigCameras;i<n.length;i++){var a=n[i];a.mode=e}},enumerable:!1,configurable:!0}),t.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},t.prototype._restoreStateValues=function(){return this._stateStored?(this.fov=this._storedFov,!0):!1},t.prototype.restoreState=function(){return this._restoreStateValues()?(this.onRestoreStateObservable.notifyObservers(this),!0):!1},t.prototype.getClassName=function(){return"Camera"},t.prototype.toString=function(e){var i="Name: "+this.name;if(i+=", type: "+this.getClassName(),this.animations)for(var n=0;n<this.animations.length;n++)i+=", animation[0]: "+this.animations[n].toString(e);return i},t.prototype.applyVerticalCorrection=function(){var e=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-e.x:e.x},Object.defineProperty(t.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!1,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.isActiveMesh=function(e){return this._activeMeshes.indexOf(e)!==-1},t.prototype.isReady=function(e){if(e===void 0&&(e=!1),e)for(var i=0,n=this._postProcesses;i<n.length;i++){var a=n[i];if(a&&!a.isReady())return!1}return o.prototype.isReady.call(this,e)},t.prototype._initCache=function(){o.prototype._initCache.call(this),this._cache.position=new f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},t.prototype._updateCache=function(e){e||o.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},t.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},t.prototype._isSynchronizedViewMatrix=function(){return o.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},t.prototype._isSynchronizedProjectionMatrix=function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var i=this.getEngine();return this.mode===t.PERSPECTIVE_CAMERA?e=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===i.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:e=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===i.getRenderWidth()&&this._cache.renderHeight===i.getRenderHeight(),e},t.prototype.attachControl=function(e,i){},t.prototype.detachControl=function(e){},t.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==t.RIG_MODE_NONE&&this._updateRigCameras()},t.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(t.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!1,configurable:!0}),t.prototype._getFirstPostProcess=function(){for(var e=0;e<this._postProcesses.length;e++)if(this._postProcesses[e]!==null)return this._postProcesses[e];return null},t.prototype._cascadePostProcessesToRigCams=function(){var e=this._getFirstPostProcess();e&&e.markTextureDirty();for(var i=0,n=this._rigCameras.length;i<n;i++){var a=this._rigCameras[i],r=a._rigPostProcess;if(r){var h=r.getEffectName()==="pass";h&&(a.isIntermediate=this._postProcesses.length===0),a._postProcesses=this._postProcesses.slice(0).concat(r),r.markTextureDirty()}else a._postProcesses=this._postProcesses.slice(0)}},t.prototype.attachPostProcess=function(e,i){return i===void 0&&(i=null),!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(E.Error("You're trying to reuse a post process not defined as reusable."),0):(i==null||i<0?this._postProcesses.push(e):this._postProcesses[i]===null?this._postProcesses[i]=e:this._postProcesses.splice(i,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))},t.prototype.detachPostProcess=function(e){var i=this._postProcesses.indexOf(e);i!==-1&&(this._postProcesses[i]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()},t.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)},t.prototype._getViewMatrix=function(){return p.Identity()},t.prototype.getViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)},t.prototype.freezeProjectionMatrix=function(e){this._doNotComputeProjectionMatrix=!0,e!==void 0&&(this._projectionMatrix=e)},t.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},t.prototype.getProjectionMatrix=function(e){var i,n,a,r,h,u,s,d;if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var _=this.getEngine(),R=this.getScene();if(this.mode===t.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=_.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1);var O=_.useReverseDepthBuffer,T=void 0;R.useRightHandedSystem?T=p.PerspectiveFovRHToRef:T=p.PerspectiveFovLHToRef,T(this.fov,_.getAspectRatio(this),O?this.maxZ:this.minZ,O?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===t.FOVMODE_VERTICAL_FIXED,_.isNDCHalfZRange,this.projectionPlaneTilt,_.useReverseDepthBuffer)}else{var I=_.getRenderWidth()/2,x=_.getRenderHeight()/2;R.useRightHandedSystem?p.OrthoOffCenterRHToRef((i=this.orthoLeft)!==null&&i!==void 0?i:-I,(n=this.orthoRight)!==null&&n!==void 0?n:I,(a=this.orthoBottom)!==null&&a!==void 0?a:-x,(r=this.orthoTop)!==null&&r!==void 0?r:x,this.minZ,this.maxZ,this._projectionMatrix,_.isNDCHalfZRange):p.OrthoOffCenterLHToRef((h=this.orthoLeft)!==null&&h!==void 0?h:-I,(u=this.orthoRight)!==null&&u!==void 0?u:I,(s=this.orthoBottom)!==null&&s!==void 0?s:-x,(d=this.orthoTop)!==null&&d!==void 0?d:x,this.minZ,this.maxZ,this._projectionMatrix,_.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=_.getRenderWidth(),this._cache.renderHeight=_.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},t.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},t.prototype._updateFrustumPlanes=function(){!this._refreshFrustumPlanes||(this.getTransformationMatrix(),this._frustumPlanes?pe.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=pe.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},t.prototype.isInFrustum=function(e,i){if(i===void 0&&(i=!1),this._updateFrustumPlanes(),i&&this.rigCameras.length>0){var n=!1;return this.rigCameras.forEach(function(a){a._updateFrustumPlanes(),n=n||e.isInFrustum(a._frustumPlanes)}),n}else return e.isInFrustum(this._frustumPlanes)},t.prototype.isCompletelyInFrustum=function(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)},t.prototype.getForwardRay=function(e,i,n){throw ie("Ray")},t.prototype.getForwardRayToRef=function(e,i,n,a){throw ie("Ray")},t.prototype.dispose=function(e,i){for(i===void 0&&(i=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this._parentContainer){var a=this._parentContainer.cameras.indexOf(this);a>-1&&this._parentContainer.cameras.splice(a,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==t.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else for(var r=this._postProcesses.length;--r>=0;){var h=this._postProcesses[r];h&&h.dispose(this)}for(var u=this.customRenderTargets.length;--u>=0;)this.customRenderTargets[u].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),o.prototype.dispose.call(this,e,i)},Object.defineProperty(t.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!1,configurable:!0}),t.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},t.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},t.prototype.setCameraRigMode=function(e,i){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=i.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=b.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==t.RIG_MODE_NONE){var a=this.createRigCamera(this.name+"_L",0);a&&(a._isLeftCamera=!0);var r=this.createRigCamera(this.name+"_R",1);r&&(r._isRightCamera=!0),a&&r&&(this._rigCameras.push(a),this._rigCameras.push(r))}this._setRigMode(i),this._cascadePostProcessesToRigCams(),this.update()}},t.prototype._setRigMode=function(e){},t.prototype._getVRProjectionMatrix=function(){return p.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},t.prototype._updateCameraRotationMatrix=function(){},t.prototype._updateWebVRCameraRotationMatrix=function(){},t.prototype._getWebVRProjectionMatrix=function(){return p.Identity()},t.prototype._getWebVRViewMatrix=function(){return p.Identity()},t.prototype.setCameraRigParameter=function(e,i){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=i,e==="interaxialDistance"&&(this._cameraRigParams.stereoHalfAngle=b.ToRadians(i/.0637))},t.prototype.createRigCamera=function(e,i){return null},t.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===t.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},t.prototype._setupInputs=function(){},t.prototype.serialize=function(){var e=z.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(e),this.inputs&&this.inputs.serialize(e),z.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e},t.prototype.clone=function(e,i){i===void 0&&(i=null);var n=z.Clone(t.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return n.name=e,n.parent=i,this.onClonedObservable.notifyObservers(n),n},t.prototype.getDirection=function(e){var i=f.Zero();return this.getDirectionToRef(e,i),i},Object.defineProperty(t.prototype,"absoluteRotation",{get:function(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation},enumerable:!1,configurable:!0}),t.prototype.getDirectionToRef=function(e,i){f.TransformNormalToRef(e,this.getWorldMatrix(),i)},t.GetConstructorFromName=function(e,i,n,a,r){a===void 0&&(a=0),r===void 0&&(r=!0);var h=P.Construct(e,i,n,{interaxial_distance:a,isStereoscopicSideBySide:r});return h||function(){return t._CreateDefaultParsedCamera(i,n)}},t.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},t.Parse=function(e,i){var n=e.type,a=t.GetConstructorFromName(n,e.name,i,e.interaxial_distance,e.isStereoscopicSideBySide),r=z.Parse(a,e,i);if(e.parentId!==void 0&&(r._waitingParentId=e.parentId),e.parentInstanceIndex!==void 0&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),r.inputs&&(r.inputs.parse(e),r._setupInputs()),e.upVector&&(r.upVector=f.FromArray(e.upVector)),r.setPosition&&(r.position.copyFromFloats(0,0,0),r.setPosition(f.FromArray(e.position))),e.target&&r.setTarget&&r.setTarget(f.FromArray(e.target)),e.cameraRigMode){var h=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};r.setCameraRigMode(e.cameraRigMode,h)}if(e.animations){for(var u=0;u<e.animations.length;u++){var s=e.animations[u],d=Je("BABYLON.Animation");d&&r.animations.push(d.Parse(s))}P.ParseAnimationRanges(r,e,i)}return e.autoAnimate&&i.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.isEnabled!==void 0&&r.setEnabled(e.isEnabled),r},t._CreateDefaultParsedCamera=function(e,i){throw ie("UniversalCamera")},t.PERSPECTIVE_CAMERA=0,t.ORTHOGRAPHIC_CAMERA=1,t.FOVMODE_VERTICAL_FIXED=0,t.FOVMODE_HORIZONTAL_FIXED=1,t.RIG_MODE_NONE=0,t.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,t.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,t.RIG_MODE_STEREOSCOPIC_INTERLACED=14,t.RIG_MODE_VR=20,t.RIG_MODE_WEBVR=21,t.RIG_MODE_CUSTOM=22,t.ForceAttachControlToAlwaysPreventDefault=!1,l([L("position")],t.prototype,"_position",void 0),l([L("upVector")],t.prototype,"_upVector",void 0),l([c()],t.prototype,"orthoLeft",null),l([c()],t.prototype,"orthoRight",null),l([c()],t.prototype,"orthoBottom",null),l([c()],t.prototype,"orthoTop",null),l([c()],t.prototype,"fov",void 0),l([c()],t.prototype,"projectionPlaneTilt",void 0),l([c()],t.prototype,"minZ",void 0),l([c()],t.prototype,"maxZ",void 0),l([c()],t.prototype,"inertia",void 0),l([c()],t.prototype,"mode",null),l([c()],t.prototype,"layerMask",void 0),l([c()],t.prototype,"fovMode",void 0),l([c()],t.prototype,"cameraRigMode",void 0),l([c()],t.prototype,"interaxialDistance",void 0),l([c()],t.prototype,"isStereoscopicSideBySide",void 0),t}(P),pt=function(){function o(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new w,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}return o.prototype.attachControl=function(t){var e=this;t=b.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(i){if(i.type===g.POINTERWHEEL){var n=i.event,a=n.deltaMode===be.DOM_DELTA_LINE?e._ffMultiplier:1;n.deltaY!==void 0?(e._wheelDeltaX+=e.wheelPrecisionX*a*n.deltaX/e._normalize,e._wheelDeltaY-=e.wheelPrecisionY*a*n.deltaY/e._normalize,e._wheelDeltaZ+=e.wheelPrecisionZ*a*n.deltaZ/e._normalize):n.wheelDeltaY!==void 0?(e._wheelDeltaX+=e.wheelPrecisionX*a*n.wheelDeltaX/e._normalize,e._wheelDeltaY-=e.wheelPrecisionY*a*n.wheelDeltaY/e._normalize,e._wheelDeltaZ+=e.wheelPrecisionZ*a*n.wheelDeltaZ/e._normalize):n.wheelDelta&&(e._wheelDeltaY-=e.wheelPrecisionY*n.wheelDelta/e._normalize),n.preventDefault&&(t||n.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,g.POINTERWHEEL)},o.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()},o.prototype.checkInputs=function(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0},o.prototype.getClassName=function(){return"BaseCameraMouseWheelInput"},o.prototype.getSimpleName=function(){return"mousewheel"},l([c()],o.prototype,"wheelPrecisionX",void 0),l([c()],o.prototype,"wheelPrecisionY",void 0),l([c()],o.prototype,"wheelPrecisionZ",void 0),o}(),Me=function(){function o(){this._currentActiveButton=-1,this.buttons=[0,1,2]}return o.prototype.attachControl=function(t){var e=this;t=b.BackCompatCameraNoPreventDefault(arguments);var i=this.camera.getEngine(),n=i.getInputElement(),a=0,r=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(u){var s=u.event,d=s.pointerType==="touch";if(!i.isInVRExclusivePointerMode&&!(u.type!==g.POINTERMOVE&&e.buttons.indexOf(s.button)===-1)){var _=s.srcElement||s.target;if(e._altKey=s.altKey,e._ctrlKey=s.ctrlKey,e._metaKey=s.metaKey,e._shiftKey=s.shiftKey,e._buttonsPressed=s.buttons,i.isPointerLock){var R=s.movementX||s.mozMovementX||s.webkitMovementX||s.msMovementX||0,O=s.movementY||s.mozMovementY||s.webkitMovementY||s.msMovementY||0;e.onTouch(null,R,O),e._pointA=null,e._pointB=null}else if(u.type===g.POINTERDOWN&&(e._currentActiveButton===-1||d)){try{_==null||_.setPointerCapture(s.pointerId)}catch{}e._pointA===null?e._pointA={x:s.clientX,y:s.clientY,pointerId:s.pointerId,type:s.pointerType}:e._pointB===null&&(e._pointB={x:s.clientX,y:s.clientY,pointerId:s.pointerId,type:s.pointerType}),e._currentActiveButton===-1&&!d&&(e._currentActiveButton=s.button),e.onButtonDown(s),t||(s.preventDefault(),n&&n.focus())}else if(u.type===g.POINTERDOUBLETAP)e.onDoubleTap(s.pointerType);else if(u.type===g.POINTERUP&&(e._currentActiveButton===s.button||d)){try{_==null||_.releasePointerCapture(s.pointerId)}catch{}d||(e._pointB=null),i._badOS?e._pointA=e._pointB=null:e._pointB&&e._pointA&&e._pointA.pointerId==s.pointerId?(e._pointA=e._pointB,e._pointB=null):e._pointA&&e._pointB&&e._pointB.pointerId==s.pointerId?e._pointB=null:e._pointA=e._pointB=null,(a!==0||r)&&(e.onMultiTouch(e._pointA,e._pointB,a,0,r,null),a=0,r=null),e._currentActiveButton=-1,e.onButtonUp(s),t||s.preventDefault()}else if(u.type===g.POINTERMOVE){if(t||s.preventDefault(),e._pointA&&e._pointB===null){var R=s.clientX-e._pointA.x,O=s.clientY-e._pointA.y;e.onTouch(e._pointA,R,O),e._pointA.x=s.clientX,e._pointA.y=s.clientY}else if(e._pointA&&e._pointB){var T=e._pointA.pointerId===s.pointerId?e._pointA:e._pointB;T.x=s.clientX,T.y=s.clientY;var I=e._pointA.x-e._pointB.x,x=e._pointA.y-e._pointB.y,Z=I*I+x*x,N={x:(e._pointA.x+e._pointB.x)/2,y:(e._pointA.y+e._pointB.y)/2,pointerId:s.pointerId,type:u.type};e.onMultiTouch(e._pointA,e._pointB,a,Z,r,N),r=N,a=Z}}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,g.POINTERDOWN|g.POINTERUP|g.POINTERMOVE|g.POINTERDOUBLETAP),this._onLostFocus=function(){e._pointA=e._pointB=null,a=0,r=null,e.onLostFocus()},this._contextMenuBind=this.onContextMenu.bind(this),n&&n.addEventListener("contextmenu",this._contextMenuBind,!1);var h=this.camera.getScene().getEngine().getHostWindow();h&&b.RegisterTopRootEvents(h,[{name:"blur",handler:this._onLostFocus}])},o.prototype.detachControl=function(){if(this._onLostFocus){var t=this.camera.getScene().getEngine().getHostWindow();t&&b.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._contextMenuBind){var e=this.camera.getScene().getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1},o.prototype.getClassName=function(){return"BaseCameraPointersInput"},o.prototype.getSimpleName=function(){return"pointers"},o.prototype.onDoubleTap=function(t){},o.prototype.onTouch=function(t,e,i){},o.prototype.onMultiTouch=function(t,e,i,n,a,r){},o.prototype.onContextMenu=function(t){t.preventDefault()},o.prototype.onButtonDown=function(t){},o.prototype.onButtonUp=function(t){},o.prototype.onLostFocus=function(){},l([c()],o.prototype,"buttons",void 0),o}(),k={},J=function(){function o(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=function(){}}return o.prototype.add=function(t){var e=t.getSimpleName();if(this.attached[e]){E.Warn("camera input of type "+e+" already exists on camera");return}this.attached[e]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl()},o.prototype.remove=function(t){for(var e in this.attached){var i=this.attached[e];i===t&&(i.detachControl(),i.camera=null,delete this.attached[e],this.rebuildInputCheck())}},o.prototype.removeByType=function(t){for(var e in this.attached){var i=this.attached[e];i.getClassName()===t&&(i.detachControl(),i.camera=null,delete this.attached[e],this.rebuildInputCheck())}},o.prototype._addCheckInputs=function(t){var e=this.checkInputs;return function(){e(),t()}},o.prototype.attachInput=function(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)},o.prototype.attachElement=function(t){if(t===void 0&&(t=!1),!this.attachedToElement){t=m.ForceAttachControlToAlwaysPreventDefault?!1:t,this.attachedToElement=!0,this.noPreventDefault=t;for(var e in this.attached)this.attached[e].attachControl(t)}},o.prototype.detachElement=function(t){t===void 0&&(t=!1);for(var e in this.attached)this.attached[e].detachControl(),t&&(this.attached[e].camera=null);this.attachedToElement=!1},o.prototype.rebuildInputCheck=function(){this.checkInputs=function(){};for(var t in this.attached){var e=this.attached[t];e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e)))}},o.prototype.clear=function(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=function(){}},o.prototype.serialize=function(t){var e={};for(var i in this.attached){var n=this.attached[i],a=z.Serialize(n);e[n.getClassName()]=a}t.inputsmgr=e},o.prototype.parse=function(t){var e=t.inputsmgr;if(e){this.clear();var i=function(u){var s=k[u];if(s){var d=e[u],_=z.Parse(function(){return new s},d,null);n.add(_)}},n=this;for(var a in e)i(a)}else{var r=function(u){var s=k[h.attached[u].getClassName()];if(s){var d=z.Parse(function(){return new s},t,null);h.remove(h.attached[u]),h.add(d)}},h=this;for(var a in this.attached)r(a)}},o}(),dt=function(){function o(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40,this._yAxisScale=1}return Object.defineProperty(o.prototype,"invertYAxis",{get:function(){return this._yAxisScale!==1},set:function(t){this._yAxisScale=t?-1:1},enumerable:!1,configurable:!0}),o.prototype.attachControl=function(){var t=this,e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add(function(i){i.type!==D.POSE_ENABLED&&(!t.gamepad||i.type===D.XBOX)&&(t.gamepad=i)}),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add(function(i){t.gamepad===i&&(t.gamepad=null)}),this.gamepad=e.getGamepadByType(D.XBOX)},o.prototype.detachControl=function(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},o.prototype.checkInputs=function(){if(this.gamepad){var t=this.camera,e=this.gamepad.rightStick;if(e){if(e.x!=0){var i=e.x/this.gamepadRotationSensibility;i!=0&&Math.abs(i)>.005&&(t.inertialAlphaOffset+=i)}if(e.y!=0){var n=e.y/this.gamepadRotationSensibility*this._yAxisScale;n!=0&&Math.abs(n)>.005&&(t.inertialBetaOffset+=n)}}var a=this.gamepad.leftStick;if(a&&a.y!=0){var r=a.y/this.gamepadMoveSensibility;r!=0&&Math.abs(r)>.005&&(this.camera.inertialRadiusOffset-=r)}}},o.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},o.prototype.getSimpleName=function(){return"gamepad"},l([c()],o.prototype,"gamepadRotationSensibility",void 0),l([c()],o.prototype,"gamepadMoveSensibility",void 0),o}();k.ArcRotateCameraGamepadInput=dt;var we=function(){function o(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return o.prototype.attachControl=function(t){var e=this;t=b.BackCompatCameraNoPreventDefault(arguments),!this._onCanvasBlurObserver&&(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys.length=0}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(i){var n=i.event;if(!n.metaKey){if(i.type===q.KEYDOWN){if(e._ctrlPressed=n.ctrlKey,e._altPressed=n.altKey,e.keysUp.indexOf(n.keyCode)!==-1||e.keysDown.indexOf(n.keyCode)!==-1||e.keysLeft.indexOf(n.keyCode)!==-1||e.keysRight.indexOf(n.keyCode)!==-1||e.keysReset.indexOf(n.keyCode)!==-1){var a=e._keys.indexOf(n.keyCode);a===-1&&e._keys.push(n.keyCode),n.preventDefault&&(t||n.preventDefault())}}else if(e.keysUp.indexOf(n.keyCode)!==-1||e.keysDown.indexOf(n.keyCode)!==-1||e.keysLeft.indexOf(n.keyCode)!==-1||e.keysRight.indexOf(n.keyCode)!==-1||e.keysReset.indexOf(n.keyCode)!==-1){var a=e._keys.indexOf(n.keyCode);a>=0&&e._keys.splice(a,1),n.preventDefault&&(t||n.preventDefault())}}}))},o.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0},o.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var i=this._keys[e];this.keysLeft.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:this.keysUp.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:this.keysRight.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:this.keysDown.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:this.keysReset.indexOf(i)!==-1&&t.useInputToRestoreState&&t.restoreState()}},o.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},o.prototype.getSimpleName=function(){return"keyboard"},l([c()],o.prototype,"keysUp",void 0),l([c()],o.prototype,"keysDown",void 0),l([c()],o.prototype,"keysLeft",void 0),l([c()],o.prototype,"keysRight",void 0),l([c()],o.prototype,"keysReset",void 0),l([c()],o.prototype,"panningSensibility",void 0),l([c()],o.prototype,"zoomingSensibility",void 0),l([c()],o.prototype,"useAltToZoom",void 0),l([c()],o.prototype,"angularSpeed",void 0),o}();k.ArcRotateCameraKeyboardMoveInput=we;var _t=40,ke=function(){function o(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._inertialPanning=f.Zero()}return o.prototype._computeDeltaFromMouseWheelLegacyEvent=function(t,e){var i=0,n=t*.01*this.wheelDeltaPercentage*e;return t>0?i=n/(1+this.wheelDeltaPercentage):i=n*(1+this.wheelDeltaPercentage),i},o.prototype.attachControl=function(t){var e=this;t=b.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(i){if(i.type===g.POINTERWHEEL){var n=i.event,a=0,r=n,h=0,u=n.deltaMode===be.DOM_DELTA_LINE?_t:1;if(n.deltaY!==void 0?h=-(n.deltaY*u):n.wheelDeltaY!==void 0?h=-(n.wheelDeltaY*u):h=r.wheelDelta,e.customComputeDeltaFromMouseWheel)a=e.customComputeDeltaFromMouseWheel(h,e,n);else if(e.wheelDeltaPercentage){if(a=e._computeDeltaFromMouseWheelLegacyEvent(h,e.camera.radius),a>0){for(var s=e.camera.radius,d=e.camera.inertialRadiusOffset+a,_=0;_<20&&Math.abs(d)>.001;_++)s-=d,d*=e.camera.inertia;s=Ue.Clamp(s,0,Number.MAX_VALUE),a=e._computeDeltaFromMouseWheelLegacyEvent(h,s)}}else a=h/(e.wheelPrecision*40);a&&(e.zoomToMouseLocation&&e._hitPlane?e._zoomToMouse(a):e.camera.inertialRadiusOffset+=a),n.preventDefault&&(t||n.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,g.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)},o.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},o.prototype.checkInputs=function(){if(!!this.zoomToMouseLocation){var t=this.camera,e=0+t.inertialAlphaOffset+t.inertialBetaOffset+t.inertialRadiusOffset;e&&(this._updateHitPlane(),t.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(t.inertia),this._zeroIfClose(this._inertialPanning))}},o.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},o.prototype.getSimpleName=function(){return"mousewheel"},o.prototype._updateHitPlane=function(){var t=this.camera,e=t.target.subtract(t.position);this._hitPlane=Qe.FromPositionAndNormal(t.target,e)},o.prototype._getPosition=function(){var t,e=this.camera,i=e.getScene(),n=i.createPickingRay(i.pointerX,i.pointerY,p.Identity(),e,!1),a=0;return this._hitPlane&&(a=(t=n.intersectsPlane(this._hitPlane))!==null&&t!==void 0?t:0),n.origin.addInPlace(n.direction.scaleInPlace(a))},o.prototype._zoomToMouse=function(t){var e,i,n=this.camera,a=1-n.inertia;if(n.lowerRadiusLimit){var r=(e=n.lowerRadiusLimit)!==null&&e!==void 0?e:0;n.radius-(n.inertialRadiusOffset+t)/a<r&&(t=(n.radius-r)*a-n.inertialRadiusOffset)}if(n.upperRadiusLimit){var h=(i=n.upperRadiusLimit)!==null&&i!==void 0?i:0;n.radius-(n.inertialRadiusOffset+t)/a>h&&(t=(n.radius-h)*a-n.inertialRadiusOffset)}var u=t/a,s=u/n.radius,d=this._getPosition(),_=H.Vector3[6];d.subtractToRef(n.target,_),_.scaleInPlace(s),_.scaleInPlace(a),this._inertialPanning.addInPlace(_),n.inertialRadiusOffset+=t},o.prototype._zeroIfClose=function(t){Math.abs(t.x)<S&&(t.x=0),Math.abs(t.y)<S&&(t.y=0),Math.abs(t.z)<S&&(t.z=0)},l([c()],o.prototype,"wheelPrecision",void 0),l([c()],o.prototype,"zoomToMouseLocation",void 0),l([c()],o.prototype,"wheelDeltaPercentage",void 0),o}();k.ArcRotateCameraMouseWheelInput=ke;var Te=function(o){C(t,o);function t(){var e=o!==null&&o.apply(this,arguments)||this;return e.buttons=[0,1,2],e.angularSensibilityX=1e3,e.angularSensibilityY=1e3,e.pinchPrecision=12,e.pinchDeltaPercentage=0,e.useNaturalPinchZoom=!1,e.pinchZoom=!0,e.panningSensibility=1e3,e.multiTouchPanning=!0,e.multiTouchPanAndZoom=!0,e.pinchInwards=!0,e._isPanClick=!1,e._twoFingerActivityCount=0,e._isPinching=!1,e}return t.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},t.prototype._computeMultiTouchPanning=function(e,i){if(this.panningSensibility!==0&&e&&i){var n=i.x-e.x,a=i.y-e.y;this.camera.inertialPanningX+=-n/this.panningSensibility,this.camera.inertialPanningY+=a/this.panningSensibility}},t.prototype._computePinchZoom=function(e,i){var n=this.camera.radius||t.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=n*Math.sqrt(e)/Math.sqrt(i):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=(i-e)*.001*n*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(i-e)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)},t.prototype.onTouch=function(e,i,n){this.panningSensibility!==0&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility):(this.camera.inertialAlphaOffset-=i/this.angularSensibilityX,this.camera.inertialBetaOffset-=n/this.angularSensibilityY)},t.prototype.onDoubleTap=function(){this.camera.useInputToRestoreState&&this.camera.restoreState()},t.prototype.onMultiTouch=function(e,i,n,a,r,h){n===0&&r===null||a===0&&h===null||(this.multiTouchPanAndZoom?(this._computePinchZoom(n,a),this._computeMultiTouchPanning(r,h)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(a)-Math.sqrt(n))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(n,a),this._isPinching=!0):this._computeMultiTouchPanning(r,h)):this.multiTouchPanning?this._computeMultiTouchPanning(r,h):this.pinchZoom&&this._computePinchZoom(n,a))},t.prototype.onButtonDown=function(e){this._isPanClick=e.button===this.camera._panningMouseButton},t.prototype.onButtonUp=function(){this._twoFingerActivityCount=0,this._isPinching=!1},t.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},t.MinimumRadiusForPinch=.001,l([c()],t.prototype,"buttons",void 0),l([c()],t.prototype,"angularSensibilityX",void 0),l([c()],t.prototype,"angularSensibilityY",void 0),l([c()],t.prototype,"pinchPrecision",void 0),l([c()],t.prototype,"pinchDeltaPercentage",void 0),l([c()],t.prototype,"useNaturalPinchZoom",void 0),l([c()],t.prototype,"pinchZoom",void 0),l([c()],t.prototype,"panningSensibility",void 0),l([c()],t.prototype,"multiTouchPanning",void 0),l([c()],t.prototype,"multiTouchPanAndZoom",void 0),t}(Me);k.ArcRotateCameraPointersInput=Te;var Se=function(o){C(t,o);function t(e){return o.call(this,e)||this}return t.prototype.addMouseWheel=function(){return this.add(new ke),this},t.prototype.addPointers=function(){return this.add(new Te),this},t.prototype.addKeyboard=function(){return this.add(new we),this},t}(J);Se.prototype.addVRDeviceOrientation=function(){return this.add(new xe),this};var xe=function(){function o(){this.alphaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return o.prototype.attachControl=function(t){var e=this;t=b.BackCompatCameraNoPreventDefault(arguments),this.camera.attachControl(t);var i=this.camera.getScene().getEngine().getHostWindow();i&&(typeof DeviceOrientationEvent!="undefined"&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(n){n==="granted"?i.addEventListener("deviceorientation",e._deviceOrientationHandler):b.Warn("Permission not granted.")}).catch(function(n){b.Error(n)}):i.addEventListener("deviceorientation",this._deviceOrientationHandler))},o.prototype._onOrientationEvent=function(t){t.alpha!==null&&(this._alpha=(+t.alpha|0)*this.alphaCorrection),t.gamma!==null&&(this._gamma=(+t.gamma|0)*this.gammaCorrection),this._dirty=!0},o.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},o.prototype.detachControl=function(){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},o.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},o.prototype.getSimpleName=function(){return"VRDeviceOrientation"},o}();k.ArcRotateCameraVRDeviceOrientationInput=xe;var Ee=function(){function o(){this.keysForward=[87],this.keysBackward=[83],this.keysUp=[69],this.keysDown=[81],this.keysRight=[68],this.keysLeft=[65],this._keys=new Array}return o.prototype.attachControl=function(t){var e=this;t=b.BackCompatCameraNoPreventDefault(arguments),!this._onCanvasBlurObserver&&(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys.length=0}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(i){var n=i.event;if(i.type===q.KEYDOWN){if(e.keysForward.indexOf(n.keyCode)!==-1||e.keysBackward.indexOf(n.keyCode)!==-1||e.keysUp.indexOf(n.keyCode)!==-1||e.keysDown.indexOf(n.keyCode)!==-1||e.keysLeft.indexOf(n.keyCode)!==-1||e.keysRight.indexOf(n.keyCode)!==-1){var a=e._keys.indexOf(n.keyCode);a===-1&&e._keys.push(n.keyCode),t||n.preventDefault()}}else if(e.keysForward.indexOf(n.keyCode)!==-1||e.keysBackward.indexOf(n.keyCode)!==-1||e.keysUp.indexOf(n.keyCode)!==-1||e.keysDown.indexOf(n.keyCode)!==-1||e.keysLeft.indexOf(n.keyCode)!==-1||e.keysRight.indexOf(n.keyCode)!==-1){var a=e._keys.indexOf(n.keyCode);a>=0&&e._keys.splice(a,1),t||n.preventDefault()}}))},o.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0},o.prototype.getClassName=function(){return"FlyCameraKeyboardInput"},o.prototype._onLostFocus=function(){this._keys.length=0},o.prototype.getSimpleName=function(){return"keyboard"},o.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var i=this._keys[e],n=t._computeLocalCameraSpeed();this.keysForward.indexOf(i)!==-1?t._localDirection.copyFromFloats(0,0,n):this.keysBackward.indexOf(i)!==-1?t._localDirection.copyFromFloats(0,0,-n):this.keysUp.indexOf(i)!==-1?t._localDirection.copyFromFloats(0,n,0):this.keysDown.indexOf(i)!==-1?t._localDirection.copyFromFloats(0,-n,0):this.keysRight.indexOf(i)!==-1?t._localDirection.copyFromFloats(n,0,0):this.keysLeft.indexOf(i)!==-1&&t._localDirection.copyFromFloats(-n,0,0),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),f.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},l([c()],o.prototype,"keysForward",void 0),l([c()],o.prototype,"keysBackward",void 0),l([c()],o.prototype,"keysUp",void 0),l([c()],o.prototype,"keysDown",void 0),l([c()],o.prototype,"keysRight",void 0),l([c()],o.prototype,"keysLeft",void 0),o}();k.FlyCameraKeyboardInput=Ee;var De=function(){function o(){this.buttons=[0,1,2],this.buttonsYaw=[-1,0,1],this.buttonsPitch=[-1,0,1],this.buttonsRoll=[2],this.activeButton=-1,this.angularSensibility=1e3,this._previousPosition=null}return o.prototype.attachControl=function(t){var e=this;t=b.BackCompatCameraNoPreventDefault(arguments),this._noPreventDefault=t,this._observer=this.camera.getScene().onPointerObservable.add(function(i){e._pointerInput(i)},g.POINTERDOWN|g.POINTERUP|g.POINTERMOVE),this._rollObserver=this.camera.getScene().onBeforeRenderObservable.add(function(){e.camera.rollCorrect&&e.camera.restoreRoll(e.camera.rollCorrect)})},o.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this.camera.getScene().onBeforeRenderObservable.remove(this._rollObserver),this._observer=null,this._rollObserver=null,this._previousPosition=null,this._noPreventDefault=void 0)},o.prototype.getClassName=function(){return"FlyCameraMouseInput"},o.prototype.getSimpleName=function(){return"mouse"},o.prototype._pointerInput=function(t){var e=t.event,i=this.camera,n=i.getEngine();if(!n.isInVRExclusivePointerMode&&!(!this.touchEnabled&&e.pointerType==="touch")&&!(t.type!==g.POINTERMOVE&&this.buttons.indexOf(e.button)===-1)){var a=e.srcElement||e.target;if(t.type===g.POINTERDOWN){try{a==null||a.setPointerCapture(e.pointerId)}catch{}this._previousPosition={x:e.clientX,y:e.clientY},this.activeButton=e.button,this._noPreventDefault||(e.preventDefault(),this._element.focus()),n.isPointerLock&&this._onMouseMove(t.event)}else if(t.type===g.POINTERUP){try{a==null||a.releasePointerCapture(e.pointerId)}catch{}this.activeButton=-1,this._previousPosition=null,this._noPreventDefault||e.preventDefault()}else if(t.type===g.POINTERMOVE){if(!this._previousPosition){n.isPointerLock&&this._onMouseMove(t.event);return}var r=e.clientX-this._previousPosition.x,h=e.clientY-this._previousPosition.y;this._rotateCamera(r,h),this._previousPosition={x:e.clientX,y:e.clientY},this._noPreventDefault||e.preventDefault()}}},o.prototype._onMouseMove=function(t){var e=this.camera,i=e.getEngine();if(!(!i.isPointerLock||i.isInVRExclusivePointerMode)){var n=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0,a=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0;this._rotateCamera(n,a),this._previousPosition=null,this._noPreventDefault||t.preventDefault()}},o.prototype._rotateCamera=function(t,e){var i=this,n=this.camera,a=this.camera.getScene();a.useRightHandedSystem&&(t*=-1),n.parent&&n.parent._getWorldMatrixDeterminant()<0&&(t*=-1);var r=t/this.angularSensibility,h=e/this.angularSensibility,u=v.RotationYawPitchRoll(n.rotation.y,n.rotation.x,n.rotation.z),s;if(this.buttonsPitch.some(function(R){return R===i.activeButton})&&(s=v.RotationAxis(A.X,h),u.multiplyInPlace(s)),this.buttonsYaw.some(function(R){return R===i.activeButton})){s=v.RotationAxis(A.Y,r),u.multiplyInPlace(s);var d=n.bankedTurnLimit+n._trackRoll;if(n.bankedTurn&&-d<n.rotation.z&&n.rotation.z<d){var _=n.bankedTurnMultiplier*-r;s=v.RotationAxis(A.Z,_),u.multiplyInPlace(s)}}this.buttonsRoll.some(function(R){return R===i.activeButton})&&(s=v.RotationAxis(A.Z,-r),n._trackRoll-=r,u.multiplyInPlace(s)),u.toEulerAnglesToRef(n.rotation)},l([c()],o.prototype,"buttons",void 0),l([c()],o.prototype,"angularSensibility",void 0),o}();k.FlyCameraMouseInput=De;var Ie=function(){function o(){this.keysHeightOffsetIncr=[38],this.keysHeightOffsetDecr=[40],this.keysHeightOffsetModifierAlt=!1,this.keysHeightOffsetModifierCtrl=!1,this.keysHeightOffsetModifierShift=!1,this.keysRotationOffsetIncr=[37],this.keysRotationOffsetDecr=[39],this.keysRotationOffsetModifierAlt=!1,this.keysRotationOffsetModifierCtrl=!1,this.keysRotationOffsetModifierShift=!1,this.keysRadiusIncr=[40],this.keysRadiusDecr=[38],this.keysRadiusModifierAlt=!0,this.keysRadiusModifierCtrl=!1,this.keysRadiusModifierShift=!1,this.heightSensibility=1,this.rotationSensibility=1,this.radiusSensibility=1,this._keys=new Array}return o.prototype.attachControl=function(t){var e=this;t=b.BackCompatCameraNoPreventDefault(arguments),!this._onCanvasBlurObserver&&(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys.length=0}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(i){var n=i.event;if(!n.metaKey){if(i.type===q.KEYDOWN){if(e._ctrlPressed=n.ctrlKey,e._altPressed=n.altKey,e._shiftPressed=n.shiftKey,e.keysHeightOffsetIncr.indexOf(n.keyCode)!==-1||e.keysHeightOffsetDecr.indexOf(n.keyCode)!==-1||e.keysRotationOffsetIncr.indexOf(n.keyCode)!==-1||e.keysRotationOffsetDecr.indexOf(n.keyCode)!==-1||e.keysRadiusIncr.indexOf(n.keyCode)!==-1||e.keysRadiusDecr.indexOf(n.keyCode)!==-1){var a=e._keys.indexOf(n.keyCode);a===-1&&e._keys.push(n.keyCode),n.preventDefault&&(t||n.preventDefault())}}else if(e.keysHeightOffsetIncr.indexOf(n.keyCode)!==-1||e.keysHeightOffsetDecr.indexOf(n.keyCode)!==-1||e.keysRotationOffsetIncr.indexOf(n.keyCode)!==-1||e.keysRotationOffsetDecr.indexOf(n.keyCode)!==-1||e.keysRadiusIncr.indexOf(n.keyCode)!==-1||e.keysRadiusDecr.indexOf(n.keyCode)!==-1){var a=e._keys.indexOf(n.keyCode);a>=0&&e._keys.splice(a,1),n.preventDefault&&(t||n.preventDefault())}}}))},o.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0},o.prototype.checkInputs=function(){var t=this;this._onKeyboardObserver&&this._keys.forEach(function(e){t.keysHeightOffsetIncr.indexOf(e)!==-1&&t._modifierHeightOffset()?t.camera.heightOffset+=t.heightSensibility:t.keysHeightOffsetDecr.indexOf(e)!==-1&&t._modifierHeightOffset()?t.camera.heightOffset-=t.heightSensibility:t.keysRotationOffsetIncr.indexOf(e)!==-1&&t._modifierRotationOffset()?(t.camera.rotationOffset+=t.rotationSensibility,t.camera.rotationOffset%=360):t.keysRotationOffsetDecr.indexOf(e)!==-1&&t._modifierRotationOffset()?(t.camera.rotationOffset-=t.rotationSensibility,t.camera.rotationOffset%=360):t.keysRadiusIncr.indexOf(e)!==-1&&t._modifierRadius()?t.camera.radius+=t.radiusSensibility:t.keysRadiusDecr.indexOf(e)!==-1&&t._modifierRadius()&&(t.camera.radius-=t.radiusSensibility)})},o.prototype.getClassName=function(){return"FollowCameraKeyboardMoveInput"},o.prototype.getSimpleName=function(){return"keyboard"},o.prototype._modifierHeightOffset=function(){return this.keysHeightOffsetModifierAlt===this._altPressed&&this.keysHeightOffsetModifierCtrl===this._ctrlPressed&&this.keysHeightOffsetModifierShift===this._shiftPressed},o.prototype._modifierRotationOffset=function(){return this.keysRotationOffsetModifierAlt===this._altPressed&&this.keysRotationOffsetModifierCtrl===this._ctrlPressed&&this.keysRotationOffsetModifierShift===this._shiftPressed},o.prototype._modifierRadius=function(){return this.keysRadiusModifierAlt===this._altPressed&&this.keysRadiusModifierCtrl===this._ctrlPressed&&this.keysRadiusModifierShift===this._shiftPressed},l([c()],o.prototype,"keysHeightOffsetIncr",void 0),l([c()],o.prototype,"keysHeightOffsetDecr",void 0),l([c()],o.prototype,"keysHeightOffsetModifierAlt",void 0),l([c()],o.prototype,"keysHeightOffsetModifierCtrl",void 0),l([c()],o.prototype,"keysHeightOffsetModifierShift",void 0),l([c()],o.prototype,"keysRotationOffsetIncr",void 0),l([c()],o.prototype,"keysRotationOffsetDecr",void 0),l([c()],o.prototype,"keysRotationOffsetModifierAlt",void 0),l([c()],o.prototype,"keysRotationOffsetModifierCtrl",void 0),l([c()],o.prototype,"keysRotationOffsetModifierShift",void 0),l([c()],o.prototype,"keysRadiusIncr",void 0),l([c()],o.prototype,"keysRadiusDecr",void 0),l([c()],o.prototype,"keysRadiusModifierAlt",void 0),l([c()],o.prototype,"keysRadiusModifierCtrl",void 0),l([c()],o.prototype,"keysRadiusModifierShift",void 0),l([c()],o.prototype,"heightSensibility",void 0),l([c()],o.prototype,"rotationSensibility",void 0),l([c()],o.prototype,"radiusSensibility",void 0),o}();k.FollowCameraKeyboardMoveInput=Ie;var Ae=function(){function o(){this.axisControlRadius=!0,this.axisControlHeight=!1,this.axisControlRotation=!1,this.wheelPrecision=3,this.wheelDeltaPercentage=0}return o.prototype.attachControl=function(t){var e=this;t=b.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(i){if(i.type===g.POINTERWHEEL){var n=i.event,a=0,r=Math.max(-1,Math.min(1,n.deltaY||n.wheelDelta||-n.detail));e.wheelDeltaPercentage?(console.assert(e.axisControlRadius+e.axisControlHeight+e.axisControlRotation<=1,"wheelDeltaPercentage only usable when mouse wheel controls ONE axis. Currently enabled: axisControlRadius: "+e.axisControlRadius+", axisControlHeightOffset: "+e.axisControlHeight+", axisControlRotationOffset: "+e.axisControlRotation),e.axisControlRadius?a=r*.01*e.wheelDeltaPercentage*e.camera.radius:e.axisControlHeight?a=r*.01*e.wheelDeltaPercentage*e.camera.heightOffset:e.axisControlRotation&&(a=r*.01*e.wheelDeltaPercentage*e.camera.rotationOffset)):a=r*e.wheelPrecision,a&&(e.axisControlRadius?e.camera.radius+=a:e.axisControlHeight?e.camera.heightOffset-=a:e.axisControlRotation&&(e.camera.rotationOffset-=a)),n.preventDefault&&(t||n.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,g.POINTERWHEEL)},o.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},o.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},o.prototype.getSimpleName=function(){return"mousewheel"},l([c()],o.prototype,"axisControlRadius",void 0),l([c()],o.prototype,"axisControlHeight",void 0),l([c()],o.prototype,"axisControlRotation",void 0),l([c()],o.prototype,"wheelPrecision",void 0),l([c()],o.prototype,"wheelDeltaPercentage",void 0),o}();k.FollowCameraMouseWheelInput=Ae;var Ve=function(o){C(t,o);function t(){var e=o!==null&&o.apply(this,arguments)||this;return e.angularSensibilityX=1,e.angularSensibilityY=1,e.pinchPrecision=1e4,e.pinchDeltaPercentage=0,e.axisXControlRadius=!1,e.axisXControlHeight=!1,e.axisXControlRotation=!0,e.axisYControlRadius=!1,e.axisYControlHeight=!0,e.axisYControlRotation=!1,e.axisPinchControlRadius=!0,e.axisPinchControlHeight=!1,e.axisPinchControlRotation=!1,e.warningEnable=!0,e._warningCounter=0,e}return t.prototype.getClassName=function(){return"FollowCameraPointersInput"},t.prototype.onTouch=function(e,i,n){this._warning(),this.axisXControlRotation?this.camera.rotationOffset+=i/this.angularSensibilityX:this.axisYControlRotation&&(this.camera.rotationOffset+=n/this.angularSensibilityX),this.axisXControlHeight?this.camera.heightOffset+=i/this.angularSensibilityY:this.axisYControlHeight&&(this.camera.heightOffset+=n/this.angularSensibilityY),this.axisXControlRadius?this.camera.radius-=i/this.angularSensibilityY:this.axisYControlRadius&&(this.camera.radius-=n/this.angularSensibilityY)},t.prototype.onMultiTouch=function(e,i,n,a,r,h){if(!(n===0&&r===null)&&!(a===0&&h===null)){var u=(a-n)/(this.pinchPrecision*(this.angularSensibilityX+this.angularSensibilityY)/2);this.pinchDeltaPercentage?(u*=.01*this.pinchDeltaPercentage,this.axisPinchControlRotation&&(this.camera.rotationOffset+=u*this.camera.rotationOffset),this.axisPinchControlHeight&&(this.camera.heightOffset+=u*this.camera.heightOffset),this.axisPinchControlRadius&&(this.camera.radius-=u*this.camera.radius)):(this.axisPinchControlRotation&&(this.camera.rotationOffset+=u),this.axisPinchControlHeight&&(this.camera.heightOffset+=u),this.axisPinchControlRadius&&(this.camera.radius-=u))}},t.prototype._warning=function(){if(!(!this.warningEnable||this._warningCounter++%100!==0)){var e="It probably only makes sense to control ONE camera property with each pointer axis. Set 'warningEnable = false' if you are sure. Currently enabled: ";console.assert(this.axisXControlRotation+this.axisXControlHeight+this.axisXControlRadius<=1,e+"axisXControlRotation: "+this.axisXControlRotation+", axisXControlHeight: "+this.axisXControlHeight+", axisXControlRadius: "+this.axisXControlRadius),console.assert(this.axisYControlRotation+this.axisYControlHeight+this.axisYControlRadius<=1,e+"axisYControlRotation: "+this.axisYControlRotation+", axisYControlHeight: "+this.axisYControlHeight+", axisYControlRadius: "+this.axisYControlRadius),console.assert(this.axisPinchControlRotation+this.axisPinchControlHeight+this.axisPinchControlRadius<=1,e+"axisPinchControlRotation: "+this.axisPinchControlRotation+", axisPinchControlHeight: "+this.axisPinchControlHeight+", axisPinchControlRadius: "+this.axisPinchControlRadius)}},l([c()],t.prototype,"angularSensibilityX",void 0),l([c()],t.prototype,"angularSensibilityY",void 0),l([c()],t.prototype,"pinchPrecision",void 0),l([c()],t.prototype,"pinchDeltaPercentage",void 0),l([c()],t.prototype,"axisXControlRadius",void 0),l([c()],t.prototype,"axisXControlHeight",void 0),l([c()],t.prototype,"axisXControlRotation",void 0),l([c()],t.prototype,"axisYControlRadius",void 0),l([c()],t.prototype,"axisYControlHeight",void 0),l([c()],t.prototype,"axisYControlRotation",void 0),l([c()],t.prototype,"axisPinchControlRadius",void 0),l([c()],t.prototype,"axisPinchControlHeight",void 0),l([c()],t.prototype,"axisPinchControlRotation",void 0),t}(Me);k.FollowCameraPointersInput=Ve;var Fe=function(){function o(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this._keys=new Array}return o.prototype.attachControl=function(t){var e=this;t=b.BackCompatCameraNoPreventDefault(arguments),!this._onCanvasBlurObserver&&(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys.length=0}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(i){var n=i.event;if(!n.metaKey){if(i.type===q.KEYDOWN){if(e.keysUp.indexOf(n.keyCode)!==-1||e.keysDown.indexOf(n.keyCode)!==-1||e.keysLeft.indexOf(n.keyCode)!==-1||e.keysRight.indexOf(n.keyCode)!==-1||e.keysUpward.indexOf(n.keyCode)!==-1||e.keysDownward.indexOf(n.keyCode)!==-1||e.keysRotateLeft.indexOf(n.keyCode)!==-1||e.keysRotateRight.indexOf(n.keyCode)!==-1){var a=e._keys.indexOf(n.keyCode);a===-1&&e._keys.push(n.keyCode),t||n.preventDefault()}}else if(e.keysUp.indexOf(n.keyCode)!==-1||e.keysDown.indexOf(n.keyCode)!==-1||e.keysLeft.indexOf(n.keyCode)!==-1||e.keysRight.indexOf(n.keyCode)!==-1||e.keysUpward.indexOf(n.keyCode)!==-1||e.keysDownward.indexOf(n.keyCode)!==-1||e.keysRotateLeft.indexOf(n.keyCode)!==-1||e.keysRotateRight.indexOf(n.keyCode)!==-1){var a=e._keys.indexOf(n.keyCode);a>=0&&e._keys.splice(a,1),t||n.preventDefault()}}}))},o.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0},o.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var i=this._keys[e],n=t._computeLocalCameraSpeed();this.keysLeft.indexOf(i)!==-1?t._localDirection.copyFromFloats(-n,0,0):this.keysUp.indexOf(i)!==-1?t._localDirection.copyFromFloats(0,0,n):this.keysRight.indexOf(i)!==-1?t._localDirection.copyFromFloats(n,0,0):this.keysDown.indexOf(i)!==-1?t._localDirection.copyFromFloats(0,0,-n):this.keysUpward.indexOf(i)!==-1?t._localDirection.copyFromFloats(0,n,0):this.keysDownward.indexOf(i)!==-1?t._localDirection.copyFromFloats(0,-n,0):this.keysRotateLeft.indexOf(i)!==-1?(t._localDirection.copyFromFloats(0,0,0),t.cameraRotation.y-=this._getLocalRotation()):this.keysRotateRight.indexOf(i)!==-1&&(t._localDirection.copyFromFloats(0,0,0),t.cameraRotation.y+=this._getLocalRotation()),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),f.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},o.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},o.prototype._onLostFocus=function(){this._keys.length=0},o.prototype.getSimpleName=function(){return"keyboard"},o.prototype._getLocalRotation=function(){var t=this.rotationSpeed*this._engine.getDeltaTime()/1e3;return this.camera.getScene().useRightHandedSystem&&(t*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(t*=-1),t},l([c()],o.prototype,"keysUp",void 0),l([c()],o.prototype,"keysUpward",void 0),l([c()],o.prototype,"keysDown",void 0),l([c()],o.prototype,"keysDownward",void 0),l([c()],o.prototype,"keysLeft",void 0),l([c()],o.prototype,"keysRight",void 0),l([c()],o.prototype,"rotationSpeed",void 0),l([c()],o.prototype,"keysRotateLeft",void 0),l([c()],o.prototype,"keysRotateRight",void 0),o}();k.FreeCameraKeyboardMoveInput=Fe;var Le=function(){function o(t){t===void 0&&(t=!0),this.touchEnabled=t,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new w,this._allowCameraRotation=!0,this._currentActiveButton=-1}return o.prototype.attachControl=function(t){var e=this;t=b.BackCompatCameraNoPreventDefault(arguments);var i=this.camera.getEngine(),n=i.getInputElement();this._pointerInput||(this._pointerInput=function(a){var r=a.event,h=r.pointerType==="touch";if(!i.isInVRExclusivePointerMode&&!(!e.touchEnabled&&h)&&!(a.type!==g.POINTERMOVE&&e.buttons.indexOf(r.button)===-1)){var u=r.srcElement||r.target;if(a.type===g.POINTERDOWN&&(e._currentActiveButton===-1||h)){try{u==null||u.setPointerCapture(r.pointerId)}catch{}e._currentActiveButton===-1&&(e._currentActiveButton=r.button),e._previousPosition={x:r.clientX,y:r.clientY},t||(r.preventDefault(),n&&n.focus()),i.isPointerLock&&e._onMouseMove&&e._onMouseMove(a.event)}else if(a.type===g.POINTERUP&&(e._currentActiveButton===r.button||h)){try{u==null||u.releasePointerCapture(r.pointerId)}catch{}e._currentActiveButton=-1,e._previousPosition=null,t||r.preventDefault()}else if(a.type===g.POINTERMOVE){if(i.isPointerLock&&e._onMouseMove)e._onMouseMove(a.event);else if(e._previousPosition){var s=r.clientX-e._previousPosition.x,d=r.clientY-e._previousPosition.y;e.camera.getScene().useRightHandedSystem&&(s*=-1),e.camera.parent&&e.camera.parent._getWorldMatrixDeterminant()<0&&(s*=-1),e._allowCameraRotation&&(e.camera.cameraRotation.y+=s/e.angularSensibility,e.camera.cameraRotation.x+=d/e.angularSensibility),e.onPointerMovedObservable.notifyObservers({offsetX:s,offsetY:d}),e._previousPosition={x:r.clientX,y:r.clientY},t||r.preventDefault()}}}}),this._onMouseMove=function(a){if(!!i.isPointerLock&&!i.isInVRExclusivePointerMode){var r=a.movementX||a.mozMovementX||a.webkitMovementX||a.msMovementX||0;e.camera.getScene().useRightHandedSystem&&(r*=-1),e.camera.parent&&e.camera.parent._getWorldMatrixDeterminant()<0&&(r*=-1),e.camera.cameraRotation.y+=r/e.angularSensibility;var h=a.movementY||a.mozMovementY||a.webkitMovementY||a.msMovementY||0;e.camera.cameraRotation.x+=h/e.angularSensibility,e._previousPosition=null,t||a.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,g.POINTERDOWN|g.POINTERUP|g.POINTERMOVE),n&&(this._contextMenuBind=this.onContextMenu.bind(this),n.addEventListener("contextmenu",this._contextMenuBind,!1))},o.prototype.onContextMenu=function(t){t.preventDefault()},o.prototype.detachControl=function(){if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._contextMenuBind){var t=this.camera.getEngine(),e=t.getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._currentActiveButton=-1},o.prototype.getClassName=function(){return"FreeCameraMouseInput"},o.prototype.getSimpleName=function(){return"mouse"},l([c()],o.prototype,"buttons",void 0),l([c()],o.prototype,"angularSensibility",void 0),o}();k.FreeCameraMouseInput=Le;var y;(function(o){o[o.MoveRelative=0]="MoveRelative",o[o.RotateRelative=1]="RotateRelative",o[o.MoveScene=2]="MoveScene"})(y||(y={}));var Ne=function(o){C(t,o);function t(){var e=o!==null&&o.apply(this,arguments)||this;return e._moveRelative=f.Zero(),e._rotateRelative=f.Zero(),e._moveScene=f.Zero(),e._wheelXAction=y.MoveRelative,e._wheelXActionCoordinate=X.X,e._wheelYAction=y.MoveRelative,e._wheelYActionCoordinate=X.Z,e._wheelZAction=null,e._wheelZActionCoordinate=null,e}return t.prototype.getClassName=function(){return"FreeCameraMouseWheelInput"},Object.defineProperty(t.prototype,"wheelXMoveRelative",{get:function(){return this._wheelXAction!==y.MoveRelative?null:this._wheelXActionCoordinate},set:function(e){e===null&&this._wheelXAction!==y.MoveRelative||(this._wheelXAction=y.MoveRelative,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelYMoveRelative",{get:function(){return this._wheelYAction!==y.MoveRelative?null:this._wheelYActionCoordinate},set:function(e){e===null&&this._wheelYAction!==y.MoveRelative||(this._wheelYAction=y.MoveRelative,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelZMoveRelative",{get:function(){return this._wheelZAction!==y.MoveRelative?null:this._wheelZActionCoordinate},set:function(e){e===null&&this._wheelZAction!==y.MoveRelative||(this._wheelZAction=y.MoveRelative,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelXRotateRelative",{get:function(){return this._wheelXAction!==y.RotateRelative?null:this._wheelXActionCoordinate},set:function(e){e===null&&this._wheelXAction!==y.RotateRelative||(this._wheelXAction=y.RotateRelative,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelYRotateRelative",{get:function(){return this._wheelYAction!==y.RotateRelative?null:this._wheelYActionCoordinate},set:function(e){e===null&&this._wheelYAction!==y.RotateRelative||(this._wheelYAction=y.RotateRelative,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelZRotateRelative",{get:function(){return this._wheelZAction!==y.RotateRelative?null:this._wheelZActionCoordinate},set:function(e){e===null&&this._wheelZAction!==y.RotateRelative||(this._wheelZAction=y.RotateRelative,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelXMoveScene",{get:function(){return this._wheelXAction!==y.MoveScene?null:this._wheelXActionCoordinate},set:function(e){e===null&&this._wheelXAction!==y.MoveScene||(this._wheelXAction=y.MoveScene,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelYMoveScene",{get:function(){return this._wheelYAction!==y.MoveScene?null:this._wheelYActionCoordinate},set:function(e){e===null&&this._wheelYAction!==y.MoveScene||(this._wheelYAction=y.MoveScene,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelZMoveScene",{get:function(){return this._wheelZAction!==y.MoveScene?null:this._wheelZActionCoordinate},set:function(e){e===null&&this._wheelZAction!==y.MoveScene||(this._wheelZAction=y.MoveScene,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),t.prototype.checkInputs=function(){if(!(this._wheelDeltaX===0&&this._wheelDeltaY===0&&this._wheelDeltaZ==0)){this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);var e=p.Zero();this.camera.getViewMatrix().invertToRef(e);var i=f.Zero();f.TransformNormalToRef(this._moveRelative,e,i),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(i),this.camera.cameraDirection.addInPlace(this._moveScene),o.prototype.checkInputs.call(this)}},t.prototype._updateCamera=function(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)},t.prototype._updateCameraProperty=function(e,i,n){if(e!==0&&!(i===null||n===null)){var a=null;switch(i){case y.MoveRelative:a=this._moveRelative;break;case y.RotateRelative:a=this._rotateRelative;break;case y.MoveScene:a=this._moveScene;break}switch(n){case X.X:a.set(e,0,0);break;case X.Y:a.set(0,e,0);break;case X.Z:a.set(0,0,e);break}}},l([c()],t.prototype,"wheelXMoveRelative",null),l([c()],t.prototype,"wheelYMoveRelative",null),l([c()],t.prototype,"wheelZMoveRelative",null),l([c()],t.prototype,"wheelXRotateRelative",null),l([c()],t.prototype,"wheelYRotateRelative",null),l([c()],t.prototype,"wheelZRotateRelative",null),l([c()],t.prototype,"wheelXMoveScene",null),l([c()],t.prototype,"wheelYMoveScene",null),l([c()],t.prototype,"wheelZMoveScene",null),t}(pt);k.FreeCameraMouseWheelInput=Ne;var Be=function(){function o(t){t===void 0&&(t=!1),this.allowMouse=t,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=b.IsSafari()}return o.prototype.attachControl=function(t){var e=this;t=b.BackCompatCameraNoPreventDefault(arguments);var i=null;if(this._pointerInput===void 0&&(this._onLostFocus=function(){e._offsetX=null,e._offsetY=null},this._pointerInput=function(r){var h=r.event,u=h.pointerType==="mouse"||e._isSafari&&typeof h.pointerType=="undefined";if(!(!e.allowMouse&&u)){if(r.type===g.POINTERDOWN){if(t||h.preventDefault(),e._pointerPressed.push(h.pointerId),e._pointerPressed.length!==1)return;i={x:h.clientX,y:h.clientY}}else if(r.type===g.POINTERUP){t||h.preventDefault();var s=e._pointerPressed.indexOf(h.pointerId);if(s===-1||(e._pointerPressed.splice(s,1),s!=0))return;i=null,e._offsetX=null,e._offsetY=null}else if(r.type===g.POINTERMOVE){if(t||h.preventDefault(),!i)return;var s=e._pointerPressed.indexOf(h.pointerId);if(s!=0)return;e._offsetX=h.clientX-i.x,e._offsetY=-(h.clientY-i.y)}}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,g.POINTERDOWN|g.POINTERUP|g.POINTERMOVE),this._onLostFocus){var n=this.camera.getEngine(),a=n.getInputElement();a&&a.addEventListener("blur",this._onLostFocus)}},o.prototype.detachControl=function(){if(this._pointerInput){if(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus){var t=this.camera.getEngine(),e=t.getInputElement();e&&e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}},o.prototype.checkInputs=function(){if(!(this._offsetX===null||this._offsetY===null)&&!(this._offsetX===0&&this._offsetY===0)){var t=this.camera;t.cameraRotation.y=this._offsetX/this.touchAngularSensibility;var e=this.singleFingerRotate&&this._pointerPressed.length===1||!this.singleFingerRotate&&this._pointerPressed.length>1;if(e)t.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{var i=t._computeLocalCameraSpeed(),n=new f(0,0,this.touchMoveSensibility!==0?i*this._offsetY/this.touchMoveSensibility:0);p.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(f.TransformCoordinates(n,t._cameraRotationMatrix))}}},o.prototype.getClassName=function(){return"FreeCameraTouchInput"},o.prototype.getSimpleName=function(){return"touch"},l([c()],o.prototype,"touchAngularSensibility",void 0),l([c()],o.prototype,"touchMoveSensibility",void 0),o}();k.FreeCameraTouchInput=Be;var ae=function(o){C(t,o);function t(e){var i=o.call(this,e)||this;return i._mouseInput=null,i._mouseWheelInput=null,i}return t.prototype.addKeyboard=function(){return this.add(new Fe),this},t.prototype.addMouse=function(e){return e===void 0&&(e=!0),this._mouseInput||(this._mouseInput=new Le(e),this.add(this._mouseInput)),this},t.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},t.prototype.addMouseWheel=function(){return this._mouseWheelInput||(this._mouseWheelInput=new Ne,this.add(this._mouseWheelInput)),this},t.prototype.removeMouseWheel=function(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this},t.prototype.addTouch=function(){return this.add(new Be),this},t.prototype.clear=function(){o.prototype.clear.call(this),this._mouseInput=null},t}(J);ae.prototype.addDeviceOrientation=function(){return this._deviceOrientationInput||(this._deviceOrientationInput=new ze,this.add(this._deviceOrientationInput)),this};var ze=function(){function o(){var t=this;this._screenOrientationAngle=0,this._screenQuaternion=new v,this._alpha=0,this._beta=0,this._gamma=0,this._onDeviceOrientationChangedObservable=new w,this._orientationChanged=function(){t._screenOrientationAngle=window.orientation!==void 0?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,t._screenOrientationAngle=-b.ToRadians(t._screenOrientationAngle/2),t._screenQuaternion.copyFromFloats(0,Math.sin(t._screenOrientationAngle),0,Math.cos(t._screenOrientationAngle))},this._deviceOrientation=function(e){t._alpha=e.alpha!==null?e.alpha:0,t._beta=e.beta!==null?e.beta:0,t._gamma=e.gamma!==null?e.gamma:0,e.alpha!==null&&t._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTranform=new v(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return o.WaitForOrientationChangeAsync=function(t){return new Promise(function(e,i){var n=!1,a=function(){window.removeEventListener("deviceorientation",a),n=!0,e()};t&&setTimeout(function(){n||(window.removeEventListener("deviceorientation",a),i("WaitForOrientationChangeAsync timed out"))},t),typeof DeviceOrientationEvent!="undefined"&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(r){r=="granted"?window.addEventListener("deviceorientation",a):b.Warn("Permission not granted.")}).catch(function(r){b.Error(r)}):window.addEventListener("deviceorientation",a)})},Object.defineProperty(o.prototype,"camera",{get:function(){return this._camera},set:function(t){var e=this;this._camera=t,this._camera!=null&&!this._camera.rotationQuaternion&&(this._camera.rotationQuaternion=new v),this._camera&&this._camera.onDisposeObservable.add(function(){e._onDeviceOrientationChangedObservable.clear()})},enumerable:!1,configurable:!0}),o.prototype.attachControl=function(){var t=this,e=this.camera.getScene().getEngine().getHostWindow();if(e){var i=function(){e.addEventListener("orientationchange",t._orientationChanged),e.addEventListener("deviceorientation",t._deviceOrientation),t._orientationChanged()};typeof DeviceOrientationEvent!="undefined"&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(n){n==="granted"?i():b.Warn("Permission not granted.")}).catch(function(n){b.Error(n)}):i()}},o.prototype.detachControl=function(){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0},o.prototype.checkInputs=function(){!this._alpha||(v.RotationYawPitchRollToRef(b.ToRadians(this._alpha),b.ToRadians(this._beta),-b.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},o.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},o.prototype.getSimpleName=function(){return"deviceOrientation"},o}();k.FreeCameraDeviceOrientationInput=ze;var mt=function(){function o(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this.deadzoneDelta=.1,this._yAxisScale=1,this._cameraTransform=p.Identity(),this._deltaTransform=f.Zero(),this._vector3=f.Zero(),this._vector2=U.Zero()}return Object.defineProperty(o.prototype,"invertYAxis",{get:function(){return this._yAxisScale!==1},set:function(t){this._yAxisScale=t?-1:1},enumerable:!1,configurable:!0}),o.prototype.attachControl=function(){var t=this,e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add(function(i){i.type!==D.POSE_ENABLED&&(!t.gamepad||i.type===D.XBOX)&&(t.gamepad=i)}),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add(function(i){t.gamepad===i&&(t.gamepad=null)}),this.gamepad=e.getGamepadByType(D.XBOX),!this.gamepad&&e.gamepads.length&&(this.gamepad=e.gamepads[0])},o.prototype.detachControl=function(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},o.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var t=this.camera,e=this.gamepad.leftStick;this.gamepadMoveSensibility!==0&&(e.x=Math.abs(e.x)>this.deadzoneDelta?e.x/this.gamepadMoveSensibility:0,e.y=Math.abs(e.y)>this.deadzoneDelta?e.y/this.gamepadMoveSensibility:0);var i=this.gamepad.rightStick;i&&this.gamepadAngularSensibility!==0?(i.x=Math.abs(i.x)>this.deadzoneDelta?i.x/this.gamepadAngularSensibility:0,i.y=(Math.abs(i.y)>this.deadzoneDelta?i.y/this.gamepadAngularSensibility:0)*this._yAxisScale):i={x:0,y:0},t.rotationQuaternion?t.rotationQuaternion.toRotationMatrix(this._cameraTransform):p.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,this._cameraTransform);var n=t._computeLocalCameraSpeed()*50;this._vector3.copyFromFloats(e.x*n,0,-e.y*n),f.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),t.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(i.y,i.x),t.cameraRotation.addInPlace(this._vector2)}},o.prototype.getClassName=function(){return"FreeCameraGamepadInput"},o.prototype.getSimpleName=function(){return"gamepad"},l([c()],o.prototype,"gamepadAngularSensibility",void 0),l([c()],o.prototype,"gamepadMoveSensibility",void 0),o}();k.FreeCameraGamepadInput=mt;ae.prototype.addVirtualJoystick=function(){return this.add(new Ge),this};var Ge=function(){function o(){}return o.prototype.getLeftJoystick=function(){return this._leftjoystick},o.prototype.getRightJoystick=function(){return this._rightjoystick},o.prototype.checkInputs=function(){if(this._leftjoystick){var t=this.camera,e=t._computeLocalCameraSpeed()*50,i=p.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),n=f.TransformCoordinates(new f(this._leftjoystick.deltaPosition.x*e,this._leftjoystick.deltaPosition.y*e,this._leftjoystick.deltaPosition.z*e),i);t.cameraDirection=t.cameraDirection.add(n),t.cameraRotation=t.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},o.prototype.attachControl=function(){this._leftjoystick=new de(!0),this._leftjoystick.setAxisForUpDown(K.Z),this._leftjoystick.setAxisForLeftRight(K.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new de(!1),this._rightjoystick.setAxisForUpDown(K.X),this._rightjoystick.setAxisForLeftRight(K.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},o.prototype.detachControl=function(){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},o.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},o.prototype.getSimpleName=function(){return"virtualJoystick"},o}();k.FreeCameraVirtualJoystickInput=Ge;var G=function(o){C(t,o);function t(e,i,n,a){a===void 0&&(a=!0);var r=o.call(this,e,i,n,a)||this;return r._tmpUpVector=f.Zero(),r._tmpTargetVector=f.Zero(),r.cameraDirection=new f(0,0,0),r.cameraRotation=new U(0,0),r.ignoreParentScaling=!1,r.updateUpVectorFromRotation=!1,r._tmpQuaternion=new v,r.rotation=new f(0,0,0),r.speed=2,r.noRotationConstraint=!1,r.invertRotation=!1,r.inverseRotationSpeed=.2,r.lockedTarget=null,r._currentTarget=f.Zero(),r._initialFocalDistance=1,r._viewMatrix=p.Zero(),r._camMatrix=p.Zero(),r._cameraTransformMatrix=p.Zero(),r._cameraRotationMatrix=p.Zero(),r._referencePoint=new f(0,0,1),r._transformedReferencePoint=f.Zero(),r._defaultUp=f.Up(),r._cachedRotationZ=0,r._cachedQuaternionRotationZ=0,r}return t.prototype.getFrontPosition=function(e){this.getWorldMatrix();var i=this.getTarget().subtract(this.position);return i.normalize(),i.scaleInPlace(e),this.globalPosition.add(i)},t.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},t.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),o.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return o.prototype._restoreStateValues.call(this)?(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0):!1},t.prototype._initCache=function(){o.prototype._initCache.call(this),this._cache.lockedTarget=new f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new v(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},t.prototype._updateCache=function(e){e||o.prototype._updateCache.call(this);var i=this._getLockedTargetPosition();i?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(i):this._cache.lockedTarget=i.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},t.prototype._isSynchronizedViewMatrix=function(){if(!o.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},t.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(e.getFps()*100))},t.prototype.setTarget=function(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=S),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),p.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var i=e.subtract(this.position);i.x>=0?this.rotation.y=-Math.atan(i.z/i.x)+Math.PI/2:this.rotation.y=-Math.atan(i.z/i.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&v.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},Object.defineProperty(t.prototype,"target",{get:function(){return this.getTarget()},set:function(e){this.setTarget(e)},enumerable:!1,configurable:!0}),t.prototype.getTarget=function(){return this._currentTarget},t.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){if(this.parent){this.parent.getWorldMatrix().invertToRef(H.Matrix[0]),f.TransformNormalToRef(this.cameraDirection,H.Matrix[0],H.Vector3[0]),this.position.addInPlace(H.Vector3[0]);return}this.position.addInPlace(this.cameraDirection)},t.prototype._checkInputs=function(){var e=this.invertRotation?-this.inverseRotationSpeed:1,i=this._decideIfNeedsToMove(),n=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(i&&this._updatePosition(),n){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*e,this.rotation.y+=this.cameraRotation.y*e,!this.noRotationConstraint){var a=1.570796;this.rotation.x>a&&(this.rotation.x=a),this.rotation.x<-a&&(this.rotation.x=-a)}if(this.rotationQuaternion){var r=this.rotation.lengthSquared();r&&v.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}}i&&(Math.abs(this.cameraDirection.x)<this.speed*S&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*S&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*S&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),n&&(Math.abs(this.cameraRotation.x)<this.speed*S&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*S&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),o.prototype._checkInputs.call(this)},t.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):p.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},t.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return f.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},t.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),f.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?A.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(v.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),A.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},t.prototype._computeViewMatrix=function(e,i,n){if(this.ignoreParentScaling){if(this.parent){var a=this.parent.getWorldMatrix();f.TransformCoordinatesToRef(e,a,this._globalPosition),f.TransformCoordinatesToRef(i,a,this._tmpTargetVector),f.TransformNormalToRef(n,a,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._tmpTargetVector.copyFrom(i),this._tmpUpVector.copyFrom(n);this.getScene().useRightHandedSystem?p.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):p.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix);return}if(this.getScene().useRightHandedSystem?p.LookAtRHToRef(e,i,n,this._viewMatrix):p.LookAtLHToRef(e,i,n,this._viewMatrix),this.parent){var a=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(a,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e)},t.prototype.createRigCamera=function(e,i){if(this.cameraRigMode!==m.RIG_MODE_NONE){var n=new t(e,this.position.clone(),this.getScene());return n.isRigCamera=!0,n.rigParent=this,(this.cameraRigMode===m.RIG_MODE_VR||this.cameraRigMode===m.RIG_MODE_WEBVR)&&(this.rotationQuaternion||(this.rotationQuaternion=new v),n._cameraRigParams={},n.rotationQuaternion=new v),n.mode=this.mode,n.orthoLeft=this.orthoLeft,n.orthoRight=this.orthoRight,n.orthoTop=this.orthoTop,n.orthoBottom=this.orthoBottom,n}return null},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],i=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case m.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case m.RIG_MODE_STEREOSCOPIC_OVERUNDER:case m.RIG_MODE_STEREOSCOPIC_INTERLACED:{var n=this.cameraRigMode===m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,a=this.cameraRigMode===m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*n,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*a,i);break}case m.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),i.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),i.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),i.position.copyFrom(this.position);break}o.prototype._updateRigCameras.call(this)},t.prototype._getRigCamPositionAndTarget=function(e,i){var n=this.getTarget();n.subtractToRef(this.position,t._TargetFocalPoint),t._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var a=t._TargetFocalPoint.addInPlace(this.position);p.TranslationToRef(-a.x,-a.y,-a.z,t._TargetTransformMatrix),t._TargetTransformMatrix.multiplyToRef(p.RotationAxis(i.upVector,e),t._RigCamTransformMatrix),p.TranslationToRef(a.x,a.y,a.z,t._TargetTransformMatrix),t._RigCamTransformMatrix.multiplyToRef(t._TargetTransformMatrix,t._RigCamTransformMatrix),f.TransformCoordinatesToRef(this.position,t._RigCamTransformMatrix,i.position),i.setTarget(a)},t.prototype.getClassName=function(){return"TargetCamera"},t._RigCamTransformMatrix=new p,t._TargetTransformMatrix=new p,t._TargetFocalPoint=new f,l([L()],t.prototype,"rotation",void 0),l([c()],t.prototype,"speed",void 0),l([oe("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(m),V=function(o){C(t,o);function t(e,i,n,a){a===void 0&&(a=!0);var r=o.call(this,e,i,n,a)||this;return r.ellipsoid=new f(.5,1,.5),r.ellipsoidOffset=new f(0,0,0),r.checkCollisions=!1,r.applyGravity=!1,r._needMoveForGravity=!1,r._oldPosition=f.Zero(),r._diffPosition=f.Zero(),r._newPosition=f.Zero(),r._collisionMask=-1,r._onCollisionPositionChange=function(h,u,s){s===void 0&&(s=null);var d=function(_){r._newPosition.copyFrom(_),r._newPosition.subtractToRef(r._oldPosition,r._diffPosition),r._diffPosition.length()>Pe.CollisionsEpsilon&&(r.position.addInPlace(r._diffPosition),r.onCollide&&s&&r.onCollide(s))};d(u)},r.inputs=new ae(r),r.inputs.addKeyboard().addMouse(),r}return Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var i=this.inputs.attached.mouse;i&&(i.angularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUpward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUpward:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysUpward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDownward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDownward:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysDownward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysRight=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRotateLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRotateLeft:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysRotateLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRotateRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRotateRight:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysRotateRight=e)},enumerable:!1,configurable:!0}),t.prototype.attachControl=function(e,i){i=b.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(i)},t.prototype.detachControl=function(){this.inputs.detachElement(),this.cameraDirection=new f(0,0,0),this.cameraRotation=new U(0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),t.prototype._collideWithWorld=function(e){var i;this.parent?i=f.TransformCoordinates(this.position,this.parent.getWorldMatrix()):i=this.position,i.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var n=this.getScene().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var a=e;this.applyGravity&&(a=e.add(this.getScene().gravity)),n.getNewPosition(this._oldPosition,a,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=f.Zero(),this._transformedDirection=f.Zero()),this.inputs.checkInputs(),o.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):o.prototype._updatePosition.call(this)},t.prototype.dispose=function(){this.inputs.clear(),o.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FreeCamera"},l([L()],t.prototype,"ellipsoid",void 0),l([L()],t.prototype,"ellipsoidOffset",void 0),l([c()],t.prototype,"checkCollisions",void 0),l([c()],t.prototype,"applyGravity",void 0),t}(G);P.AddNodeConstructor("TouchCamera",function(o,t){return function(){return new Ye(o,f.Zero(),t)}});var Ye=function(o){C(t,o);function t(e,i,n){var a=o.call(this,e,i,n)||this;return a.inputs.addTouch(),a._setupInputs(),a}return Object.defineProperty(t.prototype,"touchAngularSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchAngularSensibility:0},set:function(e){var i=this.inputs.attached.touch;i&&(i.touchAngularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"touchMoveSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchMoveSensibility:0},set:function(e){var i=this.inputs.attached.touch;i&&(i.touchMoveSensibility=e)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"TouchCamera"},t.prototype._setupInputs=function(){var e=this.inputs.attached.touch,i=this.inputs.attached.mouse;i?i.touchEnabled=!1:e.allowMouse=!0},t}(V);P.AddNodeConstructor("ArcRotateCamera",function(o,t){return function(){return new $(o,0,0,1,f.Zero(),t)}});var $=function(o){C(t,o);function t(e,i,n,a,r,h,u){u===void 0&&(u=!0);var s=o.call(this,e,f.Zero(),h,u)||this;return s.inertialAlphaOffset=0,s.inertialBetaOffset=0,s.inertialRadiusOffset=0,s.lowerAlphaLimit=null,s.upperAlphaLimit=null,s.lowerBetaLimit=.01,s.upperBetaLimit=Math.PI-.01,s.lowerRadiusLimit=null,s.upperRadiusLimit=null,s.inertialPanningX=0,s.inertialPanningY=0,s.pinchToPanMaxDistance=20,s.panningDistanceLimit=null,s.panningOriginTarget=f.Zero(),s.panningInertia=.9,s.zoomOnFactor=1,s.targetScreenOffset=U.Zero(),s.allowUpsideDown=!0,s.useInputToRestoreState=!0,s._viewMatrix=new p,s.panningAxis=new f(1,1,0),s._transformedDirection=new f,s.mapPanning=!1,s.onMeshTargetChangedObservable=new w,s.checkCollisions=!1,s.collisionRadius=new f(.5,.5,.5),s._previousPosition=f.Zero(),s._collisionVelocity=f.Zero(),s._newPosition=f.Zero(),s._computationVector=f.Zero(),s._onCollisionPositionChange=function(d,_,R){R===void 0&&(R=null),R?(s.setPosition(_),s.onCollide&&s.onCollide(R)):s._previousPosition.copyFrom(s._position);var O=Math.cos(s.alpha),T=Math.sin(s.alpha),I=Math.cos(s.beta),x=Math.sin(s.beta);x===0&&(x=1e-4);var Z=s._getTargetPosition();s._computationVector.copyFromFloats(s.radius*O*x,s.radius*I,s.radius*T*x),Z.addToRef(s._computationVector,s._newPosition),s._position.copyFrom(s._newPosition);var N=s.upVector;s.allowUpsideDown&&s.beta<0&&(N=N.clone(),N=N.negate()),s._computeViewMatrix(s._position,Z,N),s._viewMatrix.addAtIndex(12,s.targetScreenOffset.x),s._viewMatrix.addAtIndex(13,s.targetScreenOffset.y),s._collisionTriggered=!1},s._target=f.Zero(),r&&s.setTarget(r),s.alpha=i,s.beta=n,s.radius=a,s.getViewMatrix(),s.inputs=new Se(s),s.inputs.addKeyboard().addMouseWheel().addPointers(),s}return Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(e){this.setTarget(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"targetHost",{get:function(){return this._targetHost},set:function(e){e&&this.setTarget(e)},enumerable:!1,configurable:!0}),t.prototype.getTarget=function(){return this.target},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this.setPosition(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upVector",{get:function(){return this._upVector},set:function(e){this._upToYMatrix||(this._yToUpMatrix=new p,this._upToYMatrix=new p,this._upVector=f.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()},enumerable:!1,configurable:!0}),t.prototype.setMatUp=function(){p.RotationAlignToRef(f.UpReadOnly,this._upVector,this._yToUpMatrix),p.RotationAlignToRef(this._upVector,f.UpReadOnly,this._upToYMatrix)},Object.defineProperty(t.prototype,"angularSensibilityX",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0},set:function(e){var i=this.inputs.attached.pointers;i&&(i.angularSensibilityX=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angularSensibilityY",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0},set:function(e){var i=this.inputs.attached.pointers;i&&(i.angularSensibilityY=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pinchPrecision",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:0},set:function(e){var i=this.inputs.attached.pointers;i&&(i.pinchPrecision=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pinchDeltaPercentage",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0},set:function(e){var i=this.inputs.attached.pointers;i&&(i.pinchDeltaPercentage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useNaturalPinchZoom",{get:function(){var e=this.inputs.attached.pointers;return e?e.useNaturalPinchZoom:!1},set:function(e){var i=this.inputs.attached.pointers;i&&(i.useNaturalPinchZoom=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"panningSensibility",{get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:0},set:function(e){var i=this.inputs.attached.pointers;i&&(i.panningSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysRight=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelPrecision",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0},set:function(e){var i=this.inputs.attached.mousewheel;i&&(i.wheelPrecision=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zoomToMouseLocation",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.zoomToMouseLocation:!1},set:function(e){var i=this.inputs.attached.mousewheel;i&&(i.zoomToMouseLocation=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelDeltaPercentage",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0},set:function(e){var i=this.inputs.attached.mousewheel;i&&(i.wheelDeltaPercentage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useBouncingBehavior",{get:function(){return this._bouncingBehavior!=null},set:function(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new rt,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useFramingBehavior",{get:function(){return this._framingBehavior!=null},set:function(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new nt,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useAutoRotationBehavior",{get:function(){return this._autoRotationBehavior!=null},set:function(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new at,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!1,configurable:!0}),t.prototype._initCache=function(){o.prototype._initCache.call(this),this._cache._target=new f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=U.Zero()},t.prototype._updateCache=function(e){e||o.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},t.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var e=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}var i=this._getLockedTargetPosition();return i||this._target},t.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),o.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return o.prototype._restoreStateValues.call(this)?(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!1},t.prototype._isSynchronizedViewMatrix=function(){return o.prototype._isSynchronizedViewMatrix.call(this)?this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1},t.prototype.attachControl=function(e,i,n,a){var r=this;n===void 0&&(n=!0),a===void 0&&(a=2);var h=arguments;i=b.BackCompatCameraNoPreventDefault(h),this._useCtrlForPanning=n,this._panningMouseButton=a,typeof h[0]=="boolean"&&(h.length>1&&(this._useCtrlForPanning=h[1]),h.length>2&&(this._panningMouseButton=h[2])),this.inputs.attachElement(i),this._reset=function(){r.inertialAlphaOffset=0,r.inertialBetaOffset=0,r.inertialRadiusOffset=0,r.inertialPanningX=0,r.inertialPanningY=0}},t.prototype.detachControl=function(){this.inputs.detachElement(),this._reset&&this._reset()},t.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this.inertialAlphaOffset!==0||this.inertialBetaOffset!==0||this.inertialRadiusOffset!==0){var e=this.invertRotation?-1:1,i=this.inertialAlphaOffset;this.beta<=0&&(i*=-1),this.getScene().useRightHandedSystem&&(i*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(i*=-1),this.alpha+=i*e,this.beta+=this.inertialBetaOffset*e,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<S&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<S&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*S&&(this.inertialRadiusOffset=0)}if(this.inertialPanningX!==0||this.inertialPanningY!==0){var n=new f(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),n.multiplyInPlace(this.panningAxis),f.TransformNormalToRef(n,this._cameraTransformMatrix,this._transformedDirection),(this.mapPanning||!this.panningAxis.y)&&(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);var a=f.DistanceSquared(this._transformedDirection,this.panningOriginTarget);a<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)}else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*S&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*S&&(this.inertialPanningY=0)}this._checkLimits(),o.prototype._checkInputs.call(this)}},t.prototype._checkLimits=function(){this.lowerBetaLimit===null||this.lowerBetaLimit===void 0?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),this.upperBetaLimit===null||this.upperBetaLimit===void 0?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit!==null&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit!==null&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit!==null&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),this.upperRadiusLimit!==null&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},t.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),(this._upVector.x!==0||this._upVector.y!==1||this._upVector.z!==0)&&f.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),this.radius===0&&(this.radius=1e-4);var e=this.alpha;this._computationVector.x===0&&this._computationVector.z===0?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);var i=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=i*2*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},t.prototype.setPosition=function(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())},t.prototype.setTarget=function(e,i,n,a){var r;if(i===void 0&&(i=!1),n===void 0&&(n=!1),a===void 0&&(a=!1),a=(r=this.overrideCloneAlphaBetaRadius)!==null&&r!==void 0?r:a,e.getBoundingInfo)i?this._targetBoundingCenter=e.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var h=e,u=this._getTargetPosition();if(u&&!n&&u.equals(h))return;this._targetHost=null,this._target=h,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}a||this.rebuildAnglesAndRadius()},t.prototype._getViewMatrix=function(){var e=Math.cos(this.alpha),i=Math.sin(this.alpha),n=Math.cos(this.beta),a=Math.sin(this.beta);a===0&&(a=1e-4),this.radius===0&&(this.radius=1e-4);var r=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*a,this.radius*n,this.radius*i*a),(this._upVector.x!==0||this._upVector.y!==1||this._upVector.z!==0)&&f.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),r.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var h=this.getScene().collisionCoordinator;this._collider||(this._collider=h.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,h.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var u=this.upVector;this.allowUpsideDown&&a<0&&(u=u.negate()),this._computeViewMatrix(this._position,r,u),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=r,this._viewMatrix},t.prototype.zoomOn=function(e,i){i===void 0&&(i=!1),e=e||this.getScene().meshes;var n=j.MinMax(e),a=f.Distance(n.min,n.max);this.radius=a*this.zoomOnFactor,this.focusOn({min:n.min,max:n.max,distance:a},i)},t.prototype.focusOn=function(e,i){i===void 0&&(i=!1);var n,a;if(e.min===void 0){var r=e||this.getScene().meshes;n=j.MinMax(r),a=f.Distance(n.min,n.max)}else{var h=e;n=h,a=h.distance}this._target=j.Center(n),i||(this.maxZ=a*2)},t.prototype.createRigCamera=function(e,i){var n=0;switch(this.cameraRigMode){case m.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case m.RIG_MODE_STEREOSCOPIC_OVERUNDER:case m.RIG_MODE_STEREOSCOPIC_INTERLACED:case m.RIG_MODE_VR:n=this._cameraRigParams.stereoHalfAngle*(i===0?1:-1);break;case m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:n=this._cameraRigParams.stereoHalfAngle*(i===0?-1:1);break}var a=new t(e,this.alpha+n,this.beta,this.radius,this._target,this.getScene());return a._cameraRigParams={},a.isRigCamera=!0,a.rigParent=this,a.upVector=this.upVector,a.mode=this.mode,a.orthoLeft=this.orthoLeft,a.orthoRight=this.orthoRight,a.orthoBottom=this.orthoBottom,a.orthoTop=this.orthoTop,a},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],i=this._rigCameras[1];switch(e.beta=i.beta=this.beta,this.cameraRigMode){case m.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case m.RIG_MODE_STEREOSCOPIC_OVERUNDER:case m.RIG_MODE_STEREOSCOPIC_INTERLACED:case m.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle;break}o.prototype._updateRigCameras.call(this)},t.prototype.dispose=function(){this.inputs.clear(),o.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"ArcRotateCamera"},l([c()],t.prototype,"alpha",void 0),l([c()],t.prototype,"beta",void 0),l([c()],t.prototype,"radius",void 0),l([c()],t.prototype,"overrideCloneAlphaBetaRadius",void 0),l([L("target")],t.prototype,"_target",void 0),l([oe("targetHost")],t.prototype,"_targetHost",void 0),l([c()],t.prototype,"inertialAlphaOffset",void 0),l([c()],t.prototype,"inertialBetaOffset",void 0),l([c()],t.prototype,"inertialRadiusOffset",void 0),l([c()],t.prototype,"lowerAlphaLimit",void 0),l([c()],t.prototype,"upperAlphaLimit",void 0),l([c()],t.prototype,"lowerBetaLimit",void 0),l([c()],t.prototype,"upperBetaLimit",void 0),l([c()],t.prototype,"lowerRadiusLimit",void 0),l([c()],t.prototype,"upperRadiusLimit",void 0),l([c()],t.prototype,"inertialPanningX",void 0),l([c()],t.prototype,"inertialPanningY",void 0),l([c()],t.prototype,"pinchToPanMaxDistance",void 0),l([c()],t.prototype,"panningDistanceLimit",void 0),l([L()],t.prototype,"panningOriginTarget",void 0),l([c()],t.prototype,"panningInertia",void 0),l([c()],t.prototype,"zoomToMouseLocation",null),l([c()],t.prototype,"zoomOnFactor",void 0),l([$e()],t.prototype,"targetScreenOffset",void 0),l([c()],t.prototype,"allowUpsideDown",void 0),l([c()],t.prototype,"useInputToRestoreState",void 0),t}(G);P.AddNodeConstructor("DeviceOrientationCamera",function(o,t){return function(){return new se(o,f.Zero(),t)}});var se=function(o){C(t,o);function t(e,i,n){var a=o.call(this,e,i,n)||this;return a._tmpDragQuaternion=new v,a._disablePointerInputWhenUsingDeviceOrientation=!0,a._dragFactor=0,a._quaternionCache=new v,a.inputs.addDeviceOrientation(),a.inputs._deviceOrientationInput&&a.inputs._deviceOrientationInput._onDeviceOrientationChangedObservable.addOnce(function(){a._disablePointerInputWhenUsingDeviceOrientation&&a.inputs._mouseInput&&(a.inputs._mouseInput._allowCameraRotation=!1,a.inputs._mouseInput.onPointerMovedObservable.add(function(r){a._dragFactor!=0&&(a._initialQuaternion||(a._initialQuaternion=new v),v.FromEulerAnglesToRef(0,r.offsetX*a._dragFactor,0,a._tmpDragQuaternion),a._initialQuaternion.multiplyToRef(a._tmpDragQuaternion,a._initialQuaternion))}))}),a}return Object.defineProperty(t.prototype,"disablePointerInputWhenUsingDeviceOrientation",{get:function(){return this._disablePointerInputWhenUsingDeviceOrientation},set:function(e){this._disablePointerInputWhenUsingDeviceOrientation=e},enumerable:!1,configurable:!0}),t.prototype.enableHorizontalDragging=function(e){e===void 0&&(e=1/300),this._dragFactor=e},t.prototype.getClassName=function(){return"DeviceOrientationCamera"},t.prototype._checkInputs=function(){o.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},t.prototype.resetToCurrentRotation=function(e){var i=this;e===void 0&&(e=A.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new v),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach(function(n){e[n]?i._initialQuaternion[n]*=-1:i._initialQuaternion[n]=0}),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},t}(V),gt=function(o){C(t,o);function t(e){return o.call(this,e)||this}return t.prototype.addKeyboard=function(){return this.add(new Ee),this},t.prototype.addMouse=function(){return this.add(new De),this},t}(J);(function(o){C(t,o);function t(e,i,n,a){a===void 0&&(a=!0);var r=o.call(this,e,i,n,a)||this;return r.ellipsoid=new f(1,1,1),r.ellipsoidOffset=new f(0,0,0),r.checkCollisions=!1,r.applyGravity=!1,r.cameraDirection=f.Zero(),r._trackRoll=0,r.rollCorrect=100,r.bankedTurn=!1,r.bankedTurnLimit=Math.PI/2,r.bankedTurnMultiplier=1,r._needMoveForGravity=!1,r._oldPosition=f.Zero(),r._diffPosition=f.Zero(),r._newPosition=f.Zero(),r._collisionMask=-1,r._onCollisionPositionChange=function(h,u,s){s===void 0&&(s=null);var d=function(_){r._newPosition.copyFrom(_),r._newPosition.subtractToRef(r._oldPosition,r._diffPosition),r._diffPosition.length()>Pe.CollisionsEpsilon&&(r.position.addInPlace(r._diffPosition),r.onCollide&&s&&r.onCollide(s))};d(u)},r.inputs=new gt(r),r.inputs.addKeyboard().addMouse(),r}return Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var i=this.inputs.attached.mouse;i&&(i.angularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysForward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysForward:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysForward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysBackward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysBackward:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysBackward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysRight=e)},enumerable:!1,configurable:!0}),t.prototype.attachControl=function(e,i){i=b.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(i)},t.prototype.detachControl=function(){this.inputs.detachElement(),this.cameraDirection=new f(0,0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),t.prototype._collideWithWorld=function(e){var i;this.parent?i=f.TransformCoordinates(this.position,this.parent.getWorldMatrix()):i=this.position,i.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var n=this.getScene().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var a=e;this.applyGravity&&(a=e.add(this.getScene().gravity)),n.getNewPosition(this._oldPosition,a,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=f.Zero(),this._transformedDirection=f.Zero()),this.inputs.checkInputs(),o.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):o.prototype._updatePosition.call(this)},t.prototype.restoreRoll=function(e){var i=this._trackRoll,n=this.rotation.z,a=i-n,r=.001;Math.abs(a)>=r&&(this.rotation.z+=a/e,Math.abs(i-this.rotation.z)<=r&&(this.rotation.z=i))},t.prototype.dispose=function(){this.inputs.clear(),o.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FlyCamera"},l([L()],t.prototype,"ellipsoid",void 0),l([L()],t.prototype,"ellipsoidOffset",void 0),l([c()],t.prototype,"checkCollisions",void 0),l([c()],t.prototype,"applyGravity",void 0),t})(G);var yt=function(o){C(t,o);function t(e){return o.call(this,e)||this}return t.prototype.addKeyboard=function(){return this.add(new Ie),this},t.prototype.addMouseWheel=function(){return this.add(new Ae),this},t.prototype.addPointers=function(){return this.add(new Ve),this},t.prototype.addVRDeviceOrientation=function(){return console.warn("DeviceOrientation support not yet implemented for FollowCamera."),this},t}(J);P.AddNodeConstructor("FollowCamera",function(o,t){return function(){return new vt(o,f.Zero(),t)}});P.AddNodeConstructor("ArcFollowCamera",function(o,t){return function(){return new Ct(o,0,0,1,null,t)}});var vt=function(o){C(t,o);function t(e,i,n,a){a===void 0&&(a=null);var r=o.call(this,e,i,n)||this;return r.radius=12,r.lowerRadiusLimit=null,r.upperRadiusLimit=null,r.rotationOffset=0,r.lowerRotationOffsetLimit=null,r.upperRotationOffsetLimit=null,r.heightOffset=4,r.lowerHeightOffsetLimit=null,r.upperHeightOffsetLimit=null,r.cameraAcceleration=.05,r.maxCameraSpeed=20,r.lockedTarget=a,r.inputs=new yt(r),r.inputs.addKeyboard().addMouseWheel().addPointers(),r}return t.prototype._follow=function(e){if(!!e){var i=H.Matrix[0];e.absoluteRotationQuaternion.toRotationMatrix(i);var n=Math.atan2(i.m[8],i.m[10]),a=b.ToRadians(this.rotationOffset)+n,r=e.getAbsolutePosition(),h=r.x+Math.sin(a)*this.radius,u=r.z+Math.cos(a)*this.radius,s=h-this.position.x,d=r.y+this.heightOffset-this.position.y,_=u-this.position.z,R=s*this.cameraAcceleration*2,O=d*this.cameraAcceleration,T=_*this.cameraAcceleration*2;(R>this.maxCameraSpeed||R<-this.maxCameraSpeed)&&(R=R<1?-this.maxCameraSpeed:this.maxCameraSpeed),(O>this.maxCameraSpeed||O<-this.maxCameraSpeed)&&(O=O<1?-this.maxCameraSpeed:this.maxCameraSpeed),(T>this.maxCameraSpeed||T<-this.maxCameraSpeed)&&(T=T<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new f(this.position.x+R,this.position.y+O,this.position.z+T),this.setTarget(r)}},t.prototype.attachControl=function(e,i){i=b.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(i),this._reset=function(){}},t.prototype.detachControl=function(){this.inputs.detachElement(),this._reset&&this._reset()},t.prototype._checkInputs=function(){this.inputs.checkInputs(),this._checkLimits(),o.prototype._checkInputs.call(this),this.lockedTarget&&this._follow(this.lockedTarget)},t.prototype._checkLimits=function(){this.lowerRadiusLimit!==null&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),this.upperRadiusLimit!==null&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit),this.lowerHeightOffsetLimit!==null&&this.heightOffset<this.lowerHeightOffsetLimit&&(this.heightOffset=this.lowerHeightOffsetLimit),this.upperHeightOffsetLimit!==null&&this.heightOffset>this.upperHeightOffsetLimit&&(this.heightOffset=this.upperHeightOffsetLimit),this.lowerRotationOffsetLimit!==null&&this.rotationOffset<this.lowerRotationOffsetLimit&&(this.rotationOffset=this.lowerRotationOffsetLimit),this.upperRotationOffsetLimit!==null&&this.rotationOffset>this.upperRotationOffsetLimit&&(this.rotationOffset=this.upperRotationOffsetLimit)},t.prototype.getClassName=function(){return"FollowCamera"},l([c()],t.prototype,"radius",void 0),l([c()],t.prototype,"lowerRadiusLimit",void 0),l([c()],t.prototype,"upperRadiusLimit",void 0),l([c()],t.prototype,"rotationOffset",void 0),l([c()],t.prototype,"lowerRotationOffsetLimit",void 0),l([c()],t.prototype,"upperRotationOffsetLimit",void 0),l([c()],t.prototype,"heightOffset",void 0),l([c()],t.prototype,"lowerHeightOffsetLimit",void 0),l([c()],t.prototype,"upperHeightOffsetLimit",void 0),l([c()],t.prototype,"cameraAcceleration",void 0),l([c()],t.prototype,"maxCameraSpeed",void 0),l([oe("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(G),Ct=function(o){C(t,o);function t(e,i,n,a,r,h){var u=o.call(this,e,f.Zero(),h)||this;return u.alpha=i,u.beta=n,u.radius=a,u._cartesianCoordinates=f.Zero(),u.setMeshTarget(r),u}return t.prototype.setMeshTarget=function(e){this._meshTarget=e,this._follow()},t.prototype._follow=function(){if(!!this._meshTarget){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var e=this._meshTarget.getAbsolutePosition();this.position=e.add(this._cartesianCoordinates),this.setTarget(e)}},t.prototype._checkInputs=function(){o.prototype._checkInputs.call(this),this._follow()},t.prototype.getClassName=function(){return"ArcFollowCamera"},t}(G);P.AddNodeConstructor("FreeCamera",function(o,t){return function(){return new W(o,f.Zero(),t)}});var W=function(o){C(t,o);function t(e,i,n){var a=o.call(this,e,i,n)||this;return a.inputs.addGamepad(),a}return Object.defineProperty(t.prototype,"gamepadAngularSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:0},set:function(e){var i=this.inputs.attached.gamepad;i&&(i.gamepadAngularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gamepadMoveSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:0},set:function(e){var i=this.inputs.attached.gamepad;i&&(i.gamepadMoveSensibility=e)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"UniversalCamera"},t}(Ye);m._CreateDefaultParsedCamera=function(o,t){return new W(o,f.Zero(),t)};P.AddNodeConstructor("GamepadCamera",function(o,t){return function(){return new he(o,f.Zero(),t)}});var he=function(o){C(t,o);function t(e,i,n){return o.call(this,e,i,n)||this}return t.prototype.getClassName=function(){return"GamepadCamera"},t}(W);function ee(o){o._rigCameras[0]._rigPostProcess=new ve(o.name+"_passthru",1,o._rigCameras[0]),o._rigCameras[1]._rigPostProcess=new Ze(o.name+"_anaglyph",1,o._rigCameras)}P.AddNodeConstructor("AnaglyphArcRotateCamera",function(o,t,e){return function(){return new bt(o,0,0,1,f.Zero(),e.interaxial_distance,t)}});var bt=function(o){C(t,o);function t(e,i,n,a,r,h,u){var s=o.call(this,e,i,n,a,r,u)||this;return s._setRigMode=ee.bind(null,s),s.interaxialDistance=h,s.setCameraRigMode(m.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:h}),s}return t.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},t}($);P.AddNodeConstructor("AnaglyphFreeCamera",function(o,t,e){return function(){return new Rt(o,f.Zero(),e.interaxial_distance,t)}});var Rt=function(o){C(t,o);function t(e,i,n,a){var r=o.call(this,e,i,a)||this;return r._setRigMode=ee.bind(null,r),r.interaxialDistance=n,r.setCameraRigMode(m.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n}),r}return t.prototype.getClassName=function(){return"AnaglyphFreeCamera"},t}(V);P.AddNodeConstructor("AnaglyphGamepadCamera",function(o,t,e){return function(){return new Pt(o,f.Zero(),e.interaxial_distance,t)}});var Pt=function(o){C(t,o);function t(e,i,n,a){var r=o.call(this,e,i,a)||this;return r._setRigMode=ee.bind(null,r),r.interaxialDistance=n,r.setCameraRigMode(m.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n}),r}return t.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},t}(he);P.AddNodeConstructor("AnaglyphUniversalCamera",function(o,t,e){return function(){return new Ot(o,f.Zero(),e.interaxial_distance,t)}});var Ot=function(o){C(t,o);function t(e,i,n,a){var r=o.call(this,e,i,a)||this;return r._setRigMode=ee.bind(null,r),r.interaxialDistance=n,r.setCameraRigMode(m.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n}),r}return t.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},t}(W);function te(o){var t=o.cameraRigMode===m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||o.cameraRigMode===m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED,e=o.cameraRigMode===m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED,i=o.cameraRigMode===m.RIG_MODE_STEREOSCOPIC_INTERLACED;i?(o._rigCameras[0]._rigPostProcess=new ve(o.name+"_passthru",1,o._rigCameras[0]),o._rigCameras[1]._rigPostProcess=new Xe(o.name+"_stereoInterlace",o._rigCameras,!1,!0)):(o._rigCameras[e?1:0].viewport=new F(0,0,t?.5:1,t?1:.5),o._rigCameras[e?0:1].viewport=new F(t?.5:0,t?0:.5,t?.5:1,t?1:.5))}P.AddNodeConstructor("StereoscopicArcRotateCamera",function(o,t,e){return function(){return new Mt(o,0,0,1,f.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var Mt=function(o){C(t,o);function t(e,i,n,a,r,h,u,s){var d=o.call(this,e,i,n,a,r,s)||this;return d._setRigMode=te.bind(null,d),d.interaxialDistance=h,d.isStereoscopicSideBySide=u,d.setCameraRigMode(u?m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:m.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:h}),d}return t.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},t}($);P.AddNodeConstructor("StereoscopicFreeCamera",function(o,t,e){return function(){return new wt(o,f.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var wt=function(o){C(t,o);function t(e,i,n,a,r){var h=o.call(this,e,i,r)||this;return h._setRigMode=te.bind(null,h),h.interaxialDistance=n,h.isStereoscopicSideBySide=a,h.setCameraRigMode(a?m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:m.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n}),h}return t.prototype.getClassName=function(){return"StereoscopicFreeCamera"},t}(V);P.AddNodeConstructor("StereoscopicGamepadCamera",function(o,t,e){return function(){return new kt(o,f.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var kt=function(o){C(t,o);function t(e,i,n,a,r){var h=o.call(this,e,i,r)||this;return h._setRigMode=te.bind(null,h),h.interaxialDistance=n,h.isStereoscopicSideBySide=a,h.setCameraRigMode(a?m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:m.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n}),h}return t.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},t}(he);P.AddNodeConstructor("StereoscopicFreeCamera",function(o,t,e){return function(){return new Tt(o,f.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var Tt=function(o){C(t,o);function t(e,i,n,a,r){var h=o.call(this,e,i,r)||this;return h._setRigMode=te.bind(null,h),h.interaxialDistance=n,h.isStereoscopicSideBySide=a,h.setCameraRigMode(a?m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:m.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n}),h}return t.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},t}(W);(function(o){C(t,o);function t(e,i,n,a,r){a===void 0&&(a=1),r===void 0&&(r=.065);var h=o.call(this,e,i,n)||this;return h._distanceBetweenEyes=r,h._distanceToProjectionPlane=a,h.setCameraRigMode(m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL,{stereoHalfAngle:0}),h._cameraRigParams.stereoHalfAngle=0,h._cameraRigParams.interaxialDistance=r,h}return Object.defineProperty(t.prototype,"distanceBetweenEyes",{get:function(){return this._distanceBetweenEyes},set:function(e){this._distanceBetweenEyes=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"distanceToProjectionPlane",{get:function(){return this._distanceToProjectionPlane},set:function(e){this._distanceToProjectionPlane=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},t.prototype.createRigCamera=function(e){var i=new G(e,f.Zero(),this.getScene()),n=new tt("tm_"+e,this.getScene());return i.parent=n,n.setPivotMatrix(p.Identity(),!1),i.isRigCamera=!0,i.rigParent=this,i},t.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++){var i=this._rigCameras[e];i.minZ=this.minZ,i.maxZ=this.maxZ,i.fov=this.fov,i.upVector.copyFrom(this.upVector),i.rotationQuaternion?i.rotationQuaternion.copyFrom(this.rotationQuaternion):i.rotation.copyFrom(this.rotation),this._updateCamera(this._rigCameras[e],e)}},t.prototype._updateCamera=function(e,i){var n=this.distanceBetweenEyes/2,a=n/this.distanceToProjectionPlane;e.position.copyFrom(this.position),e.position.addInPlaceFromFloats(i===0?-n:n,0,-this._distanceToProjectionPlane);var r=e.parent,h=r.getPivotMatrix();h.setTranslationFromFloats(i===0?n:-n,0,0),h.setRowFromFloats(2,i===0?a:-a,0,1,0),r.setPivotMatrix(h,!1)},t.prototype._setRigMode=function(){this._rigCameras[0].viewport=new F(0,0,.5,1),this._rigCameras[1].viewport=new F(.5,0,.5,1);for(var e=0;e<this._rigCameras.length;e++)this._updateCamera(this._rigCameras[e],e)},t})(W);P.AddNodeConstructor("VirtualJoysticksCamera",function(o,t){return function(){return new St(o,f.Zero(),t)}});var St=function(o){C(t,o);function t(e,i,n){var a=o.call(this,e,i,n)||this;return a.inputs.addVirtualJoystick(),a}return t.prototype.getClassName=function(){return"VirtualJoysticksCamera"},t}(V),Q=function(){function o(){this.compensateDistortion=!0,this.multiviewEnabled=!1}return Object.defineProperty(o.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"leftHMatrix",{get:function(){var t=this.hScreenSize/4-this.lensSeparationDistance/2,e=4*t/this.hScreenSize;return p.Translation(e,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"rightHMatrix",{get:function(){var t=this.hScreenSize/4-this.lensSeparationDistance/2,e=4*t/this.hScreenSize;return p.Translation(-e,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"leftPreViewMatrix",{get:function(){return p.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"rightPreViewMatrix",{get:function(){return p.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!1,configurable:!0}),o.GetDefault=function(){var t=new o;return t.hResolution=1280,t.vResolution=800,t.hScreenSize=.149759993,t.vScreenSize=.0935999975,t.vScreenCenter=.0467999987,t.eyeToScreenDistance=.0410000011,t.lensSeparationDistance=.063500002,t.interpupillaryDistance=.064000003,t.distortionK=[1,.219999999,.239999995,0],t.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],t.postProcessScaleFactor=1.714605507808412,t.lensCenterOffset=.151976421,t},o}();function le(o,t){var e=t.vrCameraMetrics||Q.GetDefault();o._rigCameras[0]._cameraRigParams.vrMetrics=e,o._rigCameras[0].viewport=new F(0,0,.5,1),o._rigCameras[0]._cameraRigParams.vrWorkMatrix=new p,o._rigCameras[0]._cameraRigParams.vrHMatrix=e.leftHMatrix,o._rigCameras[0]._cameraRigParams.vrPreViewMatrix=e.leftPreViewMatrix,o._rigCameras[0].getProjectionMatrix=o._rigCameras[0]._getVRProjectionMatrix,o._rigCameras[1]._cameraRigParams.vrMetrics=e,o._rigCameras[1].viewport=new F(.5,0,.5,1),o._rigCameras[1]._cameraRigParams.vrWorkMatrix=new p,o._rigCameras[1]._cameraRigParams.vrHMatrix=e.rightHMatrix,o._rigCameras[1]._cameraRigParams.vrPreViewMatrix=e.rightPreViewMatrix,o._rigCameras[1].getProjectionMatrix=o._rigCameras[1]._getVRProjectionMatrix,e.multiviewEnabled&&(o.getScene().getEngine().getCaps().multiview?(o._useMultiviewToSingleView=!0,o._rigPostProcess=new Ce("VRMultiviewToSingleview",o,e.postProcessScaleFactor)):(E.Warn("Multiview is not supported, falling back to standard rendering"),e.multiviewEnabled=!1)),e.compensateDistortion&&(o._rigCameras[0]._rigPostProcess=new fe("VR_Distort_Compensation_Left",o._rigCameras[0],!1,e),o._rigCameras[1]._rigPostProcess=new fe("VR_Distort_Compensation_Right",o._rigCameras[1],!0,e))}P.AddNodeConstructor("VRDeviceOrientationArcRotateCamera",function(o,t){return function(){return new xt(o,0,0,1,f.Zero(),t)}});var xt=function(o){C(t,o);function t(e,i,n,a,r,h,u,s){u===void 0&&(u=!0),s===void 0&&(s=Q.GetDefault());var d=o.call(this,e,i,n,a,r,h)||this;return d._setRigMode=le.bind(null,d),s.compensateDistortion=u,d.setCameraRigMode(m.RIG_MODE_VR,{vrCameraMetrics:s}),d.inputs.addVRDeviceOrientation(),d}return t.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},t}($);P.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(o,t){return function(){return new ce(o,f.Zero(),t)}});var ce=function(o){C(t,o);function t(e,i,n,a,r){a===void 0&&(a=!0),r===void 0&&(r=Q.GetDefault());var h=o.call(this,e,i,n)||this;return h._setRigMode=le.bind(null,h),r.compensateDistortion=a,h.setCameraRigMode(m.RIG_MODE_VR,{vrCameraMetrics:r}),h}return t.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},t}(se);P.AddNodeConstructor("VRDeviceOrientationGamepadCamera",function(o,t){return function(){return new Et(o,f.Zero(),t)}});var Et=function(o){C(t,o);function t(e,i,n,a,r){a===void 0&&(a=!0),r===void 0&&(r=Q.GetDefault());var h=o.call(this,e,i,n,a,r)||this;return h._setRigMode=le.bind(null,h),h.inputs.addGamepad(),h}return t.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},t}(ce);function Dt(o,t){if(t.vrDisplay){var e=t.vrDisplay.getEyeParameters("left"),i=t.vrDisplay.getEyeParameters("right");o._rigCameras[0].viewport=new F(0,0,.5,1),o._rigCameras[0].setCameraRigParameter("left",!0),o._rigCameras[0].setCameraRigParameter("specs",t.specs),o._rigCameras[0].setCameraRigParameter("eyeParameters",e),o._rigCameras[0].setCameraRigParameter("frameData",t.frameData),o._rigCameras[0].setCameraRigParameter("parentCamera",t.parentCamera),o._rigCameras[0]._cameraRigParams.vrWorkMatrix=new p,o._rigCameras[0].getProjectionMatrix=o._getWebVRProjectionMatrix,o._rigCameras[0].parent=o,o._rigCameras[0]._getViewMatrix=o._getWebVRViewMatrix,o._rigCameras[1].viewport=new F(.5,0,.5,1),o._rigCameras[1].setCameraRigParameter("eyeParameters",i),o._rigCameras[1].setCameraRigParameter("specs",t.specs),o._rigCameras[1].setCameraRigParameter("frameData",t.frameData),o._rigCameras[1].setCameraRigParameter("parentCamera",t.parentCamera),o._rigCameras[1]._cameraRigParams.vrWorkMatrix=new p,o._rigCameras[1].getProjectionMatrix=o._getWebVRProjectionMatrix,o._rigCameras[1].parent=o,o._rigCameras[1]._getViewMatrix=o._getWebVRViewMatrix}}P.AddNodeConstructor("WebVRFreeCamera",function(o,t){return function(){return new ue(o,f.Zero(),t)}});P.AddNodeConstructor("WebVRGamepadCamera",function(o,t){return function(){return new ue(o,f.Zero(),t)}});var ue=function(o){C(t,o);function t(e,i,n,a){a===void 0&&(a={});var r=o.call(this,e,i,n)||this;r._webVROptions=a,r._vrDevice=null,r.rawPose=null,r._specsVersion="1.1",r._attached=!1,r._descendants=[],r._deviceRoomPosition=f.Zero(),r._deviceRoomRotationQuaternion=v.Identity(),r._standingMatrix=null,r.devicePosition=f.Zero(),r.deviceRotationQuaternion=v.Identity(),r.deviceScaleFactor=1,r._deviceToWorld=p.Identity(),r._worldToDevice=p.Identity(),r.controllers=[],r.onControllersAttachedObservable=new w,r.onControllerMeshLoadedObservable=new w,r.onPoseUpdatedFromDeviceObservable=new w,r._poseSet=!1,r.rigParenting=!0,r._defaultHeight=void 0,r._setRigMode=Dt.bind(null,r),r._detachIfAttached=function(){var u=r.getEngine().getVRDevice();u&&!u.isPresenting&&r.detachControl()},r._workingVector=f.Zero(),r._oneVector=f.One(),r._workingMatrix=p.Identity(),r._tmpMatrix=new p,r._cache.position=f.Zero(),a.defaultHeight&&(r._defaultHeight=a.defaultHeight,r.position.y=r._defaultHeight),r.minZ=.1,arguments.length===5&&(r._webVROptions=arguments[4]),r._webVROptions.trackPosition==null&&(r._webVROptions.trackPosition=!0),r._webVROptions.controllerMeshes==null&&(r._webVROptions.controllerMeshes=!0),r._webVROptions.defaultLightingOnControllers==null&&(r._webVROptions.defaultLightingOnControllers=!0),r.rotationQuaternion=new v,r._webVROptions&&r._webVROptions.positionScale&&(r.deviceScaleFactor=r._webVROptions.positionScale);var h=r.getEngine();return r._onVREnabled=function(u){u&&r.initControllers()},h.onVRRequestPresentComplete.add(r._onVREnabled),h.initWebVR().add(function(u){!u.vrDisplay||r._vrDevice===u.vrDisplay||(r._vrDevice=u.vrDisplay,r.setCameraRigMode(m.RIG_MODE_WEBVR,{parentCamera:r,vrDisplay:r._vrDevice,frameData:r._frameData,specs:r._specsVersion}),r._attached&&r.getEngine().enableVR(r._webVROptions))}),typeof VRFrameData!="undefined"&&(r._frameData=new VRFrameData),a.useMultiview&&(r.getScene().getEngine().getCaps().multiview?(r._useMultiviewToSingleView=!0,r._rigPostProcess=new Ce("VRMultiviewToSingleview",r,1)):(E.Warn("Multiview is not supported, falling back to standard rendering"),r._useMultiviewToSingleView=!1)),r.getScene().onBeforeCameraRenderObservable.add(function(u){u.parent===r&&r.rigParenting&&(r._descendants=r.getDescendants(!0,function(s){var d=r.controllers.some(function(R){return R._mesh===s}),_=r._rigCameras.indexOf(s)!==-1;return!d&&!_}),r._descendants.forEach(function(s){s.parent=u}))}),r.getScene().onAfterCameraRenderObservable.add(function(u){u.parent===r&&r.rigParenting&&r._descendants.forEach(function(s){s.parent=r})}),r}return t.prototype.deviceDistanceToRoomGround=function(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0},t.prototype.useStandingMatrix=function(e){var i=this;e===void 0&&(e=function(n){}),this.getEngine().initWebVRAsync().then(function(n){!n.vrDisplay||!n.vrDisplay.stageParameters||!n.vrDisplay.stageParameters.sittingToStandingTransform||!i._webVROptions.trackPosition?e(!1):(i._standingMatrix=new p,p.FromFloat32ArrayToRefScaled(n.vrDisplay.stageParameters.sittingToStandingTransform,0,1,i._standingMatrix),i.getScene().useRightHandedSystem||i._standingMatrix&&i._standingMatrix.toggleModelMatrixHandInPlace(),e(!0))})},t.prototype.useStandingMatrixAsync=function(){var e=this;return new Promise(function(i){e.useStandingMatrix(function(n){i(n)})})},t.prototype.dispose=function(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),o.prototype.dispose.call(this)},t.prototype.getControllerByName=function(e){for(var i=0,n=this.controllers;i<n.length;i++){var a=n[i];if(a.hand===e)return a}return null},Object.defineProperty(t.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!1,configurable:!0}),t.prototype.getForwardRay=function(e){return e===void 0&&(e=100),this.leftCamera?o.prototype.getForwardRay.call(this,e,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):o.prototype.getForwardRay.call(this,e)},t.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),o.prototype._checkInputs.call(this)},t.prototype.updateFromDevice=function(e){e&&e.orientation&&e.orientation.length===4&&(this.rawPose=e,this._deviceRoomRotationQuaternion.copyFromFloats(e.orientation[0],e.orientation[1],-e.orientation[2],-e.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this._webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)},t.prototype.attachControl=function(e){e=b.BackCompatCameraNoPreventDefault(arguments),o.prototype.attachControl.call(this,e),this._attached=!0,e=m.ForceAttachControlToAlwaysPreventDefault?!1:e,this._vrDevice&&this.getEngine().enableVR(this._webVROptions);var i=this._scene.getEngine().getHostWindow();i&&i.addEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.detachControl=function(){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),o.prototype.detachControl.call(this),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.getClassName=function(){return"WebVRFreeCamera"},t.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],i=this._rigCameras[1];e.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),i.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),e.position.copyFrom(this._deviceRoomPosition),i.position.copyFrom(this._deviceRoomPosition)},t.prototype._correctPositionIfNotTrackPosition=function(e,i){i===void 0&&(i=!1),this.rawPose&&this.rawPose.position&&!this._webVROptions.trackPosition&&(p.TranslationToRef(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2],this._tmpMatrix),i||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(e,e))},t.prototype._updateCache=function(e){var i=this;(!this.rotationQuaternion.equals(this._cache.rotationQuaternion)||!this.position.equals(this._cache.position))&&(this._updateCacheCalled||(this._updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),f.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),p.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach(function(n){n._deviceToWorld.copyFrom(i._deviceToWorld),i._correctPositionIfNotTrackPosition(n._deviceToWorld),n.update()})),e||o.prototype._updateCache.call(this),this._updateCacheCalled=!1},t.prototype._computeDevicePosition=function(){f.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)},t.prototype.update=function(){this._computeDevicePosition(),p.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),v.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),o.prototype.update.call(this)},t.prototype._getViewMatrix=function(){return p.Identity()},t.prototype._getWebVRViewMatrix=function(){var e=this._cameraRigParams.parentCamera;e._updateCache();var i=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;return p.FromArrayToRef(i,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||this._webvrViewMatrix.toggleModelMatrixHandInPlace(),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),f.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),e.deviceScaleFactor!==1&&(this._webvrViewMatrix.invert(),e.deviceScaleFactor&&(this._webvrViewMatrix.multiplyAtIndex(12,e.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(13,e.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(14,e.deviceScaleFactor)),this._webvrViewMatrix.invert()),e._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),e._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||p.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(e.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix},t.prototype._getWebVRProjectionMatrix=function(){var e=this.parent;e._vrDevice.depthNear=e.minZ,e._vrDevice.depthFar=e.maxZ;var i=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return p.FromArrayToRef(i,0,this._projectionMatrix),this.getScene().useRightHandedSystem||this._projectionMatrix.toggleProjectionMatrixHandInPlace(),this._projectionMatrix},t.prototype.initControllers=function(){var e=this;this.controllers.length=0;var i=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=i.onGamepadDisconnectedObservable.add(function(n){if(n.type===D.POSE_ENABLED){var a=n;a.defaultModel&&a.defaultModel.setEnabled(!1),a.hand==="right"&&(e._rightController=null),a.hand==="left"&&(e._leftController=null);var r=e.controllers.indexOf(a);r!==-1&&e.controllers.splice(r,1)}}),this._onGamepadConnectedObserver=i.onGamepadConnectedObservable.add(function(n){if(n.type===D.POSE_ENABLED){var a=n;if(e._webVROptions.trackPosition||(a._disableTrackPosition(new f(a.hand=="left"?-.15:.15,-.5,.25)),e._updateCacheWhenTrackingDisabledObserver||(e._updateCacheWhenTrackingDisabledObserver=e._scene.onBeforeRenderObservable.add(function(){e._updateCache()}))),a.deviceScaleFactor=e.deviceScaleFactor,a._deviceToWorld.copyFrom(e._deviceToWorld),e._correctPositionIfNotTrackPosition(a._deviceToWorld),e._webVROptions.controllerMeshes&&(a.defaultModel?a.defaultModel.setEnabled(!0):a.initControllerMesh(e.getScene(),function(u){if(u.scaling.scaleInPlace(e.deviceScaleFactor),e.onControllerMeshLoadedObservable.notifyObservers(a),e._webVROptions.defaultLightingOnControllers){e._lightOnControllers||(e._lightOnControllers=new st("vrControllersLight",new f(0,1,0),e.getScene()));var s=function(d,_){var R=d.getChildren();R&&R.length!==0&&R.forEach(function(O){_.includedOnlyMeshes.push(O),s(O,_)})};e._lightOnControllers.includedOnlyMeshes.push(u),s(u,e._lightOnControllers)}})),a.attachToPoseControlledCamera(e),e.controllers.indexOf(a)===-1){e.controllers.push(a);for(var r=!1,h=0;h<e.controllers.length;h++)e.controllers[h].controllerType===Re.VIVE&&(r?e.controllers[h].hand="right":(r=!0,e.controllers[h].hand="left"));e.controllers.length>=2&&e.onControllersAttachedObservable.notifyObservers(e.controllers)}}})},t}(V),He=function(){function o(t,e){if(e===void 0&&(e=null),this.scene=t,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=o._IdCounter++,e)this._gazeTracker=e.clone("gazeTracker");else{this._gazeTracker=Oe("gazeTracker",{diameter:.0035,thickness:.0025,tessellation:20,updatable:!1},t),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var i=new ne("targetMat",t);i.specularColor=B.Black(),i.emissiveColor=new B(.7,.7,.7),i.backFaceCulling=!1,this._gazeTracker.material=i}}return o.prototype._getForwardRay=function(t){return new re(f.Zero(),new f(0,0,t))},o.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})},o.prototype._selectionPointerUp=function(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1},o.prototype._activatePointer=function(){this._activePointer=!0},o.prototype._deactivatePointer=function(){this._activePointer=!1},o.prototype._updatePointerDistance=function(t){},o.prototype.dispose=function(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()},o._IdCounter=0,o}(),It=function(o){C(t,o);function t(e,i,n){var a=o.call(this,i,n)||this;a.webVRController=e,a._laserPointer=ot("laserPointer",{updatable:!1,height:1,diameterTop:.004,diameterBottom:2e-4,tessellation:20,subdivisions:1},i);var r=new ne("laserPointerMat",i);if(r.emissiveColor=new B(.7,.7,.7),r.alpha=.6,a._laserPointer.material=r,a._laserPointer.rotation.x=Math.PI/2,a._laserPointer.position.z=-.5,a._laserPointer.isVisible=!1,a._laserPointer.isPickable=!1,!e.mesh){var h=new j("preloadControllerMesh",i),u=new j(_e.POINTING_POSE,i);u.rotation.x=-.7,h.addChild(u),e.attachToMesh(h)}return a._setLaserPointerParent(e.mesh),a._meshAttachedObserver=e._meshAttachedObservable.add(function(s){a._setLaserPointerParent(s)}),a}return t.prototype._getForwardRay=function(e){return this.webVRController.getForwardRay(e)},t.prototype._activatePointer=function(){o.prototype._activatePointer.call(this),this._laserPointer.isVisible=!0},t.prototype._deactivatePointer=function(){o.prototype._deactivatePointer.call(this),this._laserPointer.isVisible=!1},t.prototype._setLaserPointerColor=function(e){this._laserPointer.material.emissiveColor=e},t.prototype._setLaserPointerLightingDisabled=function(e){this._laserPointer.material.disableLighting=e},t.prototype._setLaserPointerParent=function(e){var i=function(h){h.isPickable=!1,h.getChildMeshes().forEach(function(u){i(u)})};i(e);var n=e.getChildren(void 0,!1),a=e;this.webVRController._pointingPoseNode=null;for(var r=0;r<n.length;r++)if(n[r].name&&n[r].name.indexOf(_e.POINTING_POSE)>=0){a=n[r],this.webVRController._pointingPoseNode=a;break}this._laserPointer.parent=a},t.prototype._updatePointerDistance=function(e){e===void 0&&(e=100),this._laserPointer.scaling.y=e,this._laserPointer.position.z=-e/2},t.prototype.dispose=function(){o.prototype.dispose.call(this),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)},t}(He),ye=function(o){C(t,o);function t(e,i){var n=o.call(this,i)||this;return n._getCamera=e,n}return t.prototype._getForwardRay=function(e){var i=this._getCamera();return i?i.getForwardRay(e):new re(f.Zero(),f.Forward())},t}(He),Qt=function(){function o(t,e){e===void 0&&(e={});var i=this;this.webVROptions=e,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.enableGazeEvenWhenNoPointerLock=!1,this.exitVROnDoubleTap=!0,this.onEnteringVRObservable=new w,this.onAfterEnteringVRObservable=new w,this.onExitingVRObservable=new w,this.onControllerMeshLoadedObservable=new w,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._teleportationMode=o.TELEPORTATIONMODE_CONSTANTTIME,this._teleportationTime=122,this._teleportationSpeed=20,this._rotationAllowed=!0,this._teleportBackwardsVector=new f(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new f(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this._gazeColor=new B(.7,.7,.7),this._laserColor=new B(.7,.7,.7),this._pickedLaserColor=new B(.2,.2,1),this._pickedGazeColor=new B(0,0,1),this.onNewMeshSelected=new w,this.onMeshSelectedWithController=new w,this.onNewMeshPicked=new w,this.onBeforeCameraTeleport=new w,this.onAfterCameraTeleport=new w,this.onSelectedMeshUnselected=new w,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this.updateControllerLaserColor=!0,this.requestPointerLockOnFullScreen=!0,this.xrTestDone=!1,this._onResize=function(){i._moveButtonToBottomRight(),i._fullscreenVRpresenting&&i._webVRready&&i.exitVR()},this._onFullscreenChange=function(){var r=document;r.fullscreen!==void 0?i._fullscreenVRpresenting=document.fullscreen:r.mozFullScreen!==void 0?i._fullscreenVRpresenting=r.mozFullScreen:r.webkitIsFullScreen!==void 0?i._fullscreenVRpresenting=r.webkitIsFullScreen:r.msIsFullScreen!==void 0?i._fullscreenVRpresenting=r.msIsFullScreen:document.msFullscreenElement!==void 0&&(i._fullscreenVRpresenting=document.msFullscreenElement),!i._fullscreenVRpresenting&&i._inputElement&&(i.exitVR(),!i._useCustomVRButton&&i._btnVR&&(i._btnVR.style.top=i._inputElement.offsetTop+i._inputElement.offsetHeight-70+"px",i._btnVR.style.left=i._inputElement.offsetLeft+i._inputElement.offsetWidth-100+"px",i._updateButtonVisibility()))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this._beforeRender=function(){i._leftController&&i._leftController._activePointer&&i._castRayAndSelectObject(i._leftController),i._rightController&&i._rightController._activePointer&&i._castRayAndSelectObject(i._rightController),i._noControllerIsActive&&(i._scene.getEngine().isPointerLock||i.enableGazeEvenWhenNoPointerLock)?i._castRayAndSelectObject(i._cameraGazer):i._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=function(r){if(r.type!==D.POSE_ENABLED)r.leftStick&&r.onleftstickchanged(function(s){i._teleportationInitialized&&i.teleportationEnabled&&(!i._leftController&&!i._rightController||i._leftController&&!i._leftController._activePointer&&i._rightController&&!i._rightController._activePointer)&&(i._checkTeleportWithRay(s,i._cameraGazer),i._checkTeleportBackwards(s,i._cameraGazer))}),r.rightStick&&r.onrightstickchanged(function(s){i._teleportationInitialized&&i._checkRotate(s,i._cameraGazer)}),r.type===D.XBOX&&(r.onbuttondown(function(s){i._interactionsEnabled&&s===me.A&&i._cameraGazer._selectionPointerDown()}),r.onbuttonup(function(s){i._interactionsEnabled&&s===me.A&&i._cameraGazer._selectionPointerUp()}));else{var h=r,u=new It(h,i._scene,i._cameraGazer._gazeTracker);h.hand==="right"||i._leftController&&i._leftController.webVRController!=h?i._rightController=u:i._leftController=u,i._tryEnableInteractionOnController(u)}},this._tryEnableInteractionOnController=function(r){i._interactionsRequested&&!r._interactionsEnabled&&i._enableInteractionOnController(r),i._teleportationRequested&&!r._teleportationEnabled&&i._enableTeleportationOnController(r)},this._onNewGamepadDisconnected=function(r){r instanceof et&&(r.hand==="left"&&i._leftController!=null&&(i._leftController.dispose(),i._leftController=null),r.hand==="right"&&i._rightController!=null&&(i._rightController.dispose(),i._rightController=null))},this._workingVector=f.Zero(),this._workingQuaternion=v.Identity(),this._workingMatrix=p.Identity(),E.Warn("WebVR is deprecated. Please avoid using this experience helper and use the WebXR experience helper instead"),this._scene=t,this._inputElement=t.getEngine().getInputElement();var n="getVRDisplays"in navigator;if(!n&&e.useXR===void 0&&(e.useXR=!0),e.createFallbackVRDeviceOrientationFreeCamera===void 0&&(e.createFallbackVRDeviceOrientationFreeCamera=!0),e.createDeviceOrientationCamera===void 0&&(e.createDeviceOrientationCamera=!0),e.laserToggle===void 0&&(e.laserToggle=!0),e.defaultHeight===void 0&&(e.defaultHeight=1.7),e.useCustomVRButton&&(this._useCustomVRButton=!0,e.customVRButton&&(this._btnVR=e.customVRButton)),e.rayLength&&(this._rayLength=e.rayLength),this._defaultHeight=e.defaultHeight,e.positionScale&&(this._rayLength*=e.positionScale,this._defaultHeight*=e.positionScale),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new f(0,this._defaultHeight,0),e.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new se("deviceOrientationVRHelper",this._position.clone(),t),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof G&&this._scene.activeCamera.rotation)){var a=this._scene.activeCamera;a.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(a.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(v.RotationYawPitchRoll(a.rotation.y,a.rotation.x,a.rotation.z)),this._deviceOrientationCamera.rotation=a.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._inputElement&&this._scene.activeCamera.attachControl()}else this._existingCamera=this._scene.activeCamera;this.webVROptions.useXR&&navigator.xr?ft.IsSessionSupportedAsync("immersive-vr").then(function(r){r?(E.Log("Using WebXR. It is recommended to use the WebXRDefaultExperience directly"),t.createDefaultXRExperienceAsync({floorMeshes:e.floorMeshes||[]}).then(function(h){i.xr=h,i.xrTestDone=!0,i._cameraGazer=new ye(function(){return i.xr.baseExperience.camera},t),i.xr.baseExperience.onStateChangedObservable.add(function(u){switch(u){case Y.ENTERING_XR:i.onEnteringVRObservable.notifyObservers(i),i._interactionsEnabled||i.xr.pointerSelection.detach(),i.xr.pointerSelection.displayLaserPointer=i._displayLaserPointer;break;case Y.EXITING_XR:i.onExitingVRObservable.notifyObservers(i),i._scene.getEngine().resize();break;case Y.IN_XR:i._hasEnteredVR=!0;break;case Y.NOT_IN_XR:i._hasEnteredVR=!1;break}})})):i._completeVRInit(t,e)}):this._completeVRInit(t,e)}return Object.defineProperty(o.prototype,"onEnteringVR",{get:function(){return this.onEnteringVRObservable},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onExitingVR",{get:function(){return this.onExitingVRObservable},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onControllerMeshLoaded",{get:function(){return this.onControllerMeshLoadedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(t){t&&(t.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=t)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"gazeTrackerMesh",{get:function(){return this._cameraGazer._gazeTracker},set:function(t){t&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=t,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"leftControllerGazeTrackerMesh",{get:function(){return this._leftController?this._leftController._gazeTracker:null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"rightControllerGazeTrackerMesh",{get:function(){return this._rightController?this._rightController._gazeTracker:null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(t){this._displayGaze=t,t||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(t){this._displayLaserPointer=t,t?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"vrButton",{get:function(){return this._btnVR},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"_teleportationRequestInitiated",{get:function(){var t=this._cameraGazer._teleportationRequestInitiated||this._leftController!==null&&this._leftController._teleportationRequestInitiated||this._rightController!==null&&this._rightController._teleportationRequestInitiated;return t},enumerable:!1,configurable:!0}),o.prototype._completeVRInit=function(t,e){var i=this;if(this.xrTestDone=!0,e.createFallbackVRDeviceOrientationFreeCamera&&(e.useMultiview&&(e.vrDeviceOrientationCameraMetrics||(e.vrDeviceOrientationCameraMetrics=Q.GetDefault()),e.vrDeviceOrientationCameraMetrics.multiviewEnabled=!0),this._vrDeviceOrientationCamera=new ce("VRDeviceOrientationVRHelper",this._position,this._scene,!0,e.vrDeviceOrientationCameraMetrics),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._webVRCamera=new ue("WebVRHelper",this._position,this._scene,e),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new ye(function(){return i.currentVRCamera},t),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";var n=window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A":"https://cdn.babylonjs.com/Assets/vrButton.png",a=".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+n+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";a+=".babylonVRicon.vrdisplaypresenting { display: none; }";var r=document.createElement("style");r.appendChild(document.createTextNode(a)),document.getElementsByTagName("head")[0].appendChild(r),this._moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",function(){i.isInVRMode?i._scene.getEngine().disableVR():i.enterVR()});var h=this._scene.getEngine().getHostWindow();!h||(h.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),document.onmsfullscreenchange=this._onFullscreenChange,e.createFallbackVRDeviceOrientationFreeCamera?this._displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add(function(u){u.vrDisplay&&i._displayVRButton()}),this._onKeyDown=function(u){u.keyCode===27&&i.isInVRMode&&i.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add(function(){i._hasEnteredVR&&i.exitVROnDoubleTap&&(i.exitVR(),i._fullscreenVRpresenting&&i._scene.getEngine().exitFullscreen())},g.POINTERDOUBLETAP,!1),this._onVRDisplayChangedBind=function(u){return i._onVRDisplayChanged(u)},this._onVrDisplayPresentChangeBind=function(){return i._onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){i._webVRrequesting=!0,i._updateButtonVisibility()},this._onVRRequestPresentComplete=function(){i._webVRrequesting=!1,i._updateButtonVisibility()},t.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChangedBind),t.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),t.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),h.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChangeBind),t.onDisposeObservable.add(function(){i.dispose()}),this._webVRCamera.onControllerMeshLoadedObservable.add(function(u){return i._onDefaultMeshLoaded(u)}),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this._updateButtonVisibility(),this._circleEase=new ct,this._circleEase.setEasingMode(ge.EASINGMODE_EASEINOUT),this._teleportationEasing=this._circleEase,t.onPointerObservable.add(function(u){i._interactionsEnabled&&t.activeCamera===i.vrDeviceOrientationCamera&&u.event.pointerType==="mouse"&&(u.type===g.POINTERDOWN?i._cameraGazer._selectionPointerDown():u.type===g.POINTERUP&&i._cameraGazer._selectionPointerUp())}),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes}))},o.prototype._onDefaultMeshLoaded=function(t){this._leftController&&this._leftController.webVRController==t&&t.mesh&&this._leftController._setLaserPointerParent(t.mesh),this._rightController&&this._rightController.webVRController==t&&t.mesh&&this._rightController._setLaserPointerParent(t.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(t)}catch(e){E.Warn("Error in your custom logic onControllerMeshLoaded: "+e)}},Object.defineProperty(o.prototype,"isInVRMode",{get:function(){return this.xr&&this.webVROptions.useXR&&this.xr.baseExperience.state===Y.IN_XR||this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!1,configurable:!0}),o.prototype._onVrDisplayPresentChange=function(){var t=this._scene.getEngine().getVRDevice();if(t){var e=this._webVRpresenting;this._webVRpresenting=t.isPresenting,e&&!this._webVRpresenting&&this.exitVR()}else E.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this._updateButtonVisibility()},o.prototype._onVRDisplayChanged=function(t){this._webVRsupported=t.vrSupported,this._webVRready=!!t.vrDisplay,this._webVRpresenting=t.vrDisplay&&t.vrDisplay.isPresenting,this._updateButtonVisibility()},o.prototype._moveButtonToBottomRight=function(){if(this._inputElement&&!this._useCustomVRButton&&this._btnVR){var t=this._inputElement.getBoundingClientRect();this._btnVR.style.top=t.top+t.height-70+"px",this._btnVR.style.left=t.left+t.width-100+"px"}},o.prototype._displayVRButton=function(){!this._useCustomVRButton&&!this._btnVRDisplayed&&this._btnVR&&(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},o.prototype._updateButtonVisibility=function(){!this._btnVR||this._useCustomVRButton||(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},o.prototype.enterVR=function(){var t=this;if(this.xr){this.xr.baseExperience.enterXRAsync("immersive-vr","local-floor",this.xr.renderTarget);return}if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(r){E.Warn("Error in your custom logic onEnteringVR: "+r)}if(this._scene.activeCamera){if(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=v.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2e3),this.webVRCamera){var e=this.webVRCamera.deviceRotationQuaternion.toEulerAngles().y,i=v.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles().y,n=i-e,a=this.webVRCamera.rotationQuaternion.toEulerAngles().y;this.webVRCamera.rotationQuaternion=v.FromEulerAngles(0,a+n,0)}this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)}this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._scene.getEngine().onVRRequestPresentComplete.addOnce(function(r){t.onAfterEnteringVRObservable.notifyObservers({success:r})}),this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().enterFullscreen(this.requestPointerLockOnFullScreen),this._updateButtonVisibility(),this._vrDeviceOrientationCamera.onViewMatrixChangedObservable.addOnce(function(){t.onAfterEnteringVRObservable.notifyObservers({success:!0})})),this._scene.activeCamera&&this._inputElement&&this._scene.activeCamera.attachControl(),this._interactionsEnabled&&this._scene.registerBeforeRender(this._beforeRender),this._displayLaserPointer&&[this._leftController,this._rightController].forEach(function(r){r&&r._activatePointer()}),this._hasEnteredVR=!0)},o.prototype.exitVR=function(){if(this.xr){this.xr.baseExperience.exitXRAsync();return}if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(e){E.Warn("Error in your custom logic onExitingVR: "+e)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._inputElement&&this._scene.activeCamera.attachControl(),this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this._updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this._beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),[this._leftController,this._rightController].forEach(function(e){e&&e._deactivatePointer()}),this._hasEnteredVR=!1;var t=this._scene.getEngine();t._onVrDisplayPresentChange&&t._onVrDisplayPresentChange()}},Object.defineProperty(o.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._scene.activeCamera&&(this._scene.activeCamera.position=t)},enumerable:!1,configurable:!0}),o.prototype.enableInteractions=function(){var t=this;if(!this._interactionsEnabled){if(this._interactionsRequested=!0,this.xr){this.xr.baseExperience.state===Y.IN_XR&&this.xr.pointerSelection.attach();return}this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=function(e){return e.isVisible&&(e.isPickable||e.name===t._floorMeshName)},this.meshSelectionPredicate=function(){return!0},this._raySelectionPredicate=function(e){return t._isTeleportationFloor(e)||e.name.indexOf("gazeTracker")===-1&&e.name.indexOf("teleportationTarget")===-1&&e.name.indexOf("torusTeleportation")===-1?t.raySelectionPredicate(e):!1},this._interactionsEnabled=!0}},Object.defineProperty(o.prototype,"_noControllerIsActive",{get:function(){return!(this._leftController&&this._leftController._activePointer)&&!(this._rightController&&this._rightController._activePointer)},enumerable:!1,configurable:!0}),o.prototype._isTeleportationFloor=function(t){for(var e=0;e<this._floorMeshesCollection.length;e++)if(this._floorMeshesCollection[e].id===t.id)return!0;return!!(this._floorMeshName&&t.name===this._floorMeshName)},o.prototype.addFloorMesh=function(t){!this._floorMeshesCollection||this._floorMeshesCollection.indexOf(t)>-1||this._floorMeshesCollection.push(t)},o.prototype.removeFloorMesh=function(t){if(!!this._floorMeshesCollection){var e=this._floorMeshesCollection.indexOf(t);e!==-1&&this._floorMeshesCollection.splice(e,1)}},o.prototype.enableTeleportation=function(t){var e=this;if(t===void 0&&(t={}),!this._teleportationInitialized){if(this._teleportationRequested=!0,this.enableInteractions(),this.webVROptions.useXR&&(t.floorMeshes||t.floorMeshName)){var i=t.floorMeshes||[];if(!i.length){var n=this._scene.getMeshByName(t.floorMeshName);n&&i.push(n)}if(this.xr){i.forEach(function(h){e.xr.teleportation.addFloorMesh(h)}),this.xr.teleportation.attached||this.xr.teleportation.attach();return}else if(!this.xrTestDone){var a=function(){e.xrTestDone&&(e._scene.unregisterBeforeRender(a),e.xr?e.xr.teleportation.attached||e.xr.teleportation.attach():e.enableTeleportation(t))};this._scene.registerBeforeRender(a);return}}t.floorMeshName&&(this._floorMeshName=t.floorMeshName),t.floorMeshes&&(this._floorMeshesCollection=t.floorMeshes),t.teleportationMode&&(this._teleportationMode=t.teleportationMode),t.teleportationTime&&t.teleportationTime>0&&(this._teleportationTime=t.teleportationTime),t.teleportationSpeed&&t.teleportationSpeed>0&&(this._teleportationSpeed=t.teleportationSpeed),t.easingFunction!==void 0&&(this._teleportationEasing=t.easingFunction),this._leftController!=null&&this._enableTeleportationOnController(this._leftController),this._rightController!=null&&this._enableTeleportationOnController(this._rightController);var r=new ht;r.vignetteColor=new Ke(0,0,0,0),r.vignetteEnabled=!0,this._postProcessMove=new je("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,r),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}},o.prototype._enableInteractionOnController=function(t){var e=this,i=t.webVRController.mesh;i&&(t._interactionsEnabled=!0,this.isInVRMode&&this._displayLaserPointer&&t._activatePointer(),this.webVROptions.laserToggle&&t.webVRController.onMainButtonStateChangedObservable.add(function(n){e._displayLaserPointer&&n.value===1&&(t._activePointer?t._deactivatePointer():t._activatePointer(),e.displayGaze&&(t._gazeTracker.isVisible=t._activePointer))}),t.webVRController.onTriggerStateChangedObservable.add(function(n){var a=t;e._noControllerIsActive&&(a=e._cameraGazer),a._pointerDownOnMeshAsked?n.value<e._padSensibilityDown&&a._selectionPointerUp():n.value>e._padSensibilityUp&&a._selectionPointerDown()}))},o.prototype._checkTeleportWithRay=function(t,e){this._teleportationRequestInitiated&&!e._teleportationRequestInitiated||(e._teleportationRequestInitiated?Math.sqrt(t.y*t.y+t.x*t.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),e._teleportationRequestInitiated=!1):t.y<-this._padSensibilityUp&&e._dpadPressed&&(e._activatePointer(),e._teleportationRequestInitiated=!0))},o.prototype._checkRotate=function(t,e){e._teleportationRequestInitiated||(e._rotationLeftAsked?t.x>-this._padSensibilityDown&&(e._rotationLeftAsked=!1):t.x<-this._padSensibilityUp&&e._dpadPressed&&(e._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),e._rotationRightAsked?t.x<this._padSensibilityDown&&(e._rotationRightAsked=!1):t.x>this._padSensibilityUp&&e._dpadPressed&&(e._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},o.prototype._checkTeleportBackwards=function(t,e){if(!e._teleportationRequestInitiated)if(t.y>this._padSensibilityUp&&e._dpadPressed){if(!e._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var i=v.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),n=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(i=this.currentVRCamera.deviceRotationQuaternion,n=this.currentVRCamera.devicePosition),i.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,v.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),f.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);var a=new re(n,this._workingVector),r=this._scene.pickWithRay(a,this._raySelectionPredicate);r&&r.pickedPoint&&r.pickedMesh&&this._isTeleportationFloor(r.pickedMesh)&&r.distance<5&&this.teleportCamera(r.pickedPoint),e._teleportationBackRequestInitiated=!0}}else e._teleportationBackRequestInitiated=!1},o.prototype._enableTeleportationOnController=function(t){var e=this,i=t.webVRController.mesh;i&&(t._interactionsEnabled||this._enableInteractionOnController(t),t._interactionsEnabled=!0,t._teleportationEnabled=!0,t.webVRController.controllerType===Re.VIVE&&(t._dpadPressed=!1,t.webVRController.onPadStateChangedObservable.add(function(n){t._dpadPressed=n.pressed,t._dpadPressed||(t._rotationLeftAsked=!1,t._rotationRightAsked=!1,t._teleportationBackRequestInitiated=!1)})),t.webVRController.onPadValuesChangedObservable.add(function(n){e.teleportationEnabled&&(e._checkTeleportBackwards(n,t),e._checkTeleportWithRay(n,t)),e._checkRotate(n,t)}))},o.prototype._createTeleportationCircles=function(){this._teleportationTarget=it("teleportationTarget",{width:2,height:2,subdivisions:2},this._scene),this._teleportationTarget.isPickable=!1;var t=512,e=new lt("DynamicTexture",t,this._scene,!0);e.hasAlpha=!0;var i=e.getContext(),n=t/2,a=t/2,r=200;i.beginPath(),i.arc(n,a,r,0,2*Math.PI,!1),i.fillStyle=this._teleportationFillColor,i.fill(),i.lineWidth=10,i.strokeStyle=this._teleportationBorderColor,i.stroke(),i.closePath(),e.update();var h=new ne("TextPlaneMaterial",this._scene);h.diffuseTexture=e,this._teleportationTarget.material=h;var u=Oe("torusTeleportation",{diameter:.75,thickness:.1,tessellation:25,updatable:!1},this._scene);u.isPickable=!1,u.parent=this._teleportationTarget;var s=new M("animationInnerCircle","position.y",30,M.ANIMATIONTYPE_FLOAT,M.ANIMATIONLOOPMODE_CYCLE),d=[];d.push({frame:0,value:0}),d.push({frame:30,value:.4}),d.push({frame:60,value:0}),s.setKeys(d);var _=new ut;_.setEasingMode(ge.EASINGMODE_EASEINOUT),s.setEasingFunction(_),u.animations=[],u.animations.push(s),this._scene.beginAnimation(u,0,60,!0),this._hideTeleportationTarget()},o.prototype._displayTeleportationTarget=function(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},o.prototype._hideTeleportationTarget=function(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},o.prototype._rotateCamera=function(t){var e=this;if(this.currentVRCamera instanceof V){t?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var i=v.FromRotationMatrix(p.RotationY(Math.PI/4*this._rotationAngle)),n=new M("animationRotation","rotationQuaternion",90,M.ANIMATIONTYPE_QUATERNION,M.ANIMATIONLOOPMODE_CONSTANT),a=[];a.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),a.push({frame:6,value:i}),n.setKeys(a),n.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(n),this._postProcessMove.animations=[];var r=new M("animationPP","vignetteWeight",90,M.ANIMATIONTYPE_FLOAT,M.ANIMATIONLOOPMODE_CONSTANT),h=[];h.push({frame:0,value:0}),h.push({frame:3,value:4}),h.push({frame:6,value:0}),r.setKeys(h),r.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(r);var u=new M("animationPP2","vignetteStretch",90,M.ANIMATIONTYPE_FLOAT,M.ANIMATIONLOOPMODE_CONSTANT),s=[];s.push({frame:0,value:0}),s.push({frame:3,value:10}),s.push({frame:6,value:0}),u.setKeys(s),u.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(u),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,function(){e._webVRCamera.detachPostProcess(e._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},o.prototype._moveTeleportationSelectorTo=function(t,e,i){if(t.pickedPoint){e._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(t.pickedPoint),this._teleportationTarget.position.copyFrom(t.pickedPoint));var n=this._convertNormalToDirectionOfRay(t.getNormal(!0,!1),i);if(n){var a=f.Cross(A.Y,n),r=f.Cross(n,a);f.RotationFromAxisToRef(r,n,a,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},o.prototype.teleportCamera=function(t){var e=this;if(this.currentVRCamera instanceof V){this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),t.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(t),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._workingVector.y+=this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector);var i=90,n,a;if(this._teleportationMode==o.TELEPORTATIONMODE_CONSTANTSPEED){a=i;var r=f.Distance(this.currentVRCamera.position,this._workingVector);n=this._teleportationSpeed/r}else a=Math.round(this._teleportationTime*i/1e3),n=1;this.currentVRCamera.animations=[];var h=new M("animationCameraTeleportation","position",i,M.ANIMATIONTYPE_VECTOR3,M.ANIMATIONLOOPMODE_CONSTANT),u=[{frame:0,value:this.currentVRCamera.position},{frame:a,value:this._workingVector}];h.setKeys(u),h.setEasingFunction(this._teleportationEasing),this.currentVRCamera.animations.push(h),this._postProcessMove.animations=[];var s=Math.round(a/2),d=new M("animationPP","vignetteWeight",i,M.ANIMATIONTYPE_FLOAT,M.ANIMATIONLOOPMODE_CONSTANT),_=[];_.push({frame:0,value:0}),_.push({frame:s,value:8}),_.push({frame:a,value:0}),d.setKeys(_),this._postProcessMove.animations.push(d);var R=new M("animationPP2","vignetteStretch",i,M.ANIMATIONTYPE_FLOAT,M.ANIMATIONLOOPMODE_CONSTANT),O=[];O.push({frame:0,value:0}),O.push({frame:s,value:10}),O.push({frame:a,value:0}),R.setKeys(O),this._postProcessMove.animations.push(R),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,a,!1,n,function(){e._webVRCamera.detachPostProcess(e._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,a,!1,n,function(){e.onAfterCameraTeleport.notifyObservers(e._workingVector)}),this._hideTeleportationTarget()}},o.prototype._convertNormalToDirectionOfRay=function(t,e){if(t){var i=Math.acos(f.Dot(t,e.direction));i<Math.PI/2&&t.scaleInPlace(-1)}return t},o.prototype._castRayAndSelectObject=function(t){if(this.currentVRCamera instanceof V){var e=t._getForwardRay(this._rayLength),i=this._scene.pickWithRay(e,this._raySelectionPredicate);if(i&&this._scene.simulatePointerMove(i,{pointerId:t._id}),t._currentHit=i,i&&i.pickedPoint){if(this._displayGaze){var n=1;t._gazeTracker.isVisible=!0,t._isActionableMesh&&(n=3),this.updateGazeTrackerScale&&(t._gazeTracker.scaling.x=i.distance*n,t._gazeTracker.scaling.y=i.distance*n,t._gazeTracker.scaling.z=i.distance*n);var a=this._convertNormalToDirectionOfRay(i.getNormal(),e),r=.002;if(a){var h=f.Cross(A.Y,a),u=f.Cross(a,h);f.RotationFromAxisToRef(u,a,h,t._gazeTracker.rotation)}t._gazeTracker.position.copyFrom(i.pickedPoint),t._gazeTracker.position.x<0?t._gazeTracker.position.x+=r:t._gazeTracker.position.x-=r,t._gazeTracker.position.y<0?t._gazeTracker.position.y+=r:t._gazeTracker.position.y-=r,t._gazeTracker.position.z<0?t._gazeTracker.position.z+=r:t._gazeTracker.position.z-=r}t._updatePointerDistance(i.distance)}else t._updatePointerDistance(),t._gazeTracker.isVisible=!1;if(i&&i.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(i.pickedMesh)&&i.pickedPoint){t._currentMeshSelected&&!this._isTeleportationFloor(t._currentMeshSelected)&&this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,t._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(i,t,e);return}if(i.pickedMesh!==t._currentMeshSelected)if(this.meshSelectionPredicate(i.pickedMesh)){this.onNewMeshPicked.notifyObservers(i),t._currentMeshSelected=i.pickedMesh,i.pickedMesh.isPickable&&i.pickedMesh.actionManager?(this.changeGazeColor(this._pickedGazeColor),this.changeLaserColor(this._pickedLaserColor),t._isActionableMesh=!0):(this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor),t._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(i.pickedMesh);var s=t;s.webVRController&&this.onMeshSelectedWithController.notifyObservers({mesh:i.pickedMesh,controller:s.webVRController})}catch(d){E.Warn("Error while raising onNewMeshSelected or onMeshSelectedWithController: "+d)}}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}},o.prototype._notifySelectedMeshUnselected=function(t){t&&this.onSelectedMeshUnselected.notifyObservers(t)},o.prototype.setLaserColor=function(t,e){e===void 0&&(e=this._pickedLaserColor),this._laserColor=t,this._pickedLaserColor=e},o.prototype.setLaserLightingState=function(t){t===void 0&&(t=!0),this._leftController&&this._leftController._setLaserPointerLightingDisabled(!t),this._rightController&&this._rightController._setLaserPointerLightingDisabled(!t)},o.prototype.setGazeColor=function(t,e){e===void 0&&(e=this._pickedGazeColor),this._gazeColor=t,this._pickedGazeColor=e},o.prototype.changeLaserColor=function(t){!this.updateControllerLaserColor||(this._leftController&&this._leftController._setLaserPointerColor(t),this._rightController&&this._rightController._setLaserPointerColor(t))},o.prototype.changeGazeColor=function(t){!this.updateGazeTrackerColor||!this._cameraGazer._gazeTracker.material||(this._cameraGazer._gazeTracker.material.emissiveColor=t,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=t),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=t))},o.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this.xr&&this.xr.dispose(),this._floorMeshesCollection.length=0,document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChangeBind),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.onmsfullscreenchange=null,this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChangedBind),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this._beforeRender)},o.prototype.getClassName=function(){return"VRExperienceHelper"},o.TELEPORTATIONMODE_CONSTANTTIME=0,o.TELEPORTATIONMODE_CONSTANTSPEED=1,o}();export{Se as A,m as C,ae as F,G as T,W as U,Qt as V,mt as a,dt as b,$ as c,V as d};
