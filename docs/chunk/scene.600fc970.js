import{_ as K,D as Z,O as g,I as _e,a as S,P as ye,f as me}from"./precisionDate.911053b8.js";import{T as k,a as Q,L as Me,R as Pe,b as Ce}from"./decorators.033fe02c.js";import{Vector3 as O,TmpVectors as w,Vector2 as F,Matrix as ve}from"./math.vector.dbc48609.js";import{V as R,P as Oe,I as J}from"./math.plane.3df9f77f.js";import{U as Ee,L as Te}from"./lightConstants.3b1d6040.js";import{E as W}from"./performanceConfigurator.3a0adc9f.js";import{P as V}from"./perfCounter.20926986.js";import{Color4 as Re,Color3 as $}from"./math.color.a4c793a9.js";var Xe=function(){function i(){}return i.NAME_EFFECTLAYER="EffectLayer",i.NAME_LAYER="Layer",i.NAME_LENSFLARESYSTEM="LensFlareSystem",i.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",i.NAME_PARTICLESYSTEM="ParticleSystem",i.NAME_GAMEPAD="Gamepad",i.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",i.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",i.NAME_PREPASSRENDERER="PrePassRenderer",i.NAME_DEPTHRENDERER="DepthRenderer",i.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",i.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",i.NAME_SPRITE="Sprite",i.NAME_SUBSURFACE="SubSurface",i.NAME_OUTLINERENDERER="Outline",i.NAME_PROCEDURALTEXTURE="ProceduralTexture",i.NAME_SHADOWGENERATOR="ShadowGenerator",i.NAME_OCTREE="Octree",i.NAME_PHYSICSENGINE="PhysicsEngine",i.NAME_AUDIO="Audio",i.STEP_ISREADYFORMESH_EFFECTLAYER=0,i.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,i.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,i.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,i.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,i.STEP_BEFORECAMERADRAW_PREPASS=0,i.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,i.STEP_BEFORECAMERADRAW_LAYER=2,i.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,i.STEP_BEFORERENDERTARGETDRAW_LAYER=1,i.STEP_BEFORERENDERINGMESH_PREPASS=0,i.STEP_BEFORERENDERINGMESH_OUTLINE=1,i.STEP_AFTERRENDERINGMESH_PREPASS=0,i.STEP_AFTERRENDERINGMESH_OUTLINE=1,i.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,i.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,i.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,i.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,i.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,i.STEP_BEFORECLEAR_PREPASS=1,i.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,i.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,i.STEP_AFTERRENDERTARGETDRAW_LAYER=1,i.STEP_AFTERCAMERADRAW_PREPASS=0,i.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,i.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,i.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,i.STEP_AFTERCAMERADRAW_LAYER=4,i.STEP_AFTERRENDER_AUDIO=0,i.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,i.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,i.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,i.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,i.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,i.STEP_POINTERMOVE_SPRITE=0,i.STEP_POINTERDOWN_SPRITE=0,i.STEP_POINTERUP_SPRITE=0,i}(),P=function(i){K(t,i);function t(e){return i.apply(this,e)||this}return t.Create=function(){return Object.create(t.prototype)},t.prototype.registerStep=function(e,r,n){for(var s=0,a=Number.MAX_VALUE;s<this.length;s++){var h=this[s];if(a=h.index,e<a)break}this.splice(s,0,{index:e,component:r,action:n.bind(r)})},t.prototype.clear=function(){this.length=0},t}(Array),B=function(){function i(t){this.length=0,this.data=new Array(t),this._id=i._GlobalId++}return i.prototype.push=function(t){this.data[this.length++]=t,this.length>this.data.length&&(this.data.length*=2)},i.prototype.forEach=function(t){for(var e=0;e<this.length;e++)t(this.data[e])},i.prototype.sort=function(t){this.data.sort(t)},i.prototype.reset=function(){this.length=0},i.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},i.prototype.concat=function(t){if(t.length!==0){this.length+t.length>this.data.length&&(this.data.length=(this.length+t.length)*2);for(var e=0;e<t.length;e++)this.data[this.length++]=(t.data||t)[e]}},i.prototype.indexOf=function(t){var e=this.data.indexOf(t);return e>=this.length?-1:e},i.prototype.contains=function(t){return this.indexOf(t)!==-1},i._GlobalId=0,i}(),x=function(i){K(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._duplicateId=0,e}return t.prototype.push=function(e){i.prototype.push.call(this,e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},t.prototype.pushNoDuplicate=function(e){return e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId?!1:(this.push(e),!0)},t.prototype.reset=function(){i.prototype.reset.call(this),this._duplicateId++},t.prototype.concatWithNoDuplicate=function(e){if(e.length!==0){this.length+e.length>this.data.length&&(this.data.length=(this.length+e.length)*2);for(var r=0;r<e.length;r++){var n=(e.data||e)[r];this.pushNoDuplicate(n)}}},t}(B),ee=function(){function i(){this._count=0,this._data={}}return i.prototype.copyFrom=function(t){var e=this;this.clear(),t.forEach(function(r,n){return e.add(r,n)})},i.prototype.get=function(t){var e=this._data[t];if(e!==void 0)return e},i.prototype.getOrAddWithFactory=function(t,e){var r=this.get(t);return r!==void 0||(r=e(t),r&&this.add(t,r)),r},i.prototype.getOrAdd=function(t,e){var r=this.get(t);return r!==void 0?r:(this.add(t,e),e)},i.prototype.contains=function(t){return this._data[t]!==void 0},i.prototype.add=function(t,e){return this._data[t]!==void 0?!1:(this._data[t]=e,++this._count,!0)},i.prototype.set=function(t,e){return this._data[t]===void 0?!1:(this._data[t]=e,!0)},i.prototype.getAndRemove=function(t){var e=this.get(t);return e!==void 0?(delete this._data[t],--this._count,e):null},i.prototype.remove=function(t){return this.contains(t)?(delete this._data[t],--this._count,!0):!1},i.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(i.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),i.prototype.forEach=function(t){for(var e in this._data){var r=this._data[e];t(e,r)}},i.prototype.first=function(t){for(var e in this._data){var r=this._data[e],n=t(e,r);if(n)return n}return null},i}(),Ae=function(){function i(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return i.AddParser=function(t,e){this._BabylonFileParsers[t]=e},i.GetParser=function(t){return this._BabylonFileParsers[t]?this._BabylonFileParsers[t]:null},i.AddIndividualParser=function(t,e){this._IndividualBabylonFileParsers[t]=e},i.GetIndividualParser=function(t){return this._IndividualBabylonFileParsers[t]?this._IndividualBabylonFileParsers[t]:null},i.Parse=function(t,e,r,n){for(var s in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,s)&&this._BabylonFileParsers[s](t,e,r,n)},Object.defineProperty(i.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(t){this._environmentTexture=t},enumerable:!1,configurable:!0}),i.prototype.getNodes=function(){var t=new Array;return t=t.concat(this.meshes),t=t.concat(this.lights),t=t.concat(this.cameras),t=t.concat(this.transformNodes),this.skeletons.forEach(function(e){return t=t.concat(e.bones)}),t},i._BabylonFileParsers={},i._IndividualBabylonFileParsers={},i}(),j=function(){function i(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}return i.prototype.getNormal=function(t,e){if(t===void 0&&(t=!1),e===void 0&&(e=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(R.NormalKind))return null;var r=this.pickedMesh.getIndices();if(!r)return null;var n;if(e){var s=this.pickedMesh.getVerticesData(R.NormalKind),a=O.FromArray(s,r[this.faceId*3]*3),h=O.FromArray(s,r[this.faceId*3+1]*3),o=O.FromArray(s,r[this.faceId*3+2]*3);a=a.scale(this.bu),h=h.scale(this.bv),o=o.scale(1-this.bu-this.bv),n=new O(a.x+h.x+o.x,a.y+h.y+o.y,a.z+h.z+o.z)}else{var l=this.pickedMesh.getVerticesData(R.PositionKind),u=O.FromArray(l,r[this.faceId*3]*3),c=O.FromArray(l,r[this.faceId*3+1]*3),f=O.FromArray(l,r[this.faceId*3+2]*3),p=u.subtract(c),v=f.subtract(c);n=O.Cross(p,v)}if(t){var b=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(w.Matrix[0].copyFrom(b),b=w.Matrix[0],b.setTranslationFromFloats(0,0,0),b.invert(),b.transposeToRef(w.Matrix[1]),b=w.Matrix[1]),n=O.TransformNormal(n,b)}return n.normalize(),n},i.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(R.UVKind))return null;var t=this.pickedMesh.getIndices();if(!t)return null;var e=this.pickedMesh.getVerticesData(R.UVKind);if(!e)return null;var r=F.FromArray(e,t[this.faceId*3]*2),n=F.FromArray(e,t[this.faceId*3+1]*2),s=F.FromArray(e,t[this.faceId*3+2]*2);return r=r.scale(this.bu),n=n.scale(this.bv),s=s.scale(1-this.bu-this.bv),new F(r.x+n.x+s.x,r.y+n.y+s.y)},i}(),E=function(){function i(t,e,r,n,s,a){this.source=t,this.pointerX=e,this.pointerY=r,this.meshUnderPointer=n,this.sourceEvent=s,this.additionalData=a}return i.CreateNew=function(t,e,r){var n=t.getScene();return new i(t,n.pointerX,n.pointerY,n.meshUnderPointer||t,e,r)},i.CreateNewFromSprite=function(t,e,r,n){return new i(t,e.pointerX,e.pointerY,e.meshUnderPointer,r,n)},i.CreateNewFromScene=function(t,e){return new i(null,t.pointerX,t.pointerY,t.meshUnderPointer,e)},i.CreateNewFromPrimitive=function(t,e,r,n){return new i(t,e.x,e.y,null,r,n)},i}(),te=function(){function i(t){this._vertexBuffers={},this._scene=t}return i.prototype._prepareBuffers=function(){if(!this._vertexBuffers[R.PositionKind]){var t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1),this._vertexBuffers[R.PositionKind]=new R(this._scene.getEngine(),t,R.PositionKind,!1,!1,2),this._buildIndexBuffer()}},i.prototype._buildIndexBuffer=function(){var t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(t)},i.prototype._rebuild=function(){var t=this._vertexBuffers[R.PositionKind];!t||(t._rebuild(),this._buildIndexBuffer())},i.prototype._prepareFrame=function(t,e){t===void 0&&(t=null),e===void 0&&(e=null);var r=this._scene.activeCamera;return!r||(e=e||r._postProcesses.filter(function(n){return n!=null}),!e||e.length===0||!this._scene.postProcessesEnabled)?!1:(e[0].activate(r,t,e!=null),!0)},i.prototype.directRender=function(t,e,r,n,s,a){var h;e===void 0&&(e=null),r===void 0&&(r=!1),n===void 0&&(n=0),s===void 0&&(s=0),a===void 0&&(a=!1);for(var o=this._scene.getEngine(),l=0;l<t.length;l++){l<t.length-1?t[l+1].activate(this._scene.activeCamera,e==null?void 0:e.texture):(e?o.bindFramebuffer(e,n,void 0,void 0,r,s):a||o.restoreDefaultFramebuffer(),(h=o._debugInsertMarker)===null||h===void 0||h.call(o,"post process ".concat(t[l].name," output")));var u=t[l],c=u.apply();c&&(u.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,c),o.drawElementsType(0,0,6),u.onAfterRenderObservable.notifyObservers(c))}o.setDepthBuffer(!0),o.setDepthWrite(!0)},i.prototype._finalizeFrame=function(t,e,r,n,s){var a;s===void 0&&(s=!1);var h=this._scene.activeCamera;if(!!h&&(n=n||h._postProcesses.filter(function(p){return p!=null}),!(n.length===0||!this._scene.postProcessesEnabled))){for(var o=this._scene.getEngine(),l=0,u=n.length;l<u;l++){var c=n[l];if(l<u-1?c._outputTexture=n[l+1].activate(h,e==null?void 0:e.texture):(e?(o.bindFramebuffer(e,r,void 0,void 0,s),c._outputTexture=e):(o.restoreDefaultFramebuffer(),c._outputTexture=null),(a=o._debugInsertMarker)===null||a===void 0||a.call(o,"post process ".concat(n[l].name," output"))),t)break;var f=c.apply();f&&(c.onBeforeRenderObservable.notifyObservers(f),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,f),o.drawElementsType(0,0,6),c.onAfterRenderObservable.notifyObservers(f))}o.setDepthBuffer(!0),o.setDepthWrite(!0),o.setAlphaMode(0)}},i.prototype.dispose=function(){var t=this._vertexBuffers[R.PositionKind];t&&(t.dispose(),this._vertexBuffers[R.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},i}(),De=function(){function i(t,e,r,n,s){r===void 0&&(r=null),n===void 0&&(n=null),s===void 0&&(s=null),this.index=t,this._opaqueSubMeshes=new B(256),this._transparentSubMeshes=new B(256),this._alphaTestSubMeshes=new B(256),this._depthOnlySubMeshes=new B(256),this._particleSystems=new B(256),this._spriteManagers=new B(256),this._empty=!0,this._edgesRenderers=new x(16),this._scene=e,this.opaqueSortCompareFn=r,this.alphaTestSortCompareFn=n,this.transparentSortCompareFn=s}return Object.defineProperty(i.prototype,"opaqueSortCompareFn",{set:function(t){t?this._opaqueSortCompareFn=t:this._opaqueSortCompareFn=i.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"alphaTestSortCompareFn",{set:function(t){t?this._alphaTestSortCompareFn=t:this._alphaTestSortCompareFn=i.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"transparentSortCompareFn",{set:function(t){t?this._transparentSortCompareFn=t:this._transparentSortCompareFn=i.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted},enumerable:!1,configurable:!0}),i.prototype.render=function(t,e,r,n){if(t){t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);return}var s=this._scene.getEngine();this._depthOnlySubMeshes.length!==0&&(s.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),s.setColorWrite(!0)),this._opaqueSubMeshes.length!==0&&this._renderOpaque(this._opaqueSubMeshes),this._alphaTestSubMeshes.length!==0&&this._renderAlphaTest(this._alphaTestSubMeshes);var a=s.getStencilBuffer();if(s.setStencilBuffer(!1),e&&this._renderSprites(),r&&this._renderParticles(n),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length!==0||this._scene.useOrderIndependentTransparency){if(s.setStencilBuffer(a),this._scene.useOrderIndependentTransparency){var h=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);h.length&&this._renderTransparent(h)}else this._renderTransparent(this._transparentSubMeshes);s.setAlphaMode(0)}if(s.setStencilBuffer(!1),this._edgesRenderers.length){for(var o=0;o<this._edgesRenderers.length;o++)this._edgesRenderers.data[o].render();s.setAlphaMode(0)}s.setStencilBuffer(a)},i.prototype._renderOpaqueSorted=function(t){return i._RenderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},i.prototype._renderAlphaTestSorted=function(t){return i._RenderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},i.prototype._renderTransparentSorted=function(t){return i._RenderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)},i._RenderSorted=function(t,e,r,n){var s=0,a,h=r?r.globalPosition:i._ZeroVector;if(n)for(;s<t.length;s++)a=t.data[s],a._alphaIndex=a.getMesh().alphaIndex,a._distanceToCamera=O.Distance(a.getBoundingInfo().boundingSphere.centerWorld,h);var o=t.length===t.data.length?t.data:t.data.slice(0,t.length);e&&o.sort(e);var l=o[0].getMesh().getScene();for(s=0;s<o.length;s++)if(a=o[s],!(l._activeMeshesFrozenButKeepClipping&&!a.isInFrustum(l._frustumPlanes))){if(n){var u=a.getMaterial();if(u&&u.needDepthPrePass){var c=u.getScene().getEngine();c.setColorWrite(!1),c.setAlphaMode(0),a.render(!1),c.setColorWrite(!0)}}a.render(n)}},i.defaultTransparentSortCompare=function(t,e){return t._alphaIndex>e._alphaIndex?1:t._alphaIndex<e._alphaIndex?-1:i.backToFrontSortCompare(t,e)},i.backToFrontSortCompare=function(t,e){return t._distanceToCamera<e._distanceToCamera?1:t._distanceToCamera>e._distanceToCamera?-1:0},i.frontToBackSortCompare=function(t,e){return t._distanceToCamera<e._distanceToCamera?-1:t._distanceToCamera>e._distanceToCamera?1:0},i.PainterSortCompare=function(t,e){var r=t.getMesh(),n=e.getMesh();return r.material&&n.material?r.material.uniqueId-n.material.uniqueId:r.uniqueId-n.uniqueId},i.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset(),this._empty=!0},i.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},i.prototype.dispatch=function(t,e,r){e===void 0&&(e=t.getMesh()),r===void 0&&(r=t.getMaterial()),r!=null&&(r.needAlphaBlendingForMesh(e)?this._transparentSubMeshes.push(t):r.needAlphaTesting()?(r.needDepthPrePass&&this._depthOnlySubMeshes.push(t),this._alphaTestSubMeshes.push(t)):(r.needDepthPrePass&&this._depthOnlySubMeshes.push(t),this._opaqueSubMeshes.push(t)),e._renderingGroup=this,e._edgesRenderer&&e._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(e._edgesRenderer),this._empty=!1)},i.prototype.dispatchSprites=function(t){this._spriteManagers.push(t),this._empty=!1},i.prototype.dispatchParticles=function(t){this._particleSystems.push(t),this._empty=!1},i.prototype._renderParticles=function(t){if(this._particleSystems.length!==0){var e=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var r=0;r<this._particleSystems.length;r++){var n=this._particleSystems.data[r];if((e&&e.layerMask&n.layerMask)!==0){var s=n.emitter;(!s.position||!t||t.indexOf(s)!==-1)&&this._scene._activeParticles.addCount(n.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},i.prototype._renderSprites=function(){if(!(!this._scene.spritesEnabled||this._spriteManagers.length===0)){var t=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var e=0;e<this._spriteManagers.length;e++){var r=this._spriteManagers.data[e];(t&&t.layerMask&r.layerMask)!==0&&r.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},i._ZeroVector=O.Zero(),i}(),Se=function(){function i(){}return i}(),we=function(){function i(t){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Se,this._scene=t;for(var e=i.MIN_RENDERINGGROUPS;e<i.MAX_RENDERINGGROUPS;e++)this._autoClearDepthStencil[e]={autoClear:!0,depth:!0,stencil:!0}}return i.prototype._clearDepthStencilBuffer=function(t,e){t===void 0&&(t=!0),e===void 0&&(e=!0),!this._depthStencilBufferAlreadyCleaned&&(this._scene.getEngine().clear(null,!1,t,e),this._depthStencilBufferAlreadyCleaned=!0)},i.prototype.render=function(t,e,r,n){var s=this._renderingGroupInfo;if(s.scene=this._scene,s.camera=this._scene.activeCamera,this._scene.spriteManagers&&n)for(var a=0;a<this._scene.spriteManagers.length;a++){var h=this._scene.spriteManagers[a];this.dispatchSprites(h)}for(var a=i.MIN_RENDERINGGROUPS;a<i.MAX_RENDERINGGROUPS;a++){this._depthStencilBufferAlreadyCleaned=a===i.MIN_RENDERINGGROUPS;var o=this._renderingGroups[a];if(!(!o||o._empty)){var l=Math.pow(2,a);if(s.renderingGroupId=a,this._scene.onBeforeRenderingGroupObservable.notifyObservers(s,l),i.AUTOCLEAR){var u=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(a):this._autoClearDepthStencil[a];u&&u.autoClear&&this._clearDepthStencilBuffer(u.depth,u.stencil)}for(var c=0,f=this._scene._beforeRenderingGroupDrawStage;c<f.length;c++){var p=f[c];p.action(a)}o.render(t,n,r,e);for(var v=0,b=this._scene._afterRenderingGroupDrawStage;v<b.length;v++){var p=b[v];p.action(a)}this._scene.onAfterRenderingGroupObservable.notifyObservers(s,l)}}},i.prototype.reset=function(){for(var t=i.MIN_RENDERINGGROUPS;t<i.MAX_RENDERINGGROUPS;t++){var e=this._renderingGroups[t];e&&e.prepare()}},i.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},i.prototype.freeRenderingGroups=function(){for(var t=i.MIN_RENDERINGGROUPS;t<i.MAX_RENDERINGGROUPS;t++){var e=this._renderingGroups[t];e&&e.dispose()}},i.prototype._prepareRenderingGroup=function(t){this._renderingGroups[t]===void 0&&(this._renderingGroups[t]=new De(t,this._scene,this._customOpaqueSortCompareFn[t],this._customAlphaTestSortCompareFn[t],this._customTransparentSortCompareFn[t]))},i.prototype.dispatchSprites=function(t){var e=t.renderingGroupId||0;this._prepareRenderingGroup(e),this._renderingGroups[e].dispatchSprites(t)},i.prototype.dispatchParticles=function(t){var e=t.renderingGroupId||0;this._prepareRenderingGroup(e),this._renderingGroups[e].dispatchParticles(t)},i.prototype.dispatch=function(t,e,r){e===void 0&&(e=t.getMesh());var n=e.renderingGroupId||0;this._prepareRenderingGroup(n),this._renderingGroups[n].dispatch(t,e,r)},i.prototype.setRenderingOrder=function(t,e,r,n){if(e===void 0&&(e=null),r===void 0&&(r=null),n===void 0&&(n=null),this._customOpaqueSortCompareFn[t]=e,this._customAlphaTestSortCompareFn[t]=r,this._customTransparentSortCompareFn[t]=n,this._renderingGroups[t]){var s=this._renderingGroups[t];s.opaqueSortCompareFn=this._customOpaqueSortCompareFn[t],s.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[t],s.transparentSortCompareFn=this._customTransparentSortCompareFn[t]}},i.prototype.setRenderingAutoClearDepthStencil=function(t,e,r,n){r===void 0&&(r=!0),n===void 0&&(n=!0),this._autoClearDepthStencil[t]={autoClear:e,depth:r,stencil:n}},i.prototype.getAutoClearDepthStencilSetup=function(t){return this._autoClearDepthStencil[t]},i.MAX_RENDERINGGROUPS=4,i.MIN_RENDERINGGROUPS=0,i.AUTOCLEAR=!0,i}(),y=function(){function i(){}return i.POINTERDOWN=1,i.POINTERUP=2,i.POINTERMOVE=4,i.POINTERWHEEL=8,i.POINTERPICK=16,i.POINTERTAP=32,i.POINTERDOUBLETAP=64,i}(),ge=function(){function i(t,e){this.type=t,this.event=e}return i}(),Be=function(i){K(t,i);function t(e,r,n,s){var a=i.call(this,e,r)||this;return a.ray=null,a.skipOnPointerObservable=!1,a.localPosition=new F(n,s),a}return t}(ge),Y=function(i){K(t,i);function t(e,r,n){var s=i.call(this,e,r)||this;return s.pickInfo=n,s}return t}(ge),q=function(){function i(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(i,"HasTriggers",{get:function(){for(var t in i.Triggers)if(Object.prototype.hasOwnProperty.call(i.Triggers,t))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(i,"HasPickTriggers",{get:function(){for(var t in i.Triggers)if(Object.prototype.hasOwnProperty.call(i.Triggers,t)){var e=parseInt(t);if(e>=1&&e<=7)return!0}return!1},enumerable:!1,configurable:!0}),i.HasSpecificTrigger=function(t){for(var e in i.Triggers)if(Object.prototype.hasOwnProperty.call(i.Triggers,e)){var r=parseInt(e);if(r===t)return!0}return!1},i.Triggers={},i}(),re=function(){function i(){}return i.KEYDOWN=1,i.KEYUP=2,i}(),H=function(){function i(t,e){this.type=t,this.event=e}return i}(),ie=function(i){K(t,i);function t(e,r){var n=i.call(this,e,r)||this;return n.type=e,n.event=r,n.skipOnKeyboardObservable=!1,n}return Object.defineProperty(t.prototype,"skipOnPointerObservable",{get:function(){return this.skipOnKeyboardObservable},set:function(e){this.skipOnKeyboardObservable=e},enumerable:!1,configurable:!0}),t}(H),d;(function(i){i[i.Generic=0]="Generic",i[i.Keyboard=1]="Keyboard",i[i.Mouse=2]="Mouse",i[i.Touch=3]="Touch",i[i.DualShock=4]="DualShock",i[i.Xbox=5]="Xbox",i[i.Switch=6]="Switch",i[i.DualSense=7]="DualSense"})(d||(d={}));var _;(function(i){i[i.Horizontal=0]="Horizontal",i[i.Vertical=1]="Vertical",i[i.LeftClick=2]="LeftClick",i[i.MiddleClick=3]="MiddleClick",i[i.RightClick=4]="RightClick",i[i.BrowserBack=5]="BrowserBack",i[i.BrowserForward=6]="BrowserForward",i[i.MouseWheelX=7]="MouseWheelX",i[i.MouseWheelY=8]="MouseWheelY",i[i.MouseWheelZ=9]="MouseWheelZ",i[i.Move=12]="Move"})(_||(_={}));var X;(function(i){i[i.Horizontal=0]="Horizontal",i[i.Vertical=1]="Vertical",i[i.LeftClick=2]="LeftClick",i[i.MiddleClick=3]="MiddleClick",i[i.RightClick=4]="RightClick",i[i.BrowserBack=5]="BrowserBack",i[i.BrowserForward=6]="BrowserForward",i[i.MouseWheelX=7]="MouseWheelX",i[i.MouseWheelY=8]="MouseWheelY",i[i.MouseWheelZ=9]="MouseWheelZ",i[i.DeltaHorizontal=10]="DeltaHorizontal",i[i.DeltaVertical=11]="DeltaVertical"})(X||(X={}));var ne;(function(i){i[i.Cross=0]="Cross",i[i.Circle=1]="Circle",i[i.Square=2]="Square",i[i.Triangle=3]="Triangle",i[i.L1=4]="L1",i[i.R1=5]="R1",i[i.L2=6]="L2",i[i.R2=7]="R2",i[i.Share=8]="Share",i[i.Options=9]="Options",i[i.L3=10]="L3",i[i.R3=11]="R3",i[i.DPadUp=12]="DPadUp",i[i.DPadDown=13]="DPadDown",i[i.DPadLeft=14]="DPadLeft",i[i.DPadRight=15]="DPadRight",i[i.Home=16]="Home",i[i.TouchPad=17]="TouchPad",i[i.LStickXAxis=18]="LStickXAxis",i[i.LStickYAxis=19]="LStickYAxis",i[i.RStickXAxis=20]="RStickXAxis",i[i.RStickYAxis=21]="RStickYAxis"})(ne||(ne={}));var se;(function(i){i[i.Cross=0]="Cross",i[i.Circle=1]="Circle",i[i.Square=2]="Square",i[i.Triangle=3]="Triangle",i[i.L1=4]="L1",i[i.R1=5]="R1",i[i.L2=6]="L2",i[i.R2=7]="R2",i[i.Create=8]="Create",i[i.Options=9]="Options",i[i.L3=10]="L3",i[i.R3=11]="R3",i[i.DPadUp=12]="DPadUp",i[i.DPadDown=13]="DPadDown",i[i.DPadLeft=14]="DPadLeft",i[i.DPadRight=15]="DPadRight",i[i.Home=16]="Home",i[i.TouchPad=17]="TouchPad",i[i.LStickXAxis=18]="LStickXAxis",i[i.LStickYAxis=19]="LStickYAxis",i[i.RStickXAxis=20]="RStickXAxis",i[i.RStickYAxis=21]="RStickYAxis"})(se||(se={}));var ae;(function(i){i[i.A=0]="A",i[i.B=1]="B",i[i.X=2]="X",i[i.Y=3]="Y",i[i.LB=4]="LB",i[i.RB=5]="RB",i[i.LT=6]="LT",i[i.RT=7]="RT",i[i.Back=8]="Back",i[i.Start=9]="Start",i[i.LS=10]="LS",i[i.RS=11]="RS",i[i.DPadUp=12]="DPadUp",i[i.DPadDown=13]="DPadDown",i[i.DPadLeft=14]="DPadLeft",i[i.DPadRight=15]="DPadRight",i[i.Home=16]="Home",i[i.LStickXAxis=17]="LStickXAxis",i[i.LStickYAxis=18]="LStickYAxis",i[i.RStickXAxis=19]="RStickXAxis",i[i.RStickYAxis=20]="RStickYAxis"})(ae||(ae={}));var oe;(function(i){i[i.B=0]="B",i[i.A=1]="A",i[i.Y=2]="Y",i[i.X=3]="X",i[i.L=4]="L",i[i.R=5]="R",i[i.ZL=6]="ZL",i[i.ZR=7]="ZR",i[i.Minus=8]="Minus",i[i.Plus=9]="Plus",i[i.LS=10]="LS",i[i.RS=11]="RS",i[i.DPadUp=12]="DPadUp",i[i.DPadDown=13]="DPadDown",i[i.DPadLeft=14]="DPadLeft",i[i.DPadRight=15]="DPadRight",i[i.Home=16]="Home",i[i.Capture=17]="Capture",i[i.LStickXAxis=18]="LStickXAxis",i[i.LStickYAxis=19]="LStickYAxis",i[i.RStickXAxis=20]="RStickXAxis",i[i.RStickYAxis=21]="RStickYAxis"})(oe||(oe={}));var he;(function(i){i[i.PointerMove=0]="PointerMove",i[i.PointerDown=1]="PointerDown",i[i.PointerUp=2]="PointerUp"})(he||(he={}));var Ne=function(){function i(){}return i.DOM_DELTA_PIXEL=0,i.DOM_DELTA_LINE=1,i.DOM_DELTA_PAGE=2,i}(),G=function(){function i(){}return i.CreateDeviceEvent=function(t,e,r,n,s,a){switch(t){case d.Keyboard:return this._CreateKeyboardEvent(r,n,s,a);case d.Mouse:if(r===_.MouseWheelX||r===_.MouseWheelY||r===_.MouseWheelZ)return this._CreateWheelEvent(t,e,r,n,s,a);case d.Touch:return this._CreatePointerEvent(t,e,r,n,s,a);default:throw"Unable to generate event for device ".concat(d[t])}},i._CreatePointerEvent=function(t,e,r,n,s,a){var h=this._CreateMouseEvent(t,e,r,n,s,a);return t===d.Mouse?(h.deviceType=d.Mouse,h.pointerId=1,h.pointerType="mouse"):(h.deviceType=d.Touch,h.pointerId=e,h.pointerType="touch"),r===_.Move?h.type="pointermove":r>=_.LeftClick&&r<=_.RightClick&&(h.type=n===1?"pointerdown":"pointerup",h.button=r-2),h},i._CreateWheelEvent=function(t,e,r,n,s,a){var h=this._CreateMouseEvent(t,e,r,n,s,a);switch(h.type="wheel",h.deltaMode=Ne.DOM_DELTA_PIXEL,h.deltaX=0,h.deltaY=0,h.deltaZ=0,r){case _.MouseWheelX:h.deltaX=n;break;case _.MouseWheelY:h.deltaY=n;break;case _.MouseWheelZ:h.deltaZ=n;break}return h},i._CreateMouseEvent=function(t,e,r,n,s,a){var h=this._CreateEvent(a),o=s.pollInput(t,e,_.Horizontal),l=s.pollInput(t,e,_.Vertical);return a?(h.movementX=0,h.movementY=0,h.offsetX=h.movementX-a.getBoundingClientRect().x,h.offsetY=h.movementY-a.getBoundingClientRect().y):(h.movementX=s.pollInput(t,e,X.DeltaHorizontal),h.movementY=s.pollInput(t,e,X.DeltaVertical),h.offsetX=0,h.offsetY=0),this._CheckNonCharacterKeys(h,s),h.clientX=o,h.clientY=l,h.x=o,h.y=l,h.deviceType=t,h.deviceSlot=e,h.inputIndex=r,h},i._CreateKeyboardEvent=function(t,e,r,n){var s=this._CreateEvent(n);return this._CheckNonCharacterKeys(s,r),s.deviceType=d.Keyboard,s.deviceSlot=0,s.inputIndex=t,s.type=e===1?"keydown":"keyup",s.key=String.fromCharCode(t),s.keyCode=t,s},i._CheckNonCharacterKeys=function(t,e){var r=e.isDeviceAvailable(d.Keyboard),n=r&&e.pollInput(d.Keyboard,0,18)===1,s=r&&e.pollInput(d.Keyboard,0,17)===1,a=r&&(e.pollInput(d.Keyboard,0,91)===1||e.pollInput(d.Keyboard,0,92)===1||e.pollInput(d.Keyboard,0,93)===1),h=r&&e.pollInput(d.Keyboard,0,16)===1;t.altKey=n,t.ctrlKey=s,t.metaKey=a,t.shiftKey=h},i._CreateEvent=function(t){var e={};return e.preventDefault=function(){},e.target=t,e},i}(),ke=function(){function i(t,e,r){var n=this;this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(t,e,function(s,a,h,o){var l=G.CreateDeviceEvent(s,a,h,o,n);r(s,a,l)}):this._createDummyNativeInput()}return i.prototype.pollInput=function(t,e,r){return this._nativeInput.pollInput(t,e,r)},i.prototype.isDeviceAvailable=function(t){return t===d.Mouse||t===d.Touch},i.prototype.dispose=function(){this._nativeInput.dispose()},i.prototype._createDummyNativeInput=function(){var t={pollInput:function(){return 0},isDeviceAvailable:function(){return!1},dispose:function(){}};return t},i}(),le=255,ue=Object.keys(_).length/2,Ie=function(){function i(t,e,r,n){var s=this;this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=k.IsSafari(),this._usingMacOS=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=function(a){},this._keyboardUpEvent=function(a){},this._keyboardBlurEvent=function(a){},this._pointerMoveEvent=function(a){},this._pointerDownEvent=function(a){},this._pointerUpEvent=function(a){},this._pointerCancelEvent=function(a){},this._pointerWheelEvent=function(a){},this._pointerBlurEvent=function(a){},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=Z.IsNavigatorAvailable()&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!==-1,this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=function(a){},this._gamepadDisconnectedEvent=function(a){},this._eventPrefix=k.GetPointerPrefix(t),this._engine=t,this._onDeviceConnected=e,this._onDeviceDisconnected=r,this._onInputChanged=n,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=function(){s._enableEvents()})}return i.prototype.pollInput=function(t,e,r){var n=this._inputs[t][e];if(!n)throw"Unable to find device ".concat(d[t]);t>=d.DualShock&&t<=d.DualSense&&this._updateDevice(t,e,r);var s=n[r];if(s===void 0)throw"Unable to find input ".concat(r," for device ").concat(d[t]," in slot ").concat(e);return r===_.Move&&k.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),s},i.prototype.isDeviceAvailable=function(t){return this._inputs[t]!==void 0},i.prototype.dispose=function(){this._onDeviceConnected=function(){},this._onDeviceDisconnected=function(){},this._onInputChanged=function(){},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()},i.prototype._enableEvents=function(){var t=this===null||this===void 0?void 0:this._engine.getInputElement();if(t&&(!this._eventsAttached||this._elementToAttachTo!==t)){if(this._disableEvents(),this._inputs)for(var e=0,r=this._inputs;e<r.length;e++){var n=r[e];if(n)for(var s in n){var a=+s,h=n[a];if(h)for(var o=0;o<h.length;o++)h[o]=0}}this._elementToAttachTo=t,this._elementToAttachTo.tabIndex=this._elementToAttachTo.tabIndex!==-1?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}},i.prototype._disableEvents=function(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1},i.prototype._checkForConnectedDevices=function(){if(navigator.getGamepads)for(var t=navigator.getGamepads(),e=0,r=t;e<r.length;e++){var n=r[e];n&&this._addGamePad(n)}typeof matchMedia=="function"&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(d.Mouse,0,0,0)},i.prototype._addGamePad=function(t){var e=this._getGamepadDeviceType(t.id),r=t.index;this._gamepads=this._gamepads||new Array(t.index+1),this._registerDevice(e,r,t.buttons.length+t.axes.length),this._gamepads[r]=e},i.prototype._addPointerDevice=function(t,e,r,n){this._pointerActive||(this._pointerActive=!0),this._registerDevice(t,e,ue);var s=this._inputs[t][e];s[0]=r,s[1]=n},i.prototype._registerDevice=function(t,e,r){if(e===void 0)throw"Unable to register device ".concat(d[t]," to undefined slot.");if(this._inputs[t]||(this._inputs[t]={}),!this._inputs[t][e]){for(var n=new Array(r),s=0;s<r;s++)n[s]=0;this._inputs[t][e]=n,this._onDeviceConnected(t,e)}},i.prototype._unregisterDevice=function(t,e){this._inputs[t][e]&&(delete this._inputs[t][e],this._onDeviceDisconnected(t,e))},i.prototype._handleKeyActions=function(){var t=this;this._keyboardDownEvent=function(e){t._keyboardActive||(t._keyboardActive=!0,t._registerDevice(d.Keyboard,0,le));var r=t._inputs[d.Keyboard][0];if(r){r[e.keyCode]=1;var n=e;n.inputIndex=e.keyCode,t._usingMacOS&&e.metaKey&&e.key!=="Meta"&&(t._metaKeys.includes(e.keyCode)||t._metaKeys.push(e.keyCode)),t._onInputChanged(d.Keyboard,0,n)}},this._keyboardUpEvent=function(e){t._keyboardActive||(t._keyboardActive=!0,t._registerDevice(d.Keyboard,0,le));var r=t._inputs[d.Keyboard][0];if(r){r[e.keyCode]=0;var n=e;if(n.inputIndex=e.keyCode,t._usingMacOS&&e.key==="Meta"&&t._metaKeys.length>0){for(var s=0,a=t._metaKeys;s<a.length;s++){var h=a[s],o=G.CreateDeviceEvent(d.Keyboard,0,h,0,t,t._elementToAttachTo);r[h]=0,t._onInputChanged(d.Keyboard,0,o)}t._metaKeys.splice(0,t._metaKeys.length)}t._onInputChanged(d.Keyboard,0,n)}},this._keyboardBlurEvent=function(){if(t._keyboardActive){for(var e=t._inputs[d.Keyboard][0],r=0;r<e.length;r++)if(e[r]!==0){e[r]=0;var n=G.CreateDeviceEvent(d.Keyboard,0,r,0,t,t._elementToAttachTo);t._onInputChanged(d.Keyboard,0,n)}t._usingMacOS&&t._metaKeys.splice(0,t._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)},i.prototype._handlePointerActions=function(){var t=this;this._maxTouchPoints=Z.IsNavigatorAvailable()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(var e=0;e<this._maxTouchPoints;e++)this._activeTouchIds[e]=-1;this._pointerMoveEvent=function(a){var h=t._getPointerType(a),o=h===d.Mouse?0:t._activeTouchIds.indexOf(a.pointerId);t._inputs[h]||(t._inputs[h]={}),t._inputs[h][o]||t._addPointerDevice(h,o,a.clientX,a.clientY);var l=t._inputs[h][o];if(l){l[_.Horizontal]=a.clientX,l[_.Vertical]=a.clientY;var u=a;u.inputIndex=_.Move,t._onInputChanged(h,o,u),!t._usingSafari&&a.button!==-1&&(u.inputIndex=a.button+2,l[a.button+2]=l[a.button+2]?0:1,t._onInputChanged(h,o,u))}},this._pointerDownEvent=function(a){var h=t._getPointerType(a),o=h===d.Mouse?0:a.pointerId;if(h===d.Touch){var l=t._activeTouchIds.indexOf(-1);if(l>=0)o=l,t._activeTouchIds[l]=a.pointerId;else{k.Warn("Max number of touches exceeded.  Ignoring touches in excess of ".concat(t._maxTouchPoints));return}}t._inputs[h]||(t._inputs[h]={}),t._inputs[h][o]?h===d.Touch&&t._onDeviceConnected(h,o):t._addPointerDevice(h,o,a.clientX,a.clientY);var u=t._inputs[h][o];if(u){var c=u[_.Horizontal],f=u[_.Vertical];if(h===d.Mouse){if(t._mouseId===-1&&(a.pointerId===void 0?t._mouseId=t._isUsingFirefox?0:1:t._mouseId=a.pointerId),!document.pointerLockElement)try{t._elementToAttachTo.setPointerCapture(t._mouseId)}catch{}}else if(a.pointerId&&!document.pointerLockElement)try{t._elementToAttachTo.setPointerCapture(a.pointerId)}catch{}u[_.Horizontal]=a.clientX,u[_.Vertical]=a.clientY,u[a.button+2]=1;var p=a;p.inputIndex=a.button+2,t._onInputChanged(h,o,p),(c!==a.clientX||f!==a.clientY)&&(p.inputIndex=_.Move,t._onInputChanged(h,o,p))}},this._pointerUpEvent=function(a){var h,o,l,u,c,f=t._getPointerType(a),p=f===d.Mouse?0:t._activeTouchIds.indexOf(a.pointerId);if(f===d.Touch){if(p===-1)return;t._activeTouchIds[p]=-1}var v=(h=t._inputs[f])===null||h===void 0?void 0:h[p];if(v&&v[a.button+2]!==0){var b=v[_.Horizontal],m=v[_.Vertical];v[_.Horizontal]=a.clientX,v[_.Vertical]=a.clientY,v[a.button+2]=0;var M=a;(b!==a.clientX||m!==a.clientY)&&(M.inputIndex=_.Move,t._onInputChanged(f,p,M)),M.inputIndex=a.button+2,f===d.Mouse&&t._mouseId>=0&&((l=(o=t._elementToAttachTo).hasPointerCapture)===null||l===void 0?void 0:l.call(o,t._mouseId))?t._elementToAttachTo.releasePointerCapture(t._mouseId):a.pointerId&&((c=(u=t._elementToAttachTo).hasPointerCapture)===null||c===void 0?void 0:c.call(u,a.pointerId))&&t._elementToAttachTo.releasePointerCapture(a.pointerId),t._onInputChanged(f,p,M),f===d.Touch&&t._onDeviceDisconnected(f,p)}},this._pointerCancelEvent=function(a){var h,o,l,u;if(a.pointerType==="mouse"){var c=t._inputs[d.Mouse][0];t._mouseId>=0&&((o=(h=t._elementToAttachTo).hasPointerCapture)===null||o===void 0?void 0:o.call(h,t._mouseId))&&t._elementToAttachTo.releasePointerCapture(t._mouseId);for(var f=_.LeftClick;f<=_.BrowserForward;f++)if(c[f]===1){c[f]=0;var p=G.CreateDeviceEvent(d.Mouse,0,f,0,t,t._elementToAttachTo);t._onInputChanged(d.Mouse,0,p)}}else{var v=t._activeTouchIds.indexOf(a.pointerId);!((u=(l=t._elementToAttachTo).hasPointerCapture)===null||u===void 0)&&u.call(l,a.pointerId)&&t._elementToAttachTo.releasePointerCapture(a.pointerId),t._inputs[d.Touch][v][_.LeftClick]=0;var p=G.CreateDeviceEvent(d.Touch,v,_.LeftClick,0,t,t._elementToAttachTo);t._onInputChanged(d.Touch,v,p),t._activeTouchIds[v]=-1,t._onDeviceDisconnected(d.Touch,v)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";var r=!1,n=function(){};try{var s=Object.defineProperty({},"passive",{get:function(){r=!0}});this._elementToAttachTo.addEventListener("test",n,s),this._elementToAttachTo.removeEventListener("test",n,s)}catch{}this._pointerBlurEvent=function(){var a,h,o,l,u;if(t.isDeviceAvailable(d.Mouse)){var c=t._inputs[d.Mouse][0];t._mouseId>=0&&((h=(a=t._elementToAttachTo).hasPointerCapture)===null||h===void 0?void 0:h.call(a,t._mouseId))&&t._elementToAttachTo.releasePointerCapture(t._mouseId);for(var f=_.LeftClick;f<=_.BrowserForward;f++)if(c[f]===1){c[f]=0;var p=G.CreateDeviceEvent(d.Mouse,0,f,0,t,t._elementToAttachTo);t._onInputChanged(d.Mouse,0,p)}}if(t.isDeviceAvailable(d.Touch))for(var c=t._inputs[d.Touch],v=0;v<t._activeTouchIds.length;v++){var b=t._activeTouchIds[v];if(!((l=(o=t._elementToAttachTo).hasPointerCapture)===null||l===void 0)&&l.call(o,b)&&t._elementToAttachTo.releasePointerCapture(b),b!==-1&&((u=c[v])===null||u===void 0?void 0:u[_.LeftClick])===1){c[v][_.LeftClick]=0;var p=G.CreateDeviceEvent(d.Touch,v,_.LeftClick,0,t,t._elementToAttachTo);t._onInputChanged(d.Touch,v,p),t._activeTouchIds[v]=-1,t._onDeviceDisconnected(d.Touch,v)}}},this._pointerWheelEvent=function(a){var h=d.Mouse,o=0;t._inputs[h]||(t._inputs[h]=[]),t._inputs[h][o]||(t._pointerActive=!0,t._registerDevice(h,o,ue));var l=t._inputs[h][o];if(l){l[_.MouseWheelX]=a.deltaX||0,l[_.MouseWheelY]=a.deltaY||a.wheelDelta||0,l[_.MouseWheelZ]=a.deltaZ||0;var u=a;l[_.MouseWheelX]!==0&&(u.inputIndex=_.MouseWheelX,t._onInputChanged(h,o,u)),l[_.MouseWheelY]!==0&&(u.inputIndex=_.MouseWheelY,t._onInputChanged(h,o,u)),l[_.MouseWheelZ]!==0&&(u.inputIndex=_.MouseWheelZ,t._onInputChanged(h,o,u))}},this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,r?{passive:!0}:!1),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add(function(){if(t.isDeviceAvailable(d.Mouse)){var a=t._inputs[d.Mouse][0];a[_.MouseWheelX]=0,a[_.MouseWheelY]=0,a[_.MouseWheelZ]=0}})},i.prototype._handleGamepadActions=function(){var t=this;this._gamepadConnectedEvent=function(e){t._addGamePad(e.gamepad)},this._gamepadDisconnectedEvent=function(e){if(t._gamepads){var r=t._getGamepadDeviceType(e.gamepad.id),n=e.gamepad.index;t._unregisterDevice(r,n),delete t._gamepads[n]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},i.prototype._updateDevice=function(t,e,r){var n=navigator.getGamepads()[e];if(n&&t===this._gamepads[e]){var s=this._inputs[t][e];r>=n.buttons.length?s[r]=n.axes[r-n.buttons.length].valueOf():s[r]=n.buttons[r].value}},i.prototype._getGamepadDeviceType=function(t){return t.indexOf("054c")!==-1?t.indexOf("0ce6")!==-1?d.DualSense:d.DualShock:t.indexOf("Xbox One")!==-1||t.search("Xbox 360")!==-1||t.search("xinput")!==-1?d.Xbox:t.indexOf("057e")!==-1?d.Switch:d.Generic},i.prototype._getPointerType=function(t){var e=d.Mouse;return(t.pointerType==="touch"||t.pointerType==="pen"||t.touches)&&(e=d.Touch),e},i}(),fe=function(){function i(t,e,r){r===void 0&&(r=0),this.deviceType=e,this.deviceSlot=r,this.onInputChangedObservable=new g,this._deviceInputSystem=t}return i.prototype.getInput=function(t){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,t)},i}(),Ue=function(){function i(t){var e=this;this._registeredManagers=new Array,this._refCount=0,this.registerManager=function(h){for(var o=0;o<e._devices.length;o++){var l=e._devices[o];for(var u in l){var c=+u;h._addDevice(new fe(e._deviceInputSystem,o,c))}}e._registeredManagers.push(h)},this.unregisterManager=function(h){var o=e._registeredManagers.indexOf(h);o>-1&&e._registeredManagers.splice(o,1)};var r=Object.keys(d).length/2;this._devices=new Array(r);var n=function(h,o){e._devices[h]||(e._devices[h]=new Array),e._devices[h][o]||(e._devices[h][o]=o);for(var l=0,u=e._registeredManagers;l<u.length;l++){var c=u[l],f=new fe(e._deviceInputSystem,h,o);c._addDevice(f)}},s=function(h,o){var l;!((l=e._devices[h])===null||l===void 0)&&l[o]&&delete e._devices[h][o];for(var u=0,c=e._registeredManagers;u<c.length;u++){var f=c[u];f._removeDevice(h,o)}},a=function(h,o,l){if(l)for(var u=0,c=e._registeredManagers;u<c.length;u++){var f=c[u];f._onInputChanged(h,o,l)}};typeof _native!="undefined"?this._deviceInputSystem=new ke(n,s,a):this._deviceInputSystem=new Ie(t,n,s,a)}return i.prototype.dispose=function(){this._deviceInputSystem.dispose()},i}(),Fe=function(){function i(t){var e=this,r=Object.keys(d).length/2;this._devices=new Array(r),this._firstDevice=new Array(r),this._engine=t,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new Ue(t)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new g(function(n){for(var s=0,a=e._devices;s<a.length;s++){var h=a[s];if(h)for(var o=0,l=h;o<l.length;o++){var u=l[o];u&&e.onDeviceConnectedObservable.notifyObserver(n,u)}}}),this.onDeviceDisconnectedObservable=new g,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=t.onDisposeObservable.add(function(){e.dispose()})}return i.prototype.getDeviceSource=function(t,e){if(e===void 0){if(this._firstDevice[t]===void 0)return null;e=this._firstDevice[t]}return!this._devices[t]||this._devices[t][e]===void 0?null:this._devices[t][e]},i.prototype.getDeviceSources=function(t){return this._devices[t].filter(function(e){return!!e})},i.prototype.dispose=function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)},i.prototype._addDevice=function(t){this._devices[t.deviceType]||(this._devices[t.deviceType]=new Array),this._devices[t.deviceType][t.deviceSlot]||(this._devices[t.deviceType][t.deviceSlot]=t,this._updateFirstDevices(t.deviceType)),this.onDeviceConnectedObservable.notifyObservers(t)},i.prototype._removeDevice=function(t,e){var r,n,s=(r=this._devices[t])===null||r===void 0?void 0:r[e];this.onDeviceDisconnectedObservable.notifyObservers(s),!((n=this._devices[t])===null||n===void 0)&&n[e]&&delete this._devices[t][e],this._updateFirstDevices(t)},i.prototype._onInputChanged=function(t,e,r){var n,s;(s=(n=this._devices[t])===null||n===void 0?void 0:n[e])===null||s===void 0||s.onInputChangedObservable.notifyObservers(r)},i.prototype._updateFirstDevices=function(t){switch(t){case d.Keyboard:case d.Mouse:this._firstDevice[t]=0;break;case d.Touch:case d.DualSense:case d.DualShock:case d.Xbox:case d.Switch:case d.Generic:{delete this._firstDevice[t];var e=this._devices[t];if(e){for(var r=0;r<e.length;r++)if(e[r]){this._firstDevice[t]=r;break}}break}}},i}(),ce=function(){function i(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(i.prototype,"singleClick",{get:function(){return this._singleClick},set:function(t){this._singleClick=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(t){this._doubleClick=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(t){this._hasSwiped=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ignore",{get:function(){return this._ignore},set:function(t){this._ignore=t},enumerable:!1,configurable:!0}),i}(),N=function(){function i(t){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new F(0,0),this._previousStartingPointerPosition=new F(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._deviceSourceManager=null,this._scene=t||W.LastCreatedScene,this._scene}return Object.defineProperty(i.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),i.prototype.getMeshUnderPointerByPointerId=function(t){return this._meshUnderPointerId[t]||null},Object.defineProperty(i.prototype,"unTranslatedPointer",{get:function(){return new F(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pointerX",{get:function(){return this._pointerX},set:function(t){this._pointerX=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pointerY",{get:function(){return this._pointerY},set:function(t){this._pointerY=t},enumerable:!1,configurable:!0}),i.prototype._updatePointerPosition=function(t){var e=this._scene.getEngine().getInputElementClientRect();!e||(this._pointerX=t.clientX-e.left,this._pointerY=t.clientY-e.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},i.prototype._processPointerMove=function(t,e){var r=this._scene,n=r.getEngine(),s=n.getInputElement();s&&(s.tabIndex=n.canvasTabIndex,r.doNotHandleCursors||(s.style.cursor=r.defaultCursor));var a=!!(t&&t.hit&&t.pickedMesh);if(a){if(r.setPointerOverMesh(t.pickedMesh,e.pointerId,t),!r.doNotHandleCursors&&s&&this._pointerOverMesh){var h=this._pointerOverMesh._getActionManagerForTrigger();h&&h.hasPointerTriggers&&(s.style.cursor=h.hoverCursor||r.hoverCursor)}}else r.setPointerOverMesh(null,e.pointerId,t);for(var o=0,l=r._pointerMoveStage;o<l.length;o++){var u=l[o];t=u.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,a,s)}if(t){var c=e.type==="wheel"||e.type==="mousewheel"||e.type==="DOMMouseScroll"?y.POINTERWHEEL:y.POINTERMOVE;if(r.onPointerMove&&r.onPointerMove(e,t,c),r.onPointerObservable.hasObservers()){var f=new Y(c,e,t);this._setRayOnPointerInfo(f),r.onPointerObservable.notifyObservers(f,c)}}},i.prototype._setRayOnPointerInfo=function(t){var e=this._scene;t.pickInfo&&!t.pickInfo._pickingUnavailable&&(t.pickInfo.ray||(t.pickInfo.ray=e.createPickingRay(t.event.offsetX,t.event.offsetY,ve.Identity(),e.activeCamera)))},i.prototype._checkPrePointerObservable=function(t,e,r){var n=this._scene,s=new Be(r,e,this._unTranslatedPointerX,this._unTranslatedPointerY);return t&&(s.ray=t.ray,t.originMesh&&(s.nearInteractionPickingInfo=t)),n.onPrePointerObservable.notifyObservers(s,r),!!s.skipOnPointerObservable},i.prototype.simulatePointerMove=function(t,e){var r=new PointerEvent("pointermove",e);r.inputIndex=_.Move,!this._checkPrePointerObservable(t,r,y.POINTERMOVE)&&this._processPointerMove(t,r)},i.prototype.simulatePointerDown=function(t,e){var r=new PointerEvent("pointerdown",e);r.inputIndex=r.button+2,!this._checkPrePointerObservable(t,r,y.POINTERDOWN)&&this._processPointerDown(t,r)},i.prototype._processPointerDown=function(t,e){var r=this,n=this._scene;if(t&&t.hit&&t.pickedMesh){this._pickedDownMesh=t.pickedMesh;var s=t.pickedMesh._getActionManagerForTrigger();if(s){if(s.hasPickTriggers)switch(s.processTrigger(5,E.CreateNew(t.pickedMesh,e)),e.button){case 0:s.processTrigger(2,E.CreateNew(t.pickedMesh,e));break;case 1:s.processTrigger(4,E.CreateNew(t.pickedMesh,e));break;case 2:s.processTrigger(3,E.CreateNew(t.pickedMesh,e));break}s.hasSpecificTrigger(8)&&window.setTimeout(function(){var c=n.pick(r._unTranslatedPointerX,r._unTranslatedPointerY,function(f){return f.isPickable&&f.isVisible&&f.isReady()&&f.actionManager&&f.actionManager.hasSpecificTrigger(8)&&f===r._pickedDownMesh},!1,n.cameraToUseForPointers);c&&c.hit&&c.pickedMesh&&s&&r._totalPointersPressed!==0&&Date.now()-r._startingPointerTime>i.LongPressDelay&&!r._isPointerSwiping()&&(r._startingPointerTime=0,s.processTrigger(8,E.CreateNew(c.pickedMesh,e)))},i.LongPressDelay)}}else for(var a=0,h=n._pointerDownStage;a<h.length;a++){var o=h[a];t=o.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,e)}if(t){var l=y.POINTERDOWN;if(n.onPointerDown&&n.onPointerDown(e,t,l),n.onPointerObservable.hasObservers()){var u=new Y(l,e,t);this._setRayOnPointerInfo(u),n.onPointerObservable.notifyObservers(u,l)}}},i.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>i.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>i.DragMovementThreshold},i.prototype.simulatePointerUp=function(t,e,r){var n=new PointerEvent("pointerup",e);n.inputIndex=_.Move;var s=new ce;r?s.doubleClick=!0:s.singleClick=!0,!this._checkPrePointerObservable(t,n,y.POINTERUP)&&this._processPointerUp(t,n,s)},i.prototype._processPointerUp=function(t,e,r){var n=this._scene;if(t&&t.hit&&t.pickedMesh){if(this._pickedUpMesh=t.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(n.onPointerPick&&n.onPointerPick(e,t),r.singleClick&&!r.ignore&&n.onPointerObservable.hasObservers())){var s=y.POINTERPICK,a=new Y(s,e,t);this._setRayOnPointerInfo(a),n.onPointerObservable.notifyObservers(a,s)}var h=t.pickedMesh._getActionManagerForTrigger();if(h&&!r.ignore){h.processTrigger(7,E.CreateNew(t.pickedMesh,e,t)),!r.hasSwiped&&r.singleClick&&h.processTrigger(1,E.CreateNew(t.pickedMesh,e,t));var o=t.pickedMesh._getActionManagerForTrigger(6);r.doubleClick&&o&&o.processTrigger(6,E.CreateNew(t.pickedMesh,e,t))}}else if(!r.ignore)for(var l=0,u=n._pointerUpStage;l<u.length;l++){var c=u[l];t=c.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,e)}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var f=this._pickedDownMesh._getActionManagerForTrigger(16);f&&f.processTrigger(16,E.CreateNew(this._pickedDownMesh,e))}var p=0;if(n.onPointerObservable.hasObservers()){if(!r.ignore&&!r.hasSwiped&&(r.singleClick&&n.onPointerObservable.hasSpecificMask(y.POINTERTAP)?p=y.POINTERTAP:r.doubleClick&&n.onPointerObservable.hasSpecificMask(y.POINTERDOUBLETAP)&&(p=y.POINTERDOUBLETAP),p)){var a=new Y(p,e,t);this._setRayOnPointerInfo(a),n.onPointerObservable.notifyObservers(a,p)}if(!r.ignore){p=y.POINTERUP;var a=new Y(p,e,t);this._setRayOnPointerInfo(a),n.onPointerObservable.notifyObservers(a,p)}}n.onPointerUp&&!r.ignore&&n.onPointerUp(e,t,p)},i.prototype.isPointerCaptured=function(t){return t===void 0&&(t=0),this._pointerCaptures[t]},i.prototype.attachControl=function(t,e,r,n){var s=this;t===void 0&&(t=!0),e===void 0&&(e=!0),r===void 0&&(r=!0),n===void 0&&(n=null);var a=this._scene,h=a.getEngine();n||(n=h.getInputElement()),this._alreadyAttached&&this.detachControl(),n&&(this._alreadyAttachedTo=n),this._deviceSourceManager=new Fe(h),this._initActionManager=function(o){if(!s._meshPickProceed){var l=a.skipPointerUpPicking?null:a.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,a.pointerUpPredicate,!1,a.cameraToUseForPointers);s._currentPickResult=l,l&&(o=l.hit&&l.pickedMesh?l.pickedMesh._getActionManagerForTrigger():null),s._meshPickProceed=!0}return o},this._delayedSimpleClick=function(o,l,u){(Date.now()-s._previousStartingPointerTime>i.DoubleClickDelay&&!s._doubleClickOccured||o!==s._previousButtonPressed)&&(s._doubleClickOccured=!1,l.singleClick=!0,l.ignore=!1,u(l,s._currentPickResult))},this._initClickEvent=function(o,l,u,c){var f=new ce;s._currentPickResult=null;var p=null,v=o.hasSpecificMask(y.POINTERPICK)||l.hasSpecificMask(y.POINTERPICK)||o.hasSpecificMask(y.POINTERTAP)||l.hasSpecificMask(y.POINTERTAP)||o.hasSpecificMask(y.POINTERDOUBLETAP)||l.hasSpecificMask(y.POINTERDOUBLETAP);!v&&q&&(p=s._initActionManager(p,f),p&&(v=p.hasPickTriggers));var b=!1;if(v){var m=u.button;if(f.hasSwiped=s._isPointerSwiping(),!f.hasSwiped){var M=!i.ExclusiveDoubleClickMode;M||(M=!o.hasSpecificMask(y.POINTERDOUBLETAP)&&!l.hasSpecificMask(y.POINTERDOUBLETAP),M&&!q.HasSpecificTrigger(6)&&(p=s._initActionManager(p,f),p&&(M=!p.hasSpecificTrigger(6)))),M?(Date.now()-s._previousStartingPointerTime>i.DoubleClickDelay||m!==s._previousButtonPressed)&&(f.singleClick=!0,c(f,s._currentPickResult),b=!0):(s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,s._delayedSimpleClickTimeout=window.setTimeout(s._delayedSimpleClick.bind(s,m,f,c),i.DoubleClickDelay));var T=o.hasSpecificMask(y.POINTERDOUBLETAP)||l.hasSpecificMask(y.POINTERDOUBLETAP);!T&&q.HasSpecificTrigger(6)&&(p=s._initActionManager(p,f),p&&(T=p.hasSpecificTrigger(6))),T&&(m===s._previousButtonPressed&&Date.now()-s._previousStartingPointerTime<i.DoubleClickDelay&&!s._doubleClickOccured?(!f.hasSwiped&&!s._isPointerSwiping()?(s._previousStartingPointerTime=0,s._doubleClickOccured=!0,f.doubleClick=!0,f.ignore=!1,i.ExclusiveDoubleClickMode&&s._previousDelayedSimpleClickTimeout&&clearTimeout(s._previousDelayedSimpleClickTimeout),s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,c(f,s._currentPickResult)):(s._doubleClickOccured=!1,s._previousStartingPointerTime=s._startingPointerTime,s._previousStartingPointerPosition.x=s._startingPointerPosition.x,s._previousStartingPointerPosition.y=s._startingPointerPosition.y,s._previousButtonPressed=m,i.ExclusiveDoubleClickMode?(s._previousDelayedSimpleClickTimeout&&clearTimeout(s._previousDelayedSimpleClickTimeout),s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,c(f,s._previousPickResult)):c(f,s._currentPickResult)),b=!0):(s._doubleClickOccured=!1,s._previousStartingPointerTime=s._startingPointerTime,s._previousStartingPointerPosition.x=s._startingPointerPosition.x,s._previousStartingPointerPosition.y=s._startingPointerPosition.y,s._previousButtonPressed=m))}}b||c(f,s._currentPickResult)},this._onPointerMove=function(o){if(o.pointerId===void 0&&(o.pointerId=0),s._updatePointerPosition(o),!s._checkPrePointerObservable(null,o,o.type==="wheel"||o.type==="mousewheel"||o.type==="DOMMouseScroll"?y.POINTERWHEEL:y.POINTERMOVE)&&!(!a.cameraToUseForPointers&&!a.activeCamera)){if(a.skipPointerMovePicking){s._processPointerMove(new j,o);return}a.pointerMovePredicate||(a.pointerMovePredicate=function(u){return u.isPickable&&u.isVisible&&u.isReady()&&u.isEnabled()&&(u.enablePointerMoveEvents||a.constantlyUpdateMeshUnderPointer||u._getActionManagerForTrigger()!==null)&&(!a.cameraToUseForPointers||(a.cameraToUseForPointers.layerMask&u.layerMask)!==0)});var l=a.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,a.pointerMovePredicate,!1,a.cameraToUseForPointers,a.pointerMoveTrianglePredicate);s._processPointerMove(l,o)}},this._onPointerDown=function(o){if(s._totalPointersPressed++,s._pickedDownMesh=null,s._meshPickProceed=!1,o.pointerId===void 0&&(o.pointerId=0),s._updatePointerPosition(o),a.preventDefaultOnPointerDown&&n&&(o.preventDefault(),n.focus()),s._startingPointerPosition.x=s._pointerX,s._startingPointerPosition.y=s._pointerY,s._startingPointerTime=Date.now(),!s._checkPrePointerObservable(null,o,y.POINTERDOWN)&&!(!a.cameraToUseForPointers&&!a.activeCamera)){s._pointerCaptures[o.pointerId]=!0,a.pointerDownPredicate||(a.pointerDownPredicate=function(u){return u.isPickable&&u.isVisible&&u.isReady()&&u.isEnabled()&&(!a.cameraToUseForPointers||(a.cameraToUseForPointers.layerMask&u.layerMask)!==0)}),s._pickedDownMesh=null;var l;a.skipPointerDownPicking?l=new j:l=a.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,a.pointerDownPredicate,!1,a.cameraToUseForPointers),s._processPointerDown(l,o)}},this._onPointerUp=function(o){s._totalPointersPressed!==0&&(s._totalPointersPressed--,s._pickedUpMesh=null,s._meshPickProceed=!1,o.pointerId===void 0&&(o.pointerId=0),s._updatePointerPosition(o),a.preventDefaultOnPointerUp&&n&&(o.preventDefault(),n.focus()),s._initClickEvent(a.onPrePointerObservable,a.onPointerObservable,o,function(l,u){a.onPrePointerObservable.hasObservers()&&!l.ignore&&(!l.hasSwiped&&(l.singleClick&&a.onPrePointerObservable.hasSpecificMask(y.POINTERTAP)&&s._checkPrePointerObservable(null,o,y.POINTERTAP)||l.doubleClick&&a.onPrePointerObservable.hasSpecificMask(y.POINTERDOUBLETAP)&&s._checkPrePointerObservable(null,o,y.POINTERDOUBLETAP))||s._checkPrePointerObservable(null,o,y.POINTERUP))||!s._pointerCaptures[o.pointerId]&&o.buttons>0||(s._pointerCaptures[o.pointerId]=!1,!(!a.cameraToUseForPointers&&!a.activeCamera)&&(a.pointerUpPredicate||(a.pointerUpPredicate=function(c){return c.isPickable&&c.isVisible&&c.isReady()&&c.isEnabled()&&(!a.cameraToUseForPointers||(a.cameraToUseForPointers.layerMask&c.layerMask)!==0)}),!s._meshPickProceed&&(q&&q.HasTriggers||a.onPointerObservable.hasObservers())&&s._initActionManager(null,l),u||(u=s._currentPickResult),s._processPointerUp(u,o,l),s._previousPickResult=s._currentPickResult))}))},this._onKeyDown=function(o){var l=re.KEYDOWN;if(a.onPreKeyboardObservable.hasObservers()){var u=new ie(l,o);if(a.onPreKeyboardObservable.notifyObservers(u,l),u.skipOnKeyboardObservable)return}if(a.onKeyboardObservable.hasObservers()){var u=new H(l,o);a.onKeyboardObservable.notifyObservers(u,l)}a.actionManager&&a.actionManager.processTrigger(14,E.CreateNewFromScene(a,o))},this._onKeyUp=function(o){var l=re.KEYUP;if(a.onPreKeyboardObservable.hasObservers()){var u=new ie(l,o);if(a.onPreKeyboardObservable.notifyObservers(u,l),u.skipOnKeyboardObservable)return}if(a.onKeyboardObservable.hasObservers()){var u=new H(l,o);a.onKeyboardObservable.notifyObservers(u,l)}a.actionManager&&a.actionManager.processTrigger(15,E.CreateNewFromScene(a,o))},this._deviceSourceManager.onDeviceConnectedObservable.add(function(o){o.deviceType===d.Mouse?o.onInputChangedObservable.add(function(l){l.inputIndex===_.LeftClick||l.inputIndex===_.MiddleClick||l.inputIndex===_.RightClick?e&&o.getInput(l.inputIndex)===1?s._onPointerDown(l):t&&o.getInput(l.inputIndex)===0&&s._onPointerUp(l):r&&(l.inputIndex===_.Move||l.inputIndex===_.MouseWheelX||l.inputIndex===_.MouseWheelY||l.inputIndex===_.MouseWheelZ)&&s._onPointerMove(l)}):o.deviceType===d.Touch?o.onInputChangedObservable.add(function(l){l.inputIndex===_.LeftClick&&(e&&o.getInput(l.inputIndex)===1?s._onPointerDown(l):t&&o.getInput(l.inputIndex)===0&&s._onPointerUp(l)),r&&l.inputIndex===_.Move&&s._onPointerMove(l)}):o.deviceType===d.Keyboard&&o.onInputChangedObservable.add(function(l){l.type==="keydown"?s._onKeyDown(l):l.type==="keyup"&&s._onKeyUp(l)})}),this._alreadyAttached=!0},i.prototype.detachControl=function(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)},i.prototype.setPointerOverMesh=function(t,e,r){if(e===void 0&&(e=0),this._meshUnderPointerId[e]!==t){var n=this._meshUnderPointerId[e],s;n&&(s=n._getActionManagerForTrigger(10),s&&s.processTrigger(10,E.CreateNew(n,void 0,{pointerId:e}))),t?(this._meshUnderPointerId[e]=t,this._pointerOverMesh=t,s=t._getActionManagerForTrigger(9),s&&s.processTrigger(9,E.CreateNew(t,void 0,{pointerId:e,pickResult:r}))):(delete this._meshUnderPointerId[e],this._pointerOverMesh=null)}},i.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},i.prototype._invalidateMesh=function(t){this._pointerOverMesh===t&&(this._pointerOverMesh=null),this._pickedDownMesh===t&&(this._pickedDownMesh=null),this._pickedUpMesh===t&&(this._pickedUpMesh=null);for(var e in this._meshUnderPointerId)this._meshUnderPointerId[e]===t&&delete this._meshUnderPointerId[e]},i.DragMovementThreshold=10,i.LongPressDelay=500,i.DoubleClickDelay=300,i.ExclusiveDoubleClickMode=!1,i}(),de=function(){function i(){}return i.GetPlanes=function(t){for(var e=[],r=0;r<6;r++)e.push(new Oe(0,0,0,0));return i.GetPlanesToRef(t,e),e},i.GetNearPlaneToRef=function(t,e){var r=t.m;e.normal.x=r[3]+r[2],e.normal.y=r[7]+r[6],e.normal.z=r[11]+r[10],e.d=r[15]+r[14],e.normalize()},i.GetFarPlaneToRef=function(t,e){var r=t.m;e.normal.x=r[3]-r[2],e.normal.y=r[7]-r[6],e.normal.z=r[11]-r[10],e.d=r[15]-r[14],e.normalize()},i.GetLeftPlaneToRef=function(t,e){var r=t.m;e.normal.x=r[3]+r[0],e.normal.y=r[7]+r[4],e.normal.z=r[11]+r[8],e.d=r[15]+r[12],e.normalize()},i.GetRightPlaneToRef=function(t,e){var r=t.m;e.normal.x=r[3]-r[0],e.normal.y=r[7]-r[4],e.normal.z=r[11]-r[8],e.d=r[15]-r[12],e.normalize()},i.GetTopPlaneToRef=function(t,e){var r=t.m;e.normal.x=r[3]-r[1],e.normal.y=r[7]-r[5],e.normal.z=r[11]-r[9],e.d=r[15]-r[13],e.normalize()},i.GetBottomPlaneToRef=function(t,e){var r=t.m;e.normal.x=r[3]+r[1],e.normal.y=r[7]+r[5],e.normal.z=r[11]+r[9],e.d=r[15]+r[13],e.normalize()},i.GetPlanesToRef=function(t,e){i.GetNearPlaneToRef(t,e[0]),i.GetFarPlaneToRef(t,e[1]),i.GetLeftPlaneToRef(t,e[2]),i.GetRightPlaneToRef(t,e[3]),i.GetTopPlaneToRef(t,e[4]),i.GetBottomPlaneToRef(t,e[5])},i}(),Le=function(){function i(){}return Object.defineProperty(i,"UniqueId",{get:function(){var t=this._UniqueIdCounter;return this._UniqueIdCounter++,t},enumerable:!1,configurable:!0}),i._UniqueIdCounter=1,i}(),pe=function(){function i(t,e){i.IsAvailable&&(this._observer=new window.ComputePressureObserver(t,e))}return Object.defineProperty(i,"IsAvailable",{get:function(){return _e()&&"ComputePressureObserver"in window},enumerable:!1,configurable:!0}),i.prototype.observe=function(){var t,e;!((t=this._observer)===null||t===void 0)&&t.observe&&((e=this._observer)===null||e===void 0||e.observe().catch(function(){}))},i.prototype.unobserve=function(){var t,e;!((t=this._observer)===null||t===void 0)&&t.unobserve&&((e=this._observer)===null||e===void 0||e.unobserve())},i}(),C=function(i){K(t,i);function t(e,r){var n=i.call(this)||this;n._inputManager=new N(n),n.cameraToUseForPointers=null,n._isScene=!0,n._blockEntityCollection=!1,n.autoClear=!0,n.autoClearDepthAndStencil=!0,n.clearColor=new Re(.2,.2,.3,1),n.ambientColor=new $(0,0,0),n.environmentIntensity=1,n._forceWireframe=!1,n._skipFrustumClipping=!1,n._forcePointsCloud=!1,n.animationsEnabled=!0,n._animationPropertiesOverride=null,n.useConstantAnimationDeltaTime=!1,n.constantlyUpdateMeshUnderPointer=!1,n.hoverCursor="pointer",n.defaultCursor="",n.doNotHandleCursors=!1,n.preventDefaultOnPointerDown=!0,n.preventDefaultOnPointerUp=!0,n.metadata=null,n.reservedDataStore=null,n.disableOfflineSupportExceptionRules=new Array,n.onDisposeObservable=new g,n._onDisposeObserver=null,n.onBeforeRenderObservable=new g,n._onBeforeRenderObserver=null,n.onAfterRenderObservable=new g,n.onAfterRenderCameraObservable=new g,n._onAfterRenderObserver=null,n.onBeforeAnimationsObservable=new g,n.onAfterAnimationsObservable=new g,n.onBeforeDrawPhaseObservable=new g,n.onAfterDrawPhaseObservable=new g,n.onReadyObservable=new g,n.onBeforeCameraRenderObservable=new g,n._onBeforeCameraRenderObserver=null,n.onAfterCameraRenderObservable=new g,n._onAfterCameraRenderObserver=null,n.onBeforeActiveMeshesEvaluationObservable=new g,n.onAfterActiveMeshesEvaluationObservable=new g,n.onBeforeParticlesRenderingObservable=new g,n.onAfterParticlesRenderingObservable=new g,n.onDataLoadedObservable=new g,n.onNewCameraAddedObservable=new g,n.onCameraRemovedObservable=new g,n.onNewLightAddedObservable=new g,n.onLightRemovedObservable=new g,n.onNewGeometryAddedObservable=new g,n.onGeometryRemovedObservable=new g,n.onNewTransformNodeAddedObservable=new g,n.onTransformNodeRemovedObservable=new g,n.onNewMeshAddedObservable=new g,n.onMeshRemovedObservable=new g,n.onNewSkeletonAddedObservable=new g,n.onSkeletonRemovedObservable=new g,n.onNewMaterialAddedObservable=new g,n.onNewMultiMaterialAddedObservable=new g,n.onMaterialRemovedObservable=new g,n.onMultiMaterialRemovedObservable=new g,n.onNewTextureAddedObservable=new g,n.onTextureRemovedObservable=new g,n.onBeforeRenderTargetsRenderObservable=new g,n.onAfterRenderTargetsRenderObservable=new g,n.onBeforeStepObservable=new g,n.onAfterStepObservable=new g,n.onActiveCameraChanged=new g,n.onBeforeRenderingGroupObservable=new g,n.onAfterRenderingGroupObservable=new g,n.onMeshImportedObservable=new g,n.onAnimationFileImportedObservable=new g,n._registeredForLateAnimationBindings=new x(256),n.skipPointerMovePicking=!1,n.skipPointerDownPicking=!1,n.skipPointerUpPicking=!1,n.onPrePointerObservable=new g,n.onPointerObservable=new g,n.onPreKeyboardObservable=new g,n.onKeyboardObservable=new g,n._useRightHandedSystem=!1,n._timeAccumulator=0,n._currentStepId=0,n._currentInternalStep=0,n._fogEnabled=!0,n._fogMode=t.FOGMODE_NONE,n.fogColor=new $(.2,.2,.3),n.fogDensity=.1,n.fogStart=0,n.fogEnd=1e3,n.needsPreviousWorldMatrices=!1,n._shadowsEnabled=!0,n._lightsEnabled=!0,n.activeCameras=new Array,n._texturesEnabled=!0,n.physicsEnabled=!0,n.particlesEnabled=!0,n.spritesEnabled=!0,n._skeletonsEnabled=!0,n.lensFlaresEnabled=!0,n.collisionsEnabled=!0,n.gravity=new O(0,-9.807,0),n.postProcessesEnabled=!0,n.renderTargetsEnabled=!0,n.dumpNextRenderTargets=!1,n.customRenderTargets=new Array,n.importedMeshesFiles=new Array,n.probesEnabled=!0,n._meshesForIntersections=new x(256),n.proceduralTexturesEnabled=!0,n._totalVertices=new V,n._activeIndices=new V,n._activeParticles=new V,n._activeBones=new V,n._animationTime=0,n.animationTimeScale=1,n._renderId=0,n._frameId=0,n._executeWhenReadyTimeoutId=null,n._intermediateRendering=!1,n._defaultFrameBufferCleared=!1,n._viewUpdateFlag=-1,n._projectionUpdateFlag=-1,n._toBeDisposed=new Array(256),n._activeRequests=new Array,n._pendingData=new Array,n._isDisposed=!1,n.dispatchAllSubMeshesOfActiveMeshes=!1,n._activeMeshes=new B(256),n._processedMaterials=new B(256),n._renderTargets=new x(256),n._materialsRenderTargets=new x(256),n._activeParticleSystems=new B(256),n._activeSkeletons=new x(32),n._softwareSkinnedMeshes=new x(32),n._activeAnimatables=new Array,n._transformMatrix=ve.Zero(),n.requireLightSorting=!1,n._components=[],n._serializableComponents=[],n._transientComponents=[],n._beforeCameraUpdateStage=P.Create(),n._beforeClearStage=P.Create(),n._beforeRenderTargetClearStage=P.Create(),n._gatherRenderTargetsStage=P.Create(),n._gatherActiveCameraRenderTargetsStage=P.Create(),n._isReadyForMeshStage=P.Create(),n._beforeEvaluateActiveMeshStage=P.Create(),n._evaluateSubMeshStage=P.Create(),n._preActiveMeshStage=P.Create(),n._cameraDrawRenderTargetStage=P.Create(),n._beforeCameraDrawStage=P.Create(),n._beforeRenderTargetDrawStage=P.Create(),n._beforeRenderingGroupDrawStage=P.Create(),n._beforeRenderingMeshStage=P.Create(),n._afterRenderingMeshStage=P.Create(),n._afterRenderingGroupDrawStage=P.Create(),n._afterCameraDrawStage=P.Create(),n._afterRenderTargetDrawStage=P.Create(),n._afterRenderStage=P.Create(),n._pointerMoveStage=P.Create(),n._pointerDownStage=P.Create(),n._pointerUpStage=P.Create(),n._geometriesByUniqueId=null,n._defaultMeshCandidates={data:[],length:0},n._defaultSubMeshCandidates={data:[],length:0},n._preventFreeActiveMeshesAndRenderingGroups=!1,n._activeMeshesFrozen=!1,n._activeMeshesFrozenButKeepClipping=!1,n._skipEvaluateActiveMeshesCompletely=!1,n._allowPostProcessClearColor=!0,n.getDeterministicFrameTime=function(){return n._engine.getTimeStep()},n._blockMaterialDirtyMechanism=!1,n._perfCollector=null,n.onComputePressureChanged=new g;var s=me({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},r);return n._engine=e||W.LastCreatedEngine,s.virtual?n._engine._virtualScenes.push(n):(W._LastCreatedScene=n,n._engine.scenes.push(n)),n._uid=null,n._renderingManager=new we(n),te&&(n.postProcessManager=new te(n)),_e()&&n.attachControl(),n._createUbo(),J&&(n._imageProcessingConfiguration=new J),n.setDefaultCandidateProviders(),s.useGeometryUniqueIdsMap&&(n._geometriesByUniqueId={}),n.useMaterialMeshMap=s.useMaterialMeshMap,n.useClonedMeshMap=s.useClonedMeshMap,(!r||!r.virtual)&&n._engine.onNewSceneAddedObservable.notifyObservers(n),pe.IsAvailable&&(n._computePressureObserver=new pe(function(a){n.onComputePressureChanged.notifyObservers(a)},{cpuUtilizationThresholds:[.25,.5,.75,.9],cpuSpeedThresholds:[.5]}),n._computePressureObserver.observe()),n}return t.DefaultMaterialFactory=function(e){throw S("StandardMaterial")},t.CollisionCoordinatorFactory=function(){throw S("DefaultCollisionCoordinator")},Object.defineProperty(t.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DragMovementThreshold",{get:function(){return N.DragMovementThreshold},set:function(e){N.DragMovementThreshold=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LongPressDelay",{get:function(){return N.LongPressDelay},set:function(e){N.LongPressDelay=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DoubleClickDelay",{get:function(){return N.DoubleClickDelay},set:function(e){N.DoubleClickDelay=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ExclusiveDoubleClickMode",{get:function(){return N.ExclusiveDoubleClickMode},set:function(e){N.ExclusiveDoubleClickMode=e},enumerable:!1,configurable:!0}),t.prototype.bindEyePosition=function(e,r,n){var s;r===void 0&&(r="vEyePosition"),n===void 0&&(n=!1);var a=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(s=this.activeCamera.globalPosition)!==null&&s!==void 0?s:this.activeCamera.devicePosition,h=this.useRightHandedSystem===(this._mirroredCameraPosition!=null);return w.Vector4[0].set(a.x,a.y,a.z,h?-1:1),e&&(n?e.setFloat3(r,w.Vector4[0].x,w.Vector4[0].y,w.Vector4[0].z):e.setVector4(r,w.Vector4[0])),w.Vector4[0]},t.prototype.finalizeSceneUbo=function(){var e=this.getSceneUniformBuffer(),r=this.bindEyePosition(null);return e.updateFloat4("vEyePosition",r.x,r.y,r.z,r.w),e.update(),e},Object.defineProperty(t.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),t.prototype.setStepId=function(e){this._currentStepId=e},t.prototype.getStepId=function(){return this._currentStepId},t.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(t.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fogMode",{get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"prePass",{get:function(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=t.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=t.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),t.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var e=0,r=this._transientComponents;e<r.length;e++){var n=r[e];n.register()}this._transientComponents=[]}},t.prototype._addComponent=function(e){this._components.push(e),this._transientComponents.push(e);var r=e;r.addFromContainer&&r.serialize&&this._serializableComponents.push(r)},t.prototype._getComponent=function(e){for(var r=0,n=this._components;r<n.length;r++){var s=n[r];if(s.name===e)return s}return null},t.prototype.getClassName=function(){return"Scene"},t.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},t.prototype._getDefaultSubMeshCandidates=function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates},t.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(t.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(e){this._inputManager.pointerX=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(e){this._inputManager.pointerY=e},enumerable:!1,configurable:!0}),t.prototype.getCachedMaterial=function(){return this._cachedMaterial},t.prototype.getCachedEffect=function(){return this._cachedEffect},t.prototype.getCachedVisibility=function(){return this._cachedVisibility},t.prototype.isCachedMaterialInvalid=function(e,r,n){return n===void 0&&(n=1),this._cachedEffect!==r||this._cachedMaterial!==e||this._cachedVisibility!==n},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(t.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),t.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(t.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),t.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(t.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),t.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(t.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getAnimationRatio=function(){return this._animationRatio!==void 0?this._animationRatio:1},t.prototype.getRenderId=function(){return this._renderId},t.prototype.getFrameId=function(){return this._frameId},t.prototype.incrementRenderId=function(){this._renderId++},t.prototype._createUbo=function(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())},t.prototype.simulatePointerMove=function(e,r){return this._inputManager.simulatePointerMove(e,r),this},t.prototype.simulatePointerDown=function(e,r){return this._inputManager.simulatePointerDown(e,r),this},t.prototype.simulatePointerUp=function(e,r,n){return this._inputManager.simulatePointerUp(e,r,n),this},t.prototype.isPointerCaptured=function(e){return e===void 0&&(e=0),this._inputManager.isPointerCaptured(e)},t.prototype.attachControl=function(e,r,n){e===void 0&&(e=!0),r===void 0&&(r=!0),n===void 0&&(n=!0),this._inputManager.attachControl(e,r,n)},t.prototype.detachControl=function(){this._inputManager.detachControl()},t.prototype.isReady=function(e){if(e===void 0&&(e=!0),this._isDisposed)return!1;var r,n=this.getEngine(),s=!0;for(this._pendingData.length>0&&(s=!1),e&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),r=0;r<this.meshes.length;r++){var a=this.meshes[r];if(!(!a.subMeshes||a.subMeshes.length===0)){if(!a.isReady(!0)){s=!1;continue}for(var h=a.hasThinInstances||a.getClassName()==="InstancedMesh"||a.getClassName()==="InstancedLinesMesh"||n.getCaps().instancedArrays&&a.instances.length>0,o=0,l=this._isReadyForMeshStage;o<l.length;o++){var u=l[o];u.action(a,h)||(s=!1)}if(!!e){var c=a.material||this.defaultMaterial;if(c)if(c._storeEffectOnSubMeshes)for(var f=0,p=a.subMeshes;f<p.length;f++){var v=p[f],b=v.getMaterial();b&&b.hasRenderTargetTextures&&b.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(b)===-1&&(this._processedMaterials.push(b),this._materialsRenderTargets.concatWithNoDuplicate(b.getRenderTargetTextures()))}else c.hasRenderTargetTextures&&c.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(c)===-1&&(this._processedMaterials.push(c),this._materialsRenderTargets.concatWithNoDuplicate(c.getRenderTargetTextures()))}}}if(!s||!n.areAllEffectsReady())return!1;if(e)for(r=0;r<this._materialsRenderTargets.length;++r){var m=this._materialsRenderTargets.data[r];if(!m.isReadyForRendering())return!1}for(r=0;r<this.geometries.length;r++){var M=this.geometries[r];if(M.delayLoadState===2)return!1}if(this.activeCameras&&this.activeCameras.length>0)for(var T=0,D=this.activeCameras;T<D.length;T++){var L=D[T];if(!L.isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var A=0,I=this.particleSystems;A<I.length;A++){var U=I[A];if(!U.isReady())return!1}return!0},t.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},t.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},t.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},t.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},t.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},t.prototype._executeOnceBeforeRender=function(e){var r=this,n=function(){e(),setTimeout(function(){r.unregisterBeforeRender(n)})};this.registerBeforeRender(n)},t.prototype.executeOnceBeforeRender=function(e,r){var n=this;r!==void 0?setTimeout(function(){n._executeOnceBeforeRender(e)},r):this._executeOnceBeforeRender(e)},t.prototype._addPendingData=function(e){this._pendingData.push(e)},t.prototype._removePendingData=function(e){var r=this.isLoading,n=this._pendingData.indexOf(e);n!==-1&&this._pendingData.splice(n,1),r&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!1,configurable:!0}),t.prototype.executeWhenReady=function(e,r){r===void 0&&(r=!1),this.onReadyObservable.add(e),this._executeWhenReadyTimeoutId===null&&this._checkIsReady(r)},t.prototype.whenReadyAsync=function(e){var r=this;return e===void 0&&(e=!1),new Promise(function(n){r.executeWhenReady(function(){n()},e)})},t.prototype._checkIsReady=function(e){var r=this;if(e===void 0&&(e=!1),this._registerTransientComponents(),this.isReady(e)){this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=null;return}if(this._isDisposed){this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=null;return}this._executeWhenReadyTimeoutId=setTimeout(function(){r._checkIsReady(e)},100)},Object.defineProperty(t.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),t.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=ye.Now},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(e,r,n,s){!n&&!s&&this._multiviewSceneUbo&&(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),!(this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===r.updateFlag)&&(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=r.updateFlag,this._viewMatrix=e,this._projectionMatrix=r,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?de.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=de.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(n,s):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))},t.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},t.prototype.createSceneUniformBuffer=function(e){var r=new Ee(this._engine,void 0,!1,e!=null?e:"scene");return r.addUniform("viewProjection",16),r.addUniform("view",16),r.addUniform("projection",16),r.addUniform("vEyePosition",4),r},t.prototype.setSceneUniformBuffer=function(e){this._sceneUbo=e,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1},t.prototype.getUniqueId=function(){return Le.UniqueId},t.prototype.addMesh=function(e,r){var n=this;r===void 0&&(r=!1),!this._blockEntityCollection&&(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),r&&e.getChildMeshes().forEach(function(s){n.addMesh(s)}))},t.prototype.removeMesh=function(e,r){var n=this;r===void 0&&(r=!1);var s=this.meshes.indexOf(e);return s!==-1&&(this.meshes[s]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(e),this.onMeshRemovedObservable.notifyObservers(e),r&&e.getChildMeshes().forEach(function(a){n.removeMesh(a)}),s},t.prototype.addTransformNode=function(e){this._blockEntityCollection||e.getScene()===this&&e._indexInSceneTransformNodesArray!==-1||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))},t.prototype.removeTransformNode=function(e){var r=e._indexInSceneTransformNodesArray;if(r!==-1){if(r!==this.transformNodes.length-1){var n=this.transformNodes[this.transformNodes.length-1];this.transformNodes[r]=n,n._indexInSceneTransformNodesArray=r}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),r},t.prototype.removeSkeleton=function(e){var r=this.skeletons.indexOf(e);return r!==-1&&(this.skeletons.splice(r,1),this.onSkeletonRemovedObservable.notifyObservers(e),this._executeActiveContainerCleanup(this._activeSkeletons)),r},t.prototype.removeMorphTargetManager=function(e){var r=this.morphTargetManagers.indexOf(e);return r!==-1&&this.morphTargetManagers.splice(r,1),r},t.prototype.removeLight=function(e){var r=this.lights.indexOf(e);if(r!==-1){for(var n=0,s=this.meshes;n<s.length;n++){var a=s[n];a._removeLightSource(e,!1)}this.lights.splice(r,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),r},t.prototype.removeCamera=function(e){var r=this.cameras.indexOf(e);if(r!==-1&&(this.cameras.splice(r,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras){var n=this.activeCameras.indexOf(e);n!==-1&&this.activeCameras.splice(n,1)}return this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),r},t.prototype.removeParticleSystem=function(e){var r=this.particleSystems.indexOf(e);return r!==-1&&(this.particleSystems.splice(r,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),r},t.prototype.removeAnimation=function(e){var r=this.animations.indexOf(e);return r!==-1&&this.animations.splice(r,1),r},t.prototype.stopAnimation=function(e,r,n){},t.prototype.removeAnimationGroup=function(e){var r=this.animationGroups.indexOf(e);return r!==-1&&this.animationGroups.splice(r,1),r},t.prototype.removeMultiMaterial=function(e){var r=this.multiMaterials.indexOf(e);return r!==-1&&this.multiMaterials.splice(r,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),r},t.prototype.removeMaterial=function(e){var r=e._indexInSceneMaterialArray;if(r!==-1&&r<this.materials.length){if(r!==this.materials.length-1){var n=this.materials[this.materials.length-1];this.materials[r]=n,n._indexInSceneMaterialArray=r}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),r},t.prototype.removeActionManager=function(e){var r=this.actionManagers.indexOf(e);return r!==-1&&this.actionManagers.splice(r,1),r},t.prototype.removeTexture=function(e){var r=this.textures.indexOf(e);return r!==-1&&this.textures.splice(r,1),this.onTextureRemovedObservable.notifyObservers(e),r},t.prototype.addLight=function(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(var r=0,n=this.meshes;r<n.length;r++){var s=n[r];s.lightSources.indexOf(e)===-1&&(s.lightSources.push(e),s._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(e)}},t.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(Te.CompareLightsPriority)},t.prototype.addCamera=function(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())},t.prototype.addSkeleton=function(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))},t.prototype.addParticleSystem=function(e){this._blockEntityCollection||this.particleSystems.push(e)},t.prototype.addAnimation=function(e){this._blockEntityCollection||this.animations.push(e)},t.prototype.addAnimationGroup=function(e){this._blockEntityCollection||this.animationGroups.push(e)},t.prototype.addMultiMaterial=function(e){this._blockEntityCollection||(this.multiMaterials.push(e),this.onNewMultiMaterialAddedObservable.notifyObservers(e))},t.prototype.addMaterial=function(e){this._blockEntityCollection||e.getScene()===this&&e._indexInSceneMaterialArray!==-1||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))},t.prototype.addMorphTargetManager=function(e){this._blockEntityCollection||this.morphTargetManagers.push(e)},t.prototype.addGeometry=function(e){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))},t.prototype.addActionManager=function(e){this.actionManagers.push(e)},t.prototype.addTexture=function(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))},t.prototype.switchActiveCamera=function(e,r){r===void 0&&(r=!0);var n=this._engine.getInputElement();!n||(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,r&&e.attachControl())},t.prototype.setActiveCameraById=function(e){var r=this.getCameraById(e);return r?(this.activeCamera=r,r):null},t.prototype.setActiveCameraByName=function(e){var r=this.getCameraByName(e);return r?(this.activeCamera=r,r):null},t.prototype.getAnimationGroupByName=function(e){for(var r=0;r<this.animationGroups.length;r++)if(this.animationGroups[r].name===e)return this.animationGroups[r];return null},t.prototype.getMaterialByUniqueID=function(e){for(var r=0;r<this.materials.length;r++)if(this.materials[r].uniqueId===e)return this.materials[r];return null},t.prototype.getMaterialById=function(e){for(var r=0;r<this.materials.length;r++)if(this.materials[r].id===e)return this.materials[r];return null},t.prototype.getLastMaterialById=function(e,r){r===void 0&&(r=!1);for(var n=this.materials.length-1;n>=0;n--)if(this.materials[n].id===e)return this.materials[n];if(r){for(var n=this.multiMaterials.length-1;n>=0;n--)if(this.multiMaterials[n].id===e)return this.multiMaterials[n]}return null},t.prototype.getMaterialByName=function(e){for(var r=0;r<this.materials.length;r++)if(this.materials[r].name===e)return this.materials[r];return null},t.prototype.getTextureByUniqueId=function(e){for(var r=0;r<this.textures.length;r++)if(this.textures[r].uniqueId===e)return this.textures[r];return null},t.prototype.getTextureByName=function(e){for(var r=0;r<this.textures.length;r++)if(this.textures[r].name===e)return this.textures[r];return null},t.prototype.getCameraById=function(e){for(var r=0;r<this.cameras.length;r++)if(this.cameras[r].id===e)return this.cameras[r];return null},t.prototype.getCameraByUniqueId=function(e){for(var r=0;r<this.cameras.length;r++)if(this.cameras[r].uniqueId===e)return this.cameras[r];return null},t.prototype.getCameraByName=function(e){for(var r=0;r<this.cameras.length;r++)if(this.cameras[r].name===e)return this.cameras[r];return null},t.prototype.getBoneById=function(e){for(var r=0;r<this.skeletons.length;r++)for(var n=this.skeletons[r],s=0;s<n.bones.length;s++)if(n.bones[s].id===e)return n.bones[s];return null},t.prototype.getBoneByName=function(e){for(var r=0;r<this.skeletons.length;r++)for(var n=this.skeletons[r],s=0;s<n.bones.length;s++)if(n.bones[s].name===e)return n.bones[s];return null},t.prototype.getLightByName=function(e){for(var r=0;r<this.lights.length;r++)if(this.lights[r].name===e)return this.lights[r];return null},t.prototype.getLightById=function(e){for(var r=0;r<this.lights.length;r++)if(this.lights[r].id===e)return this.lights[r];return null},t.prototype.getLightByUniqueId=function(e){for(var r=0;r<this.lights.length;r++)if(this.lights[r].uniqueId===e)return this.lights[r];return null},t.prototype.getParticleSystemById=function(e){for(var r=0;r<this.particleSystems.length;r++)if(this.particleSystems[r].id===e)return this.particleSystems[r];return null},t.prototype.getGeometryById=function(e){for(var r=0;r<this.geometries.length;r++)if(this.geometries[r].id===e)return this.geometries[r];return null},t.prototype._getGeometryByUniqueId=function(e){if(this._geometriesByUniqueId){var r=this._geometriesByUniqueId[e];if(r!==void 0)return this.geometries[r]}else for(var r=0;r<this.geometries.length;r++)if(this.geometries[r].uniqueId===e)return this.geometries[r];return null},t.prototype.pushGeometry=function(e,r){return!r&&this._getGeometryByUniqueId(e.uniqueId)?!1:(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)},t.prototype.removeGeometry=function(e){var r;if(this._geometriesByUniqueId){if(r=this._geometriesByUniqueId[e.uniqueId],r===void 0)return!1}else if(r=this.geometries.indexOf(e),r<0)return!1;if(r!==this.geometries.length-1){var n=this.geometries[this.geometries.length-1];n&&(this.geometries[r]=n,this._geometriesByUniqueId&&(this._geometriesByUniqueId[n.uniqueId]=r,this._geometriesByUniqueId[e.uniqueId]=void 0))}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0},t.prototype.getGeometries=function(){return this.geometries},t.prototype.getMeshById=function(e){for(var r=0;r<this.meshes.length;r++)if(this.meshes[r].id===e)return this.meshes[r];return null},t.prototype.getMeshesById=function(e){return this.meshes.filter(function(r){return r.id===e})},t.prototype.getTransformNodeById=function(e){for(var r=0;r<this.transformNodes.length;r++)if(this.transformNodes[r].id===e)return this.transformNodes[r];return null},t.prototype.getTransformNodeByUniqueId=function(e){for(var r=0;r<this.transformNodes.length;r++)if(this.transformNodes[r].uniqueId===e)return this.transformNodes[r];return null},t.prototype.getTransformNodesById=function(e){return this.transformNodes.filter(function(r){return r.id===e})},t.prototype.getMeshByUniqueId=function(e){for(var r=0;r<this.meshes.length;r++)if(this.meshes[r].uniqueId===e)return this.meshes[r];return null},t.prototype.getLastMeshById=function(e){for(var r=this.meshes.length-1;r>=0;r--)if(this.meshes[r].id===e)return this.meshes[r];return null},t.prototype.getLastEntryById=function(e){var r;for(r=this.meshes.length-1;r>=0;r--)if(this.meshes[r].id===e)return this.meshes[r];for(r=this.transformNodes.length-1;r>=0;r--)if(this.transformNodes[r].id===e)return this.transformNodes[r];for(r=this.cameras.length-1;r>=0;r--)if(this.cameras[r].id===e)return this.cameras[r];for(r=this.lights.length-1;r>=0;r--)if(this.lights[r].id===e)return this.lights[r];return null},t.prototype.getNodeById=function(e){var r=this.getMeshById(e);if(r)return r;var n=this.getTransformNodeById(e);if(n)return n;var s=this.getLightById(e);if(s)return s;var a=this.getCameraById(e);if(a)return a;var h=this.getBoneById(e);return h||null},t.prototype.getNodeByName=function(e){var r=this.getMeshByName(e);if(r)return r;var n=this.getTransformNodeByName(e);if(n)return n;var s=this.getLightByName(e);if(s)return s;var a=this.getCameraByName(e);if(a)return a;var h=this.getBoneByName(e);return h||null},t.prototype.getMeshByName=function(e){for(var r=0;r<this.meshes.length;r++)if(this.meshes[r].name===e)return this.meshes[r];return null},t.prototype.getTransformNodeByName=function(e){for(var r=0;r<this.transformNodes.length;r++)if(this.transformNodes[r].name===e)return this.transformNodes[r];return null},t.prototype.getLastSkeletonById=function(e){for(var r=this.skeletons.length-1;r>=0;r--)if(this.skeletons[r].id===e)return this.skeletons[r];return null},t.prototype.getSkeletonByUniqueId=function(e){for(var r=0;r<this.skeletons.length;r++)if(this.skeletons[r].uniqueId===e)return this.skeletons[r];return null},t.prototype.getSkeletonById=function(e){for(var r=0;r<this.skeletons.length;r++)if(this.skeletons[r].id===e)return this.skeletons[r];return null},t.prototype.getSkeletonByName=function(e){for(var r=0;r<this.skeletons.length;r++)if(this.skeletons[r].name===e)return this.skeletons[r];return null},t.prototype.getMorphTargetManagerById=function(e){for(var r=0;r<this.morphTargetManagers.length;r++)if(this.morphTargetManagers[r].uniqueId===e)return this.morphTargetManagers[r];return null},t.prototype.getMorphTargetById=function(e){for(var r=0;r<this.morphTargetManagers.length;++r)for(var n=this.morphTargetManagers[r],s=0;s<n.numTargets;++s){var a=n.getTarget(s);if(a.id===e)return a}return null},t.prototype.getMorphTargetByName=function(e){for(var r=0;r<this.morphTargetManagers.length;++r)for(var n=this.morphTargetManagers[r],s=0;s<n.numTargets;++s){var a=n.getTarget(s);if(a.name===e)return a}return null},t.prototype.getPostProcessByName=function(e){for(var r=0;r<this.postProcesses.length;++r){var n=this.postProcesses[r];if(n.name===e)return n}return null},t.prototype.isActiveMesh=function(e){return this._activeMeshes.indexOf(e)!==-1},Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid||(this._uid=k.RandomId()),this._uid},enumerable:!1,configurable:!0}),t.prototype.addExternalData=function(e,r){return this._externalData||(this._externalData=new ee),this._externalData.add(e,r)},t.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},t.prototype.getOrAddExternalDataWithFactory=function(e,r){return this._externalData||(this._externalData=new ee),this._externalData.getOrAddWithFactory(e,r)},t.prototype.removeExternalData=function(e){return this._externalData.remove(e)},t.prototype._evaluateSubMesh=function(e,r,n){if(n.hasInstances||n.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||r.alwaysSelectAsActiveMesh||r.subMeshes.length===1||e.isInFrustum(this._frustumPlanes)){for(var s=0,a=this._evaluateSubMeshStage;s<a.length;s++){var h=a[s];h.action(r,e)}var o=e.getMaterial();o!=null&&(o.hasRenderTargetTextures&&o.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(o)===-1&&(this._processedMaterials.push(o),this._materialsRenderTargets.concatWithNoDuplicate(o.getRenderTargetTextures())),this._renderingManager.dispatch(e,r,o))}},t.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(t.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)},enumerable:!1,configurable:!0}),t.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var e=0;e<this.activeCameras.length;e++){var r=this.activeCameras[e];r&&r._activeMeshes&&r._activeMeshes.dispose()}},t.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var e=0;e<this.textures.length;e++){var r=this.textures[e];r&&r.renderList&&r.freeRenderingGroups()}},t.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},t.prototype.freezeActiveMeshes=function(e,r,n,s,a){var h=this;return e===void 0&&(e=!1),s===void 0&&(s=!0),a===void 0&&(a=!1),this.executeWhenReady(function(){if(!h.activeCamera){n&&n("No active camera found");return}if(h._frustumPlanes||h.updateTransformMatrix(),h._evaluateActiveMeshes(),h._activeMeshesFrozen=!0,h._activeMeshesFrozenButKeepClipping=a,h._skipEvaluateActiveMeshesCompletely=e,s)for(var o=0;o<h._activeMeshes.length;o++)h._activeMeshes.data[o]._freeze();r&&r()}),this},t.prototype.unfreezeActiveMeshes=function(){for(var e=0;e<this.meshes.length;e++){var r=this.meshes[e];r._internalAbstractMeshDataInfo&&(r._internalAbstractMeshDataInfo._isActive=!1)}for(var e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this},t.prototype._executeActiveContainerCleanup=function(e){var r=this._engine.snapshotRendering&&this._engine.snapshotRenderingMode===1;!r&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce(function(){return e.dispose()})},t.prototype._evaluateActiveMeshes=function(){var e;if(this._engine.snapshotRendering&&this._engine.snapshotRenderingMode===1){this._activeMeshes.length>0&&((e=this.activeCamera)===null||e===void 0||e._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset());return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var r=this._activeMeshes.length,n=0;n<r;n++){var s=this._activeMeshes.data[n];s.computeWorldMatrix()}if(this._activeParticleSystems)for(var a=this._activeParticleSystems.length,n=0;n<a;n++)this._activeParticleSystems.data[n].animate();return}if(!!this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(var h=0,o=this._beforeEvaluateActiveMeshStage;h<o.length;h++){var l=o[h];l.action()}for(var u=this.getActiveMeshCandidates(),c=u.length,n=0;n<c;n++){var s=u.data[n];if(s._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!s.isBlocked&&(this._totalVertices.addCount(s.getTotalVertices(),!1),!(!s.isReady()||!s.isEnabled()||s.scaling.hasAZeroComponent))){s.computeWorldMatrix(),s.actionManager&&s.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(s);var f=this.customLODSelector?this.customLODSelector(s,this.activeCamera):s.getLOD(this.activeCamera);if(s._internalAbstractMeshDataInfo._currentLOD=f,s._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,f!=null&&(f!==s&&f.billboardMode!==0&&f.computeWorldMatrix(),s._preActivate(),s.isVisible&&s.visibility>0&&(s.layerMask&this.activeCamera.layerMask)!==0&&(this._skipFrustumClipping||s.alwaysSelectAsActiveMesh||s.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(s),this.activeCamera._activeMeshes.push(s),f!==s&&f._activate(this._renderId,!1);for(var p=0,v=this._preActiveMeshStage;p<v.length;p++){var l=v[p];l.action(s)}s._activate(this._renderId,!1)&&(s.isAnInstance?s._internalAbstractMeshDataInfo._actAsRegularMesh&&(f=s):f._internalAbstractMeshDataInfo._onlyForInstances=!1,f._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(s,f)),s._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var b=0;b<this.particleSystems.length;b++){var m=this.particleSystems[b];if(!(!m.isStarted()||!m.emitter)){var M=m.emitter;(!M.position||M.isEnabled())&&(this._activeParticleSystems.push(m),m.animate(),this._renderingManager.dispatchParticles(m))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},t.prototype._activeMesh=function(e,r){if(this._skeletonsEnabled&&r.skeleton!==null&&r.skeleton!==void 0&&(this._activeSkeletons.pushNoDuplicate(r.skeleton)&&(r.skeleton.prepare(),this._activeBones.addCount(r.skeleton.bones.length,!1)),r.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(r)),r&&r.subMeshes&&r.subMeshes.length>0)for(var n=this.getActiveSubMeshCandidates(r),s=n.length,a=0;a<s;a++){var h=n.data[a];this._evaluateSubMesh(h,r,e)}},t.prototype.updateTransformMatrix=function(e){if(!!this.activeCamera)if(this.activeCamera._renderingMultiview){var r=this.activeCamera._rigCameras[0],n=this.activeCamera._rigCameras[1];this.setTransformMatrix(r.getViewMatrix(),r.getProjectionMatrix(e),n.getViewMatrix(),n.getProjectionMatrix(e))}else this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},t.prototype._bindFrameBuffer=function(e,r){r===void 0&&(r=!0),e&&e._multiviewTexture?e._multiviewTexture._bindFrameBuffer():e&&e.outputRenderTarget?e.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),r&&this._clearFrameBuffer(e)},t.prototype._clearFrameBuffer=function(e){if(!(e&&e._multiviewTexture))if(e&&e.outputRenderTarget){var r=e.outputRenderTarget;r.onClearObservable.hasObservers()?r.onClearObservable.notifyObservers(this._engine):r.skipInitialClear||(this._engine.clear(r.clearColor||this.clearColor,!r._cleared,!0,!0),r._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())},t.prototype._renderForCamera=function(e,r,n){var s,a,h;if(n===void 0&&(n=!0),!(e&&e._skipRendering)){var o=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");if(o.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&n){var l=!0;e._renderingMultiview&&e.outputRenderTarget&&(l=e.outputRenderTarget.skipInitialClear,this.autoClear&&(e.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),e._renderingMultiview&&e.outputRenderTarget&&(e.outputRenderTarget.skipInitialClear=l)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var u=0;u<this._softwareSkinnedMeshes.length;u++){var c=this._softwareSkinnedMeshes.data[u];c.applySkeleton(c.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),r&&r.customRenderTargets&&r.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(r.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(var f=0,p=this._gatherActiveCameraRenderTargetsStage;f<p.length;f++){var v=p[f];v.action(this._renderTargets)}var b=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){k.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var m=0;m<this._renderTargets.length;m++){var M=this._renderTargets.data[m];if(M._shouldRender()){this._renderId++;var T=M.activeCamera&&M.activeCamera!==this.activeCamera;M.render(T,this.dumpNextRenderTargets),b=!0}}k.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var D=0,L=this._cameraDrawRenderTargetStage;D<L.length;D++){var v=L[D];b=v.action(this.activeCamera)||b}this._intermediateRendering=!1}this._engine.currentRenderPassId=(h=(a=(s=e.outputRenderTarget)===null||s===void 0?void 0:s.renderPassId)!==null&&a!==void 0?a:e.renderPassId)!==null&&h!==void 0?h:0,b&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!e._multiviewTexture&&!this.prePass&&this.postProcessManager._prepareFrame();for(var A=0,I=this._beforeCameraDrawStage;A<I.length;A++){var v=I[A];v.action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),o.snapshotRendering&&o.snapshotRenderingMode===1&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var U=0,z=this._afterCameraDrawStage;U<z.length;U++){var v=z[U];v.action(this.activeCamera)}if(this.postProcessManager&&!e._multiviewTexture){var be=e.outputRenderTarget?e.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(e.isIntermediate,be)}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},t.prototype._processSubCameras=function(e,r){if(r===void 0&&(r=!0),e.cameraRigMode===0||e._renderingMultiview){e._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(e,void 0,r),this.onAfterRenderCameraObservable.notifyObservers(e);return}if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else{this.onBeforeCameraRenderObservable.notifyObservers(e);for(var n=0;n<e._rigCameras.length;n++)this._renderForCamera(e._rigCameras[n],e)}this._activeCamera=e,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(e)},t.prototype._checkIntersections=function(){for(var e=0;e<this._meshesForIntersections.length;e++){var r=this._meshesForIntersections.data[e];if(!!r.actionManager)for(var n=function(a){var h=r.actionManager.actions[a];if(h.trigger===12||h.trigger===13){var o=h.getTriggerParameter(),l=o.mesh?o.mesh:o,u=l.intersectsMesh(r,o.usePreciseIntersection),c=r._intersectionsInProgress.indexOf(l);u&&c===-1?h.trigger===12?(h._executeCurrent(E.CreateNew(r,void 0,l)),r._intersectionsInProgress.push(l)):h.trigger===13&&r._intersectionsInProgress.push(l):!u&&c>-1&&(h.trigger===13&&h._executeCurrent(E.CreateNew(r,void 0,l)),(!r.actionManager.hasSpecificTrigger(13,function(f){var p=f.mesh?f.mesh:f;return l===p})||h.trigger===13)&&r._intersectionsInProgress.splice(c,1))}},s=0;r.actionManager&&s<r.actionManager.actions.length;s++)n(s)}},t.prototype._advancePhysicsEngineStep=function(e){},t.prototype._animate=function(){},t.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var e=Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime))+this._timeAccumulator,r=this._engine.getTimeStep(),n=1e3/r/1e3,s=0,a=this._engine.getLockstepMaxSteps(),h=Math.floor(e/r);for(h=Math.min(h,a);e>0&&s<h;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=r*n,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(r),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,s++,e-=r;this._timeAccumulator=e<0?0:e}else{var e=this.useConstantAnimationDeltaTime?16:Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime));this._animationRatio=e*(60/1e3),this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(e)}},t.prototype._clear=function(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)},t.prototype._checkCameraRenderTarget=function(e){var r;if((e==null?void 0:e.outputRenderTarget)&&!(e!=null&&e.isRigCamera)&&(e.outputRenderTarget._cleared=!1),!((r=e==null?void 0:e.rigCameras)===null||r===void 0)&&r.length)for(var n=0;n<e.rigCameras.length;++n){var s=e.rigCameras[n].outputRenderTarget;s&&(s._cleared=!1)}},t.prototype.resetDrawCache=function(e){if(!!this.meshes)for(var r=0,n=this.meshes;r<n.length;r++){var s=n[r];s.resetDrawCache(e)}},t.prototype.render=function(e,r){var n,s,a;if(e===void 0&&(e=!0),r===void 0&&(r=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&this._executeWhenReadyTimeoutId===null&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),!((n=this.activeCameras)===null||n===void 0)&&n.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),r||this.animate();for(var h=0,o=this._beforeCameraUpdateStage;h<o.length;h++){var l=o[h];l.action()}if(e){if(this.activeCameras&&this.activeCameras.length>0)for(var u=0;u<this.activeCameras.length;u++){var c=this.activeCameras[u];if(c.update(),c.cameraRigMode!==0)for(var f=0;f<c._rigCameras.length;f++)c._rigCameras[f].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==0))for(var f=0;f<this.activeCamera._rigCameras.length;f++)this.activeCamera._rigCameras[f].update()}this.onBeforeRenderObservable.notifyObservers(this);var p=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var v=!((s=this.activeCameras)===null||s===void 0)&&s.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){k.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var b=0;b<this.customRenderTargets.length;b++){var m=this.customRenderTargets[b];if(m._shouldRender()){if(this._renderId++,this.activeCamera=m.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");p.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),m.render(v!==this.activeCamera,this.dumpNextRenderTargets)}}k.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(a=v==null?void 0:v.renderPassId)!==null&&a!==void 0?a:0,this.activeCamera=v,this._activeCamera&&this._activeCamera.cameraRigMode!==22&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var M=0,T=this._beforeClearStage;M<T.length;M++){var l=T[M];l.action()}this._clearFrameBuffer(this.activeCamera);for(var D=0,L=this._gatherRenderTargetsStage;D<L.length;D++){var l=L[D];l.action(this._renderTargets)}if(this.activeCameras&&this.activeCameras.length>0)for(var u=0;u<this.activeCameras.length;u++)this._processSubCameras(this.activeCameras[u],u>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();for(var A=0,I=this._afterRenderStage;A<I.length;A++){var l=I[A];l.action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(var f=0;f<this._toBeDisposed.length;f++){var U=this._toBeDisposed[f];U&&U.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}},t.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},t.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},t.prototype.dispose=function(){var e;if(!this.isDisposed){this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var r=this._activeRequests.slice(),n=0,s=r;n<s.length;n++){var a=s[n];a.abort()}this._activeRequests=[],this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onComputePressureChanged.clear(),(e=this._computePressureObserver)===null||e===void 0||e.unobserve(),this._computePressureObserver=void 0,this.detachControl();var h=this._engine.getInputElement();if(h)for(var o=0;o<this.cameras.length;o++)this.cameras[o].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,function(u){return u.dispose(!0)}),this._disposeList(this.transformNodes,function(u){return u.dispose(!0)}),this._disposeList(this.cameras),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);var l=this._engine.scenes.indexOf(this);l>-1&&this._engine.scenes.splice(l,1),W._LastCreatedScene===this&&(this._engine.scenes.length>0?W._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:W._LastCreatedScene=null),l=this._engine._virtualScenes.indexOf(this),l>-1&&this._engine._virtualScenes.splice(l,1),this._engine.wipeCaches(!0),this._isDisposed=!0}},t.prototype._disposeList=function(e,r){var n=e.slice(0);r=r!=null?r:function(o){return o.dispose()};for(var s=0,a=n;s<a.length;s++){var h=a[s];r(h)}e.length=0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),t.prototype.clearCachedVertexData=function(){for(var e=0;e<this.meshes.length;e++){var r=this.meshes[e],n=r.geometry;n&&n.clearCachedData()}},t.prototype.cleanCachedTextureBuffer=function(){for(var e=0,r=this.textures;e<r.length;e++){var n=r[e],s=n._buffer;s&&(n._buffer=null)}},t.prototype.getWorldExtends=function(e){var r=new O(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new O(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||function(){return!0},this.meshes.filter(e).forEach(function(s){if(s.computeWorldMatrix(!0),!(!s.subMeshes||s.subMeshes.length===0||s.infiniteDistance)){var a=s.getBoundingInfo(),h=a.boundingBox.minimumWorld,o=a.boundingBox.maximumWorld;O.CheckExtends(h,r,n),O.CheckExtends(o,r,n)}}),{min:r,max:n}},t.prototype.createPickingRay=function(e,r,n,s,a){throw S("Ray")},t.prototype.createPickingRayToRef=function(e,r,n,s,a,h,o){throw S("Ray")},t.prototype.createPickingRayInCameraSpace=function(e,r,n){throw S("Ray")},t.prototype.createPickingRayInCameraSpaceToRef=function(e,r,n,s){throw S("Ray")},t.prototype.pick=function(e,r,n,s,a,h){var o=new j;return o._pickingUnavailable=!0,o},t.prototype.pickWithBoundingInfo=function(e,r,n,s,a){var h=new j;return h._pickingUnavailable=!0,h},t.prototype.pickWithRay=function(e,r,n,s){throw S("Ray")},t.prototype.multiPick=function(e,r,n,s,a){throw S("Ray")},t.prototype.multiPickWithRay=function(e,r,n){throw S("Ray")},t.prototype.setPointerOverMesh=function(e,r,n){this._inputManager.setPointerOverMesh(e,r,n)},t.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},t.prototype._rebuildGeometries=function(){for(var e=0,r=this.geometries;e<r.length;e++){var n=r[e];n._rebuild()}for(var s=0,a=this.meshes;s<a.length;s++){var h=a[s];h._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var o=0,l=this._components;o<l.length;o++){var u=l[o];u.rebuild()}for(var c=0,f=this.particleSystems;c<f.length;c++){var p=f[c];p.rebuild()}if(this.spriteManagers)for(var v=0,b=this.spriteManagers;v<b.length;v++){var m=b[v];m.rebuild()}},t.prototype._rebuildTextures=function(){for(var e=0,r=this.textures;e<r.length;e++){var n=r[e];n._rebuild()}this.markAllMaterialsAsDirty(1)},t.prototype._getByTags=function(e,r,n){if(r===void 0)return e;var s=[];n=n||function(o){};for(var a in e){var h=e[a];Q&&Q.MatchesQuery(h,r)&&(s.push(h),n(h))}return s},t.prototype.getMeshesByTags=function(e,r){return this._getByTags(this.meshes,e,r)},t.prototype.getCamerasByTags=function(e,r){return this._getByTags(this.cameras,e,r)},t.prototype.getLightsByTags=function(e,r){return this._getByTags(this.lights,e,r)},t.prototype.getMaterialByTags=function(e,r){return this._getByTags(this.materials,e,r).concat(this._getByTags(this.multiMaterials,e,r))},t.prototype.getTransformNodesByTags=function(e,r){return this._getByTags(this.transformNodes,e,r)},t.prototype.setRenderingOrder=function(e,r,n,s){r===void 0&&(r=null),n===void 0&&(n=null),s===void 0&&(s=null),this._renderingManager.setRenderingOrder(e,r,n,s)},t.prototype.setRenderingAutoClearDepthStencil=function(e,r,n,s){n===void 0&&(n=!0),s===void 0&&(s=!0),this._renderingManager.setRenderingAutoClearDepthStencil(e,r,n,s)},t.prototype.getAutoClearDepthStencilSetup=function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)},Object.defineProperty(t.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(63))},enumerable:!1,configurable:!0}),t.prototype.markAllMaterialsAsDirty=function(e,r){if(!this._blockMaterialDirtyMechanism)for(var n=0,s=this.materials;n<s.length;n++){var a=s[n];r&&!r(a)||a.markAsDirty(e)}},t.prototype._loadFile=function(e,r,n,s,a,h,o){var l=this,u=Me(e,r,n,s?this.offlineProvider:void 0,a,h,o);return this._activeRequests.push(u),u.onCompleteObservable.add(function(c){l._activeRequests.splice(l._activeRequests.indexOf(c),1)}),u},t.prototype._loadFileAsync=function(e,r,n,s,a){var h=this;return new Promise(function(o,l){h._loadFile(e,function(u){o(u)},r,n,s,function(u,c){l(c)},a)})},t.prototype._requestFile=function(e,r,n,s,a,h,o){var l=this,u=Pe(e,r,n,s?this.offlineProvider:void 0,a,h,o);return this._activeRequests.push(u),u.onCompleteObservable.add(function(c){l._activeRequests.splice(l._activeRequests.indexOf(c),1)}),u},t.prototype._requestFileAsync=function(e,r,n,s,a){var h=this;return new Promise(function(o,l){h._requestFile(e,function(u){o(u)},r,n,s,function(u){l(u)},a)})},t.prototype._readFile=function(e,r,n,s,a){var h=this,o=Ce(e,r,n,s,a);return this._activeRequests.push(o),o.onCompleteObservable.add(function(l){h._activeRequests.splice(h._activeRequests.indexOf(l),1)}),o},t.prototype._readFileAsync=function(e,r,n){var s=this;return new Promise(function(a,h){s._readFile(e,function(o){a(o)},r,n,function(o){h(o)})})},t.prototype.getPerfCollector=function(){throw S("performanceViewerSceneExtension")},t.FOGMODE_NONE=0,t.FOGMODE_EXP=1,t.FOGMODE_EXP2=2,t.FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}(Ae);C.prototype.setActiveCameraByID=function(i){return this.setActiveCameraById(i)};C.prototype.getLastMaterialByID=function(i){return this.getLastMaterialById(i)};C.prototype.getMaterialByID=function(i){return this.getMaterialById(i)};C.prototype.getTextureByUniqueID=function(i){return this.getTextureByUniqueId(i)};C.prototype.getCameraByID=function(i){return this.getCameraById(i)};C.prototype.getCameraByUniqueID=function(i){return this.getCameraByUniqueId(i)};C.prototype.getBoneByID=function(i){return this.getBoneById(i)};C.prototype.getLightByID=function(i){return this.getLightById(i)};C.prototype.getLightByUniqueID=function(i){return this.getLightByUniqueId(i)};C.prototype.getParticleSystemByID=function(i){return this.getParticleSystemById(i)};C.prototype.getGeometryByID=function(i){return this.getGeometryById(i)};C.prototype.getMeshByID=function(i){return this.getMeshById(i)};C.prototype.getMeshesByID=function(i){return this.getMeshesById(i)};C.prototype.getTransformNodeByID=function(i){return this.getTransformNodeById(i)};C.prototype.getTransformNodeByUniqueID=function(i){return this.getTransformNodeByUniqueId(i)};C.prototype.getTransformNodesByID=function(i){return this.getTransformNodesById(i)};C.prototype.getMeshByUniqueID=function(i){return this.getMeshByUniqueId(i)};C.prototype.getLastMeshByID=function(i){return this.getLastMeshById(i)};C.prototype.getLastEntryByID=function(i){return this.getLastEntryById(i)};C.prototype.getNodeByID=function(i){return this.getNodeById(i)};C.prototype.getLastSkeletonByID=function(i){return this.getLastSkeletonById(i)};var He=Object.freeze(Object.defineProperty({__proto__:null,Scene:C},Symbol.toStringTag,{value:"Module"}));export{Ae as A,Ne as E,de as F,re as K,j as P,we as R,Xe as S,C as a,B as b,y as c,te as d,He as s};
