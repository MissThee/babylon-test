import{P as he,E as q}from"./performanceConfigurator.3a0adc9f.js";var J=function(r,e){return J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])},J(r,e)};function M(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");J(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var te=function(){return te=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},te.apply(this,arguments)};function Me(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var o=r.length-1;o>=0;o--)(a=r[o])&&(n=(s<3?a(n):s>3?a(e,t,n):a(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function fe(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(h){try{u(i.next(h))}catch(f){a(f)}}function l(h){try{u(i.throw(h))}catch(f){a(f)}}function u(h){h.done?n(h.value):s(h.value).then(o,l)}u((i=i.apply(r,e||[])).next())})}function _e(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(u){return function(h){return l([u,h])}}function l(u){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=u[0]&2?s.return:u[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,u[1])).done)return n;switch(s=0,n&&(u=[u[0]&2,n.value]),u[0]){case 0:case 1:n=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,s=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!n||u[1]>n[0]&&u[1]<n[3])){t.label=u[1];break}if(u[0]===6&&t.label<n[1]){t.label=n[1],n=u;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(u);break}n[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(h){u=[6,h],s=0}finally{i=n=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var ce=function(){function r(e,t,i,s){t===void 0&&(t=!1),this.initialize(e,t,i,s)}return r.prototype.initialize=function(e,t,i,s){return t===void 0&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=s,this},r}(),pe=function(){function r(e,t,i){i===void 0&&(i=null),this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1}return r}(),I=function(){function r(e){this._observers=new Array,this._eventState=new ce(0),e&&(this._onObserverAdded=e)}return r.FromPromise=function(e,t){var i=new r;return e.then(function(s){i.notifyObservers(s)}).catch(function(s){if(t)t.notifyObservers(s);else throw s}),i},Object.defineProperty(r.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),r.prototype.add=function(e,t,i,s,n){if(t===void 0&&(t=-1),i===void 0&&(i=!1),s===void 0&&(s=null),n===void 0&&(n=!1),!e)return null;var a=new pe(e,t,s);return a.unregisterOnNextCall=n,i?this._observers.unshift(a):this._observers.push(a),this._onObserverAdded&&this._onObserverAdded(a),a},r.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},r.prototype.remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return t!==-1?(this._deferUnregister(e),!0):!1},r.prototype.removeCallback=function(e,t){for(var i=0;i<this._observers.length;i++){var s=this._observers[i];if(!s._willBeUnregistered&&s.callback===e&&(!t||t===s.scope))return this._deferUnregister(s),!0}return!1},r.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(function(){t._remove(e)},0)},r.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return t!==-1?(this._observers.splice(t,1),!0):!1},r.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},r.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},r.prototype.notifyObservers=function(e,t,i,s,n){if(t===void 0&&(t=-1),!this._observers.length)return!0;var a=this._eventState;a.mask=t,a.target=i,a.currentTarget=s,a.skipNextObservers=!1,a.lastReturnValue=e,a.userInfo=n;for(var o=0,l=this._observers;o<l.length;o++){var u=l[o];if(!u._willBeUnregistered&&(u.mask&t&&(u.scope?a.lastReturnValue=u.callback.apply(u.scope,[e,a]):a.lastReturnValue=u.callback(e,a),u.unregisterOnNextCall&&this._deferUnregister(u)),a.skipNextObservers))return!1}return!0},r.prototype.notifyObserversWithPromise=function(e,t,i,s,n){var a=this;t===void 0&&(t=-1);var o=Promise.resolve(e);if(!this._observers.length)return o;var l=this._eventState;return l.mask=t,l.target=i,l.currentTarget=s,l.skipNextObservers=!1,l.userInfo=n,this._observers.forEach(function(u){l.skipNextObservers||u._willBeUnregistered||u.mask&t&&(u.scope?o=o.then(function(h){return l.lastReturnValue=h,u.callback.apply(u.scope,[e,l])}):o=o.then(function(h){return l.lastReturnValue=h,u.callback(e,l)}),u.unregisterOnNextCall&&a._deferUnregister(u))}),o.then(function(){return e})},r.prototype.notifyObserver=function(e,t,i){if(i===void 0&&(i=-1),!e._willBeUnregistered){var s=this._eventState;s.mask=i,s.skipNextObservers=!1,e.callback(t,s),e.unregisterOnNextCall&&this._deferUnregister(e)}},r.prototype.hasObservers=function(){return this._observers.length>0},r.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},r.prototype.clone=function(){var e=new r;return e._observers=this._observers.slice(0),e},r.prototype.hasSpecificMask=function(e){e===void 0&&(e=-1);for(var t=0,i=this._observers;t<i.length;t++){var s=i[t];if(s.mask&e||s.mask===e)return!0}return!1},r}(),de=function(){function r(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}return Object.defineProperty(r.prototype,"wrapU",{get:function(){return this._cachedWrapU},set:function(e){this._cachedWrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"wrapV",{get:function(){return this._cachedWrapV},set:function(e){this._cachedWrapV=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"wrapR",{get:function(){return this._cachedWrapR},set:function(e){this._cachedWrapR=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"anisotropicFilteringLevel",{get:function(){return this._cachedAnisotropicFilteringLevel},set:function(e){this._cachedAnisotropicFilteringLevel=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"comparisonFunction",{get:function(){return this._comparisonFunction},set:function(e){this._comparisonFunction=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"useMipMaps",{get:function(){return this._useMipMaps},set:function(e){this._useMipMaps=e},enumerable:!1,configurable:!0}),r.prototype.setParameters=function(e,t,i,s,n,a){return e===void 0&&(e=1),t===void 0&&(t=1),i===void 0&&(i=1),s===void 0&&(s=1),n===void 0&&(n=2),a===void 0&&(a=0),this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=i,this._cachedAnisotropicFilteringLevel=s,this.samplingMode=n,this._comparisonFunction=a,this},r.prototype.compareSampler=function(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps},r}(),F;(function(r){r[r.Unknown=0]="Unknown",r[r.Url=1]="Url",r[r.Temp=2]="Temp",r[r.Raw=3]="Raw",r[r.Dynamic=4]="Dynamic",r[r.RenderTarget=5]="RenderTarget",r[r.MultiRenderTarget=6]="MultiRenderTarget",r[r.Cube=7]="Cube",r[r.CubeRaw=8]="CubeRaw",r[r.CubePrefiltered=9]="CubePrefiltered",r[r.Raw3D=10]="Raw3D",r[r.Raw2DArray=11]="Raw2DArray",r[r.DepthStencil=12]="DepthStencil",r[r.CubeRawRGBD=13]="CubeRawRGBD",r[r.Depth=14]="Depth"})(F||(F={}));var Q=function(r){M(e,r);function e(t,i,s){s===void 0&&(s=!1);var n=r.call(this)||this;return n.isReady=!1,n.isCube=!1,n.is3D=!1,n.is2DArray=!1,n.isMultiview=!1,n.url="",n.generateMipMaps=!1,n.samples=0,n.type=-1,n.format=-1,n.onLoadedObservable=new I,n.onErrorObservable=new I,n.onRebuildCallback=null,n.width=0,n.height=0,n.depth=0,n.baseWidth=0,n.baseHeight=0,n.baseDepth=0,n.invertY=!1,n._invertVScale=!1,n._associatedChannel=-1,n._source=F.Unknown,n._buffer=null,n._bufferView=null,n._bufferViewArray=null,n._bufferViewArrayArray=null,n._size=0,n._extension="",n._files=null,n._workingCanvas=null,n._workingContext=null,n._cachedCoordinatesMode=null,n._isDisabled=!1,n._compression=null,n._sphericalPolynomial=null,n._sphericalPolynomialPromise=null,n._sphericalPolynomialComputed=!1,n._lodGenerationScale=0,n._lodGenerationOffset=0,n._useSRGBBuffer=!1,n._lodTextureHigh=null,n._lodTextureMid=null,n._lodTextureLow=null,n._isRGBD=!1,n._linearSpecularLOD=!1,n._irradianceTexture=null,n._hardwareTexture=null,n._maxLodLevel=null,n._references=1,n._gammaSpace=null,n._engine=t,n._source=i,n._uniqueId=e._Counter++,s||(n._hardwareTexture=t._createHardwareTexture()),n}return Object.defineProperty(e.prototype,"useMipMaps",{get:function(){return this.generateMipMaps},set:function(t){this.generateMipMaps=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),e.prototype.getEngine=function(){return this._engine},Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),e.prototype.incrementReferences=function(){this._references++},e.prototype.updateSize=function(t,i,s){s===void 0&&(s=1),this._engine.updateTextureDimensions(this,t,i,s),this.width=t,this.height=i,this.depth=s,this.baseWidth=t,this.baseHeight=i,this.baseDepth=s,this._size=t*i*s},e.prototype._rebuild=function(){var t=this,i;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){var s=this.onRebuildCallback(this),n=function(o){o._swapAndDie(t,!1),t.isReady=s.isReady};s.isAsync?s.proxy.then(n):n(s.proxy);return}var a;switch(this.source){case F.Temp:break;case F.Url:a=this._engine.createTexture((i=this._originalUrl)!==null&&i!==void 0?i:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){a._swapAndDie(t,!1),t.isReady=!0},null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer);return;case F.Raw:a=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,void 0,this._useSRGBBuffer),a._swapAndDie(this,!1),this.isReady=!0;break;case F.Raw3D:a=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),a._swapAndDie(this,!1),this.isReady=!0;break;case F.Raw2DArray:a=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),a._swapAndDie(this,!1),this.isReady=!0;break;case F.Dynamic:a=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),a._swapAndDie(this,!1),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);break;case F.Cube:a=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){a._swapAndDie(t,!1),t.isReady=!0},null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer);return;case F.CubeRaw:a=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),a._swapAndDie(this,!1),this.isReady=!0;break;case F.CubeRawRGBD:return;case F.CubePrefiltered:a=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(o){o&&o._swapAndDie(t,!1),t.isReady=!0},null,this.format,this._extension),a._sphericalPolynomial=this._sphericalPolynomial;return}},e.prototype._swapAndDie=function(t,i){var s;i===void 0&&(i=!0),(s=this._hardwareTexture)===null||s===void 0||s.setUsage(t._source,this.generateMipMaps,this.isCube,this.width,this.height),t._hardwareTexture=this._hardwareTexture,i&&(t._isRGBD=this._isRGBD),this._lodTextureHigh&&(t._lodTextureHigh&&t._lodTextureHigh.dispose(),t._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(t._lodTextureMid&&t._lodTextureMid.dispose(),t._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(t._lodTextureLow&&t._lodTextureLow.dispose(),t._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(t._irradianceTexture&&t._irradianceTexture.dispose(),t._irradianceTexture=this._irradianceTexture);var n=this._engine.getLoadedTexturesCache(),a=n.indexOf(this);a!==-1&&n.splice(a,1),a=n.indexOf(t),a===-1&&n.push(t)},e.prototype.dispose=function(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._references===0&&(this._engine._releaseTexture(this),this._hardwareTexture=null)},e._Counter=0,e}(de);function O(){return typeof window!="undefined"}function ge(){return typeof navigator!="undefined"}function ee(){return typeof document!="undefined"}function ne(r){for(var e="",t=r.firstChild;t;)t.nodeType===3&&(e+=t.textContent),t=t.nextSibling;return e}var be={IsWindowObjectExist:O,IsNavigatorAvailable:ge,IsDocumentAvailable:ee,GetDOMTextContent:ne};function G(r){return"".concat(r," needs to be imported before as it contains a side-effect required by your code.")}var P=function(){function r(){}return r._CheckLimit=function(e,t){var i=r._LogLimitOutputs[e];return i?i.current++:(i={limit:t,current:1},r._LogLimitOutputs[e]=i),i.current<=i.limit},r._GenerateLimitMessage=function(e,t){var i=r._LogLimitOutputs[e];if(!(!i||!r.MessageLimitReached)&&i.current===i.limit)switch(t){case 0:r.Log(r.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,"log"));break;case 1:r.Warn(r.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,"warning"));break;case 2:r.Error(r.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,"error"));break}},r._AddLogEntry=function(e){r._LogCache=e+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(e)},r._FormatMessage=function(e){var t=function(s){return s<10?"0"+s:""+s},i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e},r._LogDisabled=function(e,t){},r._LogEnabled=function(e,t){if(!(t!==void 0&&!r._CheckLimit(e,t))){var i=r._FormatMessage(e);console.log("BJS - "+i);var s="<div style='color:white'>"+i+"</div><br>";r._AddLogEntry(s),r._GenerateLimitMessage(e,0)}},r._WarnDisabled=function(e,t){},r._WarnEnabled=function(e,t){if(!(t!==void 0&&!r._CheckLimit(e,t))){var i=r._FormatMessage(e);console.warn("BJS - "+i);var s="<div style='color:orange'>"+e+"</div><br>";r._AddLogEntry(s),r._GenerateLimitMessage(e,1)}},r._ErrorDisabled=function(e,t){},r._ErrorEnabled=function(e,t){if(!(t!==void 0&&!r._CheckLimit(e,t))){var i=r._FormatMessage(e);r.errorsCount++,console.error("BJS - "+i);var s="<div style='color:red'>"+i+"</div><br>";r._AddLogEntry(s),r._GenerateLimitMessage(e,2)}},Object.defineProperty(r,"LogCache",{get:function(){return r._LogCache},enumerable:!1,configurable:!0}),r.ClearLogCache=function(){r._LogCache="",r._LogLimitOutputs={},r.errorsCount=0},Object.defineProperty(r,"LogLevels",{set:function(e){(e&r.MessageLogLevel)===r.MessageLogLevel?r.Log=r._LogEnabled:r.Log=r._LogDisabled,(e&r.WarningLogLevel)===r.WarningLogLevel?r.Warn=r._WarnEnabled:r.Warn=r._WarnDisabled,(e&r.ErrorLogLevel)===r.ErrorLogLevel?r.Error=r._ErrorEnabled:r.Error=r._ErrorDisabled},enumerable:!1,configurable:!0}),r.NoneLogLevel=0,r.MessageLogLevel=1,r.WarningLogLevel=2,r.ErrorLogLevel=4,r.AllLogLevel=7,r.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",r._LogCache="",r._LogLimitOutputs={},r.errorsCount=0,r.Log=r._LogEnabled,r.Warn=r._WarnEnabled,r.Error=r._ErrorEnabled,r}(),W=function(){function r(){this.children=[]}return r.prototype.isValid=function(e){return!0},r.prototype.process=function(e,t){var i="";if(this.line){var s=this.line,n=t.processor;if(n){if(n.lineProcessor&&(s=n.lineProcessor(s,t.isFragment,t.processingContext)),n.attributeProcessor&&this.line.startsWith("attribute"))s=n.attributeProcessor(this.line,e,t.processingContext);else if(n.varyingProcessor&&this.line.startsWith("varying"))s=n.varyingProcessor(this.line,t.isFragment,e,t.processingContext);else if(n.uniformProcessor&&n.uniformRegexp&&n.uniformRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(s=n.uniformProcessor(this.line,t.isFragment,e,t.processingContext));else if(n.uniformBufferProcessor&&n.uniformBufferRegexp&&n.uniformBufferRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(s=n.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0);else if(n.textureProcessor&&n.textureRegexp&&n.textureRegexp.test(this.line))s=n.textureProcessor(this.line,t.isFragment,e,t.processingContext);else if((n.uniformProcessor||n.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer){var a=/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/;a.test(this.line)?n.uniformProcessor&&(s=n.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):n.uniformBufferProcessor&&(s=n.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)}t.lookForClosingBracketForUniformBuffer&&this.line.indexOf("}")!==-1&&(t.lookForClosingBracketForUniformBuffer=!1,n.endOfUniformBufferProcessor&&(s=n.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}i+=s+`\r
`}return this.children.forEach(function(o){i+=o.process(e,t)}),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),i},r}(),ve=function(){function r(){}return Object.defineProperty(r.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,i=e;t<i.length;t++){var s=i[t];if(s[0]==="#"){this._lines.push(s);continue}if(s.trim().startsWith("//")){this._lines.push(s);continue}for(var n=s.split(";"),a=0;a<n.length;a++){var o=n[a];o=o.trim(),o&&this._lines.push(o+(a!==n.length-1?";":""))}}},enumerable:!1,configurable:!0}),r}(),Z=function(r){M(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.process=function(t,i){for(var s=0;s<this.children.length;s++){var n=this.children[s];if(n.isValid(t))return n.process(t,i)}return""},e}(W),ye=function(r){M(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.isValid=function(t){return this.testExpression.isTrue(t)},e}(W),H=function(){function r(){}return r.prototype.isTrue=function(e){return!0},r.postfixToInfix=function(e){for(var t=[],i=0,s=e;i<s.length;i++){var n=s[i];if(r._OperatorPriority[n]===void 0)t.push(n);else{var a=t[t.length-1],o=t[t.length-2];t.length-=2,t.push("(".concat(o).concat(n).concat(a,")"))}}return t[t.length-1]},r.infixToPostfix=function(e){for(var t=[],i=-1,s=function(){u=u.trim(),u!==""&&(t.push(u),u="")},n=function(_){i<r._Stack.length-1&&(r._Stack[++i]=_)},a=function(){return r._Stack[i]},o=function(){return i===-1?"!!INVALID EXPRESSION!!":r._Stack[i--]},l=0,u="";l<e.length;){var h=e.charAt(l),f=l<e.length-1?e.substr(l,2):"";if(h==="(")u="",n(h);else if(h===")"){for(s();i!==-1&&a()!=="(";)t.push(o());o()}else if(r._OperatorPriority[f]>1){for(s();i!==-1&&r._OperatorPriority[a()]>=r._OperatorPriority[f];)t.push(o());n(f),l++}else u+=h;l++}for(s();i!==-1;)a()==="("?o():t.push(o());return t},r._OperatorPriority={")":0,"(":1,"||":2,"&&":3},r._Stack=["","","","","","","","","","","","","","","","","","","",""],r}(),Y=function(r){M(e,r);function e(t,i){i===void 0&&(i=!1);var s=r.call(this)||this;return s.define=t,s.not=i,s}return e.prototype.isTrue=function(t){var i=t[this.define]!==void 0;return this.not&&(i=!i),i},e}(H),Ee=function(r){M(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.isTrue=function(t){return this.leftOperand.isTrue(t)||this.rightOperand.isTrue(t)},e}(H),me=function(r){M(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.isTrue=function(t){return this.leftOperand.isTrue(t)&&this.rightOperand.isTrue(t)},e}(H),Te=function(r){M(e,r);function e(t,i,s){var n=r.call(this)||this;return n.define=t,n.operand=i,n.testValue=s,n}return e.prototype.isTrue=function(t){var i=t[this.define];i===void 0&&(i=this.define);var s=!1,n=parseInt(i),a=parseInt(this.testValue);switch(this.operand){case">":s=n>a;break;case"<":s=n<a;break;case"<=":s=n<=a;break;case">=":s=n>=a;break;case"==":s=n===a;break}return s},e}(H),A;(function(r){r[r.GLSL=0]="GLSL",r[r.WGSL=1]="WGSL"})(A||(A={}));var Re=/defined\s*?\((.+?)\)/g,$=/defined\s*?\[(.+?)\]/g,re=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,z=function(){function r(){}return r.Initialize=function(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)},r.Process=function(e,t,i,s){var n=this,a;!((a=t.processor)===null||a===void 0)&&a.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,function(o){t.processCodeAfterIncludes&&(o=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",o));var l=n._ProcessShaderConversion(o,t,s);i(l)})},r.PreProcess=function(e,t,i,s){var n=this,a;!((a=t.processor)===null||a===void 0)&&a.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,function(o){t.processCodeAfterIncludes&&(o=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",o));var l=n._ApplyPreProcessing(o,t,s);i(l)})},r.Finalize=function(e,t,i){return!i.processor||!i.processor.finalizeShaders?{vertexCode:e,fragmentCode:t}:i.processor.finalizeShaders(e,t,i.processingContext)},r._ProcessPrecision=function(e,t){var i;if(!((i=t.processor)===null||i===void 0)&&i.noPrecision)return e;var s=t.shouldUseHighPrecisionShader;return e.indexOf("precision highp float")===-1?s?e=`precision highp float;
`+e:e=`precision mediump float;
`+e:s||(e=e.replace("precision highp float","precision mediump float")),e},r._ExtractOperation=function(e){var t=/defined\((.+)\)/,i=t.exec(e);if(i&&i.length)return new Y(i[1].trim(),e[0]==="!");for(var s=["==",">=","<=","<",">"],n="",a=0,o=0,l=s;o<l.length&&(n=l[o],a=e.indexOf(n),!(a>-1));o++);if(a===-1)return new Y(e);var u=e.substring(0,a).trim(),h=e.substring(a+n.length).trim();return new Te(u,n,h)},r._BuildSubExpression=function(e){e=e.replace(Re,"defined[$1]");for(var t=H.infixToPostfix(e),i=[],s=0,n=t;s<n.length;s++){var a=n[s];if(a!=="||"&&a!=="&&")i.push(a);else if(i.length>=2){var o=i[i.length-1],l=i[i.length-2];i.length-=2;var u=a=="&&"?new me:new Ee;typeof o=="string"&&(o=o.replace($,"defined($1)")),typeof l=="string"&&(l=l.replace($,"defined($1)")),u.leftOperand=typeof l=="string"?this._ExtractOperation(l):l,u.rightOperand=typeof o=="string"?this._ExtractOperation(o):o,i.push(u)}}var h=i[i.length-1];return typeof h=="string"&&(h=h.replace($,"defined($1)")),typeof h=="string"?this._ExtractOperation(h):h},r._BuildExpression=function(e,t){var i=new ye,s=e.substring(0,t),n=e.substring(t);return n=n.substring(0,(n.indexOf("//")+1||n.length+1)-1).trim(),s==="#ifdef"?i.testExpression=new Y(n):s==="#ifndef"?i.testExpression=new Y(n,!0):i.testExpression=this._BuildSubExpression(n),i},r._MoveCursorWithinIf=function(e,t,i){for(var s=e.currentLine;this._MoveCursor(e,i);){s=e.currentLine;var n=s.substring(0,5).toLowerCase();if(n==="#else"){var a=new W;t.children.push(a),this._MoveCursor(e,a);return}else if(n==="#elif"){var o=this._BuildExpression(s,5);t.children.push(o),i=o}}},r._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var i=e.currentLine,s=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/,n=s.exec(i);if(n&&n.length){var a=n[0];switch(a){case"#ifdef":{var o=new Z;t.children.push(o);var l=this._BuildExpression(i,6);o.children.push(l),this._MoveCursorWithinIf(e,o,l);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{var o=new Z;t.children.push(o);var l=this._BuildExpression(i,7);o.children.push(l),this._MoveCursorWithinIf(e,o,l);break}case"#if":{var o=new Z,l=this._BuildExpression(i,3);t.children.push(o),o.children.push(l),this._MoveCursorWithinIf(e,o,l);break}}}else{var u=new W;if(u.line=i,t.children.push(u),i[0]==="#"&&i[1]==="d"){var h=i.replace(";","").split(" ");u.additionalDefineKey=h[1],h.length===3&&(u.additionalDefineValue=h[2])}}}return!1},r._EvaluatePreProcessors=function(e,t,i){var s=new W,n=new ve;return n.lineIndex=-1,n.lines=e.split(`
`),this._MoveCursor(n,s),s.process(t,i)},r._PreparePreProcessors=function(e,t){for(var i,s=e.defines,n={},a=0,o=s;a<o.length;a++){var l=o[a],u=l.replace("#define","").replace(";","").trim(),h=u.split(" ");n[h[0]]=h.length>1?h[1]:""}return((i=e.processor)===null||i===void 0?void 0:i.shaderLanguage)===A.GLSL&&(n.GL_ES="true"),n.__VERSION__=e.version,n[e.platformName]="true",t._getGlobalDefines(n),n},r._ProcessShaderConversion=function(e,t,i){var s=this._ProcessPrecision(e,t);if(!t.processor)return s;if(t.processor.shaderLanguage===A.GLSL&&s.indexOf("#version 3")!==-1)return s.replace("#version 300 es","");var n=t.defines,a=this._PreparePreProcessors(t,i);return t.processor.preProcessor&&(s=t.processor.preProcessor(s,n,t.isFragment,t.processingContext)),s=this._EvaluatePreProcessors(s,a,t),t.processor.postProcessor&&(s=t.processor.postProcessor(s,n,t.isFragment,t.processingContext,i)),i._features.needShaderCodeInlining&&(s=i.inlineShaderCode(s)),s},r._ApplyPreProcessing=function(e,t,i){var s,n,a=e,o=t.defines,l=this._PreparePreProcessors(t,i);return!((s=t.processor)===null||s===void 0)&&s.preProcessor&&(a=t.processor.preProcessor(a,o,t.isFragment,t.processingContext)),a=this._EvaluatePreProcessors(a,l,t),!((n=t.processor)===null||n===void 0)&&n.postProcessor&&(a=t.processor.postProcessor(a,o,t.isFragment,t.processingContext,i)),i._features.needShaderCodeInlining&&(a=i.inlineShaderCode(a)),a},r._ProcessIncludes=function(e,t,i){for(var s=this,n=re.exec(e),a=new String(e),o=!1,l=function(){var h=n[1];if(h.indexOf("__decl__")!==-1&&(h=h.replace(/__decl__/,""),t.supportsUniformBuffers&&(h=h.replace(/Vertex/,"Ubo"),h=h.replace(/Fragment/,"Ubo")),h=h+"Declaration"),t.includesShadersStore[h]){var f=t.includesShadersStore[h];if(n[2])for(var _=n[3].split(","),p=0;p<_.length;p+=2){var d=new RegExp(_[p],"g"),y=_[p+1];f=f.replace(d,y)}if(n[4]){var g=n[5];if(g.indexOf("..")!==-1){var E=g.split(".."),m=parseInt(E[0]),b=parseInt(E[1]),x=f.slice(0);f="",isNaN(b)&&(b=t.indexParameters[E[1]]);for(var c=m;c<b;c++)t.supportsUniformBuffers||(x=x.replace(/light\{X\}.(\w*)/g,function(v,R){return R+"{X}"})),f+=x.replace(/\{X\}/g,c.toString())+`
`}else t.supportsUniformBuffers||(f=f.replace(/light\{X\}.(\w*)/g,function(v,R){return R+"{X}"})),f=f.replace(/\{X\}/g,g)}a=a.replace(n[0],f),o=o||f.indexOf("#include<")>=0||f.indexOf("#include <")>=0}else{var C=t.shadersRepository+"ShadersInclude/"+h+".fx";return r._FileToolsLoadFile(C,function(v){t.includesShadersStore[h]=v,s._ProcessIncludes(a,t,i)}),{value:void 0}}n=re.exec(e)};n!=null;){var u=l();if(typeof u=="object")return u.value}o?this._ProcessIncludes(a.toString(),t,i):i(a)},r._FileToolsLoadFile=function(e,t,i,s,n,a){throw G("FileTools")},r}(),D=function(){function r(){}return r.GetShadersRepository=function(e){return e===void 0&&(e=A.GLSL),e===A.GLSL?r.ShadersRepository:r.ShadersRepositoryWGSL},r.GetShadersStore=function(e){return e===void 0&&(e=A.GLSL),e===A.GLSL?r.ShadersStore:r.ShadersStoreWGSL},r.GetIncludesShadersStore=function(e){return e===void 0&&(e=A.GLSL),e===A.GLSL?r.IncludesShadersStore:r.IncludesShadersStoreWGSL},r.ShadersRepository="src/Shaders/",r.ShadersStore={},r.IncludesShadersStore={},r.ShadersRepositoryWGSL="src/ShadersWGSL/",r.ShadersStoreWGSL={},r.IncludesShadersStoreWGSL={},r}(),V=function(){function r(e,t,i,s,n,a,o,l,u,h,f,_){s===void 0&&(s=null),a===void 0&&(a=null),o===void 0&&(o=null),l===void 0&&(l=null),u===void 0&&(u=null),f===void 0&&(f=""),_===void 0&&(_=A.GLSL);var p=this,d,y,g;this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new I,this.onErrorObservable=new I,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._wasPreviouslyUsingInstances=null,this._isDisposed=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this.name=e,this._key=f;var E=void 0,m=null;if(t.attributes){var b=t;if(this._engine=i,this._attributesNames=b.attributes,this._uniformsNames=b.uniformsNames.concat(b.samplers),this._samplerList=b.samplers.slice(),this.defines=b.defines,this.onError=b.onError,this.onCompiled=b.onCompiled,this._fallbacks=b.fallbacks,this._indexParameters=b.indexParameters,this._transformFeedbackVaryings=b.transformFeedbackVaryings||null,this._multiTarget=!!b.multiTarget,this._shaderLanguage=(d=b.shaderLanguage)!==null&&d!==void 0?d:A.GLSL,b.uniformBuffersNames){this._uniformBuffersNamesList=b.uniformBuffersNames.slice();for(var x=0;x<b.uniformBuffersNames.length;x++)this._uniformBuffersNames[b.uniformBuffersNames[x]]=x}m=(y=b.processFinalCode)!==null&&y!==void 0?y:null,E=(g=b.processCodeAfterIncludes)!==null&&g!==void 0?g:void 0}else this._engine=n,this.defines=a==null?"":a,this._uniformsNames=i.concat(s),this._samplerList=s?s.slice():[],this._attributesNames=t,this._uniformBuffersNamesList=[],this._shaderLanguage=_,this.onError=u,this.onCompiled=l,this._indexParameters=h,this._fallbacks=o;this._attributeLocationByName={},this.uniqueId=r._UniqueIdSeed++;var c,C,v=O()?this._engine.getHostDocument():null;e.vertexSource?c="source:"+e.vertexSource:e.vertexElement?(c=v?v.getElementById(e.vertexElement):null,c||(c=e.vertexElement)):c=e.vertex||e,e.fragmentSource?C="source:"+e.fragmentSource:e.fragmentElement?(C=v?v.getElementById(e.fragmentElement):null,C||(C=e.fragmentElement)):C=e.fragment||e,this._processingContext=this._engine._getShaderProcessingContext(this._shaderLanguage);var R={defines:this.defines.split(`
`),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:D.GetShadersRepository(this._shaderLanguage),includesShadersStore:D.GetIncludesShadersStore(this._shaderLanguage),version:(this._engine.version*100).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:E},S=[void 0,void 0],L=function(){if(S[0]&&S[1]){R.isFragment=!0;var T=S[0],B=S[1];z.Process(B,R,function(U){m&&(U=m("fragment",U));var N=z.Finalize(T,U,R);p._useFinalCode(N.vertexCode,N.fragmentCode,e)},p._engine)}};this._loadShader(c,"Vertex","",function(T){z.Initialize(R),z.Process(T,R,function(B){p._rawVertexSourceCode=T,m&&(B=m("vertex",B)),S[0]=B,L()},p._engine)}),this._loadShader(C,"Fragment","Pixel",function(T){p._rawFragmentSourceCode=T,S[1]=T,L()})}return Object.defineProperty(r,"ShadersRepository",{get:function(){return D.ShadersRepository},set:function(e){D.ShadersRepository=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new I),this._onBindObservable},enumerable:!1,configurable:!0}),r.prototype._useFinalCode=function(e,t,i){if(i){var s=i.vertexElement||i.vertex||i.spectorName||i,n=i.fragmentElement||i.fragment||i.spectorName||i;this._vertexSourceCode=(this._shaderLanguage===A.WGSL?"//":"")+"#define SHADER_NAME vertex:"+s+`
`+e,this._fragmentSourceCode=(this._shaderLanguage===A.WGSL?"//":"")+"#define SHADER_NAME fragment:"+n+`
`+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()},Object.defineProperty(r.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),r.prototype.isReady=function(){try{return this._isReadyInternal()}catch{return!1}},r.prototype._isReadyInternal=function(){return this._isReady?!0:this._pipelineContext?this._pipelineContext.isReady:!1},r.prototype.getEngine=function(){return this._engine},r.prototype.getPipelineContext=function(){return this._pipelineContext},r.prototype.getAttributesNames=function(){return this._attributesNames},r.prototype.getAttributeLocation=function(e){return this._attributes[e]},r.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},r.prototype.getAttributesCount=function(){return this._attributes.length},r.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},r.prototype.getUniform=function(e){return this._uniforms[e]},r.prototype.getSamplers=function(){return this._samplerList},r.prototype.getUniformNames=function(){return this._uniformsNames},r.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},r.prototype.getIndexParameters=function(){return this._indexParameters},r.prototype.getCompilationError=function(){return this._compilationError},r.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},r.prototype.executeWhenCompiled=function(e){var t=this;if(this.isReady()){e(this);return}this.onCompileObservable.add(function(i){e(i)}),(!this._pipelineContext||this._pipelineContext.isAsync)&&setTimeout(function(){t._checkIsReady(null)},16)},r.prototype._checkIsReady=function(e){var t=this;try{if(this._isReadyInternal())return}catch(i){this._processCompilationErrors(i,e);return}this._isDisposed||setTimeout(function(){t._checkIsReady(e)},16)},r.prototype._loadShader=function(e,t,i,s){if(typeof HTMLElement!="undefined"&&e instanceof HTMLElement){var n=ne(e);s(n);return}if(e.substr(0,7)==="source:"){s(e.substr(7));return}if(e.substr(0,7)==="base64:"){var a=window.atob(e.substr(7));s(a);return}var o=D.GetShadersStore(this._shaderLanguage);if(o[e+t+"Shader"]){s(o[e+t+"Shader"]);return}if(i&&o[e+i+"Shader"]){s(o[e+i+"Shader"]);return}var l;e[0]==="."||e[0]==="/"||e.indexOf("http")>-1?l=e:l=D.GetShadersRepository(this._shaderLanguage)+e,this._engine._loadFile(l+"."+t.toLowerCase()+".fx",s)},Object.defineProperty(r.prototype,"vertexSourceCode",{get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(t=(e=this._pipelineContext)===null||e===void 0?void 0:e._getVertexShaderCode())!==null&&t!==void 0?t:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fragmentSourceCode",{get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(t=(e=this._pipelineContext)===null||e===void 0?void 0:e._getFragmentShaderCode())!==null&&t!==void 0?t:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),r.prototype._rebuildProgram=function(e,t,i,s){var n=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(a,o){s&&s(o)},this.onCompiled=function(){var a=n.getEngine().scenes;if(a)for(var o=0;o<a.length;o++)a[o].markAllMaterialsAsDirty(63);n._pipelineContext._handlesSpectorRebuildCallback(i)},this._fallbacks=null,this._prepareEffect()},r.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,i=this.defines,s=this._pipelineContext;this._isReady=!1;try{var n=this._engine;this._pipelineContext=n.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key;var a=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?n._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,a,null,this._transformFeedbackVaryings,this._key):n._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,a,i,this._transformFeedbackVaryings,this._key),n._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(e._attributes=[],e._pipelineContext._fillEffectInformation(e,e._uniformBuffersNames,e._uniformsNames,e._uniforms,e._samplerList,e._samplers,t,e._attributes),t)for(var o=0;o<t.length;o++){var l=t[o];e._attributeLocationByName[l]=e._attributes[o]}n.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),s&&e.getEngine()._deletePipelineContext(s)}),this._pipelineContext.isAsync&&this._checkIsReady(s)}catch(o){this._processCompilationErrors(o,s)}},r.prototype._getShaderCodeAndErrorLine=function(e,t,i){var s=i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,n=null;if(t&&e){var a=t.match(s);if(a&&a.length===2){var o=parseInt(a[1]),l=e.split(`
`,-1);l.length>=o&&(n="Offending line [".concat(o,"] in ").concat(i?"fragment":"vertex"," code: ").concat(l[o-1]))}}return[e,n]},r.prototype._processCompilationErrors=function(e,t){var i,s,n,a,o;t===void 0&&(t=null),this._compilationError=e.message;var l=this._attributesNames,u=this._fallbacks;if(P.Error("Unable to compile effect:"),P.Error("Uniforms: "+this._uniformsNames.map(function(p){return" "+p})),P.Error("Attributes: "+l.map(function(p){return" "+p})),P.Error(`Defines:\r
`+this.defines),r.LogShaderCodeOnCompilationError){var h=null,f=null,_=null;!((n=this._pipelineContext)===null||n===void 0)&&n._getVertexShaderCode()&&(i=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),_=i[0],h=i[1],_&&(P.Error("Vertex code:"),P.Error(_))),!((a=this._pipelineContext)===null||a===void 0)&&a._getFragmentShaderCode()&&(s=this._getShaderCodeAndErrorLine((o=this._pipelineContext)===null||o===void 0?void 0:o._getFragmentShaderCode(),this._compilationError,!0),_=s[0],f=s[1],_&&(P.Error("Fragment code:"),P.Error(_))),h&&P.Error(h),f&&P.Error(f)}P.Error("Error: "+this._compilationError),t&&(this._pipelineContext=t,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),u?(this._pipelineContext=null,u.hasMoreFallbacks?(this._allFallbacksProcessed=!1,P.Error("Trying next fallback."),this.defines=u.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(r.prototype,"isSupported",{get:function(){return this._compilationError===""},enumerable:!1,configurable:!0}),r.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t,e)},r.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)},r.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)},r.prototype.setTextureArray=function(e,t){var i=e+"Ex";if(this._samplerList.indexOf(i+"0")===-1){for(var s=this._samplerList.indexOf(e),n=1;n<t.length;n++){var a=i+(n-1).toString();this._samplerList.splice(s+n,0,a)}for(var o=0,l=0,u=this._samplerList;l<u.length;l++){var h=u[l];this._samplers[h]=o,o+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)},r.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)},r.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)},r.prototype.bindUniformBuffer=function(e,t){var i=this._uniformBuffersNames[t];i===void 0||r._BaseCache[i]===e&&this._engine._features.useUBOBindingCache||(r._BaseCache[i]=e,this._engine.bindUniformBufferBase(e,i,t))},r.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},r.prototype.setInt=function(e,t){return this._pipelineContext.setInt(e,t),this},r.prototype.setInt2=function(e,t,i){return this._pipelineContext.setInt2(e,t,i),this},r.prototype.setInt3=function(e,t,i,s){return this._pipelineContext.setInt3(e,t,i,s),this},r.prototype.setInt4=function(e,t,i,s,n){return this._pipelineContext.setInt4(e,t,i,s,n),this},r.prototype.setIntArray=function(e,t){return this._pipelineContext.setIntArray(e,t),this},r.prototype.setIntArray2=function(e,t){return this._pipelineContext.setIntArray2(e,t),this},r.prototype.setIntArray3=function(e,t){return this._pipelineContext.setIntArray3(e,t),this},r.prototype.setIntArray4=function(e,t){return this._pipelineContext.setIntArray4(e,t),this},r.prototype.setFloatArray=function(e,t){return this._pipelineContext.setArray(e,t),this},r.prototype.setFloatArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},r.prototype.setFloatArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},r.prototype.setFloatArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},r.prototype.setArray=function(e,t){return this._pipelineContext.setArray(e,t),this},r.prototype.setArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},r.prototype.setArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},r.prototype.setArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},r.prototype.setMatrices=function(e,t){return this._pipelineContext.setMatrices(e,t),this},r.prototype.setMatrix=function(e,t){return this._pipelineContext.setMatrix(e,t),this},r.prototype.setMatrix3x3=function(e,t){return this._pipelineContext.setMatrix3x3(e,t),this},r.prototype.setMatrix2x2=function(e,t){return this._pipelineContext.setMatrix2x2(e,t),this},r.prototype.setFloat=function(e,t){return this._pipelineContext.setFloat(e,t),this},r.prototype.setBool=function(e,t){return this._pipelineContext.setInt(e,t?1:0),this},r.prototype.setVector2=function(e,t){return this._pipelineContext.setVector2(e,t),this},r.prototype.setFloat2=function(e,t,i){return this._pipelineContext.setFloat2(e,t,i),this},r.prototype.setVector3=function(e,t){return this._pipelineContext.setVector3(e,t),this},r.prototype.setFloat3=function(e,t,i,s){return this._pipelineContext.setFloat3(e,t,i,s),this},r.prototype.setVector4=function(e,t){return this._pipelineContext.setVector4(e,t),this},r.prototype.setQuaternion=function(e,t){return this._pipelineContext.setQuaternion(e,t),this},r.prototype.setFloat4=function(e,t,i,s,n){return this._pipelineContext.setFloat4(e,t,i,s,n),this},r.prototype.setColor3=function(e,t){return this._pipelineContext.setColor3(e,t),this},r.prototype.setColor4=function(e,t,i){return this._pipelineContext.setColor4(e,t,i),this},r.prototype.setDirectColor4=function(e,t){return this._pipelineContext.setDirectColor4(e,t),this},r.prototype.dispose=function(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseEffect(this),this._isDisposed=!0},r.RegisterShader=function(e,t,i,s){s===void 0&&(s=A.GLSL),t&&(D.GetShadersStore(s)["".concat(e,"PixelShader")]=t),i&&(D.GetShadersStore(s)["".concat(e,"VertexShader")]=i)},r.ResetCache=function(){r._BaseCache={}},r.LogShaderCodeOnCompilationError=!0,r._UniqueIdSeed=0,r._BaseCache={},r.ShadersStore=D.ShadersStore,r.IncludesShadersStore=D.IncludesShadersStore,r}(),Se=function(){function r(e){e===void 0&&(e=!0),this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"zOffsetUnits",{get:function(){return this._zOffsetUnits},set:function(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1},r.prototype.apply=function(e){!this.isDirty||(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},r}(),Ce=function(){function r(){this.reset()}return r.prototype.reset=function(){this.enabled=!1,this.mask=255,this.func=r.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=r.KEEP,this.opDepthFail=r.KEEP,this.opStencilDepthPass=r.REPLACE},Object.defineProperty(r.prototype,"stencilFunc",{get:function(){return this.func},set:function(e){this.func=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilFuncRef",{get:function(){return this.funcRef},set:function(e){this.funcRef=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilFuncMask",{get:function(){return this.funcMask},set:function(e){this.funcMask=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilOpStencilFail",{get:function(){return this.opStencilFail},set:function(e){this.opStencilFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilOpDepthFail",{get:function(){return this.opDepthFail},set:function(e){this.opDepthFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilOpStencilDepthPass",{get:function(){return this.opStencilDepthPass},set:function(e){this.opStencilDepthPass=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilMask",{get:function(){return this.mask},set:function(e){this.mask=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilTest",{get:function(){return this.enabled},set:function(e){this.enabled=e},enumerable:!1,configurable:!0}),r.ALWAYS=519,r.KEEP=7680,r.REPLACE=7681,r}(),Ae=function(){function r(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),r.prototype.setAlphaBlendConstants=function(e,t,i,s){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===i&&this._blendConstants[3]===s||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=s,this._isBlendConstantsDirty=!0)},r.prototype.setAlphaBlendFunctionParameters=function(e,t,i,s){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===s||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=s,this._isBlendFunctionParametersDirty=!0)},r.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},r.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},r.prototype.apply=function(e){!this.isDirty||(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},r}(),xe=function(){function r(){this.shaderLanguage=A.GLSL}return r.prototype.postProcessor=function(e,t,i,s,n){if(!n.getCaps().drawBuffersExtension){var a=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;e=e.replace(a,"")}return e},r}(),Pe=function(){function r(){this.shaderLanguage=A.GLSL}return r.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},r.prototype.varyingProcessor=function(e,t){return e.replace("varying",t?"in":"out")},r.prototype.postProcessor=function(e,t,i){var s=e.search(/#extension.+GL_EXT_draw_buffers.+require/)!==-1,n=/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g;if(e=e.replace(n,""),e=e.replace(/texture2D\s*\(/g,"texture("),i)e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod("),e=e.replace(/textureCubeLodEXT\s*\(/g,"textureLod("),e=e.replace(/textureCube\s*\(/g,"texture("),e=e.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),e=e.replace(/gl_FragColor/g,"glFragColor"),e=e.replace(/gl_FragData/g,"glFragData"),e=e.replace(/void\s+?main\s*\(/g,(s?"":`out vec4 glFragColor;
`)+"void main(");else{var a=t.indexOf("#define MULTIVIEW")!==-1;if(a)return`#extension GL_OVR_multiview2 : require
layout (num_views = 2) in;
`+e}return e},r}(),Fe=function(){function r(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=r._Counter++}return Object.defineProperty(r.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),r._Counter=0,r}(),ie=function(r){M(e,r);function e(t){var i=r.call(this)||this;return i._buffer=t,i}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),e}(Fe),we=function(){function r(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(r.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isReady",{get:function(){return this.program?this.isParallelCompiled?this.engine._isRenderingStateCompiled(this):!0:!1},enumerable:!1,configurable:!0}),r.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},r.prototype._fillEffectInformation=function(e,t,i,s,n,a,o,l){var u=this.engine;if(u.supportsUniformBuffers)for(var h in t)e.bindUniformBlock(h,t[h]);var f=this.engine.getUniforms(this,i);f.forEach(function(E,m){s[i[m]]=E}),this._uniforms=s;var _;for(_=0;_<n.length;_++){var p=e.getUniform(n[_]);p==null&&(n.splice(_,1),_--)}n.forEach(function(E,m){a[E]=m});for(var d=0,y=u.getAttributes(this,o);d<y.length;d++){var g=y[d];l.push(g)}},r.prototype.dispose=function(){this._uniforms={}},r.prototype._cacheMatrix=function(e,t){var i=this._valueCache[e],s=t.updateFlag;return i!==void 0&&i===s?!1:(this._valueCache[e]=s,!0)},r.prototype._cacheFloat2=function(e,t,i){var s=this._valueCache[e];if(!s||s.length!==2)return s=[t,i],this._valueCache[e]=s,!0;var n=!1;return s[0]!==t&&(s[0]=t,n=!0),s[1]!==i&&(s[1]=i,n=!0),n},r.prototype._cacheFloat3=function(e,t,i,s){var n=this._valueCache[e];if(!n||n.length!==3)return n=[t,i,s],this._valueCache[e]=n,!0;var a=!1;return n[0]!==t&&(n[0]=t,a=!0),n[1]!==i&&(n[1]=i,a=!0),n[2]!==s&&(n[2]=s,a=!0),a},r.prototype._cacheFloat4=function(e,t,i,s,n){var a=this._valueCache[e];if(!a||a.length!==4)return a=[t,i,s,n],this._valueCache[e]=a,!0;var o=!1;return a[0]!==t&&(a[0]=t,o=!0),a[1]!==i&&(a[1]=i,o=!0),a[2]!==s&&(a[2]=s,o=!0),a[3]!==n&&(a[3]=n,o=!0),o},r.prototype.setInt=function(e,t){var i=this._valueCache[e];i!==void 0&&i===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)},r.prototype.setInt2=function(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))},r.prototype.setInt3=function(e,t,i,s){this._cacheFloat3(e,t,i,s)&&(this.engine.setInt3(this._uniforms[e],t,i,s)||(this._valueCache[e]=null))},r.prototype.setInt4=function(e,t,i,s,n){this._cacheFloat4(e,t,i,s,n)&&(this.engine.setInt4(this._uniforms[e],t,i,s,n)||(this._valueCache[e]=null))},r.prototype.setIntArray=function(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)},r.prototype.setIntArray2=function(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)},r.prototype.setIntArray3=function(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)},r.prototype.setIntArray4=function(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)},r.prototype.setArray=function(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)},r.prototype.setArray2=function(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)},r.prototype.setArray3=function(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)},r.prototype.setArray4=function(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)},r.prototype.setMatrices=function(e,t){!t||(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))},r.prototype.setMatrix=function(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.toArray())||(this._valueCache[e]=null))},r.prototype.setMatrix3x3=function(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)},r.prototype.setMatrix2x2=function(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)},r.prototype.setFloat=function(e,t){var i=this._valueCache[e];i!==void 0&&i===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)},r.prototype.setVector2=function(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))},r.prototype.setFloat2=function(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setFloat2(this._uniforms[e],t,i)||(this._valueCache[e]=null))},r.prototype.setVector3=function(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))},r.prototype.setFloat3=function(e,t,i,s){this._cacheFloat3(e,t,i,s)&&(this.engine.setFloat3(this._uniforms[e],t,i,s)||(this._valueCache[e]=null))},r.prototype.setVector4=function(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))},r.prototype.setQuaternion=function(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))},r.prototype.setFloat4=function(e,t,i,s,n){this._cacheFloat4(e,t,i,s,n)&&(this.engine.setFloat4(this._uniforms[e],t,i,s,n)||(this._valueCache[e]=null))},r.prototype.setColor3=function(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))},r.prototype.setColor4=function(e,t,i){this._cacheFloat4(e,t.r,t.g,t.b,i)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,i)||(this._valueCache[e]=null))},r.prototype.setDirectColor4=function(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))},r.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},r.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},r}(),Le=function(){function r(e,t){if(e===void 0&&(e=null),this._MSAARenderBuffer=null,this._context=t,!e&&(e=t.createTexture(),!e))throw new Error("Unable to create webGL texture");this.set(e)}return Object.defineProperty(r.prototype,"underlyingResource",{get:function(){return this._webGLTexture},enumerable:!1,configurable:!0}),r.prototype.setUsage=function(){},r.prototype.set=function(e){this._webGLTexture=e},r.prototype.reset=function(){this._webGLTexture=null,this._MSAARenderBuffer=null},r.prototype.release=function(){this._MSAARenderBuffer&&(this._context.deleteRenderbuffer(this._MSAARenderBuffer),this._MSAARenderBuffer=null),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()},r}(),Be=function(){function r(e,t){t===void 0&&(t=!0),this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}return r.IsWrapper=function(e){return e.getPipelineContext===void 0},r.GetEffect=function(e){return e.getPipelineContext===void 0?e.effect:e},r.prototype.setEffect=function(e,t,i){var s;i===void 0&&(i=!0),this.effect=e,t!==void 0&&(this.defines=t),i&&((s=this.drawContext)===null||s===void 0||s.reset())},r.prototype.dispose=function(){var e;(e=this.drawContext)===null||e===void 0||e.dispose()},r}(),De=function(){function r(e){e===void 0&&(e=!0),this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"func",{get:function(){return this._func},set:function(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"funcRef",{get:function(){return this._funcRef},set:function(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"funcMask",{get:function(){return this._funcMask},set:function(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),r.prototype.reset=function(){var e;this.stencilMaterial=void 0,(e=this.stencilGlobal)===null||e===void 0||e.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},r.prototype.apply=function(e){var t;if(!!e){var i=!this.useStencilGlobalOnly&&!!(!((t=this.stencilMaterial)===null||t===void 0)&&t.enabled);this.enabled=i?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=i?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=i?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=i?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=i?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=i?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=i?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=i?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}},r}(),Oe=function(){function r(){}return r}(),Ge=function(){function r(e,t,i,s){var n=this;this._name="WebGL",this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=null,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this.disableUniformBuffers=!1,this.onDisposeObservable=new I,this._frameId=0,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new I,this.onContextRestoredObservable=new I,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new Se,this._stencilStateComposer=new De,this._stencilState=new Ce,this._alphaState=new Ae,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._renderTargetWrapperCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._activeRequests=new Array,this._adaptToDeviceRatio=!1,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new I,this._isWebGPU=!1,this._snapshotRenderingMode=0,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={};var a=null;if(i=i||{},this._creationOptions=i,this._adaptToDeviceRatio=s!=null?s:!1,this._stencilStateComposer.stencilGlobal=this._stencilState,he.SetMatrixPrecision(!!i.useHighPrecisionMatrix),!!e){if(s=s||i.adaptToDeviceRatio||!1,e.getContext){if(a=e,this._renderingCanvas=a,t!==void 0&&(i.antialias=t),i.deterministicLockstep===void 0&&(i.deterministicLockstep=!1),i.lockstepMaxSteps===void 0&&(i.lockstepMaxSteps=4),i.timeStep===void 0&&(i.timeStep=1/60),i.preserveDrawingBuffer===void 0&&(i.preserveDrawingBuffer=!1),i.audioEngine===void 0&&(i.audioEngine=!0),i.audioEngineOptions!==void 0&&i.audioEngineOptions.audioContext!==void 0&&(this._audioContext=i.audioEngineOptions.audioContext),i.audioEngineOptions!==void 0&&i.audioEngineOptions.audioDestination!==void 0&&(this._audioDestination=i.audioEngineOptions.audioDestination),i.stencil===void 0&&(i.stencil=!0),i.premultipliedAlpha===!1&&(this.premultipliedAlpha=!1),i.xrCompatible===void 0&&(i.xrCompatible=!0),this._doNotHandleContextLost=!!i.doNotHandleContextLost,navigator&&navigator.userAgent){this._checkForMobile=function(){var T=navigator.userAgent;n.hostInformation.isMobile=T.indexOf("Mobile")!==-1||T.indexOf("Mac")!==-1&&ee()&&"ontouchend"in document},this._checkForMobile(),O()&&window.addEventListener("resize",this._checkForMobile);for(var o=navigator.userAgent,l=0,u=r.ExceptionList;l<u.length;l++){var h=u[l],f=h.key,_=h.targets,p=new RegExp(f);if(p.test(o)){if(h.capture&&h.captureConstraint){var d=h.capture,y=h.captureConstraint,g=new RegExp(d),E=g.exec(o);if(E&&E.length>0){var m=parseInt(E[E.length-1]);if(m>=y)continue}}for(var b=0,x=_;b<x.length;b++){var c=x[b];switch(c){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":i.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1;break}}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(T){T.preventDefault(),n._contextWasLost=!0,P.Warn("WebGL context lost."),n.onContextLostObservable.notifyObservers(n)},this._onContextRestored=function(){n._restoreEngineAfterContextLost(n._initGLContext.bind(n))},a.addEventListener("webglcontextlost",this._onContextLost,!1),a.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference="high-performance"),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._badDesktopOS&&(i.xrCompatible=!1),!i.disableWebGL2Support)try{this._gl=a.getContext("webgl2",i)||a.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch{}if(!this._gl){if(!a)throw new Error("The provided canvas is null or undefined.");try{this._gl=a.getContext("webgl",i)||a.getContext("experimental-webgl",i)}catch{throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=e,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";var C=this._gl.getContextAttributes();C&&(i.stencil=C.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),i.useHighPrecisionFloats!==void 0&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats);var v=O()&&window.devicePixelRatio||1,R=i.limitDeviceRatio||v;this._hardwareScalingLevel=s?1/Math.min(R,v):1,this.resize(),this._isStencilEnable=!!i.stencil,this._initGLContext(),this._initFeatures();for(var S=0;S<this._caps.maxVertexAttribs;S++)this._currentBufferPointers[S]=new Oe;this._shaderProcessor=this.webGLVersion>1?new Pe:new xe,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent);var L="Babylon.js v".concat(r.Version);console.log(L+" - ".concat(this.description)),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",L)}}return Object.defineProperty(r,"NpmPackage",{get:function(){return"babylonjs@5.13.2"},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Version",{get:function(){return"5.13.2"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"description",{get:function(){var e=this.name+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"version",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ShadersRepository",{get:function(){return V.ShadersRepository},set:function(e){V.ShadersRepository=e},enumerable:!1,configurable:!0}),r.prototype._getShaderProcessor=function(e){return this._shaderProcessor},Object.defineProperty(r.prototype,"useReverseDepthBuffer",{get:function(){return this._useReverseDepthBuffer},set:function(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,e?this._depthCullingState.depthFunc=518:this._depthCullingState.depthFunc=515)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"frameId",{get:function(){return this._frameId},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),r.prototype.getCreationOptions=function(){return this._creationOptions},Object.defineProperty(r.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!!(this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"activeRenderLoops",{get:function(){return this._activeRenderLoops},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"framebufferDimensionsObject",{set:function(e){this._framebufferDimensionsObject=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isWebGPU",{get:function(){return this._isWebGPU},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shaderPlatformName",{get:function(){return this._shaderPlatformName},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"snapshotRendering",{get:function(){return!1},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"snapshotRenderingMode",{get:function(){return this._snapshotRenderingMode},set:function(e){this._snapshotRenderingMode=e},enumerable:!1,configurable:!0}),r.prototype.snapshotRenderingReset=function(){this.snapshotRendering=!1},r._CreateCanvas=function(e,t){if(typeof document=="undefined")return new OffscreenCanvas(e,t);var i=document.createElement("canvas");return i.width=e,i.height=t,i},r.prototype.createCanvas=function(e,t){return r._CreateCanvas(e,t)},r.prototype.createCanvasImage=function(){return document.createElement("img")},r.prototype._restoreEngineAfterContextLost=function(e){var t=this;setTimeout(function(){return fe(t,void 0,void 0,function(){var i,s,n,a,o;return _e(this,function(l){switch(l.label){case 0:return this._dummyFramebuffer=null,i=this._depthCullingState.depthTest,s=this._depthCullingState.depthFunc,n=this._depthCullingState.depthMask,a=this._stencilState.stencilTest,[4,e()];case 1:return l.sent(),this._rebuildEffects(),(o=this._rebuildComputeEffects)===null||o===void 0||o.call(this),this._rebuildInternalTextures(),this._rebuildRenderTargetWrappers(),this._rebuildBuffers(),this.wipeCaches(!0),this._depthCullingState.depthTest=i,this._depthCullingState.depthFunc=s,this._depthCullingState.depthMask=n,this._stencilState.stencilTest=a,P.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1,[2]}})})},0)},r.prototype._sharedInit=function(e,t,i){this._renderingCanvas=e},r.prototype._getShaderProcessingContext=function(e){return null},r.prototype._rebuildInternalTextures=function(){for(var e=this._internalTexturesCache.slice(),t=0,i=e;t<i.length;t++){var s=i[t];s._rebuild()}},r.prototype._rebuildRenderTargetWrappers=function(){for(var e=this._renderTargetWrapperCache.slice(),t=0,i=e;t<i.length;t++){var s=i[t];s._rebuild()}},r.prototype._rebuildEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e];t._pipelineContext=null,t._wasPreviouslyReady=!1,t._prepareEffect()}V.ResetCache()},r.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e];if(!t.isReady())return!1}return!0},r.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++){var i=t[e];i._rebuild()}for(var s=0,n=this._storageBuffers;s<n.length;s++){var a=n[s];a._rebuild()}},r.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||this._gl.getExtension("OES_standard_derivatives")!==null,maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||this._gl.getExtension("OES_element_index_uint")!==null,fragmentDepthSupported:this._webGLVersion>1||this._gl.getExtension("EXT_frag_depth")!==null,highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?256:128},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(e!=null&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),this._gl.HALF_FLOAT_OES!==36193&&(this._gl.HALF_FLOAT_OES=36193),this._gl.RGBA16F!==34842&&(this._gl.RGBA16F=34842),this._gl.RGBA32F!==34836&&(this._gl.RGBA32F=34836),this._gl.DEPTH24_STENCIL8!==35056&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(this._webGLVersion===1&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!!(this._caps.textureFloat&&this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!!(this._caps.textureFloat&&this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&this._gl.HALF_FLOAT_OES!==5131&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._maxMSAASamplesOverride!==null?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(t!==null){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var i=0;i<16;i++)this._gl["COLOR_ATTACHMENT"+i+"_WEBGL"]=t["COLOR_ATTACHMENT"+i+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var s=this._gl.getExtension("WEBGL_depth_texture");s!=null&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=s.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var n=this._gl.getExtension("OES_vertex_array_object");n!=null&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=n.createVertexArrayOES.bind(n),this._gl.bindVertexArray=n.bindVertexArrayOES.bind(n),this._gl.deleteVertexArray=n.deleteVertexArrayOES.bind(n))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var a=this._gl.getExtension("ANGLE_instanced_arrays");a!=null?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=a.drawArraysInstancedANGLE.bind(a),this._gl.drawElementsInstanced=a.drawElementsInstancedANGLE.bind(a),this._gl.vertexAttribDivisor=a.vertexAttribDivisorANGLE.bind(a)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var o=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),l=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);o&&l&&(this._caps.highPrecisionShaderSupported=o.precision!==0&&l.precision!==0)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var u=this._gl.getExtension("EXT_blend_minmax");u!=null&&(this._caps.blendMinMax=!0,this._gl.MAX=u.MAX_EXT,this._gl.MIN=u.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0;else{var h=this._gl.getExtension("EXT_sRGB");h!=null&&(this._caps.supportSRGBBuffers=!0,this._gl.SRGB=h.SRGB_EXT,this._gl.SRGB8=h.SRGB_ALPHA_EXT,this._gl.SRGB8_ALPHA8=h.SRGB_ALPHA_EXT)}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!!(this._creationOptions&&this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var f=0;f<this._maxSimultaneousTextures;f++)this._nextFreeTextureSlots.push(f)},r.prototype._initFeatures=function(){this._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:this._webGLVersion!==1,supportDepthStencilTexture:this._webGLVersion!==1,supportShadowSamplers:this._webGLVersion!==1,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:this._webGLVersion!==1,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:this._webGLVersion!==1,basisNeedsPOT:this._webGLVersion===1,support3DTextures:this._webGLVersion!==1,needTypeSuffixInShaderConstants:this._webGLVersion!==1,supportMSAA:this._webGLVersion!==1,supportSSAO2:this._webGLVersion!==1,supportExtendedTextureFormats:this._webGLVersion!==1,supportSwitchCaseInShader:this._webGLVersion!==1,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,_collectUbosUpdatedInFrame:!1}},Object.defineProperty(r.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),r.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(r.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),r.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=this.createCanvas(1,1);var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},r.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)!Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)||(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},r.prototype.getInfo=function(){return this.getGlInfo()},r.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},r.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},r.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},r.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},r.prototype.getCaps=function(){return this._caps},r.prototype.stopRenderLoop=function(e){if(!e){this._activeRenderLoops=[];return}var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)},r.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++){var i=this._activeRenderLoops[t];i()}this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},r.prototype.getRenderingCanvas=function(){return this._renderingCanvas},r.prototype.getAudioContext=function(){return this._audioContext},r.prototype.getAudioDestination=function(){return this._audioDestination},r.prototype.getHostWindow=function(){return O()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},r.prototype.getRenderWidth=function(e){return e===void 0&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},r.prototype.getRenderHeight=function(e){return e===void 0&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},r.prototype._queueNewFrame=function(e,t){return r.QueueNewFrame(e,t)},r.prototype.runRenderLoop=function(e){this._activeRenderLoops.indexOf(e)===-1&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},r.prototype.clear=function(e,t,i,s){s===void 0&&(s=!1);var n=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=n;var a=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,e.a!==void 0?e.a:1),a|=this._gl.COLOR_BUFFER_BIT),i&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),a|=this._gl.DEPTH_BUFFER_BIT),s&&(this._gl.clearStencil(0),a|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(a)},r.prototype._viewport=function(e,t,i,s){(e!==this._viewportCached.x||t!==this._viewportCached.y||i!==this._viewportCached.z||s!==this._viewportCached.w)&&(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=s,this._gl.viewport(e,t,i,s))},r.prototype.setViewport=function(e,t,i){var s=t||this.getRenderWidth(),n=i||this.getRenderHeight(),a=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(a*s,o*n,s*e.width,n*e.height)},r.prototype.beginFrame=function(){},r.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._frameId++},r.prototype.resize=function(e){e===void 0&&(e=!1);var t,i;if(this._adaptToDeviceRatio){var s=O()&&window.devicePixelRatio||1,n=this._creationOptions.limitDeviceRatio||s;this._hardwareScalingLevel=this._adaptToDeviceRatio?1/Math.min(n,s):1}O()?(t=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,i=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(t=this._renderingCanvas?this._renderingCanvas.width:100,i=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(t/this._hardwareScalingLevel,i/this._hardwareScalingLevel,e)},r.prototype.setSize=function(e,t,i){return i===void 0&&(i=!1),!this._renderingCanvas||(e=e|0,t=t|0,!i&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t)?!1:(this._renderingCanvas.width=e,this._renderingCanvas.height=t,!0)},r.prototype.bindFramebuffer=function(e,t,i,s,n,a,o){var l,u,h,f,_;t===void 0&&(t=0),a===void 0&&(a=0),o===void 0&&(o=0);var p=e;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(p._MSAAFramebuffer?p._MSAAFramebuffer:p._framebuffer);var d=this._gl;e.is2DArray?d.framebufferTextureLayer(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,(l=e.texture._hardwareTexture)===null||l===void 0?void 0:l.underlyingResource,a,o):e.isCube&&d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+t,(u=e.texture._hardwareTexture)===null||u===void 0?void 0:u.underlyingResource,a);var y=e._depthStencilTexture;if(y){var g=e._depthStencilTextureWithStencil?d.DEPTH_STENCIL_ATTACHMENT:d.DEPTH_ATTACHMENT;e.is2DArray?d.framebufferTextureLayer(d.FRAMEBUFFER,g,(h=y._hardwareTexture)===null||h===void 0?void 0:h.underlyingResource,a,o):e.isCube?d.framebufferTexture2D(d.FRAMEBUFFER,g,d.TEXTURE_CUBE_MAP_POSITIVE_X+t,(f=y._hardwareTexture)===null||f===void 0?void 0:f.underlyingResource,a):d.framebufferTexture2D(d.FRAMEBUFFER,g,d.TEXTURE_2D,(_=y._hardwareTexture)===null||_===void 0?void 0:_.underlyingResource,a)}this._cachedViewport&&!n?this.setViewport(this._cachedViewport,i,s):(i||(i=e.width,a&&(i=i/Math.pow(2,a))),s||(s=e.height,a&&(s=s/Math.pow(2,a))),this._viewport(0,0,i,s)),this.wipeCaches()},r.prototype.setState=function(e,t,i,s,n,a,o){var l,u;t===void 0&&(t=0),s===void 0&&(s=!1),o===void 0&&(o=0),(this._depthCullingState.cull!==e||i)&&(this._depthCullingState.cull=e);var h=!((u=(l=this.cullBackFaces)!==null&&l!==void 0?l:n)!==null&&u!==void 0)||u?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==h||i)&&(this._depthCullingState.cullFace=h),this.setZOffset(t),this.setZOffsetUnits(o);var f=s?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==f||i)&&(this._depthCullingState.frontFace=f),this._stencilStateComposer.stencilMaterial=a},r.prototype.setZOffset=function(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e},r.prototype.getZOffset=function(){var e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e},r.prototype.setZOffsetUnits=function(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e},r.prototype.getZOffsetUnits=function(){var e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e},r.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},r.prototype._currentFrameBufferIsDefaultFrameBuffer=function(){return this._currentFramebuffer===null},r.prototype.generateMipmaps=function(e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)},r.prototype.unBindFramebuffer=function(e,t,i){var s;t===void 0&&(t=!1);var n=e;this._currentRenderTarget=null;var a=this._gl;if(n._MSAAFramebuffer){if(e.isMulti){this.unBindMultiColorAttachmentFramebuffer(e,t,i);return}a.bindFramebuffer(a.READ_FRAMEBUFFER,n._MSAAFramebuffer),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,n._framebuffer),a.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,a.COLOR_BUFFER_BIT,a.NEAREST)}((s=e.texture)===null||s===void 0?void 0:s.generateMipMaps)&&!t&&!e.isCube&&this.generateMipmaps(e.texture),i&&(n._MSAAFramebuffer&&this._bindUnboundFramebuffer(n._framebuffer),i()),this._bindUnboundFramebuffer(null)},r.prototype.flushFramebuffer=function(){this._gl.flush()},r.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},r.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},r.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},r.prototype._createVertexBuffer=function(e,t){var i=this._gl.createBuffer();if(!i)throw new Error("Unable to create vertex buffer");var s=new ie(i);return this.bindArrayBuffer(s),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),this._resetVertexBufferBinding(),s.references=1,s},r.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},r.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},r.prototype.createIndexBuffer=function(e,t){var i=this._gl.createBuffer(),s=new ie(i);if(!i)throw new Error("Unable to create index buffer");this.bindIndexBuffer(s);var n=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),s.references=1,s.is32Bits=n.BYTES_PER_ELEMENT===4,s},r.prototype._normalizeIndexData=function(e){var t=e.BYTES_PER_ELEMENT;if(t===2)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var i=0;i<e.length;i++)if(e[i]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},r.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)},r.prototype.bindUniformBlock=function(e,t,i){var s=e.program,n=this._gl.getUniformBlockIndex(s,t);this._gl.uniformBlockBinding(s,n,i)},r.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},r.prototype._bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},r.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},r.prototype._vertexAttribPointer=function(e,t,i,s,n,a,o){var l=this._currentBufferPointers[t];if(!!l){var u=!1;l.active?(l.buffer!==e&&(l.buffer=e,u=!0),l.size!==i&&(l.size=i,u=!0),l.type!==s&&(l.type=s,u=!0),l.normalized!==n&&(l.normalized=n,u=!0),l.stride!==a&&(l.stride=a,u=!0),l.offset!==o&&(l.offset=o,u=!0)):(u=!0,l.active=!0,l.index=t,l.size=i,l.type=s,l.normalized=n,l.stride=a,l.offset=o,l.buffer=e),(u||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,i,s,n,a,o))}},r.prototype._bindIndexBufferWithCache=function(e){e!=null&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},r.prototype._bindVertexBuffersAttributes=function(e,t,i){var s=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var n=0;n<s.length;n++){var a=t.getAttributeLocation(n);if(a>=0){var o=s[n],l=null;if(i&&(l=i[o]),l||(l=e[o]),!l)continue;this._gl.enableVertexAttribArray(a),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[a]=!0);var u=l.getBuffer();u&&(this._vertexAttribPointer(u,a,l.getSize(),l.type,l.normalized,l.byteStride,l.byteOffset),l.getIsInstanced()&&(this._gl.vertexAttribDivisor(a,l.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(a),this._currentInstanceBuffers.push(u))))}}},r.prototype.recordVertexArrayObject=function(e,t,i,s){var n=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(n),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i,s),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),n},r.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=t!=null&&t.is32Bits,this._mustWipeVertexAttributes=!0)},r.prototype.bindBuffersDirectly=function(e,t,i,s,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n;var a=n.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var o=0,l=0;l<a;l++)if(l<i.length){var u=n.getAttributeLocation(l);u>=0&&(this._gl.enableVertexAttribArray(u),this._vertexAttribArraysEnabled[u]=!0,this._vertexAttribPointer(e,u,i[l],this._gl.FLOAT,!1,s,o)),o+=i[l]*4}}this._bindIndexBufferWithCache(t)},r.prototype._unbindVertexArrayObject=function(){!this._cachedVertexArrayObject||(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},r.prototype.bindBuffers=function(e,t,i,s){(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i)&&(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i,s)),this._bindIndexBufferWithCache(t)},r.prototype.unbindInstanceAttributes=function(){for(var e,t=0,i=this._currentInstanceLocations.length;t<i;t++){var s=this._currentInstanceBuffers[t];e!=s&&s.references&&(e=s,this.bindArrayBuffer(s));var n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},r.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},r.prototype._releaseBuffer=function(e){return e.references--,e.references===0?(this._deleteBuffer(e),!0):!1},r.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},r.prototype.updateAndBindInstancesBuffer=function(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),i[0].index!==void 0)this.bindInstancesBuffer(e,i,!0);else for(var s=0;s<4;s++){var n=i[s];this._vertexAttribArraysEnabled[n]||(this._gl.enableVertexAttribArray(n),this._vertexAttribArraysEnabled[n]=!0),this._vertexAttribPointer(e,n,4,this._gl.FLOAT,!1,64,s*16),this._gl.vertexAttribDivisor(n,1),this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(e)}},r.prototype.bindInstancesBuffer=function(e,t,i){i===void 0&&(i=!0),this.bindArrayBuffer(e);var s=0;if(i)for(var n=0;n<t.length;n++){var a=t[n];s+=a.attributeSize*4}for(var n=0;n<t.length;n++){var a=t[n];a.index===void 0&&(a.index=this._currentEffect.getAttributeLocationByName(a.attributeName)),!(a.index<0)&&(this._vertexAttribArraysEnabled[a.index]||(this._gl.enableVertexAttribArray(a.index),this._vertexAttribArraysEnabled[a.index]=!0),this._vertexAttribPointer(e,a.index,a.attributeSize,a.attributeType||this._gl.FLOAT,a.normalized||!1,s,a.offset),this._gl.vertexAttribDivisor(a.index,a.divisor===void 0?1:a.divisor),this._currentInstanceLocations.push(a.index),this._currentInstanceBuffers.push(e))}},r.prototype.disableInstanceAttributeByName=function(e){if(!!this._currentEffect){var t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}},r.prototype.disableInstanceAttribute=function(e){for(var t=!1,i;(i=this._currentInstanceLocations.indexOf(e))!==-1;)this._currentInstanceLocations.splice(i,1),this._currentInstanceBuffers.splice(i,1),t=!0,i=this._currentInstanceLocations.indexOf(e);t&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},r.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},r.prototype.draw=function(e,t,i,s){this.drawElementsType(e?0:1,t,i,s)},r.prototype.drawPointClouds=function(e,t,i){this.drawArraysType(2,e,t,i)},r.prototype.drawUnIndexed=function(e,t,i,s){this.drawArraysType(e?0:1,t,i,s)},r.prototype.drawElementsType=function(e,t,i,s){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e),a=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;s?this._gl.drawElementsInstanced(n,i,a,t*o,s):this._gl.drawElements(n,i,a,t*o)},r.prototype.drawArraysType=function(e,t,i,s){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e);s?this._gl.drawArraysInstanced(n,t,i,s):this._gl.drawArrays(n,t,i)},r.prototype._drawMode=function(e){switch(e){case 0:return this._gl.TRIANGLES;case 2:return this._gl.POINTS;case 1:return this._gl.LINES;case 3:return this._gl.POINTS;case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},r.prototype._reportDrawCall=function(){},r.prototype._releaseEffect=function(e){if(this._compiledEffects[e._key]){delete this._compiledEffects[e._key];var t=e.getPipelineContext();t&&this._deletePipelineContext(t)}},r.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},r.prototype._getGlobalDefines=function(e){if(e){this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER;return}else{var t="";return this.isNDCHalfZRange&&(t+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(t&&(t+=`
`),t+="#define USE_REVERSE_DEPTHBUFFER"),t}},r.prototype.createEffect=function(e,t,i,s,n,a,o,l,u,h){var f;h===void 0&&(h=A.GLSL);var _=e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e,p=e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e,d=this._getGlobalDefines(),y=(f=n!=null?n:t.defines)!==null&&f!==void 0?f:"";d&&(y+=d);var g=_+"+"+p+"@"+y;if(this._compiledEffects[g]){var E=this._compiledEffects[g];return o&&E.isReady()&&o(E),E}var m=new V(e,t,i,s,this,n,a,o,l,u,g,h);return this._compiledEffects[g]=m,m},r._ConcatenateShader=function(e,t,i){return i===void 0&&(i=""),i+(t?t+`
`:"")+e},r.prototype._compileShader=function(e,t,i,s){return this._compileRawShader(r._ConcatenateShader(e,i,s),t)},r.prototype._compileRawShader=function(e,t){var i=this._gl,s=i.createShader(t==="vertex"?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!s){for(var n=i.NO_ERROR,a=i.NO_ERROR;(a=i.getError())!==i.NO_ERROR;)n=a;throw new Error("Something went wrong while creating a gl ".concat(t," shader object. gl error=").concat(n,", gl isContextLost=").concat(i.isContextLost(),", _contextWasLost=").concat(this._contextWasLost))}return i.shaderSource(s,e),i.compileShader(s),s},r.prototype._getShaderSource=function(e){return this._gl.getShaderSource(e)},r.prototype.createRawShaderProgram=function(e,t,i,s,n){n===void 0&&(n=null),s=s||this._gl;var a=this._compileRawShader(t,"vertex"),o=this._compileRawShader(i,"fragment");return this._createShaderProgram(e,a,o,s,n)},r.prototype.createShaderProgram=function(e,t,i,s,n,a){a===void 0&&(a=null),n=n||this._gl;var o=this._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",l=this._compileShader(t,"vertex",s,o),u=this._compileShader(i,"fragment",s,o);return this._createShaderProgram(e,l,u,n,a)},r.prototype.inlineShaderCode=function(e){return e},r.prototype.createPipelineContext=function(e){var t=new we;return t.engine=this,this._caps.parallelShaderCompile&&(t.isParallelCompiled=!0),t},r.prototype.createMaterialContext=function(){},r.prototype.createDrawContext=function(){},r.prototype._createShaderProgram=function(e,t,i,s,n){var a=s.createProgram();if(e.program=a,!a)throw new Error("Unable to create program");return s.attachShader(a,t),s.attachShader(a,i),s.linkProgram(a),e.context=s,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),a},r.prototype._finalizePipelineContext=function(e){var t=e.context,i=e.vertexShader,s=e.fragmentShader,n=e.program,a=t.getProgramParameter(n,t.LINK_STATUS);if(!a){if(!this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)){var o=this._gl.getShaderInfoLog(i);if(o)throw e.vertexCompilationError=o,new Error("VERTEX SHADER "+o)}if(!this._gl.getShaderParameter(s,this._gl.COMPILE_STATUS)){var o=this._gl.getShaderInfoLog(s);if(o)throw e.fragmentCompilationError=o,new Error("FRAGMENT SHADER "+o)}var l=t.getProgramInfoLog(n);if(l)throw e.programLinkError=l,new Error(l)}if(this.validateShaderPrograms){t.validateProgram(n);var u=t.getProgramParameter(n,t.VALIDATE_STATUS);if(!u){var l=t.getProgramInfoLog(n);if(l)throw e.programValidationError=l,new Error(l)}}t.deleteShader(i),t.deleteShader(s),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},r.prototype._preparePipelineContext=function(e,t,i,s,n,a,o,l,u,h){var f=e;s?f.program=this.createRawShaderProgram(f,t,i,void 0,u):f.program=this.createShaderProgram(f,t,i,l,void 0,u),f.program.__SPECTOR_rebuildProgram=o},r.prototype._isRenderingStateCompiled=function(e){var t=e;return this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)?(this._finalizePipelineContext(t),!0):!1},r.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var i=e;if(!i.isParallelCompiled){t();return}var s=i.onCompiled;s?i.onCompiled=function(){s(),t()}:i.onCompiled=t},r.prototype.getUniforms=function(e,t){for(var i=new Array,s=e,n=0;n<t.length;n++)i.push(this._gl.getUniformLocation(s.program,t[n]));return i},r.prototype.getAttributes=function(e,t){for(var i=[],s=e,n=0;n<t.length;n++)try{i.push(this._gl.getAttribLocation(s.program,t[n]))}catch{i.push(-1)}return i},r.prototype.enableEffect=function(e){e=e!==null&&Be.IsWrapper(e)?e.effect:e,!(!e||e===this._currentEffect)&&(this._stencilStateComposer.stencilMaterial=void 0,e=e,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},r.prototype.setInt=function(e,t){return e?(this._gl.uniform1i(e,t),!0):!1},r.prototype.setInt2=function(e,t,i){return e?(this._gl.uniform2i(e,t,i),!0):!1},r.prototype.setInt3=function(e,t,i,s){return e?(this._gl.uniform3i(e,t,i,s),!0):!1},r.prototype.setInt4=function(e,t,i,s,n){return e?(this._gl.uniform4i(e,t,i,s,n),!0):!1},r.prototype.setIntArray=function(e,t){return e?(this._gl.uniform1iv(e,t),!0):!1},r.prototype.setIntArray2=function(e,t){return!e||t.length%2!==0?!1:(this._gl.uniform2iv(e,t),!0)},r.prototype.setIntArray3=function(e,t){return!e||t.length%3!==0?!1:(this._gl.uniform3iv(e,t),!0)},r.prototype.setIntArray4=function(e,t){return!e||t.length%4!==0?!1:(this._gl.uniform4iv(e,t),!0)},r.prototype.setArray=function(e,t){return!e||t.length<1?!1:(this._gl.uniform1fv(e,t),!0)},r.prototype.setArray2=function(e,t){return!e||t.length%2!==0?!1:(this._gl.uniform2fv(e,t),!0)},r.prototype.setArray3=function(e,t){return!e||t.length%3!==0?!1:(this._gl.uniform3fv(e,t),!0)},r.prototype.setArray4=function(e,t){return!e||t.length%4!==0?!1:(this._gl.uniform4fv(e,t),!0)},r.prototype.setMatrices=function(e,t){return e?(this._gl.uniformMatrix4fv(e,!1,t),!0):!1},r.prototype.setMatrix3x3=function(e,t){return e?(this._gl.uniformMatrix3fv(e,!1,t),!0):!1},r.prototype.setMatrix2x2=function(e,t){return e?(this._gl.uniformMatrix2fv(e,!1,t),!0):!1},r.prototype.setFloat=function(e,t){return e?(this._gl.uniform1f(e,t),!0):!1},r.prototype.setFloat2=function(e,t,i){return e?(this._gl.uniform2f(e,t,i),!0):!1},r.prototype.setFloat3=function(e,t,i,s){return e?(this._gl.uniform3f(e,t,i,s),!0):!1},r.prototype.setFloat4=function(e,t,i,s,n){return e?(this._gl.uniform4f(e,t,i,s,n),!0):!1},r.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var e=this._colorWrite;this._gl.colorMask(e,e,e,e)}},r.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},r.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(r.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilStateComposer",{get:function(){return this._stencilStateComposer},enumerable:!1,configurable:!0}),r.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},r.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},r.prototype._getSamplingParameters=function(e,t){var i=this._gl,s=i.NEAREST,n=i.NEAREST;switch(e){case 11:s=i.LINEAR,t?n=i.LINEAR_MIPMAP_NEAREST:n=i.LINEAR;break;case 3:s=i.LINEAR,t?n=i.LINEAR_MIPMAP_LINEAR:n=i.LINEAR;break;case 8:s=i.NEAREST,t?n=i.NEAREST_MIPMAP_LINEAR:n=i.NEAREST;break;case 4:s=i.NEAREST,t?n=i.NEAREST_MIPMAP_NEAREST:n=i.NEAREST;break;case 5:s=i.NEAREST,t?n=i.LINEAR_MIPMAP_NEAREST:n=i.LINEAR;break;case 6:s=i.NEAREST,t?n=i.LINEAR_MIPMAP_LINEAR:n=i.LINEAR;break;case 7:s=i.NEAREST,n=i.LINEAR;break;case 1:s=i.NEAREST,n=i.NEAREST;break;case 9:s=i.LINEAR,t?n=i.NEAREST_MIPMAP_NEAREST:n=i.NEAREST;break;case 10:s=i.LINEAR,t?n=i.NEAREST_MIPMAP_LINEAR:n=i.NEAREST;break;case 2:s=i.LINEAR,n=i.LINEAR;break;case 12:s=i.LINEAR,n=i.NEAREST;break}return{min:n,mag:s}},r.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},r.prototype._createHardwareTexture=function(){return new Le(this._createTexture(),this._gl)},r.prototype._createInternalTexture=function(e,t,i,s){s===void 0&&(s=F.Unknown);var n={};t!==void 0&&typeof t=="object"?(n.generateMipMaps=t.generateMipMaps,n.type=t.type===void 0?0:t.type,n.samplingMode=t.samplingMode===void 0?3:t.samplingMode,n.format=t.format===void 0?5:t.format,n.useSRGBBuffer=t.useSRGBBuffer===void 0?!1:t.useSRGBBuffer):(n.generateMipMaps=t,n.type=0,n.samplingMode=3,n.format=5,n.useSRGBBuffer=!1),n.useSRGBBuffer=n.useSRGBBuffer&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU),(n.type===1&&!this._caps.textureFloatLinearFiltering||n.type===2&&!this._caps.textureHalfFloatLinearFiltering)&&(n.samplingMode=1),n.type===1&&!this._caps.textureFloat&&(n.type=0,P.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));var a=this._gl,o=new Q(this,s);o._useSRGBBuffer=!!n.useSRGBBuffer;var l=e.width||e,u=e.height||e,h=e.layers||0,f=this._getSamplingParameters(n.samplingMode,!!n.generateMipMaps),_=h!==0?a.TEXTURE_2D_ARRAY:a.TEXTURE_2D,p=this._getRGBABufferInternalSizedFormat(n.type,n.format,n.useSRGBBuffer),d=this._getInternalFormat(n.format),y=this._getWebGLTextureType(n.type);return this._bindTextureDirectly(_,o),h!==0?(o.is2DArray=!0,a.texImage3D(_,0,p,l,u,h,0,d,y,null)):a.texImage2D(_,0,p,l,u,0,d,y,null),a.texParameteri(_,a.TEXTURE_MAG_FILTER,f.mag),a.texParameteri(_,a.TEXTURE_MIN_FILTER,f.min),a.texParameteri(_,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(_,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),n.generateMipMaps&&this._gl.generateMipmap(_),this._bindTextureDirectly(_,null),o.baseWidth=l,o.baseHeight=u,o.width=l,o.height=u,o.depth=h,o.isReady=!0,o.samples=1,o.generateMipMaps=!!n.generateMipMaps,o.samplingMode=n.samplingMode,o.type=n.type,o.format=n.format,this._internalTexturesCache.push(o),o},r.prototype._getUseSRGBBuffer=function(e,t){return e&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||t)},r.prototype._createTextureBase=function(e,t,i,s,n,a,o,l,u,h,f,_,p,d,y,g){var E=this;n===void 0&&(n=3),a===void 0&&(a=null),o===void 0&&(o=null),h===void 0&&(h=null),f===void 0&&(f=null),_===void 0&&(_=null),p===void 0&&(p=null),e=e||"";var m=e.substr(0,5)==="data:",b=e.substr(0,5)==="blob:",x=m&&e.indexOf(";base64,")!==-1,c=f||new Q(this,F.Url),C=e;this._transformTextureUrl&&!x&&!f&&!h&&(e=this._transformTextureUrl(e)),C!==e&&(c._originalUrl=C);var v=e.lastIndexOf("."),R=p||(v>-1?e.substring(v).toLowerCase():""),S=null,L=R.indexOf("?");L>-1&&(R=R.split("?")[0]);for(var T=0,B=r._TextureLoaders;T<B.length;T++){var U=B[T];if(U.canLoad(R,d)){S=U;break}}s&&s._addPendingData(c),c.url=e,c.generateMipMaps=!t,c.samplingMode=n,c.invertY=i,c._useSRGBBuffer=this._getUseSRGBBuffer(!!g,t),this._doNotHandleContextLost||(c._buffer=h);var N=null;a&&!f&&(N=c.onLoadedObservable.add(a)),f||this._internalTexturesCache.push(c);var X=function(w,k){s&&s._removePendingData(c),e===C?(N&&c.onLoadedObservable.remove(N),q.UseFallbackTexture&&E._createTextureBase(q.FallbackTexture,t,c.invertY,s,n,null,o,l,u,h,c),w=(w||"Unknown error")+(q.UseFallbackTexture?" - Fallback texture was used":""),c.onErrorObservable.notifyObservers({message:w,exception:k}),o&&o(w,k)):(P.Warn("Failed to load ".concat(e,", falling back to ").concat(C)),E._createTextureBase(C,t,c.invertY,s,n,a,o,l,u,h,c,_,p,d,y,g))};if(S){var K=function(w){S.loadData(w,c,function(k,se,ae,oe,le,ue){ue?X("TextureLoader failed to load data"):l(c,R,s,{width:k,height:se},c.invertY,!ae,oe,function(){return le(),!1},n)},y)};h?h instanceof ArrayBuffer?K(new Uint8Array(h)):ArrayBuffer.isView(h)?K(h):o&&o("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(e,function(w){return K(new Uint8Array(w))},void 0,s?s.offlineProvider:void 0,!0,function(w,k){X("Unable to load "+(w&&w.responseURL,k))})}else{var j=function(w){b&&!E._doNotHandleContextLost&&(c._buffer=w),l(c,R,s,w,c.invertY,t,!1,u,n)};!m||x?h&&(typeof h.decoding=="string"||h.close)?j(h):r._FileToolsLoadImage(e,j,X,s?s.offlineProvider:null,d,c.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):typeof h=="string"||h instanceof ArrayBuffer||ArrayBuffer.isView(h)||h instanceof Blob?r._FileToolsLoadImage(h,j,X,s?s.offlineProvider:null,d,c.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):h&&j(h)}return c},r.prototype.createTexture=function(e,t,i,s,n,a,o,l,u,h,f,_,p,d,y){var g=this;return n===void 0&&(n=3),a===void 0&&(a=null),o===void 0&&(o=null),l===void 0&&(l=null),u===void 0&&(u=null),h===void 0&&(h=null),f===void 0&&(f=null),this._createTextureBase(e,t,i,s,n,a,o,this._prepareWebGLTexture.bind(this),function(E,m,b,x,c,C){var v=g._gl,R=b.width===E&&b.height===m,S=h?g._getInternalFormat(h,c._useSRGBBuffer):x===".jpg"&&!c._useSRGBBuffer?v.RGB:c._useSRGBBuffer?v.SRGB8_ALPHA8:v.RGBA,L=h?g._getInternalFormat(h):x===".jpg"&&!c._useSRGBBuffer?v.RGB:v.RGBA;if(c._useSRGBBuffer&&g.webGLVersion===1&&(L=S),R)return v.texImage2D(v.TEXTURE_2D,0,S,L,v.UNSIGNED_BYTE,b),!1;var T=g._caps.maxTextureSize;if(b.width>T||b.height>T||!g._supportsHardwareTextureRescaling)return g._prepareWorkingCanvas(),!g._workingCanvas||!g._workingContext||(g._workingCanvas.width=E,g._workingCanvas.height=m,g._workingContext.drawImage(b,0,0,b.width,b.height,0,0,E,m),v.texImage2D(v.TEXTURE_2D,0,S,L,v.UNSIGNED_BYTE,g._workingCanvas),c.width=E,c.height=m),!1;var B=new Q(g,F.Temp);return g._bindTextureDirectly(v.TEXTURE_2D,B,!0),v.texImage2D(v.TEXTURE_2D,0,S,L,v.UNSIGNED_BYTE,b),g._rescaleTexture(B,c,s,S,function(){g._releaseTexture(B),g._bindTextureDirectly(v.TEXTURE_2D,c,!0),C()}),!0},l,u,h,f,_,p,y)},r._FileToolsLoadImage=function(e,t,i,s,n,a){throw G("FileTools")},r.prototype._rescaleTexture=function(e,t,i,s,n){},r.prototype.createRawTexture=function(e,t,i,s,n,a,o,l,u,h,f){throw G("Engine.RawTexture")},r.prototype.createRawCubeTexture=function(e,t,i,s,n,a,o,l){throw G("Engine.RawTexture")},r.prototype.createRawTexture3D=function(e,t,i,s,n,a,o,l,u,h){throw G("Engine.RawTexture")},r.prototype.createRawTexture2DArray=function(e,t,i,s,n,a,o,l,u,h){throw G("Engine.RawTexture")},r.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},r.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},r.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},r.prototype.updateTextureSamplingMode=function(e,t,i){i===void 0&&(i=!1);var s=this._getTextureTarget(t),n=this._getSamplingParameters(e,t.generateMipMaps||i);this._setTextureParameterInteger(s,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(s,this._gl.TEXTURE_MIN_FILTER,n.min),i&&(t.generateMipMaps=!0,this._gl.generateMipmap(s)),this._bindTextureDirectly(s,null),t.samplingMode=e},r.prototype.updateTextureDimensions=function(e,t,i,s){},r.prototype.updateTextureWrappingMode=function(e,t,i,s){i===void 0&&(i=null),s===void 0&&(s=null);var n=this._getTextureTarget(e);t!==null&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),i!==null&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i),e),e._cachedWrapV=i),(e.is2DArray||e.is3D)&&s!==null&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(s),e),e._cachedWrapR=s),this._bindTextureDirectly(n,null)},r.prototype._setupDepthStencilTexture=function(e,t,i,s,n,a){a===void 0&&(a=1);var o=t.width||t,l=t.height||t,u=t.layers||0;e.baseWidth=o,e.baseHeight=l,e.width=o,e.height=l,e.is2DArray=u>0,e.depth=u,e.isReady=!0,e.samples=a,e.generateMipMaps=!1,e.samplingMode=s?2:1,e.type=0,e._comparisonFunction=n;var h=this._gl,f=this._getTextureTarget(e),_=this._getSamplingParameters(e.samplingMode,!1);h.texParameteri(f,h.TEXTURE_MAG_FILTER,_.mag),h.texParameteri(f,h.TEXTURE_MIN_FILTER,_.min),h.texParameteri(f,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(f,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),this.webGLVersion>1&&(n===0?(h.texParameteri(f,h.TEXTURE_COMPARE_FUNC,515),h.texParameteri(f,h.TEXTURE_COMPARE_MODE,h.NONE)):(h.texParameteri(f,h.TEXTURE_COMPARE_FUNC,n),h.texParameteri(f,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE)))},r.prototype._uploadCompressedDataToTextureDirectly=function(e,t,i,s,n,a,o){a===void 0&&(a=0),o===void 0&&(o=0);var l=this._gl,u=l.TEXTURE_2D;if(e.isCube&&(u=l.TEXTURE_CUBE_MAP_POSITIVE_X+a),e._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=l.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case 36492:t=l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=l.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1;break}this._gl.compressedTexImage2D(u,o,t,i,s,0,n)},r.prototype._uploadDataToTextureDirectly=function(e,t,i,s,n,a){i===void 0&&(i=0),s===void 0&&(s=0),a===void 0&&(a=!1);var o=this._gl,l=this._getWebGLTextureType(e.type),u=this._getInternalFormat(e.format),h=n===void 0?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(n,e._useSRGBBuffer);this._unpackFlipY(e.invertY);var f=o.TEXTURE_2D;e.isCube&&(f=o.TEXTURE_CUBE_MAP_POSITIVE_X+i);var _=Math.round(Math.log(e.width)*Math.LOG2E),p=Math.round(Math.log(e.height)*Math.LOG2E),d=a?e.width:Math.pow(2,Math.max(_-s,0)),y=a?e.height:Math.pow(2,Math.max(p-s,0));o.texImage2D(f,s,h,d,y,0,u,l,t)},r.prototype.updateTextureData=function(e,t,i,s,n,a,o,l,u){o===void 0&&(o=0),l===void 0&&(l=0),u===void 0&&(u=!1);var h=this._gl,f=this._getWebGLTextureType(e.type),_=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var p=h.TEXTURE_2D;e.isCube&&(p=h.TEXTURE_CUBE_MAP_POSITIVE_X+o),this._bindTextureDirectly(p,e,!0),h.texSubImage2D(p,l,i,s,n,a,_,f,t),u&&this._gl.generateMipmap(p),this._bindTextureDirectly(p,null)},r.prototype._uploadArrayBufferViewToTexture=function(e,t,i,s){i===void 0&&(i=0),s===void 0&&(s=0);var n=this._gl,a=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(a,e,!0),this._uploadDataToTextureDirectly(e,t,i,s),this._bindTextureDirectly(a,null,!0)},r.prototype._prepareWebGLTextureContinuation=function(e,t,i,s,n){var a=this._gl;if(!!a){var o=this._getSamplingParameters(n,!i);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,o.mag),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,o.min),!i&&!s&&a.generateMipmap(a.TEXTURE_2D),this._bindTextureDirectly(a.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},r.prototype._prepareWebGLTexture=function(e,t,i,s,n,a,o,l,u){var h=this;u===void 0&&(u=3);var f=this.getCaps().maxTextureSize,_=Math.min(f,this.needPOTTextures?r.GetExponentOfTwo(s.width,f):s.width),p=Math.min(f,this.needPOTTextures?r.GetExponentOfTwo(s.height,f):s.height),d=this._gl;if(!!d){if(!e._hardwareTexture){i&&i._removePendingData(e);return}this._bindTextureDirectly(d.TEXTURE_2D,e,!0),this._unpackFlipY(n===void 0?!0:!!n),e.baseWidth=s.width,e.baseHeight=s.height,e.width=_,e.height=p,e.isReady=!0,!l(_,p,s,t,e,function(){h._prepareWebGLTextureContinuation(e,i,a,o,u)})&&this._prepareWebGLTextureContinuation(e,i,a,o,u)}},r.prototype._setupFramebufferDepthAttachments=function(e,t,i,s,n){n===void 0&&(n=1);var a=this._gl;if(e&&t)return this._createRenderBuffer(i,s,n,a.DEPTH_STENCIL,a.DEPTH24_STENCIL8,a.DEPTH_STENCIL_ATTACHMENT);if(t){var o=a.DEPTH_COMPONENT16;return this._webGLVersion>1&&(o=a.DEPTH_COMPONENT32F),this._createRenderBuffer(i,s,n,o,o,a.DEPTH_ATTACHMENT)}return e?this._createRenderBuffer(i,s,n,a.STENCIL_INDEX8,a.STENCIL_INDEX8,a.STENCIL_ATTACHMENT):null},r.prototype._createRenderBuffer=function(e,t,i,s,n,a,o){o===void 0&&(o=!0);var l=this._gl,u=l.createRenderbuffer();return l.bindRenderbuffer(l.RENDERBUFFER,u),i>1&&l.renderbufferStorageMultisample?l.renderbufferStorageMultisample(l.RENDERBUFFER,i,n,e,t):l.renderbufferStorage(l.RENDERBUFFER,s,e,t),l.framebufferRenderbuffer(l.FRAMEBUFFER,a,l.RENDERBUFFER,u),o&&l.bindRenderbuffer(l.RENDERBUFFER,null),u},r.prototype._releaseTexture=function(e){var t;this._deleteTexture((t=e._hardwareTexture)===null||t===void 0?void 0:t.underlyingResource),this.unbindAllTextures();var i=this._internalTexturesCache.indexOf(e);i!==-1&&this._internalTexturesCache.splice(i,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},r.prototype._releaseRenderTargetWrapper=function(e){var t=this._renderTargetWrapperCache.indexOf(e);t!==-1&&this._renderTargetWrapperCache.splice(t,1)},r.prototype._deleteTexture=function(e){e&&this._gl.deleteTexture(e)},r.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},r.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var i=e.getSamplers(),s=0;s<i.length;s++){var n=e.getUniform(i[s]);n&&(this._boundUniforms[s]=n)}this._currentEffect=null},r.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},r.prototype._bindTextureDirectly=function(e,t,i,s){var n,a;i===void 0&&(i=!1),s===void 0&&(s=!1);var o=!1,l=t&&t._associatedChannel>-1;i&&l&&(this._activeChannel=t._associatedChannel);var u=this._boundTexturesCache[this._activeChannel];if(u!==t||s){if(this._activateCurrentTexture(),t&&t.isMultiview)throw console.error(e,t),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,(a=(n=t==null?void 0:t._hardwareTexture)===null||n===void 0?void 0:n.underlyingResource)!==null&&a!==void 0?a:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else i&&(o=!0,this._activateCurrentTexture());return l&&!i&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),o},r.prototype._bindTexture=function(e,t,i){if(e!==void 0){t&&(t._associatedChannel=e),this._activeChannel=e;var s=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(s,t)}},r.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},r.prototype.setTexture=function(e,t,i,s){e!==void 0&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,i))},r.prototype._bindSamplerUniformToChannel=function(e,t){var i=this._boundUniforms[e];!i||i._currentState===t||(this._gl.uniform1i(i,t),i._currentState=t)},r.prototype._getTextureWrapMode=function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},r.prototype._setTexture=function(e,t,i,s,n){if(i===void 0&&(i=!1),s===void 0&&(s=!1),!t)return this._boundTexturesCache[e]!=null&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(t.delayLoadState===4)return t.delayLoad(),!1;var a;s?a=t.depthStencilTexture:t.isReady()?a=t.getInternalTexture():t.isCube?a=this.emptyCubeTexture:t.is3D?a=this.emptyTexture3D:t.is2DArray?a=this.emptyTexture2DArray:a=this.emptyTexture,!i&&a&&(a._associatedChannel=e);var o=!0;this._boundTexturesCache[e]===a&&(i||this._bindSamplerUniformToChannel(a._associatedChannel,e),o=!1),this._activeChannel=e;var l=this._getTextureTarget(a);if(o&&this._bindTextureDirectly(l,a,i),a&&!a.isMultiview){if(a.isCube&&a._cachedCoordinatesMode!==t.coordinatesMode){a._cachedCoordinatesMode=t.coordinatesMode;var u=t.coordinatesMode!==3&&t.coordinatesMode!==5?1:0;t.wrapU=u,t.wrapV=u}a._cachedWrapU!==t.wrapU&&(a._cachedWrapU=t.wrapU,this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),a)),a._cachedWrapV!==t.wrapV&&(a._cachedWrapV=t.wrapV,this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),a)),a.is3D&&a._cachedWrapR!==t.wrapR&&(a._cachedWrapR=t.wrapR,this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),a)),this._setAnisotropicLevel(l,a,t.anisotropicFilteringLevel)}return!0},r.prototype.setTextureArray=function(e,t,i,s){if(!(e===void 0||!t)){(!this._textureUnits||this._textureUnits.length!==i.length)&&(this._textureUnits=new Int32Array(i.length));for(var n=0;n<i.length;n++){var a=i[n].getInternalTexture();a?(this._textureUnits[n]=e+n,a._associatedChannel=e+n):this._textureUnits[n]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var o=0;o<i.length;o++)this._setTexture(this._textureUnits[o],i[o],!0)}},r.prototype._setAnisotropicLevel=function(e,t,i){var s=this._caps.textureAnisotropicFilterExtension;t.samplingMode!==11&&t.samplingMode!==3&&t.samplingMode!==2&&(i=1),s&&t._cachedAnisotropicFilteringLevel!==i&&(this._setTextureParameterFloat(e,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=i)},r.prototype._setTextureParameterFloat=function(e,t,i,s){this._bindTextureDirectly(e,s,!0,!0),this._gl.texParameterf(e,t,i)},r.prototype._setTextureParameterInteger=function(e,t,i,s){s&&this._bindTextureDirectly(e,s,!0,!0),this._gl.texParameteri(e,t,i)},r.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e);return}for(var e=0,t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)},r.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},r.prototype.dispose=function(){var e;this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),(e=this.releaseComputeEffects)===null||e===void 0||e.call(this),this.unbindAllAttributes(),this._boundUniforms=[],O()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),window.removeEventListener("resize",this._checkForMobile)),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,V.ResetCache();for(var t=0,i=this._activeRequests;t<i.length;t++){var s=i[t];s.abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},r.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},r.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},r.prototype.getError=function(){return this._gl.getError()},r.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},r.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},r.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var i=!0,s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);var a=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i=i&&a===t.FRAMEBUFFER_COMPLETE,i=i&&t.getError()===t.NO_ERROR,i&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i){t.bindFramebuffer(t.FRAMEBUFFER,null);var o=t.RGBA,l=t.UNSIGNED_BYTE,u=new Uint8Array(4);t.readPixels(0,0,1,1,o,l,u),i=i&&t.getError()===t.NO_ERROR}for(t.deleteTexture(s),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i},r.prototype._getWebGLTextureType=function(e){if(this._webGLVersion===1){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},r.prototype._getInternalFormat=function(e,t){t===void 0&&(t=!1);var i=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:i=this._gl.ALPHA;break;case 1:i=this._gl.LUMINANCE;break;case 2:i=this._gl.LUMINANCE_ALPHA;break;case 6:i=this._gl.RED;break;case 7:i=this._gl.RG;break;case 4:i=t?this._gl.SRGB:this._gl.RGB;break;case 5:i=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA;break}if(this._webGLVersion>1)switch(e){case 8:i=this._gl.RED_INTEGER;break;case 9:i=this._gl.RG_INTEGER;break;case 10:i=this._gl.RGB_INTEGER;break;case 11:i=this._gl.RGBA_INTEGER;break}return i},r.prototype._getRGBABufferInternalSizedFormat=function(e,t,i){if(i===void 0&&(i=!1),this._webGLVersion===1){if(t!==void 0)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return i?this._gl.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return i?this._gl.SRGB8:this._gl.RGB8;case 5:return i?this._gl.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;case 11:return this._gl.RGBA16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;case 11:return this._gl.RGBA16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;case 11:return this._gl.RGBA32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;case 11:return this._gl.RGBA32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;case 5:return this._gl.RGBA32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;case 5:return this._gl.RGBA16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return i?this._gl.SRGB8_ALPHA8:this._gl.RGBA8},r.prototype._getRGBAMultiSampleBufferFormat=function(e){return e===1?this._gl.RGBA32F:e===2?this._gl.RGBA16F:this._gl.RGBA8},r.prototype._loadFile=function(e,t,i,s,n,a){var o=this,l=r._FileToolsLoadFile(e,t,i,s,n,a);return this._activeRequests.push(l),l.onCompleteObservable.add(function(u){o._activeRequests.splice(o._activeRequests.indexOf(u),1)}),l},r._FileToolsLoadFile=function(e,t,i,s,n,a){throw G("FileTools")},r.prototype.readPixels=function(e,t,i,s,n,a){n===void 0&&(n=!0),a===void 0&&(a=!0);var o=n?4:3,l=n?this._gl.RGBA:this._gl.RGB,u=new Uint8Array(s*i*o);return a&&this.flushFramebuffer(),this._gl.readPixels(e,t,i,s,l,this._gl.UNSIGNED_BYTE,u),Promise.resolve(u)},Object.defineProperty(r,"IsSupportedAsync",{get:function(){return Promise.resolve(this.isSupported())},enumerable:!1,configurable:!0}),Object.defineProperty(r,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),r.isSupported=function(){if(this._HasMajorPerformanceCaveat!==null)return!this._HasMajorPerformanceCaveat;if(this._IsSupported===null)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=t!=null&&!!window.WebGLRenderingContext}catch{this._IsSupported=!1}return this._IsSupported},Object.defineProperty(r,"HasMajorPerformanceCaveat",{get:function(){if(this._HasMajorPerformanceCaveat===null)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch{this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),r.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e},r.FloorPOT=function(e){return e=e|e>>1,e=e|e>>2,e=e|e>>4,e=e|e>>8,e=e|e>>16,e-(e>>1)},r.NearestPOT=function(e){var t=r.CeilingPOT(e),i=r.FloorPOT(e);return t-e>e-i?i:t},r.GetExponentOfTwo=function(e,t,i){i===void 0&&(i=2);var s;switch(i){case 1:s=r.FloorPOT(e);break;case 2:s=r.NearestPOT(e);break;case 3:default:s=r.CeilingPOT(e);break}return Math.min(s,t)},r.QueueNewFrame=function(e,t){return O()?(t||(t=window),t.requestPostAnimationFrame?t.requestPostAnimationFrame(e):t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):typeof requestAnimationFrame!="undefined"?requestAnimationFrame(e):setTimeout(e,16)},r.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:ee()?document:null},r.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],r._TextureLoaders=[],r.CollisionsEpsilon=.001,r._IsSupported=null,r._HasMajorPerformanceCaveat=null,r}(),Ue=function(){function r(){}return Object.defineProperty(r,"Now",{get:function(){return be.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),r}();export{be as D,ne as G,O as I,P as L,I as O,Ue as P,z as S,Ge as T,Le as W,M as _,G as a,Q as b,F as c,ie as d,ee as e,te as f,fe as g,_e as h,ge as i,Me as j,Fe as k,Be as l,D as m};
