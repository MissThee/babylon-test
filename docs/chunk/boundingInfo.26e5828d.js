import{A as h,E as I}from"./arrayTools.49279cc5.js";import{Vector3 as n,Matrix as b}from"./math.vector.560c6bc4.js";var W=function(){function o(r,e,t){this.vectors=h.BuildArray(8,n.Zero),this.center=n.Zero(),this.centerWorld=n.Zero(),this.extendSize=n.Zero(),this.extendSizeWorld=n.Zero(),this.directions=h.BuildArray(3,n.Zero),this.vectorsWorld=h.BuildArray(8,n.Zero),this.minimumWorld=n.Zero(),this.maximumWorld=n.Zero(),this.minimum=n.Zero(),this.maximum=n.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(r,e,t)}return o.prototype.reConstruct=function(r,e,t){var i=r.x,s=r.y,u=r.z,a=e.x,c=e.y,l=e.z,m=this.vectors;this.minimum.copyFromFloats(i,s,u),this.maximum.copyFromFloats(a,c,l),m[0].copyFromFloats(i,s,u),m[1].copyFromFloats(a,c,l),m[2].copyFromFloats(a,s,u),m[3].copyFromFloats(i,c,u),m[4].copyFromFloats(i,s,l),m[5].copyFromFloats(a,c,u),m[6].copyFromFloats(i,c,l),m[7].copyFromFloats(a,s,l),e.addToRef(r,this.center).scaleInPlace(.5),e.subtractToRef(r,this.extendSize).scaleInPlace(.5),this._worldMatrix=t||b.IdentityReadOnly,this._update(this._worldMatrix)},o.prototype.scale=function(r){var e=o._TmpVector3,t=this.maximum.subtractToRef(this.minimum,e[0]),i=t.length();t.normalizeFromLength(i);var s=i*r,u=t.scaleInPlace(s*.5),a=this.center.subtractToRef(u,e[1]),c=this.center.addToRef(u,e[2]);return this.reConstruct(a,c,this._worldMatrix),this},o.prototype.getWorldMatrix=function(){return this._worldMatrix},o.prototype._update=function(r){var e=this.minimumWorld,t=this.maximumWorld,i=this.directions,s=this.vectorsWorld,u=this.vectors;if(r.isIdentity()){e.copyFrom(this.minimum),t.copyFrom(this.maximum);for(var a=0;a<8;++a)s[a].copyFrom(u[a]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{e.setAll(Number.MAX_VALUE),t.setAll(-Number.MAX_VALUE);for(var a=0;a<8;++a){var c=s[a];n.TransformCoordinatesToRef(u[a],r,c),e.minimizeInPlace(c),t.maximizeInPlace(c)}t.subtractToRef(e,this.extendSizeWorld).scaleInPlace(.5),t.addToRef(e,this.centerWorld).scaleInPlace(.5)}n.FromArrayToRef(r.m,0,i[0]),n.FromArrayToRef(r.m,4,i[1]),n.FromArrayToRef(r.m,8,i[2]),this._worldMatrix=r},o.prototype.isInFrustum=function(r){return o.IsInFrustum(this.vectorsWorld,r)},o.prototype.isCompletelyInFrustum=function(r){return o.IsCompletelyInFrustum(this.vectorsWorld,r)},o.prototype.intersectsPoint=function(r){var e=this.minimumWorld,t=this.maximumWorld,i=e.x,s=e.y,u=e.z,a=t.x,c=t.y,l=t.z,m=r.x,p=r.y,y=r.z,f=-I;return!(a-m<f||f>m-i||c-p<f||f>p-s||l-y<f||f>y-u)},o.prototype.intersectsSphere=function(r){return o.IntersectsSphere(this.minimumWorld,this.maximumWorld,r.centerWorld,r.radiusWorld)},o.prototype.intersectsMinMax=function(r,e){var t=this.minimumWorld,i=this.maximumWorld,s=t.x,u=t.y,a=t.z,c=i.x,l=i.y,m=i.z,p=r.x,y=r.y,f=r.z,_=e.x,B=e.y,T=e.z;return!(c<p||s>_||l<y||u>B||m<f||a>T)},o.prototype.dispose=function(){var r,e;(r=this._drawWrapperFront)===null||r===void 0||r.dispose(),(e=this._drawWrapperBack)===null||e===void 0||e.dispose()},o.Intersects=function(r,e){return r.intersectsMinMax(e.minimumWorld,e.maximumWorld)},o.IntersectsSphere=function(r,e,t,i){var s=o._TmpVector3[0];n.ClampToRef(t,r,e,s);var u=n.DistanceSquared(t,s);return u<=i*i},o.IsCompletelyInFrustum=function(r,e){for(var t=0;t<6;++t)for(var i=e[t],s=0;s<8;++s)if(i.dotCoordinate(r[s])<0)return!1;return!0},o.IsInFrustum=function(r,e){for(var t=0;t<6;++t){for(var i=!0,s=e[t],u=0;u<8;++u)if(s.dotCoordinate(r[u])>=0){i=!1;break}if(i)return!1}return!0},o._TmpVector3=h.BuildArray(3,n.Zero),o}(),g=function(){function o(r,e,t){this.center=n.Zero(),this.centerWorld=n.Zero(),this.minimum=n.Zero(),this.maximum=n.Zero(),this.reConstruct(r,e,t)}return o.prototype.reConstruct=function(r,e,t){this.minimum.copyFrom(r),this.maximum.copyFrom(e);var i=n.Distance(r,e);e.addToRef(r,this.center).scaleInPlace(.5),this.radius=i*.5,this._update(t||b.IdentityReadOnly)},o.prototype.scale=function(r){var e=this.radius*r,t=o._TmpVector3,i=t[0].setAll(e),s=this.center.subtractToRef(i,t[1]),u=this.center.addToRef(i,t[2]);return this.reConstruct(s,u,this._worldMatrix),this},o.prototype.getWorldMatrix=function(){return this._worldMatrix},o.prototype._update=function(r){if(r.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{n.TransformCoordinatesToRef(this.center,r,this.centerWorld);var e=o._TmpVector3[0];n.TransformNormalFromFloatsToRef(1,1,1,r,e),this.radiusWorld=Math.max(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z))*this.radius}},o.prototype.isInFrustum=function(r){for(var e=this.centerWorld,t=this.radiusWorld,i=0;i<6;i++)if(r[i].dotCoordinate(e)<=-t)return!1;return!0},o.prototype.isCenterInFrustum=function(r){for(var e=this.centerWorld,t=0;t<6;t++)if(r[t].dotCoordinate(e)<0)return!1;return!0},o.prototype.intersectsPoint=function(r){var e=n.DistanceSquared(this.centerWorld,r);return!(this.radiusWorld*this.radiusWorld<e)},o.Intersects=function(r,e){var t=n.DistanceSquared(r.centerWorld,e.centerWorld),i=r.radiusWorld+e.radiusWorld;return!(i*i<t)},o.CreateFromCenterAndRadius=function(r,e,t){this._TmpVector3[0].copyFrom(r),this._TmpVector3[1].copyFromFloats(0,0,e),this._TmpVector3[2].copyFrom(r),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);var i=new o(this._TmpVector3[0],this._TmpVector3[2]);return t?i._worldMatrix=t:i._worldMatrix=b.Identity(),i},o._TmpVector3=h.BuildArray(3,n.Zero),o}(),v={min:0,max:0},x={min:0,max:0},F=function(o,r,e){var t=n.Dot(r.centerWorld,o),i=Math.abs(n.Dot(r.directions[0],o))*r.extendSize.x,s=Math.abs(n.Dot(r.directions[1],o))*r.extendSize.y,u=Math.abs(n.Dot(r.directions[2],o))*r.extendSize.z,a=i+s+u;e.min=t-a,e.max=t+a},d=function(o,r,e){return F(o,r,v),F(o,e,x),!(v.min>x.max||x.min>v.max)},S=function(){function o(r,e,t){this._isLocked=!1,this.boundingBox=new W(r,e,t),this.boundingSphere=new g(r,e,t)}return o.prototype.reConstruct=function(r,e,t){this.boundingBox.reConstruct(r,e,t),this.boundingSphere.reConstruct(r,e,t)},Object.defineProperty(o.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isLocked",{get:function(){return this._isLocked},set:function(r){this._isLocked=r},enumerable:!1,configurable:!0}),o.prototype.update=function(r){this._isLocked||(this.boundingBox._update(r),this.boundingSphere._update(r))},o.prototype.centerOn=function(r,e){var t=o._TmpVector3[0].copyFrom(r).subtractInPlace(e),i=o._TmpVector3[1].copyFrom(r).addInPlace(e);return this.boundingBox.reConstruct(t,i,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(t,i,this.boundingBox.getWorldMatrix()),this},o.prototype.encapsulate=function(r){var e=n.Minimize(this.minimum,r),t=n.Maximize(this.maximum,r);return this.reConstruct(e,t,this.boundingBox.getWorldMatrix()),this},o.prototype.encapsulateBoundingInfo=function(r){return this.encapsulate(r.boundingBox.centerWorld.subtract(r.boundingBox.extendSizeWorld)),this.encapsulate(r.boundingBox.centerWorld.add(r.boundingBox.extendSizeWorld)),this},o.prototype.scale=function(r){return this.boundingBox.scale(r),this.boundingSphere.scale(r),this},o.prototype.isInFrustum=function(r,e){e===void 0&&(e=0);var t=e===2||e===3;if(t&&this.boundingSphere.isCenterInFrustum(r))return!0;if(!this.boundingSphere.isInFrustum(r))return!1;var i=e===1||e===3;return i?!0:this.boundingBox.isInFrustum(r)},Object.defineProperty(o.prototype,"diagonalLength",{get:function(){var r=this.boundingBox,e=r.maximumWorld.subtractToRef(r.minimumWorld,o._TmpVector3[0]);return e.length()},enumerable:!1,configurable:!0}),o.prototype.isCompletelyInFrustum=function(r){return this.boundingBox.isCompletelyInFrustum(r)},o.prototype._checkCollision=function(r){return r._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},o.prototype.intersectsPoint=function(r){return!(!this.boundingSphere.centerWorld||!this.boundingSphere.intersectsPoint(r)||!this.boundingBox.intersectsPoint(r))},o.prototype.intersects=function(r,e){if(!g.Intersects(this.boundingSphere,r.boundingSphere)||!W.Intersects(this.boundingBox,r.boundingBox))return!1;if(!e)return!0;var t=this.boundingBox,i=r.boundingBox;return!(!d(t.directions[0],t,i)||!d(t.directions[1],t,i)||!d(t.directions[2],t,i)||!d(i.directions[0],t,i)||!d(i.directions[1],t,i)||!d(i.directions[2],t,i)||!d(n.Cross(t.directions[0],i.directions[0]),t,i)||!d(n.Cross(t.directions[0],i.directions[1]),t,i)||!d(n.Cross(t.directions[0],i.directions[2]),t,i)||!d(n.Cross(t.directions[1],i.directions[0]),t,i)||!d(n.Cross(t.directions[1],i.directions[1]),t,i)||!d(n.Cross(t.directions[1],i.directions[2]),t,i)||!d(n.Cross(t.directions[2],i.directions[0]),t,i)||!d(n.Cross(t.directions[2],i.directions[1]),t,i)||!d(n.Cross(t.directions[2],i.directions[2]),t,i))},o._TmpVector3=h.BuildArray(2,n.Zero),o}();export{S as B};
