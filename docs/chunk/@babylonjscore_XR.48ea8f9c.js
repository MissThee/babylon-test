import{c as V,d as W,b as I,_ as R,e as Xe}from"./tslibtslib.b6e59fa7.js";import{M as E,Q as y,C as k,A as fe,f as Oe,a as _,T,e as Je,s as et,i as tt,q as rt,V as B}from"./@babylonjscore_Maths.42afce42.js";import{T as nt,d as it,C as ot,U as at}from"./@babylonjscore_Cameras.c6ce826c.js";import{a as L,O as g,L as N,au as De}from"./@babylonjscore_Misc.329df4d9.js";import{E as st,W as Ue,R as lt}from"./@babylonjscore_Engines.a7c830c0.js";import{M as ut,N as ze,f as qe,e as je,g as ct,k as ht,S as ie,D as dt,B as pt}from"./@babylonjscore_Materials.49fd589a.js";import{n as ft,T as _t,M as ae,d as le,A as He,b as Fe,c as Qe,a as mt,f as gt}from"./@babylonjscore_Meshes.896ebf22.js";import{S as ue}from"./@babylonjscore_Loading.1653106a.js";import{R as oe,a as Ve}from"./@babylonjscore_Culling.f738e368.js";import{P as re}from"./@babylonjscore_Collisions.8a0e928d.js";import{U as ee}from"./@babylonjscore_Rendering.98162e5e.js";import{Q as vt,E as Ye,A as D,S as bt}from"./@babylonjscore_Animations.ea9e461f.js";import{P as We}from"./@babylonjscore_Events.9219334a.js";import{P as Z}from"./@babylonjscore_Physics.061917a4.js";import{D as yt,a as Rt}from"./@babylonjscore_Lights.ab9a75bc.js";var ce,P=function(){function o(){}return o.ANCHOR_SYSTEM="xr-anchor-system",o.BACKGROUND_REMOVER="xr-background-remover",o.HIT_TEST="xr-hit-test",o.MESH_DETECTION="xr-mesh-detection",o.PHYSICS_CONTROLLERS="xr-physics-controller",o.PLANE_DETECTION="xr-plane-detection",o.POINTER_SELECTION="xr-controller-pointer-selection",o.TELEPORTATION="xr-controller-teleportation",o.FEATURE_POINTS="xr-feature-points",o.HAND_TRACKING="xr-hand-tracking",o.IMAGE_TRACKING="xr-image-tracking",o.NEAR_INTERACTION="xr-near-interaction",o.DOM_OVERLAY="xr-dom-overlay",o.MOVEMENT="xr-controller-movement",o.LIGHT_ESTIMATION="xr-light-estimation",o.EYE_TRACKING="xr-eye-tracking",o.WALKING_LOCOMOTION="xr-walking-locomotion",o.LAYERS="xr-layers",o}(),A=function(){function o(n){var r=this;this._xrSessionManager=n,this._features={},this._xrSessionManager.onXRSessionInit.add(function(){r.getEnabledFeatures().forEach(function(t){var e=r._features[t];e.enabled&&!e.featureImplementation.attached&&!e.featureImplementation.disableAutoAttach&&r.attachFeature(t)})}),this._xrSessionManager.onXRSessionEnded.add(function(){r.getEnabledFeatures().forEach(function(t){var e=r._features[t];e.enabled&&e.featureImplementation.attached&&r.detachFeature(t)})})}return o.AddWebXRFeature=function(n,r,t,e){t===void 0&&(t=1),e===void 0&&(e=!1),this._AvailableFeatures[n]=this._AvailableFeatures[n]||{latest:t},t>this._AvailableFeatures[n].latest&&(this._AvailableFeatures[n].latest=t),e&&(this._AvailableFeatures[n].stable=t),this._AvailableFeatures[n][t]=r},o.ConstructFeature=function(n,r,t,e){r===void 0&&(r=1);var i=this._AvailableFeatures[n][r];if(!i)throw new Error("feature not found");return i(t,e)},o.GetAvailableFeatures=function(){return Object.keys(this._AvailableFeatures)},o.GetAvailableVersions=function(n){return Object.keys(this._AvailableFeatures[n])},o.GetLatestVersionOfFeature=function(n){return this._AvailableFeatures[n]&&this._AvailableFeatures[n].latest||-1},o.GetStableVersionOfFeature=function(n){return this._AvailableFeatures[n]&&this._AvailableFeatures[n].stable||-1},o.prototype.attachFeature=function(n){var r=this._features[n];r&&r.enabled&&!r.featureImplementation.attached&&r.featureImplementation.attach()},o.prototype.detachFeature=function(n){var r=this._features[n];r&&r.featureImplementation.attached&&r.featureImplementation.detach()},o.prototype.disableFeature=function(n){var r=typeof n=="string"?n:n.Name,t=this._features[r];return t&&t.enabled?(t.enabled=!1,this.detachFeature(r),t.featureImplementation.dispose(),delete this._features[r],!0):!1},o.prototype.dispose=function(){var n=this;this.getEnabledFeatures().forEach(function(r){n.disableFeature(r)})},o.prototype.enableFeature=function(n,r,t,e,i){var a=this;r===void 0&&(r="latest"),t===void 0&&(t={}),e===void 0&&(e=!0),i===void 0&&(i=!0);var s=typeof n=="string"?n:n.Name,l=0;if(typeof r=="string"){if(!r)throw new Error("Error in provided version - ".concat(s," (").concat(r,")"));if(r==="stable"?l=o.GetStableVersionOfFeature(s):r==="latest"?l=o.GetLatestVersionOfFeature(s):l=+r,l===-1||isNaN(l))throw new Error("feature not found - ".concat(s," (").concat(r,")"))}else l=r;var u=o._ConflictingFeatures[s];if(u!==void 0&&this.getEnabledFeatures().indexOf(u)!==-1)throw new Error("Feature ".concat(s," cannot be enabled while ").concat(u," is enabled."));var h=this._features[s],c=o.ConstructFeature(s,l,this._xrSessionManager,t);if(!c)throw new Error("feature not found - ".concat(s));h&&this.disableFeature(s);var d=c();if(d.dependsOn){var f=d.dependsOn.every(function(m){return!!a._features[m]});if(!f)throw new Error("Dependant features missing. Make sure the following features are enabled - ".concat(d.dependsOn.join(", ")))}if(d.isCompatible())return this._features[s]={featureImplementation:d,enabled:!0,version:l,required:i},e?this._xrSessionManager.session&&!this._features[s].featureImplementation.attached&&this.attachFeature(s):this._features[s].featureImplementation.disableAutoAttach=!0,this._features[s].featureImplementation;if(i)throw new Error("required feature not compatible");return L.Warn("Feature ".concat(s," not compatible with the current environment/browser and was not enabled.")),d},o.prototype.getEnabledFeature=function(n){return this._features[n]&&this._features[n].featureImplementation},o.prototype.getEnabledFeatures=function(){return Object.keys(this._features)},o.prototype._extendXRSessionInitObject=function(n){return V(this,void 0,void 0,function(){var r,t,e,i,a,s,l;return W(this,function(u){switch(u.label){case 0:r=this.getEnabledFeatures(),t=0,e=r,u.label=1;case 1:return t<e.length?(i=e[t],a=this._features[i],s=a.featureImplementation.xrNativeFeatureName,s&&(a.required?(n.requiredFeatures=n.requiredFeatures||[],n.requiredFeatures.indexOf(s)===-1&&n.requiredFeatures.push(s)):(n.optionalFeatures=n.optionalFeatures||[],n.optionalFeatures.indexOf(s)===-1&&n.optionalFeatures.push(s))),a.featureImplementation.getXRSessionInitExtension?[4,a.featureImplementation.getXRSessionInitExtension()]:[3,3]):[3,4];case 2:l=u.sent(),n=I(I({},n),l),u.label=3;case 3:return t++,[3,1];case 4:return[2,n]}})})},o._AvailableFeatures={},o._ConflictingFeatures=(ce={},ce[P.TELEPORTATION]=P.MOVEMENT,ce[P.MOVEMENT]=P.TELEPORTATION,ce),o}(),O=function(){function o(n){this._xrSessionManager=n,this._attached=!1,this._removeOnDetach=[],this.isDisposed=!1,this.disableAutoAttach=!1,this.xrNativeFeatureName=""}return Object.defineProperty(o.prototype,"attached",{get:function(){return this._attached},enumerable:!1,configurable:!0}),o.prototype.attach=function(n){var r=this;if(this.isDisposed)return!1;if(n)this.attached&&this.detach();else if(this.attached)return!1;return this._attached=!0,this._addNewAttachObserver(this._xrSessionManager.onXRFrameObservable,function(t){return r._onXRFrame(t)}),!0},o.prototype.detach=function(){return this._attached?(this._attached=!1,this._removeOnDetach.forEach(function(n){n.observable.remove(n.observer)}),!0):(this.disableAutoAttach=!0,!1)},o.prototype.dispose=function(){this.detach(),this.isDisposed=!0},o.prototype.isCompatible=function(){return!0},o.prototype._addNewAttachObserver=function(n,r){this._removeOnDetach.push({observable:n,observer:n.add(r)})},o}(),K,$;(function(o){o.WRIST="wrist",o.THUMB="thumb",o.INDEX="index",o.MIDDLE="middle",o.RING="ring",o.LITTLE="little"})($||($={}));var p;(function(o){o.WRIST="wrist",o.THUMB_METACARPAL="thumb-metacarpal",o.THUMB_PHALANX_PROXIMAL="thumb-phalanx-proximal",o.THUMB_PHALANX_DISTAL="thumb-phalanx-distal",o.THUMB_TIP="thumb-tip",o.INDEX_FINGER_METACARPAL="index-finger-metacarpal",o.INDEX_FINGER_PHALANX_PROXIMAL="index-finger-phalanx-proximal",o.INDEX_FINGER_PHALANX_INTERMEDIATE="index-finger-phalanx-intermediate",o.INDEX_FINGER_PHALANX_DISTAL="index-finger-phalanx-distal",o.INDEX_FINGER_TIP="index-finger-tip",o.MIDDLE_FINGER_METACARPAL="middle-finger-metacarpal",o.MIDDLE_FINGER_PHALANX_PROXIMAL="middle-finger-phalanx-proximal",o.MIDDLE_FINGER_PHALANX_INTERMEDIATE="middle-finger-phalanx-intermediate",o.MIDDLE_FINGER_PHALANX_DISTAL="middle-finger-phalanx-distal",o.MIDDLE_FINGER_TIP="middle-finger-tip",o.RING_FINGER_METACARPAL="ring-finger-metacarpal",o.RING_FINGER_PHALANX_PROXIMAL="ring-finger-phalanx-proximal",o.RING_FINGER_PHALANX_INTERMEDIATE="ring-finger-phalanx-intermediate",o.RING_FINGER_PHALANX_DISTAL="ring-finger-phalanx-distal",o.RING_FINGER_TIP="ring-finger-tip",o.PINKY_FINGER_METACARPAL="pinky-finger-metacarpal",o.PINKY_FINGER_PHALANX_PROXIMAL="pinky-finger-phalanx-proximal",o.PINKY_FINGER_PHALANX_INTERMEDIATE="pinky-finger-phalanx-intermediate",o.PINKY_FINGER_PHALANX_DISTAL="pinky-finger-phalanx-distal",o.PINKY_FINGER_TIP="pinky-finger-tip"})(p||(p={}));var z=[p.WRIST,p.THUMB_METACARPAL,p.THUMB_PHALANX_PROXIMAL,p.THUMB_PHALANX_DISTAL,p.THUMB_TIP,p.INDEX_FINGER_METACARPAL,p.INDEX_FINGER_PHALANX_PROXIMAL,p.INDEX_FINGER_PHALANX_INTERMEDIATE,p.INDEX_FINGER_PHALANX_DISTAL,p.INDEX_FINGER_TIP,p.MIDDLE_FINGER_METACARPAL,p.MIDDLE_FINGER_PHALANX_PROXIMAL,p.MIDDLE_FINGER_PHALANX_INTERMEDIATE,p.MIDDLE_FINGER_PHALANX_DISTAL,p.MIDDLE_FINGER_TIP,p.RING_FINGER_METACARPAL,p.RING_FINGER_PHALANX_PROXIMAL,p.RING_FINGER_PHALANX_INTERMEDIATE,p.RING_FINGER_PHALANX_DISTAL,p.RING_FINGER_TIP,p.PINKY_FINGER_METACARPAL,p.PINKY_FINGER_PHALANX_PROXIMAL,p.PINKY_FINGER_PHALANX_INTERMEDIATE,p.PINKY_FINGER_PHALANX_DISTAL,p.PINKY_FINGER_TIP],xt=(K={},K[$.WRIST]=[p.WRIST],K[$.THUMB]=[p.THUMB_METACARPAL,p.THUMB_PHALANX_PROXIMAL,p.THUMB_PHALANX_DISTAL,p.THUMB_TIP],K[$.INDEX]=[p.INDEX_FINGER_METACARPAL,p.INDEX_FINGER_PHALANX_PROXIMAL,p.INDEX_FINGER_PHALANX_INTERMEDIATE,p.INDEX_FINGER_PHALANX_DISTAL,p.INDEX_FINGER_TIP],K[$.MIDDLE]=[p.MIDDLE_FINGER_METACARPAL,p.MIDDLE_FINGER_PHALANX_PROXIMAL,p.MIDDLE_FINGER_PHALANX_INTERMEDIATE,p.MIDDLE_FINGER_PHALANX_DISTAL,p.MIDDLE_FINGER_TIP],K[$.RING]=[p.RING_FINGER_METACARPAL,p.RING_FINGER_PHALANX_PROXIMAL,p.RING_FINGER_PHALANX_INTERMEDIATE,p.RING_FINGER_PHALANX_DISTAL,p.RING_FINGER_TIP],K[$.LITTLE]=[p.PINKY_FINGER_METACARPAL,p.PINKY_FINGER_PHALANX_PROXIMAL,p.PINKY_FINGER_PHALANX_INTERMEDIATE,p.PINKY_FINGER_PHALANX_DISTAL,p.PINKY_FINGER_TIP],K),Mt=function(){function o(n,r,t,e,i,a,s){i===void 0&&(i=!1),a===void 0&&(a=!1),s===void 0&&(s=1),this.xrController=n,this._jointMeshes=r,this._handMesh=t,this.rigMapping=e,this._leftHandedMeshes=i,this._jointsInvisible=a,this._jointScaleFactor=s,this._jointTransforms=new Array(z.length),this._jointTransformMatrices=new Float32Array(z.length*16),this._tempJointMatrix=new E,this._jointRadii=new Float32Array(z.length),this._scene=r[0].getScene();for(var l=0;l<this._jointTransforms.length;l++){var u=this._jointTransforms[l]=new _t(z[l],this._scene);u.rotationQuaternion=new y,r[l].rotationQuaternion=new y}t&&this.setHandMesh(t,e),this.xrController.motionController&&(this.xrController.motionController.rootMesh?this.xrController.motionController.rootMesh.setEnabled(!1):this.xrController.motionController.onModelLoadedObservable.add(function(h){h.rootMesh&&h.rootMesh.setEnabled(!1)})),this.xrController.onMotionControllerInitObservable.add(function(h){h.onModelLoadedObservable.add(function(c){c.rootMesh&&c.rootMesh.setEnabled(!1)}),h.rootMesh&&h.rootMesh.setEnabled(!1)})}return Object.defineProperty(o.prototype,"handMesh",{get:function(){return this._handMesh},enumerable:!1,configurable:!0}),o.prototype.getHandPartMeshes=function(n){var r=this;return xt[n].map(function(t){return r._jointMeshes[z.indexOf(t)]})},o.prototype.getJointMesh=function(n){return this._jointMeshes[z.indexOf(n)]},o.prototype.setHandMesh=function(n,r){var t=this;if(this._handMesh=n,n.alwaysSelectAsActiveMesh=!0,n.getChildMeshes().forEach(function(i){return i.alwaysSelectAsActiveMesh=!0}),this._handMesh.skeleton){var e=this._handMesh.skeleton;z.forEach(function(i,a){var s=e.getBoneIndexByName(r?r[i]:i);s!==-1&&e.bones[s].linkTransformNode(t._jointTransforms[a])})}},o.prototype.updateFromXRFrame=function(n,r){var t=this,e=this.xrController.inputSource.hand;if(!!e){var i=e,a=z.map(function(h){return i[h]||e.get(h)}),s=!1;if(n.fillPoses&&n.fillJointRadii)s=n.fillPoses(a,r,this._jointTransformMatrices)&&n.fillJointRadii(a,this._jointRadii);else if(n.getJointPose){s=!0;for(var l=0;l<a.length;l++){var u=n.getJointPose(a[l],r);if(u)this._jointTransformMatrices.set(u.transform.matrix,l*16),this._jointRadii[l]=u.radius||.008;else{s=!1;break}}}!s||(z.forEach(function(h,c){var d=t._jointTransforms[c];E.FromArrayToRef(t._jointTransformMatrices,c*16,t._tempJointMatrix),t._tempJointMatrix.decompose(void 0,d.rotationQuaternion,d.position);var f=t._jointRadii[c]*t._jointScaleFactor,m=t._jointMeshes[c];m.isVisible=!t._handMesh&&!t._jointsInvisible,m.position.copyFrom(d.position),m.rotationQuaternion.copyFrom(d.rotationQuaternion),m.scaling.setAll(f),t._scene.useRightHandedSystem||(m.position.z*=-1,m.rotationQuaternion.z*=-1,m.rotationQuaternion.w*=-1,t._leftHandedMeshes&&t._handMesh&&(d.position.z*=-1,d.rotationQuaternion.z*=-1,d.rotationQuaternion.w*=-1))}),this._handMesh&&(this._handMesh.isVisible=!0))}},o.prototype.dispose=function(){this._handMesh&&(this._handMesh.isVisible=!1)},o}(),_e=function(o){R(n,o);function n(r,t){var e=o.call(this,r)||this;e.options=t,e._attachedHands={},e._trackingHands={left:null,right:null},e._handResources={jointMeshes:null,handMeshes:null,rigMappings:null},e.onHandAddedObservable=new g,e.onHandRemovedObservable=new g,e._attachHand=function(u){var h,c,d;if(!(!u.inputSource.hand||u.inputSource.handedness=="none"||!e._handResources.jointMeshes)){var f=u.inputSource.handedness,m=new Mt(u,e._handResources.jointMeshes[f],e._handResources.handMeshes&&e._handResources.handMeshes[f],e._handResources.rigMappings&&e._handResources.rigMappings[f],(h=e.options.handMeshes)===null||h===void 0?void 0:h.meshesUseLeftHandedCoordinates,(c=e.options.jointMeshes)===null||c===void 0?void 0:c.invisible,(d=e.options.jointMeshes)===null||d===void 0?void 0:d.scaleFactor);e._attachedHands[u.uniqueId]=m,e._trackingHands[f]=m,e.onHandAddedObservable.notifyObservers(m)}},e._detachHand=function(u){e._detachHandById(u.uniqueId)},e.xrNativeFeatureName="hand-tracking";var i=t,a=i.jointMeshes;if(a&&(typeof a.disableDefaultHandMesh!="undefined"&&(t.handMeshes=t.handMeshes||{},t.handMeshes.disableDefaultMeshes=a.disableDefaultHandMesh),typeof a.handMeshes!="undefined"&&(t.handMeshes=t.handMeshes||{},t.handMeshes.customMeshes=a.handMeshes),typeof a.leftHandedSystemMeshes!="undefined"&&(t.handMeshes=t.handMeshes||{},t.handMeshes.meshesUseLeftHandedCoordinates=a.leftHandedSystemMeshes),typeof a.rigMapping!="undefined")){t.handMeshes=t.handMeshes||{};var s={},l={};[[a.rigMapping.left,s],[a.rigMapping.right,l]].forEach(function(u){var h=u[0],c=u[1];h.forEach(function(d,f){c[z[f]]=d})}),t.handMeshes.customRigMappings={left:s,right:l}}return e}return n._GenerateTrackedJointMeshes=function(r){var t={};return["left","right"].map(function(e){var i,a,s,l,u,h=[],c=((i=r.jointMeshes)===null||i===void 0?void 0:i.sourceMesh)||ft("jointParent",n._ICOSPHERE_PARAMS);c.isVisible=!!(!((a=r.jointMeshes)===null||a===void 0)&&a.keepOriginalVisible);for(var d=0;d<z.length;++d){var f=c.createInstance("".concat(e,"-handJoint-").concat(d));if(!((s=r.jointMeshes)===null||s===void 0)&&s.onHandJointMeshGenerated){var m=r.jointMeshes.onHandJointMeshGenerated(f,d,e);m&&m!==f&&(f.dispose(),f=m)}if(f.isPickable=!1,!((l=r.jointMeshes)===null||l===void 0)&&l.enablePhysics){var v=((u=r.jointMeshes)===null||u===void 0?void 0:u.physicsProps)||{};f.scaling.setAll(.02);var x=v.impostorType!==void 0?v.impostorType:Z.SphereImpostor;f.physicsImpostor=new Z(f,x,I({mass:0},v))}f.rotationQuaternion=new y,f.isVisible=!1,h.push(f)}t[e]=h}),{left:t.left,right:t.right}},n._GenerateDefaultHandMeshesAsync=function(r,t){var e=this;return new Promise(function(i){return V(e,void 0,void 0,function(){var a,s,l,u,h,c,d,f,m,v,x;return W(this,function(S){switch(S.label){case 0:return a={},!((f=(d=n._RightHandGLB)===null||d===void 0?void 0:d.meshes[1])===null||f===void 0)&&f.isDisposed()&&(n._RightHandGLB=null),!((v=(m=n._LeftHandGLB)===null||m===void 0?void 0:m.meshes[1])===null||v===void 0)&&v.isDisposed()&&(n._LeftHandGLB=null),s=!!(n._RightHandGLB&&n._LeftHandGLB),[4,Promise.all([n._RightHandGLB||ue.ImportMeshAsync("",n.DEFAULT_HAND_MODEL_BASE_URL,n.DEFAULT_HAND_MODEL_RIGHT_FILENAME,r),n._LeftHandGLB||ue.ImportMeshAsync("",n.DEFAULT_HAND_MODEL_BASE_URL,n.DEFAULT_HAND_MODEL_LEFT_FILENAME,r)])];case 1:return l=S.sent(),n._RightHandGLB=l[0],n._LeftHandGLB=l[1],u=new ze("handShader",r,{emitComments:!1}),[4,u.loadAsync(n.DEFAULT_HAND_MODEL_SHADER_URL)];case 2:return S.sent(),u.needDepthPrePass=!0,u.transparencyMode=ut.MATERIAL_ALPHABLEND,u.alphaMode=2,u.build(!1),h=I({base:k.FromInts(116,63,203),fresnel:k.FromInts(149,102,229),fingerColor:k.FromInts(177,130,255),tipFresnel:k.FromInts(220,200,255)},(x=t==null?void 0:t.handMeshes)===null||x===void 0?void 0:x.customColors),c={base:u.getBlockByName("baseColor"),fresnel:u.getBlockByName("fresnelColor"),fingerColor:u.getBlockByName("fingerColor"),tipFresnel:u.getBlockByName("tipFresnelColor")},c.base.value=h.base,c.fresnel.value=h.fresnel,c.fingerColor.value=h.fingerColor,c.tipFresnel.value=h.tipFresnel,["left","right"].forEach(function(M){var C=M=="left"?n._LeftHandGLB:n._RightHandGLB;if(!C)throw new Error("Could not load hand model");var F=C.meshes[1];F._internalAbstractMeshDataInfo._computeBonesUsingShaders=!0,F.material=u.clone("".concat(M,"HandShaderClone"),!0),F.isVisible=!1,a[M]=F,!s&&!r.useRightHandedSystem&&C.meshes[1].rotate(fe.Y,Math.PI)}),u.dispose(),i({left:a.left,right:a.right}),[2]}})})})},n._GenerateDefaultHandMeshRigMapping=function(r){var t,e=r=="right"?"R":"L";return t={},t[p.WRIST]="wrist_".concat(e),t[p.THUMB_METACARPAL]="thumb_metacarpal_".concat(e),t[p.THUMB_PHALANX_PROXIMAL]="thumb_proxPhalanx_".concat(e),t[p.THUMB_PHALANX_DISTAL]="thumb_distPhalanx_".concat(e),t[p.THUMB_TIP]="thumb_tip_".concat(e),t[p.INDEX_FINGER_METACARPAL]="index_metacarpal_".concat(e),t[p.INDEX_FINGER_PHALANX_PROXIMAL]="index_proxPhalanx_".concat(e),t[p.INDEX_FINGER_PHALANX_INTERMEDIATE]="index_intPhalanx_".concat(e),t[p.INDEX_FINGER_PHALANX_DISTAL]="index_distPhalanx_".concat(e),t[p.INDEX_FINGER_TIP]="index_tip_".concat(e),t[p.MIDDLE_FINGER_METACARPAL]="middle_metacarpal_".concat(e),t[p.MIDDLE_FINGER_PHALANX_PROXIMAL]="middle_proxPhalanx_".concat(e),t[p.MIDDLE_FINGER_PHALANX_INTERMEDIATE]="middle_intPhalanx_".concat(e),t[p.MIDDLE_FINGER_PHALANX_DISTAL]="middle_distPhalanx_".concat(e),t[p.MIDDLE_FINGER_TIP]="middle_tip_".concat(e),t[p.RING_FINGER_METACARPAL]="ring_metacarpal_".concat(e),t[p.RING_FINGER_PHALANX_PROXIMAL]="ring_proxPhalanx_".concat(e),t[p.RING_FINGER_PHALANX_INTERMEDIATE]="ring_intPhalanx_".concat(e),t[p.RING_FINGER_PHALANX_DISTAL]="ring_distPhalanx_".concat(e),t[p.RING_FINGER_TIP]="ring_tip_".concat(e),t[p.PINKY_FINGER_METACARPAL]="little_metacarpal_".concat(e),t[p.PINKY_FINGER_PHALANX_PROXIMAL]="little_proxPhalanx_".concat(e),t[p.PINKY_FINGER_PHALANX_INTERMEDIATE]="little_intPhalanx_".concat(e),t[p.PINKY_FINGER_PHALANX_DISTAL]="little_distPhalanx_".concat(e),t[p.PINKY_FINGER_TIP]="little_tip_".concat(e),t},n.prototype.isCompatible=function(){return typeof XRHand!="undefined"},n.prototype.getHandByControllerId=function(r){return this._attachedHands[r]},n.prototype.getHandByHandedness=function(r){return r=="none"?null:this._trackingHands[r]},n.prototype.attach=function(){var r=this,t,e,i,a;return o.prototype.attach.call(this)?(this._handResources={jointMeshes:n._GenerateTrackedJointMeshes(this.options),handMeshes:((t=this.options.handMeshes)===null||t===void 0?void 0:t.customMeshes)||null,rigMappings:((e=this.options.handMeshes)===null||e===void 0?void 0:e.customRigMappings)||null},!(!((i=this.options.handMeshes)===null||i===void 0)&&i.customMeshes)&&!(!((a=this.options.handMeshes)===null||a===void 0)&&a.disableDefaultMeshes)&&n._GenerateDefaultHandMeshesAsync(st.LastCreatedScene,this.options).then(function(s){var l,u;r._handResources.handMeshes=s,r._handResources.rigMappings={left:n._GenerateDefaultHandMeshRigMapping("left"),right:n._GenerateDefaultHandMeshRigMapping("right")},(l=r._trackingHands.left)===null||l===void 0||l.setHandMesh(r._handResources.handMeshes.left,r._handResources.rigMappings.left),(u=r._trackingHands.right)===null||u===void 0||u.setHandMesh(r._handResources.handMeshes.right,r._handResources.rigMappings.right)}),this.options.xrInput.controllers.forEach(this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerAddedObservable,this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerRemovedObservable,this._detachHand),!0):!1},n.prototype._onXRFrame=function(r){var t,e;(t=this._trackingHands.left)===null||t===void 0||t.updateFromXRFrame(r,this._xrSessionManager.referenceSpace),(e=this._trackingHands.right)===null||e===void 0||e.updateFromXRFrame(r,this._xrSessionManager.referenceSpace)},n.prototype._detachHandById=function(r){var t,e=this.getHandByControllerId(r);if(e){var i=e.xrController.inputSource.handedness=="left"?"left":"right";((t=this._trackingHands[i])===null||t===void 0?void 0:t.xrController.uniqueId)===r&&(this._trackingHands[i]=null),this.onHandRemovedObservable.notifyObservers(e),e.dispose(),delete this._attachedHands[r]}},n.prototype.detach=function(){var r=this;return o.prototype.detach.call(this)?(Object.keys(this._attachedHands).forEach(function(t){return r._detachHandById(t)}),!0):!1},n.prototype.dispose=function(){var r;o.prototype.dispose.call(this),this.onHandAddedObservable.clear(),this.onHandRemovedObservable.clear(),this._handResources.handMeshes&&!(!((r=this.options.handMeshes)===null||r===void 0)&&r.customMeshes)&&(this._handResources.handMeshes.left.dispose(),this._handResources.handMeshes.right.dispose(),n._RightHandGLB=null,n._LeftHandGLB=null),this._handResources.jointMeshes&&(this._handResources.jointMeshes.left.forEach(function(t){return t.dispose()}),this._handResources.jointMeshes.right.forEach(function(t){return t.dispose()}))},n.Name=P.HAND_TRACKING,n.Version=1,n.DEFAULT_HAND_MODEL_BASE_URL="https://assets.babylonjs.com/meshes/HandMeshes/",n.DEFAULT_HAND_MODEL_RIGHT_FILENAME="r_hand_rhs.glb",n.DEFAULT_HAND_MODEL_LEFT_FILENAME="l_hand_rhs.glb",n.DEFAULT_HAND_MODEL_SHADER_URL="https://assets.babylonjs.com/meshes/HandMeshes/handsShader.json",n._ICOSPHERE_PARAMS={radius:.5,flat:!1,subdivisions:2},n._RightHandGLB=null,n._LeftHandGLB=null,n}(O);A.AddWebXRFeature(_e.Name,function(o,n){return function(){return new _e(o,n)}},_e.Version,!1);var Le=function(){function o(n,r,t,e,i){this.getWidth=n,this.getHeight=r,this.layer=t,this.layerType=e,this.createRenderTargetTextureProvider=i}return Object.defineProperty(o.prototype,"isFixedFoveationSupported",{get:function(){return this.layerType=="XRWebGLLayer"&&typeof this.layer.fixedFoveation=="number"},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"fixedFoveation",{get:function(){return this.isFixedFoveationSupported?this.layer.fixedFoveation:null},set:function(n){if(this.isFixedFoveationSupported){var r=Math.max(0,Math.min(1,n||0));this.layer.fixedFoveation=r}},enumerable:!1,configurable:!0}),o}(),we=function(){function o(n,r){this._scene=n,this.layerWrapper=r,this._renderTargetTextures=new Array,this._engine=n.getEngine()}return o.prototype._createInternalTexture=function(n,r){var t=new qe(this._engine,je.Unknown,!0);return t.width=n.width,t.height=n.height,t._hardwareTexture=new Ue(r,this._engine._gl),t.isReady=!0,t},o.prototype._createRenderTargetTexture=function(n,r,t,e,i,a){if(!this._engine)throw new Error("Engine is disposed");var s={width:n,height:r},l=a?new ct(this._scene,s):new ht("XR renderTargetTexture",s,this._scene),u=l.renderTarget;if((t||!e)&&(u._framebuffer=t),e)if(a)u._colorTextureArray=e;else{var h=this._createInternalTexture(s,e);u.setTexture(h,0),l._texture=h}return i&&(a?u._depthStencilTextureArray=i:u._depthStencilTexture=this._createInternalTexture(s,i)),l.disableRescaling(),typeof XRWebGLBinding!="undefined"&&(l.skipInitialClear=!0),this._renderTargetTextures.push(l),l},o.prototype._destroyRenderTargetTexture=function(n){this._renderTargetTextures.splice(this._renderTargetTextures.indexOf(n),1),n.dispose()},o.prototype.getFramebufferDimensions=function(){return this._framebufferDimensions},o.prototype.dispose=function(){this._renderTargetTextures.forEach(function(n){return n.dispose()}),this._renderTargetTextures.length=0},o}(),ke=function(o){R(n,o);function n(r){var t=o.call(this,function(){return r.framebufferWidth},function(){return r.framebufferHeight},r,"XRWebGLLayer",function(e){return new Ct(e.scene,t)})||this;return t.layer=r,t}return n}(Le),Ct=function(o){R(n,o);function n(r,t){var e=o.call(this,r,t)||this;return e.layerWrapper=t,e._layer=t.layer,e._framebufferDimensions={framebufferWidth:e._layer.framebufferWidth,framebufferHeight:e._layer.framebufferHeight},e}return n.prototype.trySetViewportForView=function(r,t){var e=this._layer.getViewport(t),i=this._framebufferDimensions.framebufferWidth,a=this._framebufferDimensions.framebufferHeight;return r.x=e.x/i,r.y=e.y/a,r.width=e.width/i,r.height=e.height/a,!0},n.prototype.getRenderTargetTextureForEye=function(r){var t=this._layer.framebufferWidth,e=this._layer.framebufferHeight,i=this._layer.framebuffer;return(!this._rtt||t!==this._framebufferDimensions.framebufferWidth||e!==this._framebufferDimensions.framebufferHeight||i!==this._framebuffer)&&(this._rtt=this._createRenderTargetTexture(t,e,i),this._framebufferDimensions.framebufferWidth=t,this._framebufferDimensions.framebufferHeight=e,this._framebuffer=i),this._rtt},n.prototype.getRenderTargetTextureForView=function(r){return this.getRenderTargetTextureForEye(r.eye)},n}(we),Ke=function(){function o(){}return o.GetDefaults=function(n){var r=new o;return r.canvasOptions={antialias:!0,depth:!0,stencil:n?n.isStencilEnable:!0,alpha:!0,multiview:!1,framebufferScaleFactor:1},r.newCanvasCssStyle="position:absolute; bottom:0px;right:0px;z-index:10;width:90%;height:100%;background-color: #000000;",r},o}(),Pt=function(){function o(n,r){r===void 0&&(r=Ke.GetDefaults());var t=this;if(this._options=r,this._canvas=null,this._engine=null,this.xrLayer=null,this._xrLayerWrapper=null,this.onXRLayerInitObservable=new g,this._engine=n.scene.getEngine(),this._engine.onDisposeObservable.addOnce(function(){t._engine=null}),r.canvasElement)this._setManagedOutputCanvas(r.canvasElement);else{var e=document.createElement("canvas");e.style.cssText=this._options.newCanvasCssStyle||"position:absolute; bottom:0px;right:0px;",this._setManagedOutputCanvas(e)}n.onXRSessionInit.add(function(){t._addCanvas()}),n.onXRSessionEnded.add(function(){t._removeCanvas()})}return o.prototype.dispose=function(){this._removeCanvas(),this._setManagedOutputCanvas(null)},o.prototype.initializeXRLayerAsync=function(n){return V(this,void 0,void 0,function(){var r,t=this;return W(this,function(e){return r=function(){return t.xrLayer=new XRWebGLLayer(n,t.canvasContext,t._options.canvasOptions),t._xrLayerWrapper=new ke(t.xrLayer),t.onXRLayerInitObservable.notifyObservers(t.xrLayer),t.xrLayer},this.canvasContext.makeXRCompatible?[2,this.canvasContext.makeXRCompatible().then(function(){},function(){L.Warn("Error executing makeXRCompatible. This does not mean that the session will work incorrectly.")}).then(function(){return r()})]:[2,Promise.resolve(r())]})})},o.prototype._addCanvas=function(){var n=this;this._canvas&&this._engine&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.appendChild(this._canvas),this.xrLayer?this._setCanvasSize(!0):this.onXRLayerInitObservable.addOnce(function(){n._setCanvasSize(!0)})},o.prototype._removeCanvas=function(){this._canvas&&this._engine&&document.body.contains(this._canvas)&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.removeChild(this._canvas),this._setCanvasSize(!1)},o.prototype._setCanvasSize=function(n,r){n===void 0&&(n=!0),r===void 0&&(r=this._xrLayerWrapper),!(!this._canvas||!this._engine)&&(n?r&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=r.getWidth()+"px",this._canvas.style.height=r.getHeight()+"px"):this._engine.setSize(r.getWidth(),r.getHeight())):this._originalCanvasSize&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=this._originalCanvasSize.width+"px",this._canvas.style.height=this._originalCanvasSize.height+"px"):this._engine.setSize(this._originalCanvasSize.width,this._originalCanvasSize.height)))},o.prototype._setManagedOutputCanvas=function(n){this._removeCanvas(),n?(this._originalCanvasSize={width:n.offsetWidth,height:n.offsetHeight},this._canvas=n,this.canvasContext=this._canvas.getContext("webgl2"),this.canvasContext||(this.canvasContext=this._canvas.getContext("webgl"))):(this._canvas=null,this.canvasContext=null)},o}(),Tt=function(o){R(n,o);function n(r){var t=o.call(this,function(){return r.framebufferWidth},function(){return r.framebufferHeight},r,"XRWebGLLayer",function(e){return new It(e,t)})||this;return t.layer=r,t}return n}(Le),It=function(o){R(n,o);function n(r,t){var e=o.call(this,r.scene,t)||this;return e.layerWrapper=t,e._nativeRTTProvider=navigator.xr.getNativeRenderTargetProvider(r.session,e._createRenderTargetTexture.bind(e),e._destroyRenderTargetTexture.bind(e)),e._nativeLayer=t.layer,e}return n.prototype.trySetViewportForView=function(r){return r.x=0,r.y=0,r.width=1,r.height=1,!0},n.prototype.getRenderTargetTextureForEye=function(r){return this._nativeRTTProvider.getRenderTargetForEye(r)},n.prototype.getRenderTargetTextureForView=function(r){return this._nativeRTTProvider.getRenderTargetForEye(r.eye)},n.prototype.getFramebufferDimensions=function(){return{framebufferWidth:this._nativeLayer.framebufferWidth,framebufferHeight:this._nativeLayer.framebufferHeight}},n}(we),Nt=function(){function o(n){this._nativeRenderTarget=navigator.xr.getWebXRRenderTarget(n.scene.getEngine())}return o.prototype.initializeXRLayerAsync=function(n){return V(this,void 0,void 0,function(){return W(this,function(r){switch(r.label){case 0:return[4,this._nativeRenderTarget.initializeXRLayerAsync(n)];case 1:return r.sent(),this.xrLayer=this._nativeRenderTarget.xrLayer,[2,this.xrLayer]}})})},o.prototype.dispose=function(){},o}(),Et=function(){function o(n){var r=this;this.scene=n,this.currentTimestamp=-1,this.defaultHeightCompensation=1.7,this.onXRFrameObservable=new g,this.onXRReferenceSpaceChanged=new g,this.onXRSessionEnded=new g,this.onXRSessionInit=new g,this.inXRFrameLoop=!1,this.inXRSession=!1,this._engine=n.getEngine(),this._onEngineDisposedObserver=this._engine.onDisposeObservable.addOnce(function(){r._engine=null}),n.onDisposeObservable.addOnce(function(){r.dispose()})}return Object.defineProperty(o.prototype,"referenceSpace",{get:function(){return this._referenceSpace},set:function(n){this._referenceSpace=n,this.onXRReferenceSpaceChanged.notifyObservers(this._referenceSpace)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"sessionMode",{get:function(){return this._sessionMode},enumerable:!1,configurable:!0}),o.prototype.dispose=function(){var n;this.inXRSession&&this.exitXRAsync(),this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear(),this.onXRReferenceSpaceChanged.clear(),this.onXRSessionInit.clear(),(n=this._engine)===null||n===void 0||n.onDisposeObservable.remove(this._onEngineDisposedObserver),this._engine=null},o.prototype.exitXRAsync=function(){return this.session&&this.inXRSession?(this.inXRSession=!1,this.session.end().catch(function(){N.Warn("Could not end XR session.")})):Promise.resolve()},o.prototype.trySetViewportForView=function(n,r){var t;return((t=this._baseLayerRTTProvider)===null||t===void 0?void 0:t.trySetViewportForView(n,r))||!1},o.prototype.getRenderTargetTextureForEye=function(n){var r;return((r=this._baseLayerRTTProvider)===null||r===void 0?void 0:r.getRenderTargetTextureForEye(n))||null},o.prototype.getRenderTargetTextureForView=function(n){var r;return((r=this._baseLayerRTTProvider)===null||r===void 0?void 0:r.getRenderTargetTextureForView(n))||null},o.prototype.getWebXRRenderTarget=function(n){var r=this.scene.getEngine();return this._xrNavigator.xr.native?new Nt(this):(n=n||Ke.GetDefaults(r),n.canvasElement=n.canvasElement||r.getRenderingCanvas()||void 0,new Pt(this,n))},o.prototype.initializeAsync=function(){return this._xrNavigator=navigator,this._xrNavigator.xr?Promise.resolve():Promise.reject("WebXR not available")},o.prototype.initializeSessionAsync=function(n,r){var t=this;return n===void 0&&(n="immersive-vr"),r===void 0&&(r={}),this._xrNavigator.xr.requestSession(n,r).then(function(e){return t.session=e,t._sessionMode=n,t.onXRSessionInit.notifyObservers(e),t.inXRSession=!0,t.session.addEventListener("end",function(){var i;t.inXRSession=!1,t.onXRSessionEnded.notifyObservers(null),t._engine&&(t._engine.framebufferDimensionsObject=null,t._engine.restoreDefaultFramebuffer(),t._engine.customAnimationFrameRequester=null,t._engine._renderLoop()),t.isNative&&((i=t._baseLayerRTTProvider)===null||i===void 0||i.dispose()),t._baseLayerRTTProvider=null,t._baseLayerWrapper=null},{once:!0}),t.session})},o.prototype.isSessionSupportedAsync=function(n){return o.IsSessionSupportedAsync(n)},o.prototype.resetReferenceSpace=function(){this.referenceSpace=this.baseReferenceSpace},o.prototype.runXRRenderLoop=function(){var n=this,r;!this.inXRSession||!this._engine||(this._engine.customAnimationFrameRequester={requestAnimationFrame:this.session.requestAnimationFrame.bind(this.session),renderFunction:function(t,e){var i;!n.inXRSession||!n._engine||(n.currentFrame=e,n.currentTimestamp=t,e&&(n.inXRFrameLoop=!0,n._engine.framebufferDimensionsObject=((i=n._baseLayerRTTProvider)===null||i===void 0?void 0:i.getFramebufferDimensions())||null,n.onXRFrameObservable.notifyObservers(e),n._engine._renderLoop(),n._engine.framebufferDimensionsObject=null,n.inXRFrameLoop=!1))}},this._engine.framebufferDimensionsObject=((r=this._baseLayerRTTProvider)===null||r===void 0?void 0:r.getFramebufferDimensions())||null,typeof window!="undefined"&&window.cancelAnimationFrame&&window.cancelAnimationFrame(this._engine._frameHandler),this._engine._renderLoop())},o.prototype.setReferenceSpaceTypeAsync=function(n){var r=this;return n===void 0&&(n="local-floor"),this.session.requestReferenceSpace(n).then(function(t){return t},function(t){return N.Error("XR.requestReferenceSpace failed for the following reason: "),N.Error(t),N.Log('Defaulting to universally-supported "viewer" reference space type.'),r.session.requestReferenceSpace("viewer").then(function(e){var i=new XRRigidTransform({x:0,y:-r.defaultHeightCompensation,z:0});return e.getOffsetReferenceSpace(i)},function(e){throw N.Error(e),'XR initialization failed: required "viewer" reference space type not supported.'})}).then(function(t){return r.session.requestReferenceSpace("viewer").then(function(e){return r.viewerReferenceSpace=e,t})}).then(function(t){return r.referenceSpace=r.baseReferenceSpace=t,r.referenceSpace})},o.prototype.updateRenderStateAsync=function(n){return Promise.resolve(this.session.updateRenderState(n))},o.prototype._setBaseLayerWrapper=function(n){var r,t;this.isNative&&((r=this._baseLayerRTTProvider)===null||r===void 0||r.dispose()),this._baseLayerWrapper=n,this._baseLayerRTTProvider=((t=this._baseLayerWrapper)===null||t===void 0?void 0:t.createRenderTargetTextureProvider(this))||null},o.prototype.updateRenderState=function(n){n.baseLayer&&this._setBaseLayerWrapper(this.isNative?new Tt(n.baseLayer):new ke(n.baseLayer)),this.session.updateRenderState(n)},o.IsSessionSupportedAsync=function(n){if(!navigator.xr)return Promise.resolve(!1);var r=navigator.xr.isSessionSupported||navigator.xr.supportsSession;return r?r.call(navigator.xr,n).then(function(t){var e=typeof t=="undefined"?!0:t;return Promise.resolve(e)}).catch(function(t){return N.Warn(t),Promise.resolve(!1)}):Promise.resolve(!1)},Object.defineProperty(o.prototype,"isNative",{get:function(){var n;return(n=this._xrNavigator.xr.native)!==null&&n!==void 0?n:!1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentFrameRate",{get:function(){var n;return(n=this.session)===null||n===void 0?void 0:n.frameRate},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"supportedFrameRates",{get:function(){var n;return(n=this.session)===null||n===void 0?void 0:n.supportedFrameRates},enumerable:!1,configurable:!0}),o.prototype.updateTargetFrameRate=function(n){return this.session.updateTargetFrameRate(n)},o.prototype.runInXRFrame=function(n,r){r===void 0&&(r=!0),this.inXRFrameLoop?n():(this.inXRSession||!r)&&this.onXRFrameObservable.addOnce(n)},Object.defineProperty(o.prototype,"isFixedFoveationSupported",{get:function(){var n;return((n=this._baseLayerWrapper)===null||n===void 0?void 0:n.isFixedFoveationSupported)||!1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"fixedFoveation",{get:function(){var n;return((n=this._baseLayerWrapper)===null||n===void 0?void 0:n.fixedFoveation)||null},set:function(n){var r=Math.max(0,Math.min(1,n||0));this._baseLayerWrapper&&(this._baseLayerWrapper.fixedFoveation=r)},enumerable:!1,configurable:!0}),o}(),w;(function(o){o[o.ENTERING_XR=0]="ENTERING_XR",o[o.EXITING_XR=1]="EXITING_XR",o[o.IN_XR=2]="IN_XR",o[o.NOT_IN_XR=3]="NOT_IN_XR"})(w||(w={}));var ne;(function(o){o[o.NOT_TRACKING=0]="NOT_TRACKING",o[o.TRACKING_LOST=1]="TRACKING_LOST",o[o.TRACKING=2]="TRACKING"})(ne||(ne={}));var St=function(o){R(n,o);function n(r,t,e){var i=o.call(this,r,_.Zero(),t)||this;return i._xrSessionManager=e,i._firstFrame=!1,i._referenceQuaternion=y.Identity(),i._referencedPosition=new _,i._trackingState=ne.NOT_TRACKING,i.onBeforeCameraTeleport=new g,i.onAfterCameraTeleport=new g,i.onTrackingStateChanged=new g,i.compensateOnFirstFrame=!0,i._rotate180=new y(0,1,0,0),i.minZ=.1,i.rotationQuaternion=new y,i.cameraRigMode=ot.RIG_MODE_CUSTOM,i.updateUpVectorFromRotation=!0,i._updateNumberOfRigCameras(1),i.freezeProjectionMatrix(),i._xrSessionManager.onXRSessionInit.add(function(){i._referencedPosition.copyFromFloats(0,0,0),i._referenceQuaternion.copyFromFloats(0,0,0,1),i._firstFrame=i.compensateOnFirstFrame}),i._xrSessionManager.onXRFrameObservable.add(function(){i._firstFrame&&i._updateFromXRSession(),i._updateReferenceSpace(),i._updateFromXRSession()},void 0,!0),i}return Object.defineProperty(n.prototype,"trackingState",{get:function(){return this._trackingState},enumerable:!1,configurable:!0}),n.prototype._setTrackingState=function(r){this._trackingState!==r&&(this._trackingState=r,this.onTrackingStateChanged.notifyObservers(r))},Object.defineProperty(n.prototype,"realWorldHeight",{get:function(){var r=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.baseReferenceSpace);return r&&r.transform?r.transform.position.y:0},enumerable:!1,configurable:!0}),n.prototype._updateForDualEyeDebugging=function(){this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new Oe(0,0,.5,1),this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new Oe(.5,0,.5,1),this.rigCameras[1].outputRenderTarget=null},n.prototype.setTransformationFromNonVRCamera=function(r,t){if(r===void 0&&(r=this.getScene().activeCamera),t===void 0&&(t=!0),!(!r||r===this)){var e=r.computeWorldMatrix();e.decompose(void 0,this.rotationQuaternion,this.position),this.position.y=0,y.FromEulerAnglesToRef(0,this.rotationQuaternion.toEulerAngles().y,0,this.rotationQuaternion),this._firstFrame=!0,t&&this._xrSessionManager.resetReferenceSpace()}},n.prototype.getClassName=function(){return"WebXRCamera"},n.prototype.dispose=function(){o.prototype.dispose.call(this),this._lastXRViewerPose=void 0},n.prototype._updateFromXRSession=function(){var r=this,t=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.referenceSpace);if(this._lastXRViewerPose=t||void 0,!t){this._setTrackingState(ne.NOT_TRACKING);return}var e=t.emulatedPosition?ne.TRACKING_LOST:ne.TRACKING;if(this._setTrackingState(e),this.minZ!==this._cache.minZ||this.maxZ!==this._cache.maxZ){var i={depthFar:this.maxZ||1e4,depthNear:this.minZ};this._xrSessionManager.updateRenderState(i),this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ}if(t.transform){var a=t.transform.orientation;if(t.transform.orientation.x===void 0)return;var s=t.transform.position;this._referencedPosition.set(s.x,s.y,s.z),this._referenceQuaternion.set(a.x,a.y,a.z,a.w),this._scene.useRightHandedSystem||(this._referencedPosition.z*=-1,this._referenceQuaternion.z*=-1,this._referenceQuaternion.w*=-1),this._firstFrame?(this._firstFrame=!1,this.position.y+=this._referencedPosition.y,this._referenceQuaternion.copyFromFloats(0,0,0,1)):(this.rotationQuaternion.copyFrom(this._referenceQuaternion),this.position.copyFrom(this._referencedPosition))}this.rigCameras.length!==t.views.length&&this._updateNumberOfRigCameras(t.views.length),t.views.forEach(function(l,u){var h,c=r.rigCameras[u];!c.isLeftCamera&&!c.isRightCamera&&(l.eye==="right"?c._isRightCamera=!0:l.eye==="left"&&(c._isLeftCamera=!0));var d=l.transform.position,f=l.transform.orientation;c.parent=r.parent,c.position.set(d.x,d.y,d.z),c.rotationQuaternion.set(f.x,f.y,f.z,f.w),r._scene.useRightHandedSystem?c.rotationQuaternion.multiplyInPlace(r._rotate180):(c.position.z*=-1,c.rotationQuaternion.z*=-1,c.rotationQuaternion.w*=-1),E.FromFloat32ArrayToRefScaled(l.projectionMatrix,0,1,c._projectionMatrix),r._scene.useRightHandedSystem||c._projectionMatrix.toggleProjectionMatrixHandInPlace(),u===0&&r._projectionMatrix.copyFrom(c._projectionMatrix);var m=r._xrSessionManager.getRenderTargetTextureForView(l);r._renderingMultiview=((h=m==null?void 0:m._texture)===null||h===void 0?void 0:h.isMultiview)||!1,r._renderingMultiview?u==0&&(r._xrSessionManager.trySetViewportForView(r.viewport,l),r.outputRenderTarget=m):(r._xrSessionManager.trySetViewportForView(c.viewport,l),c.outputRenderTarget=m||r._xrSessionManager.getRenderTargetTextureForView(l))})},n.prototype._updateNumberOfRigCameras=function(r){for(r===void 0&&(r=1);this.rigCameras.length<r;){var t=new nt("XR-RigCamera: "+this.rigCameras.length,_.Zero(),this.getScene());t.minZ=.1,t.rotationQuaternion=new y,t.updateUpVectorFromRotation=!0,t.isRigCamera=!0,t.rigParent=this,t.freezeProjectionMatrix(),this.rigCameras.push(t)}for(;this.rigCameras.length>r;){var e=this.rigCameras.pop();e&&e.dispose()}},n.prototype._updateReferenceSpace=function(){if(!this.position.equals(this._referencedPosition)||!this.rotationQuaternion.equals(this._referenceQuaternion)){var r=T.Matrix[0],t=T.Matrix[1],e=T.Matrix[2];E.ComposeToRef(n._ScaleReadOnly,this._referenceQuaternion,this._referencedPosition,r),E.ComposeToRef(n._ScaleReadOnly,this.rotationQuaternion,this.position,t),r.invert().multiplyToRef(t,e),e.invert(),this._scene.useRightHandedSystem||e.toggleModelMatrixHandInPlace(),e.decompose(void 0,this._referenceQuaternion,this._referencedPosition);var i=new XRRigidTransform({x:this._referencedPosition.x,y:this._referencedPosition.y,z:this._referencedPosition.z},{x:this._referenceQuaternion.x,y:this._referenceQuaternion.y,z:this._referenceQuaternion.z,w:this._referenceQuaternion.w});this._xrSessionManager.referenceSpace=this._xrSessionManager.referenceSpace.getOffsetReferenceSpace(i)}},n._ScaleReadOnly=_.One(),n}(it),At=function(){function o(n){var r=this;this._scene=n,this._nonVRCamera=null,this._attachedToElement=!1,this._spectatorCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this._spectatorMode=!1,this.onInitialXRPoseSetObservable=new g,this.onStateChangedObservable=new g,this.state=w.NOT_IN_XR,this.sessionManager=new Et(n),this.camera=new St("webxr",n,this.sessionManager),this.featuresManager=new A(this.sessionManager),n.onDisposeObservable.addOnce(function(){r.dispose()})}return o.CreateAsync=function(n){var r=new o(n);return r.sessionManager.initializeAsync().then(function(){return r._supported=!0,r}).catch(function(t){throw r._setState(w.NOT_IN_XR),r.dispose(),t})},o.prototype.dispose=function(){var n;this.exitXRAsync(),this.camera.dispose(),this.onStateChangedObservable.clear(),this.onInitialXRPoseSetObservable.clear(),this.sessionManager.dispose(),(n=this._spectatorCamera)===null||n===void 0||n.dispose(),this._nonVRCamera&&(this._scene.activeCamera=this._nonVRCamera)},o.prototype.enterXRAsync=function(n,r,t,e){var i,a,s;return t===void 0&&(t=this.sessionManager.getWebXRRenderTarget()),e===void 0&&(e={}),V(this,void 0,void 0,function(){var l,u,h,c=this;return W(this,function(d){switch(d.label){case 0:if(!this._supported)throw"WebXR not supported in this browser or environment";return this._setState(w.ENTERING_XR),r!=="viewer"&&r!=="local"&&(e.optionalFeatures=e.optionalFeatures||[],e.optionalFeatures.push(r)),[4,this.featuresManager._extendXRSessionInitObject(e)];case 1:e=d.sent(),n==="immersive-ar"&&r!=="unbounded"&&N.Warn("We recommend using 'unbounded' reference space type when using 'immersive-ar' session mode"),d.label=2;case 2:return d.trys.push([2,6,,7]),[4,this.sessionManager.initializeSessionAsync(n,e)];case 3:return d.sent(),[4,this.sessionManager.setReferenceSpaceTypeAsync(r)];case 4:return d.sent(),[4,t.initializeXRLayerAsync(this.sessionManager.session)];case 5:return l=d.sent(),u={depthFar:this.camera.maxZ||1e4,depthNear:this.camera.minZ},this.featuresManager.getEnabledFeature(P.LAYERS)||(u.baseLayer=l),this.sessionManager.updateRenderState(u),this.sessionManager.runXRRenderLoop(),this._originalSceneAutoClear=this._scene.autoClear,this._nonVRCamera=this._scene.activeCamera,this._attachedToElement=!!(!((a=(i=this._nonVRCamera)===null||i===void 0?void 0:i.inputs)===null||a===void 0)&&a.attachedToElement),(s=this._nonVRCamera)===null||s===void 0||s.detachControl(),this._scene.activeCamera=this.camera,n!=="immersive-ar"?this._nonXRToXRCamera():(this._scene.autoClear=!1,this.camera.compensateOnFirstFrame=!1,this.camera.position.set(0,0,0),this.camera.rotationQuaternion.set(0,0,0,1)),this.sessionManager.onXRSessionEnded.addOnce(function(){c.state!==w.EXITING_XR&&c._setState(w.EXITING_XR),c.camera.rigCameras.forEach(function(f){f.outputRenderTarget=null}),c._scene.autoClear=c._originalSceneAutoClear,c._scene.activeCamera=c._nonVRCamera,c._attachedToElement&&c._nonVRCamera&&c._nonVRCamera.attachControl(!!c._nonVRCamera.inputs.noPreventDefault),n!=="immersive-ar"&&c.camera.compensateOnFirstFrame&&(c._nonVRCamera.setPosition?c._nonVRCamera.setPosition(c.camera.position):c._nonVRCamera.position.copyFrom(c.camera.position)),c._setState(w.NOT_IN_XR)}),this.sessionManager.onXRFrameObservable.addOnce(function(){c._setState(w.IN_XR)}),[2,this.sessionManager];case 6:throw h=d.sent(),console.log(h),console.log(h.message),this._setState(w.NOT_IN_XR),h;case 7:return[2]}})})},o.prototype.exitXRAsync=function(){return this.state!==w.IN_XR?Promise.resolve():(this._setState(w.EXITING_XR),this.sessionManager.exitXRAsync())},o.prototype.enableSpectatorMode=function(){var n=this;if(!this._spectatorMode){var r=function(){n._spectatorCamera&&(n._spectatorCamera.position.copyFrom(n.camera.rigCameras[0].globalPosition),n._spectatorCamera.rotationQuaternion.copyFrom(n.camera.rigCameras[0].absoluteRotation))},t=function(){n.state===w.IN_XR?(n._spectatorCamera=new at("webxr-spectator",_.Zero(),n._scene),n._spectatorCamera.rotationQuaternion=new y,n._scene.activeCameras=[n.camera,n._spectatorCamera],n.sessionManager.onXRFrameObservable.add(r),n._scene.onAfterRenderCameraObservable.add(function(e){e===n.camera&&(n._scene.getEngine().framebufferDimensionsObject=null)})):n.state===w.EXITING_XR&&(n.sessionManager.onXRFrameObservable.removeCallback(r),n._scene.activeCameras=null)};this._spectatorMode=!0,this.onStateChangedObservable.add(t),t()}},o.prototype._nonXRToXRCamera=function(){this.camera.setTransformationFromNonVRCamera(this._nonVRCamera),this.onInitialXRPoseSetObservable.notifyObservers(this.camera)},o.prototype._setState=function(n){this.state!==n&&(this.state=n,this.onStateChangedObservable.notifyObservers(this.state))},o}(),Q=function(){function o(n,r,t,e){t===void 0&&(t=-1),e===void 0&&(e=[]),this.id=n,this.type=r,this._buttonIndex=t,this._axesIndices=e,this._axes={x:0,y:0},this._changes={},this._currentValue=0,this._hasChanges=!1,this._pressed=!1,this._touched=!1,this.onAxisValueChangedObservable=new g,this.onButtonStateChangedObservable=new g}return Object.defineProperty(o.prototype,"axes",{get:function(){return this._axes},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"changes",{get:function(){return this._changes},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"hasChanges",{get:function(){return this._hasChanges},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"pressed",{get:function(){return this._pressed},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"touched",{get:function(){return this._touched},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"value",{get:function(){return this._currentValue},enumerable:!1,configurable:!0}),o.prototype.dispose=function(){this.onAxisValueChangedObservable.clear(),this.onButtonStateChangedObservable.clear()},o.prototype.isAxes=function(){return this._axesIndices.length!==0},o.prototype.isButton=function(){return this._buttonIndex!==-1},o.prototype.update=function(n){var r=!1,t=!1;if(this._hasChanges=!1,this._changes={},this.isButton()){var e=n.buttons[this._buttonIndex];if(!e)return;this._currentValue!==e.value&&(this.changes.value={current:e.value,previous:this._currentValue},r=!0,this._currentValue=e.value),this._touched!==e.touched&&(this.changes.touched={current:e.touched,previous:this._touched},r=!0,this._touched=e.touched),this._pressed!==e.pressed&&(this.changes.pressed={current:e.pressed,previous:this._pressed},r=!0,this._pressed=e.pressed)}this.isAxes()&&(this._axes.x!==n.axes[this._axesIndices[0]]&&(this.changes.axes={current:{x:n.axes[this._axesIndices[0]],y:this._axes.y},previous:{x:this._axes.x,y:this._axes.y}},this._axes.x=n.axes[this._axesIndices[0]],t=!0),this._axes.y!==n.axes[this._axesIndices[1]]&&(this.changes.axes?this.changes.axes.current.y=n.axes[this._axesIndices[1]]:this.changes.axes={current:{x:this._axes.x,y:n.axes[this._axesIndices[1]]},previous:{x:this._axes.x,y:this._axes.y}},this._axes.y=n.axes[this._axesIndices[1]],t=!0)),r&&(this._hasChanges=!0,this.onButtonStateChangedObservable.notifyObservers(this)),t&&(this._hasChanges=!0,this.onAxisValueChangedObservable.notifyObservers(this._axes))},o.BUTTON_TYPE="button",o.SQUEEZE_TYPE="squeeze",o.THUMBSTICK_TYPE="thumbstick",o.TOUCHPAD_TYPE="touchpad",o.TRIGGER_TYPE="trigger",o}(),se=function(){function o(n,r,t,e,i,a){i===void 0&&(i=!1);var s=this;this.scene=n,this.layout=r,this.gamepadObject=t,this.handedness=e,this._doNotLoadControllerMesh=i,this._controllerCache=a,this._initComponent=function(l){if(!!l){var u=s.layout.components[l],h=u.type,c=u.gamepadIndices.button,d=[];u.gamepadIndices.xAxis!==void 0&&u.gamepadIndices.yAxis!==void 0&&d.push(u.gamepadIndices.xAxis,u.gamepadIndices.yAxis),s.components[l]=new Q(l,h,c,d)}},this._modelReady=!1,this.components={},this.disableAnimation=!1,this.onModelLoadedObservable=new g,r.components&&Object.keys(r.components).forEach(this._initComponent)}return o.prototype.dispose=function(){var n=this;this.getComponentIds().forEach(function(r){return n.getComponent(r).dispose()}),this.rootMesh&&(this.rootMesh.getChildren(void 0,!0).forEach(function(r){r.setEnabled(!1)}),this.rootMesh.dispose(!!this._controllerCache,!this._controllerCache))},o.prototype.getAllComponentsOfType=function(n){var r=this;return this.getComponentIds().map(function(t){return r.components[t]}).filter(function(t){return t.type===n})},o.prototype.getComponent=function(n){return this.components[n]},o.prototype.getComponentIds=function(){return Object.keys(this.components)},o.prototype.getComponentOfType=function(n){return this.getAllComponentsOfType(n)[0]||null},o.prototype.getMainComponent=function(){return this.getComponent(this.layout.selectComponentId)},o.prototype.loadModel=function(){return V(this,void 0,void 0,function(){var n,r,t=this;return W(this,function(e){return n=!this._getModelLoadingConstraints(),r=this._getGenericFilenameAndPath(),n?N.Warn("Falling back to generic models"):r=this._getFilenameAndPath(),[2,new Promise(function(i,a){var s=function(u){n?t._getGenericParentMesh(u):t._setRootMesh(u),t._processLoadedModel(u),t._modelReady=!0,t.onModelLoadedObservable.notifyObservers(t),i(!0)};if(t._controllerCache){var l=t._controllerCache.filter(function(u){return u.filename===r.filename&&u.path===r.path});if(l[0]){l[0].meshes.forEach(function(u){return u.setEnabled(!0)}),s(l[0].meshes);return}}ue.ImportMesh("",r.path,r.filename,t.scene,function(u){t._controllerCache&&t._controllerCache.push(I(I({},r),{meshes:u})),s(u)},null,function(u,h){N.Log(h),N.Warn("Failed to retrieve controller model of type ".concat(t.profileId," from the remote server: ").concat(r.path).concat(r.filename)),a(h)})})]})})},o.prototype.updateFromXRFrame=function(n){var r=this;this.getComponentIds().forEach(function(t){return r.getComponent(t).update(r.gamepadObject)}),this.updateModel(n)},Object.defineProperty(o.prototype,"handness",{get:function(){return this.handedness},enumerable:!1,configurable:!0}),o.prototype.pulse=function(n,r,t){return t===void 0&&(t=0),this.gamepadObject.hapticActuators&&this.gamepadObject.hapticActuators[t]?this.gamepadObject.hapticActuators[t].pulse(n,r):Promise.resolve(!1)},o.prototype._getChildByName=function(n,r){return n.getChildren(function(t){return t.name===r},!1)[0]},o.prototype._getImmediateChildByName=function(n,r){return n.getChildren(function(t){return t.name==r},!0)[0]},o.prototype._lerpTransform=function(n,r,t){if(!(!n.minMesh||!n.maxMesh||!n.valueMesh)&&!(!n.minMesh.rotationQuaternion||!n.maxMesh.rotationQuaternion||!n.valueMesh.rotationQuaternion)){var e=t?r*.5+.5:r;y.SlerpToRef(n.minMesh.rotationQuaternion,n.maxMesh.rotationQuaternion,e,n.valueMesh.rotationQuaternion),_.LerpToRef(n.minMesh.position,n.maxMesh.position,e,n.valueMesh.position)}},o.prototype.updateModel=function(n){!this._modelReady||this._updateModel(n)},o.prototype._getGenericFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},o.prototype._getGenericParentMesh=function(n){var r=this;this.rootMesh=new ae(this.profileId+" "+this.handedness,this.scene),n.forEach(function(t){t.parent||(t.isPickable=!1,t.setParent(r.rootMesh))}),this.rootMesh.rotationQuaternion=y.FromEulerAngles(0,Math.PI,0)},o}(),Ge=function(o){R(n,o);function n(r,t,e){var i=o.call(this,r,Ot[e],t,e)||this;return i.profileId=n.ProfileId,i}return n.prototype._getFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},n.prototype._getModelLoadingConstraints=function(){return!0},n.prototype._processLoadedModel=function(r){},n.prototype._setRootMesh=function(r){var t=this;this.rootMesh=new ae(this.profileId+" "+this.handedness,this.scene),r.forEach(function(e){e.isPickable=!1,e.parent||e.setParent(t.rootMesh)}),this.rootMesh.rotationQuaternion=y.FromEulerAngles(0,Math.PI,0)},n.prototype._updateModel=function(){},n.ProfileId="generic-trigger",n}(se),Ot={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-right",assetPath:"right.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-none",assetPath:"none.glb"}},Ft=function(o){R(n,o);function n(r,t,e,i,a){var s=o.call(this,r,e.layouts[t.handedness||"none"],t.gamepad,t.handedness,void 0,a)||this;return s._repositoryUrl=i,s.controllerCache=a,s._buttonMeshMapping={},s._touchDots={},s.profileId=e.profileId,s}return n.prototype.dispose=function(){var r=this;o.prototype.dispose.call(this),this.controllerCache||Object.keys(this._touchDots).forEach(function(t){r._touchDots[t].dispose()})},n.prototype._getFilenameAndPath=function(){return{filename:this.layout.assetPath,path:"".concat(this._repositoryUrl,"/profiles/").concat(this.profileId,"/")}},n.prototype._getModelLoadingConstraints=function(){var r=ue.IsPluginForExtensionAvailable(".glb");return r||N.Warn("glTF / glb loader was not registered, using generic controller instead"),r},n.prototype._processLoadedModel=function(r){var t=this;this.getComponentIds().forEach(function(e){var i=t.layout.components[e];t._buttonMeshMapping[e]={mainMesh:t._getChildByName(t.rootMesh,i.rootNodeName),states:{}},Object.keys(i.visualResponses).forEach(function(a){var s=i.visualResponses[a];if(s.valueNodeProperty==="transform")t._buttonMeshMapping[e].states[a]={valueMesh:t._getChildByName(t.rootMesh,s.valueNodeName),minMesh:t._getChildByName(t.rootMesh,s.minNodeName),maxMesh:t._getChildByName(t.rootMesh,s.maxNodeName)};else{var l=i.type===Q.TOUCHPAD_TYPE&&i.touchPointNodeName?i.touchPointNodeName:s.valueNodeName;if(t._buttonMeshMapping[e].states[a]={valueMesh:t._getChildByName(t.rootMesh,l)},i.type===Q.TOUCHPAD_TYPE&&!t._touchDots[a]){var u=le(a+"dot",{diameter:.0015,segments:8},t.scene);u.material=new ie(a+"mat",t.scene),u.material.diffuseColor=k.Red(),u.parent=t._buttonMeshMapping[e].states[a].valueMesh||null,u.isVisible=!1,t._touchDots[a]=u}}})})},n.prototype._setRootMesh=function(r){this.rootMesh=new ae(this.profileId+"-"+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(var t,e=0;e<r.length;e++){var i=r[e];i.isPickable=!1,i.parent||(t=i)}t&&t.setParent(this.rootMesh),this.scene.useRightHandedSystem||this.rootMesh.rotate(fe.Y,Math.PI,Je.WORLD)},n.prototype._updateModel=function(r){var t=this;this.disableAnimation||this.getComponentIds().forEach(function(e){var i=t.getComponent(e);if(!!i.hasChanges){var a=t._buttonMeshMapping[e],s=t.layout.components[e];Object.keys(s.visualResponses).forEach(function(l){var u=s.visualResponses[l],h=i.value;if(u.componentProperty==="xAxis"?h=i.axes.x:u.componentProperty==="yAxis"&&(h=i.axes.y),u.valueNodeProperty==="transform")t._lerpTransform(a.states[l],h,u.componentProperty!=="button");else{var c=a.states[l].valueMesh;c&&(c.isVisible=i.touched||i.pressed),t._touchDots[l]&&(t._touchDots[l].isVisible=i.touched||i.pressed)}})}})},n}(se),me=[],H=function(){function o(){}return o.ClearProfilesCache=function(){this._ProfilesList=null,this._ProfileLoadingPromises={}},o.DefaultFallbacks=function(){this.RegisterFallbacksForProfileId("google-daydream",["generic-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive-focus",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("magicleap-one",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("windows-mixed-reality",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("microsoft-mixed-reality",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-go",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("oculus-touch-v2",["oculus-touch","generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-touch",["generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-gearvr",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-odyssey",["generic-touchpad"]),this.RegisterFallbacksForProfileId("valve-index",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("generic-hand-select",["generic-trigger"])},o.FindFallbackWithProfileId=function(n){var r=this._Fallbacks[n]||[];return r.unshift(n),r},o.GetMotionControllerWithXRInput=function(n,r,t){var e=this,i=[];if(t&&i.push(t),i.push.apply(i,n.profiles||[]),i.length&&!i[0]&&i.pop(),n.gamepad&&n.gamepad.id)switch(n.gamepad.id){case(n.gamepad.id.match(/oculus touch/gi)?n.gamepad.id:void 0):i.push("oculus-touch-v2");break}var a=i.indexOf("windows-mixed-reality");if(a!==-1&&i.splice(a,0,"microsoft-mixed-reality"),i.length||i.push("generic-trigger"),this.UseOnlineRepository){var s=this.PrioritizeOnlineRepository?this._LoadProfileFromRepository:this._LoadProfilesFromAvailableControllers,l=this.PrioritizeOnlineRepository?this._LoadProfilesFromAvailableControllers:this._LoadProfileFromRepository;return s.call(this,i,n,r).catch(function(){return l.call(e,i,n,r)})}else return this._LoadProfilesFromAvailableControllers(i,n,r)},o.RegisterController=function(n,r){this._AvailableControllers[n]=r},o.RegisterFallbacksForProfileId=function(n,r){var t;this._Fallbacks[n]?(t=this._Fallbacks[n]).push.apply(t,r):this._Fallbacks[n]=r},o.UpdateProfilesList=function(){return this._ProfilesList=L.LoadFileAsync(this.BaseRepositoryUrl+"/profiles/profilesList.json",!1).then(function(n){return JSON.parse(n.toString())}),this._ProfilesList},o.ClearControllerCache=function(){me.forEach(function(n){n.meshes.forEach(function(r){r.dispose(!1,!0)})}),me.length=0},o._LoadProfileFromRepository=function(n,r,t){var e=this;return Promise.resolve().then(function(){return e._ProfilesList?e._ProfilesList:e.UpdateProfilesList()}).then(function(i){for(var a=0;a<n.length;++a)if(!!n[a]&&i[n[a]])return n[a];throw new Error("neither controller ".concat(n[0]," nor all fallbacks were found in the repository,"))}).then(function(i){return e._ProfileLoadingPromises[i]||(e._ProfileLoadingPromises[i]=L.LoadFileAsync("".concat(e.BaseRepositoryUrl,"/profiles/").concat(i,"/profile.json"),!1).then(function(a){return JSON.parse(a)})),e._ProfileLoadingPromises[i]}).then(function(i){return new Ft(t,r,i,e.BaseRepositoryUrl,e.DisableControllerCache?void 0:me)})},o._LoadProfilesFromAvailableControllers=function(n,r,t){for(var e=0;e<n.length;++e)if(!!n[e])for(var i=this.FindFallbackWithProfileId(n[e]),a=0;a<i.length;++a){var s=this._AvailableControllers[i[a]];if(s)return Promise.resolve(s(r,t))}throw new Error("no controller requested was found in the available controllers list")},o._AvailableControllers={},o._Fallbacks={},o._ProfileLoadingPromises={},o.BaseRepositoryUrl="https://immersive-web.github.io/webxr-input-profiles/packages/viewer/dist",o.PrioritizeOnlineRepository=!0,o.UseOnlineRepository=!0,o.DisableControllerCache=!0,o}();H.RegisterController(Ge.ProfileId,function(o,n){return new Ge(n,o.gamepad,o.handedness)});H.DefaultFallbacks();var Lt=0,wt=function(){function o(n,r,t){t===void 0&&(t={});var e=this;this._scene=n,this.inputSource=r,this._options=t,this._tmpVector=new _,this._disposed=!1,this.onDisposeObservable=new g,this.onMeshLoadedObservable=new g,this.onMotionControllerInitObservable=new g,this._uniqueId="controller-".concat(Lt++,"-").concat(r.targetRayMode,"-").concat(r.handedness),this.pointer=new He("".concat(this._uniqueId,"-pointer"),n),this.pointer.rotationQuaternion=new y,this.inputSource.gripSpace&&(this.grip=new He("".concat(this._uniqueId,"-grip"),this._scene),this.grip.rotationQuaternion=new y),this._tmpVector.set(0,0,this._scene.useRightHandedSystem?-1:1),this.inputSource.gamepad&&this.inputSource.targetRayMode==="tracked-pointer"&&H.GetMotionControllerWithXRInput(r,n,this._options.forceControllerProfile).then(function(i){e.motionController=i,e.onMotionControllerInitObservable.notifyObservers(i),!e._options.doNotLoadControllerMesh&&!e.motionController._doNotLoadControllerMesh&&e.motionController.loadModel().then(function(a){var s;a&&e.motionController&&e.motionController.rootMesh&&(e._options.renderingGroupId&&(e.motionController.rootMesh.renderingGroupId=e._options.renderingGroupId,e.motionController.rootMesh.getChildMeshes(!1).forEach(function(l){return l.renderingGroupId=e._options.renderingGroupId})),e.onMeshLoadedObservable.notifyObservers(e.motionController.rootMesh),e.motionController.rootMesh.parent=e.grip||e.pointer,e.motionController.disableAnimation=!!e._options.disableMotionControllerAnimation),e._disposed&&((s=e.motionController)===null||s===void 0||s.dispose())})},function(){L.Warn("Could not find a matching motion controller for the registered input source")})}return Object.defineProperty(o.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),o.prototype.dispose=function(){this.grip&&this.grip.dispose(!0),this.motionController&&this.motionController.dispose(),this.pointer.dispose(!0),this.onMotionControllerInitObservable.clear(),this.onMeshLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._disposed=!0},o.prototype.getWorldPointerRayToRef=function(n,r){r===void 0&&(r=!1);var t=r&&this.grip?this.grip:this.pointer;_.TransformNormalToRef(this._tmpVector,t.getWorldMatrix(),n.direction),n.direction.normalize(),n.origin.copyFrom(t.absolutePosition),n.length=1e3},o.prototype.updateFromXRFrame=function(n,r,t){var e=n.getPose(this.inputSource.targetRaySpace,r);if(this._lastXRPose=e,e){var i=e.transform.position;this.pointer.position.set(i.x,i.y,i.z);var a=e.transform.orientation;this.pointer.rotationQuaternion.set(a.x,a.y,a.z,a.w),this._scene.useRightHandedSystem||(this.pointer.position.z*=-1,this.pointer.rotationQuaternion.z*=-1,this.pointer.rotationQuaternion.w*=-1),this.pointer.parent=t.parent}if(this.inputSource.gripSpace&&this.grip){var s=n.getPose(this.inputSource.gripSpace,r);if(s){var i=s.transform.position,l=s.transform.orientation;this.grip.position.set(i.x,i.y,i.z),this.grip.rotationQuaternion.set(l.x,l.y,l.z,l.w),this._scene.useRightHandedSystem||(this.grip.position.z*=-1,this.grip.rotationQuaternion.z*=-1,this.grip.rotationQuaternion.w*=-1)}this.grip.parent=t.parent}this.motionController&&this.motionController.updateFromXRFrame(n)},o}(),kt=function(){function o(n,r,t){t===void 0&&(t={});var e=this;if(this.xrSessionManager=n,this.xrCamera=r,this._options=t,this.controllers=[],this.onControllerAddedObservable=new g,this.onControllerRemovedObservable=new g,this._onInputSourcesChange=function(i){e._addAndRemoveControllers(i.added,i.removed)},this._sessionEndedObserver=this.xrSessionManager.onXRSessionEnded.add(function(){e._addAndRemoveControllers([],e.controllers.map(function(i){return i.inputSource}))}),this._sessionInitObserver=this.xrSessionManager.onXRSessionInit.add(function(i){i.addEventListener("inputsourceschange",e._onInputSourcesChange)}),this._frameObserver=this.xrSessionManager.onXRFrameObservable.add(function(i){e.controllers.forEach(function(a){a.updateFromXRFrame(i,e.xrSessionManager.referenceSpace,e.xrCamera)})}),this._options.customControllersRepositoryURL&&(H.BaseRepositoryUrl=this._options.customControllersRepositoryURL),H.UseOnlineRepository=!this._options.disableOnlineControllerRepository,H.UseOnlineRepository)try{H.UpdateProfilesList().catch(function(){H.UseOnlineRepository=!1})}catch{H.UseOnlineRepository=!1}}return o.prototype._addAndRemoveControllers=function(n,r){for(var t=this,e=this.controllers.map(function(c){return c.inputSource}),i=0,a=n;i<a.length;i++){var s=a[i];if(e.indexOf(s)===-1){var l=new wt(this.xrSessionManager.scene,s,I(I({},this._options.controllerOptions||{}),{forceControllerProfile:this._options.forceInputProfile,doNotLoadControllerMesh:this._options.doNotLoadControllerMeshes,disableMotionControllerAnimation:this._options.disableControllerAnimation}));this.controllers.push(l),this.onControllerAddedObservable.notifyObservers(l)}}var u=[],h=[];this.controllers.forEach(function(c){r.indexOf(c.inputSource)===-1?u.push(c):h.push(c)}),this.controllers=u,h.forEach(function(c){t.onControllerRemovedObservable.notifyObservers(c),c.dispose()})},o.prototype.dispose=function(){this.controllers.forEach(function(n){n.dispose()}),this.xrSessionManager.onXRFrameObservable.remove(this._frameObserver),this.xrSessionManager.onXRSessionInit.remove(this._sessionInitObserver),this.xrSessionManager.onXRSessionEnded.remove(this._sessionEndedObserver),this.onControllerAddedObservable.clear(),this.onControllerRemovedObservable.clear(),H.ClearControllerCache()},o}(),he=function(o){R(n,o);function n(r,t){var e=o.call(this,r)||this;return e._options=t,e._attachController=function(i){if(!e._controllers[i.uniqueId]){var a=e._generateNewMeshPair(i.pointer),s=a.laserPointer,l=a.selectionMesh;switch(e._controllers[i.uniqueId]={xrController:i,laserPointer:s,selectionMesh:l,meshUnderPointer:null,pick:null,tmpRay:new oe(new _,new _),disabledByNearInteraction:!1,id:n._IdCounter++},e._attachedController?!e._options.enablePointerSelectionOnAllControllers&&e._options.preferredHandedness&&i.inputSource.handedness===e._options.preferredHandedness&&(e._attachedController=i.uniqueId):e._options.enablePointerSelectionOnAllControllers||(e._attachedController=i.uniqueId),i.inputSource.targetRayMode){case"tracked-pointer":return e._attachTrackedPointerRayMode(i);case"gaze":return e._attachGazeMode(i);case"screen":return e._attachScreenRayMode(i)}}},e._controllers={},e._tmpVectorForPickCompare=new _,e.disablePointerLighting=!0,e.disableSelectionMeshLighting=!0,e.displayLaserPointer=!0,e.displaySelectionMesh=!0,e.laserPointerPickedColor=new k(.9,.9,.9),e.laserPointerDefaultColor=new k(.7,.7,.7),e.selectionMeshDefaultColor=new k(.8,.8,.8),e.selectionMeshPickedColor=new k(.3,.3,1),e._identityMatrix=E.Identity(),e._screenCoordinatesRef=_.Zero(),e._viewportRef=new Oe(0,0,0,0),e._scene=e._xrSessionManager.scene,e}return n.prototype.attach=function(){var r=this;if(!o.prototype.attach.call(this))return!1;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(s){r._detachController(s.uniqueId)}),this._scene.constantlyUpdateMeshUnderPointer=!0,this._options.gazeCamera){var t=this._options.gazeCamera,e=this._generateNewMeshPair(t),i=e.laserPointer,a=e.selectionMesh;this._controllers.camera={webXRCamera:t,laserPointer:i,selectionMesh:a,meshUnderPointer:null,pick:null,tmpRay:new oe(new _,new _),disabledByNearInteraction:!1,id:n._IdCounter++},this._attachGazeMode()}return!0},n.prototype.detach=function(){var r=this;return o.prototype.detach.call(this)?(Object.keys(this._controllers).forEach(function(t){r._detachController(t)}),!0):!1},n.prototype.getMeshUnderPointer=function(r){return this._controllers[r]?this._controllers[r].meshUnderPointer:null},n.prototype.getXRControllerByPointerId=function(r){for(var t=Object.keys(this._controllers),e=0;e<t.length;++e)if(this._controllers[t[e]].id===r)return this._controllers[t[e]].xrController||null;return null},n.prototype._getPointerSelectionDisabledByPointerId=function(r){for(var t=Object.keys(this._controllers),e=0;e<t.length;++e)if(this._controllers[t[e]].id===r)return this._controllers[t[e]].disabledByNearInteraction;return!0},n.prototype._setPointerSelectionDisabledByPointerId=function(r,t){for(var e=Object.keys(this._controllers),i=0;i<e.length;++i)if(this._controllers[e[i]].id===r){this._controllers[e[i]].disabledByNearInteraction=t;return}},n.prototype._onXRFrame=function(r){var t=this;Object.keys(this._controllers).forEach(function(e){var i=t._controllers[e];if(!t._options.enablePointerSelectionOnAllControllers&&e!==t._attachedController||i.disabledByNearInteraction){i.selectionMesh.isVisible=!1,i.laserPointer.isVisible=!1,i.pick=null;return}i.laserPointer.isVisible=t.displayLaserPointer;var a;if(i.xrController)a=i.xrController.pointer.position,i.xrController.getWorldPointerRayToRef(i.tmpRay);else if(i.webXRCamera)a=i.webXRCamera.position,i.webXRCamera.getForwardRayToRef(i.tmpRay);else return;if(t._options.maxPointerDistance&&(i.tmpRay.length=t._options.maxPointerDistance),!t._options.disableScenePointerVectorUpdate&&a){var s=t._xrSessionManager.scene,l=t._options.xrInput.xrCamera;l&&(l.viewport.toGlobalToRef(s.getEngine().getRenderWidth(),s.getEngine().getRenderHeight(),t._viewportRef),_.ProjectToRef(a,t._identityMatrix,s.getTransformMatrix(),t._viewportRef,t._screenCoordinatesRef),typeof t._screenCoordinatesRef.x=="number"&&typeof t._screenCoordinatesRef.y=="number"&&!isNaN(t._screenCoordinatesRef.x)&&!isNaN(t._screenCoordinatesRef.y)&&(s.pointerX=t._screenCoordinatesRef.x,s.pointerY=t._screenCoordinatesRef.y,i.screenCoordinates={x:t._screenCoordinatesRef.x,y:t._screenCoordinatesRef.y}))}var u=null;t._utilityLayerScene&&(u=t._utilityLayerScene.pickWithRay(i.tmpRay,t._utilityLayerScene.pointerMovePredicate||t.raySelectionPredicate));var h=t._scene.pickWithRay(i.tmpRay,t._scene.pointerMovePredicate||t.raySelectionPredicate);!u||!u.hit?i.pick=h:!h||!h.hit||u.distance<h.distance?i.pick=u:i.pick=h,i.pick&&i.xrController&&(i.pick.aimTransform=i.xrController.pointer,i.pick.gripTransform=i.xrController.grip||null);var c=i.pick;if(c&&c.pickedPoint&&c.hit){t._updatePointerDistance(i.laserPointer,c.distance),i.selectionMesh.position.copyFrom(c.pickedPoint),i.selectionMesh.scaling.x=Math.sqrt(c.distance),i.selectionMesh.scaling.y=Math.sqrt(c.distance),i.selectionMesh.scaling.z=Math.sqrt(c.distance);var d=t._convertNormalToDirectionOfRay(c.getNormal(!0),i.tmpRay),f=.001;if(i.selectionMesh.position.copyFrom(c.pickedPoint),d){var m=_.Cross(fe.Y,d),v=_.Cross(d,m);_.RotationFromAxisToRef(v,d,m,i.selectionMesh.rotation),i.selectionMesh.position.addInPlace(d.scale(f))}i.selectionMesh.isVisible=t.displaySelectionMesh,i.meshUnderPointer=c.pickedMesh}else i.selectionMesh.isVisible=!1,t._updatePointerDistance(i.laserPointer,1),i.meshUnderPointer=null})},Object.defineProperty(n.prototype,"_utilityLayerScene",{get:function(){return this._options.customUtilityLayerScene||ee.DefaultUtilityLayer.utilityLayerScene},enumerable:!1,configurable:!0}),n.prototype._attachGazeMode=function(r){var t=this,e=this._controllers[r&&r.uniqueId||"camera"],i=this._options.timeToSelect||3e3,a=this._options.useUtilityLayer?this._utilityLayerScene:this._scene,s=new re,l=Fe("selection",{diameter:.0035*15,thickness:.0025*6,tessellation:20},a);l.isVisible=!1,l.isPickable=!1,l.parent=e.selectionMesh;var u=0,h=!1,c={pointerId:e.id,pointerType:"xr"};e.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){if(!!e.pick){if(t._augmentPointerInit(c,e.id,e.screenCoordinates),e.laserPointer.material.alpha=0,l.isVisible=!1,e.pick.hit)if(t._pickingMoved(s,e.pick))h&&(t._options.disablePointerUpOnTouchOut||t._scene.simulatePointerUp(e.pick,c)),h=!1,u=0;else if(u>i/10&&(l.isVisible=!0),u+=t._scene.getEngine().getDeltaTime(),u>=i)t._scene.simulatePointerDown(e.pick,c),h=!0,t._options.disablePointerUpOnTouchOut&&t._scene.simulatePointerUp(e.pick,c),l.isVisible=!1;else{var d=1-u/i;l.scaling.set(d,d,d)}else h=!1,u=0;t._scene.simulatePointerMove(e.pick,c),s=e.pick}}),this._options.renderingGroupId!==void 0&&(l.renderingGroupId=this._options.renderingGroupId),r&&r.onDisposeObservable.addOnce(function(){e.pick&&!t._options.disablePointerUpOnTouchOut&&h&&(t._scene.simulatePointerUp(e.pick,c),e.finalPointerUpTriggered=!0),l.dispose()})},n.prototype._attachScreenRayMode=function(r){var t=this,e=this._controllers[r.uniqueId],i=!1,a={pointerId:e.id,pointerType:"xr"};e.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){t._augmentPointerInit(a,e.id,e.screenCoordinates),!(!e.pick||t._options.disablePointerUpOnTouchOut&&i)&&(i?t._scene.simulatePointerMove(e.pick,a):(t._scene.simulatePointerDown(e.pick,a),e.pointerDownTriggered=!0,i=!0,t._options.disablePointerUpOnTouchOut&&t._scene.simulatePointerUp(e.pick,a)))}),r.onDisposeObservable.addOnce(function(){t._augmentPointerInit(a,e.id,e.screenCoordinates),t._xrSessionManager.runInXRFrame(function(){e.pick&&!e.finalPointerUpTriggered&&i&&!t._options.disablePointerUpOnTouchOut&&(t._scene.simulatePointerUp(e.pick,a),e.finalPointerUpTriggered=!0)})})},n.prototype._attachTrackedPointerRayMode=function(r){var t=this,e=this._controllers[r.uniqueId];if(this._options.forceGazeMode)return this._attachGazeMode(r);var i={pointerId:e.id,pointerType:"xr"};if(e.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){e.laserPointer.material.disableLighting=t.disablePointerLighting,e.selectionMesh.material.disableLighting=t.disableSelectionMeshLighting,e.pick&&(t._augmentPointerInit(i,e.id,e.screenCoordinates),t._scene.simulatePointerMove(e.pick,i))}),r.inputSource.gamepad){var a=function(u){t._options.overrideButtonId&&(e.selectionComponent=u.getComponent(t._options.overrideButtonId)),e.selectionComponent||(e.selectionComponent=u.getMainComponent()),e.onButtonChangedObserver=e.selectionComponent.onButtonStateChangedObservable.add(function(h){if(h.changes.pressed){var c=h.changes.pressed.current;e.pick?(t._options.enablePointerSelectionOnAllControllers||r.uniqueId===t._attachedController)&&(t._augmentPointerInit(i,e.id,e.screenCoordinates),c?(t._scene.simulatePointerDown(e.pick,i),e.pointerDownTriggered=!0,e.selectionMesh.material.emissiveColor=t.selectionMeshPickedColor,e.laserPointer.material.emissiveColor=t.laserPointerPickedColor):(t._scene.simulatePointerUp(e.pick,i),e.selectionMesh.material.emissiveColor=t.selectionMeshDefaultColor,e.laserPointer.material.emissiveColor=t.laserPointerDefaultColor)):c&&!t._options.enablePointerSelectionOnAllControllers&&!t._options.disableSwitchOnClick&&(t._attachedController=r.uniqueId)}})};r.motionController?a(r.motionController):r.onMotionControllerInitObservable.add(a)}else{var s=function(u){t._augmentPointerInit(i,e.id,e.screenCoordinates),e.xrController&&u.inputSource===e.xrController.inputSource&&e.pick&&(t._scene.simulatePointerDown(e.pick,i),e.pointerDownTriggered=!0,e.selectionMesh.material.emissiveColor=t.selectionMeshPickedColor,e.laserPointer.material.emissiveColor=t.laserPointerPickedColor)},l=function(u){t._augmentPointerInit(i,e.id,e.screenCoordinates),e.xrController&&u.inputSource===e.xrController.inputSource&&e.pick&&(t._scene.simulatePointerUp(e.pick,i),e.selectionMesh.material.emissiveColor=t.selectionMeshDefaultColor,e.laserPointer.material.emissiveColor=t.laserPointerDefaultColor)};e.eventListeners={selectend:l,selectstart:s},this._xrSessionManager.session.addEventListener("selectstart",s),this._xrSessionManager.session.addEventListener("selectend",l)}},n.prototype._convertNormalToDirectionOfRay=function(r,t){if(r){var e=Math.acos(_.Dot(r,t.direction));e<Math.PI/2&&r.scaleInPlace(-1)}return r},n.prototype._detachController=function(r){var t=this,e=this._controllers[r];if(!!e){if(e.selectionComponent&&e.onButtonChangedObserver&&e.selectionComponent.onButtonStateChangedObservable.remove(e.onButtonChangedObserver),e.onFrameObserver&&this._xrSessionManager.onXRFrameObservable.remove(e.onFrameObserver),e.eventListeners&&Object.keys(e.eventListeners).forEach(function(a){var s=e.eventListeners&&e.eventListeners[a];s&&t._xrSessionManager.session.removeEventListener(a,s)}),!e.finalPointerUpTriggered&&e.pointerDownTriggered){var i={pointerId:e.id,pointerType:"xr"};this._xrSessionManager.runInXRFrame(function(){t._augmentPointerInit(i,e.id,e.screenCoordinates),t._scene.simulatePointerUp(e.pick||new re,i),e.finalPointerUpTriggered=!0})}this._xrSessionManager.scene.onBeforeRenderObservable.addOnce(function(){try{if(e.selectionMesh.dispose(),e.laserPointer.dispose(),delete t._controllers[r],t._attachedController===r){var a=Object.keys(t._controllers);a.length?t._attachedController=a[0]:t._attachedController=""}}catch{L.Warn("controller already detached.")}})}},n.prototype._generateNewMeshPair=function(r){var t=this._options.useUtilityLayer?this._options.customUtilityLayerScene||ee.DefaultUtilityLayer.utilityLayerScene:this._scene,e=this._options.customLasterPointerMeshGenerator?this._options.customLasterPointerMeshGenerator():Qe("laserPointer",{height:1,diameterTop:2e-4,diameterBottom:.004,tessellation:20,subdivisions:1},t);e.parent=r;var i=new ie("laserPointerMat",t);i.emissiveColor=this.laserPointerDefaultColor,i.alpha=.7,e.material=i,e.rotation.x=Math.PI/2,this._updatePointerDistance(e,1),e.isPickable=!1,e.isVisible=!1;var a=this._options.customSelectionMeshGenerator?this._options.customSelectionMeshGenerator():Fe("gazeTracker",{diameter:.0035*3,thickness:.0025*3,tessellation:20},t);a.bakeCurrentTransformIntoVertices(),a.isPickable=!1,a.isVisible=!1;var s=new ie("targetMat",t);return s.specularColor=k.Black(),s.emissiveColor=this.selectionMeshDefaultColor,s.backFaceCulling=!1,a.material=s,this._options.renderingGroupId!==void 0&&(e.renderingGroupId=this._options.renderingGroupId,a.renderingGroupId=this._options.renderingGroupId),{laserPointer:e,selectionMesh:a}},n.prototype._pickingMoved=function(r,t){var e;if(!r.hit||!t.hit||!r.pickedMesh||!r.pickedPoint||!t.pickedMesh||!t.pickedPoint||r.pickedMesh!==t.pickedMesh)return!0;(e=r.pickedPoint)===null||e===void 0||e.subtractToRef(t.pickedPoint,this._tmpVectorForPickCompare),this._tmpVectorForPickCompare.set(Math.abs(this._tmpVectorForPickCompare.x),Math.abs(this._tmpVectorForPickCompare.y),Math.abs(this._tmpVectorForPickCompare.z));var i=(this._options.gazeModePointerMovedFactor||1)*.01*t.distance,a=this._tmpVectorForPickCompare.length();return a>i},n.prototype._updatePointerDistance=function(r,t){t===void 0&&(t=100),r.scaling.y=t,this._scene.useRightHandedSystem&&(t*=-1),r.position.z=t/2+.05},n.prototype._augmentPointerInit=function(r,t,e){r.pointerId=t,r.pointerType="xr",e&&(r.screenX=e.x,r.screenY=e.y)},Object.defineProperty(n.prototype,"lasterPointerDefaultColor",{get:function(){return this.laserPointerDefaultColor},enumerable:!1,configurable:!0}),n._IdCounter=200,n.Name=P.POINTER_SELECTION,n.Version=1,n}(O);A.AddWebXRFeature(he.Name,function(o,n){return function(){return new he(o,n)}},he.Version,!0);var G;(function(o){o[o.DEHYDRATED=0]="DEHYDRATED",o[o.HOVER=1]="HOVER",o[o.TOUCH=2]="TOUCH"})(G||(G={}));var J;(function(o){o[o.DISABLED=0]="DISABLED",o[o.CENTERED_ON_CONTROLLER=1]="CENTERED_ON_CONTROLLER",o[o.CENTERED_IN_FRONT=2]="CENTERED_IN_FRONT"})(J||(J={}));var de=function(o){R(n,o);function n(r,t){var e=o.call(this,r)||this;return e._options=t,e._tmpRay=new oe(new _,new _),e._attachController=function(i){if(!e._controllers[i.uniqueId]){var a=e._generateNewTouchPointMesh(),s=a.touchCollisionMesh,l=a.touchCollisionMeshFunction,u=a.hydrateCollisionMeshFunction,h=e._generateVisualCue();switch(e._controllers[i.uniqueId]={xrController:i,meshUnderPointer:null,nearInteractionTargetMesh:null,pick:null,stalePick:null,touchCollisionMesh:s,touchCollisionMeshFunction:l,hydrateCollisionMeshFunction:u,currentAnimationState:G.DEHYDRATED,grabRay:new oe(new _,new _),hoverInteraction:!1,nearInteraction:!1,grabInteraction:!1,id:n._IdCounter++,pickedPointVisualCue:h},e._attachedController?!e._options.enableNearInteractionOnAllControllers&&e._options.preferredHandedness&&i.inputSource.handedness===e._options.preferredHandedness&&(e._attachedController=i.uniqueId):e._options.enableNearInteractionOnAllControllers||(e._attachedController=i.uniqueId),i.inputSource.targetRayMode){case"tracked-pointer":return e._attachNearInteractionMode(i);case"gaze":return null;case"screen":return null}}},e._controllers={},e._farInteractionFeature=null,e.selectionMeshDefaultColor=new k(.8,.8,.8),e.selectionMeshPickedColor=new k(.3,.3,1),e._hoverRadius=.1,e._pickRadius=.02,e._controllerPickRadius=.03,e._nearGrabLengthScale=5,e._scene=e._xrSessionManager.scene,e._options.nearInteractionControllerMode===void 0&&(e._options.nearInteractionControllerMode=J.CENTERED_IN_FRONT),e._options.farInteractionFeature&&(e._farInteractionFeature=e._options.farInteractionFeature),e}return n.prototype.attach=function(){var r=this;return o.prototype.attach.call(this)?(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(t){r._detachController(t.uniqueId)}),this._scene.constantlyUpdateMeshUnderPointer=!0,!0):!1},n.prototype.detach=function(){var r=this;return o.prototype.detach.call(this)?(Object.keys(this._controllers).forEach(function(t){r._detachController(t)}),!0):!1},n.prototype.getMeshUnderPointer=function(r){return this._controllers[r]?this._controllers[r].meshUnderPointer:null},n.prototype.getXRControllerByPointerId=function(r){for(var t=Object.keys(this._controllers),e=0;e<t.length;++e)if(this._controllers[t[e]].id===r)return this._controllers[t[e]].xrController||null;return null},n.prototype.setFarInteractionFeature=function(r){this._farInteractionFeature=r},n.prototype._nearPickPredicate=function(r){return r.isEnabled()&&r.isVisible&&r.isPickable&&r.isNearPickable},n.prototype._nearGrabPredicate=function(r){return r.isEnabled()&&r.isVisible&&r.isPickable&&r.isNearGrabbable},n.prototype._nearInteractionPredicate=function(r){return r.isEnabled()&&r.isVisible&&r.isPickable&&(r.isNearPickable||r.isNearGrabbable)},n.prototype._controllerAvailablePredicate=function(r,t){for(var e=r;e;){if(e.reservedDataStore&&e.reservedDataStore.nearInteraction&&e.reservedDataStore.nearInteraction.excludedControllerId===t)return!1;e=e.parent}return!0},n.prototype._handleTransitionAnimation=function(r,t){var e;if(!(r.currentAnimationState===t||this._options.nearInteractionControllerMode!==J.CENTERED_IN_FRONT||!!(!((e=r.xrController)===null||e===void 0)&&e.inputSource.hand))){if(t>r.currentAnimationState)switch(r.currentAnimationState){case G.DEHYDRATED:if(r.hydrateCollisionMeshFunction(!0),t===G.HOVER)break;case G.HOVER:if(r.touchCollisionMeshFunction(!0),t===G.TOUCH)break}else switch(r.currentAnimationState){case G.TOUCH:if(r.touchCollisionMeshFunction(!1),t===G.HOVER)break;case G.HOVER:if(r.hydrateCollisionMeshFunction(!1),t===G.DEHYDRATED)break}r.currentAnimationState=t}},n.prototype._processTouchPoint=function(r,t,e){var i,a=this._controllers[r];a.grabRay.origin.copyFrom(t),e.toEulerAnglesToRef(T.Vector3[0]),a.grabRay.direction.copyFrom(T.Vector3[0]),this._options.nearInteractionControllerMode===J.CENTERED_IN_FRONT&&!(!((i=a.xrController)===null||i===void 0)&&i.inputSource.hand)&&(a.xrController.getWorldPointerRayToRef(this._tmpRay),a.grabRay.origin.addInPlace(this._tmpRay.direction.scale(.05))),a.grabRay.length=this._nearGrabLengthScale*this._hoverRadius,a.touchCollisionMesh.position.copyFrom(a.grabRay.origin)},n.prototype._onXRFrame=function(r){var t=this;Object.keys(this._controllers).forEach(function(e){var i,a=t._controllers[e],s=(i=a.xrController)===null||i===void 0?void 0:i.inputSource.hand;if(!t._options.enableNearInteractionOnAllControllers&&e!==t._attachedController||!a.xrController||!s&&(!t._options.nearInteractionControllerMode||!a.xrController.inputSource.gamepad)){a.pick=null;return}if(a.hoverInteraction=!1,a.nearInteraction=!1,a.xrController){if(s){var l=s.get("index-finger-tip");if(l){var u=r.getJointPose(l,t._xrSessionManager.referenceSpace);if(u&&u.transform){var h=t._scene.useRightHandedSystem?1:-1;T.Vector3[0].set(u.transform.position.x,u.transform.position.y,u.transform.position.z*h),T.Quaternion[0].set(u.transform.orientation.x,u.transform.orientation.y,u.transform.orientation.z*h,u.transform.orientation.w*h),t._processTouchPoint(e,T.Vector3[0],T.Quaternion[0])}}}else if(a.xrController.inputSource.gamepad&&t._options.nearInteractionControllerMode!==J.DISABLED){var c=a.xrController.pointer;a.xrController.grip&&t._options.nearInteractionControllerMode===J.CENTERED_ON_CONTROLLER&&(c=a.xrController.grip),t._processTouchPoint(e,c.position,c.rotationQuaternion)}}else return;var d=function(b,X){var q=null;return!X||!X.hit?q=b:!b||!b.hit||X.distance<b.distance?q=X:q=b,q},f=function(b){var X=new re,q=!1,$e=b&&b.pickedPoint&&b.hit;return b!=null&&b.pickedPoint&&(q=b.pickedPoint.x===0&&b.pickedPoint.y===0&&b.pickedPoint.z===0),$e&&!q&&(X=b),X};if(!a.grabInteraction){var m=null,v=null;t._options.useUtilityLayer&&t._utilityLayerScene&&(v=t._pickWithSphere(a,t._hoverRadius,t._utilityLayerScene,function(b){return t._nearInteractionPredicate(b)}));var x=t._pickWithSphere(a,t._hoverRadius,t._scene,function(b){return t._nearInteractionPredicate(b)}),S=d(x,v);if(S&&S.hit&&(m=f(S),m.hit&&(a.hoverInteraction=!0)),a.hoverInteraction){var M=null,C=s?t._pickRadius:t._controllerPickRadius;t._options.useUtilityLayer&&t._utilityLayerScene&&(M=t._pickWithSphere(a,C,t._utilityLayerScene,function(b){return t._nearPickPredicate(b)}));var F=t._pickWithSphere(a,C,t._scene,function(b){return t._nearPickPredicate(b)}),U=d(F,M),te=f(U);te.hit&&(m=te,a.nearInteraction=!0)}a.stalePick=a.pick,a.pick=m,a.pick&&a.pick.pickedPoint&&a.pick.hit?(a.meshUnderPointer=a.pick.pickedMesh,a.pickedPointVisualCue.position.copyFrom(a.pick.pickedPoint),a.pickedPointVisualCue.isVisible=!0,t._farInteractionFeature&&t._farInteractionFeature.attached&&t._farInteractionFeature._setPointerSelectionDisabledByPointerId(a.id,!0)):(a.meshUnderPointer=null,a.pickedPointVisualCue.isVisible=!1,t._farInteractionFeature&&t._farInteractionFeature.attached&&t._farInteractionFeature._setPointerSelectionDisabledByPointerId(a.id,!1))}var Y=G.DEHYDRATED;a.grabInteraction||a.nearInteraction?Y=G.TOUCH:a.hoverInteraction&&(Y=G.HOVER),t._handleTransitionAnimation(a,Y)})},Object.defineProperty(n.prototype,"_utilityLayerScene",{get:function(){return this._options.customUtilityLayerScene||ee.DefaultUtilityLayer.utilityLayerScene},enumerable:!1,configurable:!0}),n.prototype._generateVisualCue=function(){var r=this._options.useUtilityLayer?this._options.customUtilityLayerScene||ee.DefaultUtilityLayer.utilityLayerScene:this._scene,t=le("nearInteraction",{diameter:.0035*3},r);t.bakeCurrentTransformIntoVertices(),t.isPickable=!1,t.isVisible=!1,t.rotationQuaternion=y.Identity();var e=new ie("targetMat",r);return e.specularColor=k.Black(),e.emissiveColor=this.selectionMeshDefaultColor,e.backFaceCulling=!1,t.material=e,t},n.prototype._isControllerReadyForNearInteraction=function(r){return this._farInteractionFeature?this._farInteractionFeature._getPointerSelectionDisabledByPointerId(r):!0},n.prototype._attachNearInteractionMode=function(r){var t=this,e=this._controllers[r.uniqueId],i={pointerId:e.id,pointerType:"xr"};e.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){!t._options.enableNearInteractionOnAllControllers&&r.uniqueId!==t._attachedController||!e.xrController||!e.xrController.inputSource.hand&&(!t._options.nearInteractionControllerMode||!e.xrController.inputSource.gamepad)||(e.pick&&(e.pick.ray=e.grabRay),e.pick&&t._isControllerReadyForNearInteraction(e.id)&&t._scene.simulatePointerMove(e.pick,i),e.nearInteraction&&e.pick&&e.pick.hit?e.nearInteractionTargetMesh||(t._scene.simulatePointerDown(e.pick,i),e.nearInteractionTargetMesh=e.meshUnderPointer):e.nearInteractionTargetMesh&&e.stalePick&&(t._scene.simulatePointerUp(e.stalePick,i),e.nearInteractionTargetMesh=null))});var a=function(h){t._options.enableNearInteractionOnAllControllers||r.uniqueId===t._attachedController&&t._isControllerReadyForNearInteraction(e.id)?(e.pick&&(e.pick.ray=e.grabRay),h&&e.pick&&e.meshUnderPointer&&t._nearGrabPredicate(e.meshUnderPointer)?(e.grabInteraction=!0,e.pickedPointVisualCue.isVisible=!1,t._scene.simulatePointerDown(e.pick,i)):!h&&e.pick&&e.grabInteraction&&(t._scene.simulatePointerUp(e.pick,i),e.grabInteraction=!1,e.pickedPointVisualCue.isVisible=!0)):h&&!t._options.enableNearInteractionOnAllControllers&&!t._options.disableSwitchOnClick&&(t._attachedController=r.uniqueId)};if(r.inputSource.gamepad){var s=function(h){e.squeezeComponent=h.getComponent("grasp"),e.squeezeComponent?e.onSqueezeButtonChangedObserver=e.squeezeComponent.onButtonStateChangedObservable.add(function(c){if(c.changes.pressed){var d=c.changes.pressed.current;a(d)}}):(e.selectionComponent=h.getMainComponent(),e.onButtonChangedObserver=e.selectionComponent.onButtonStateChangedObservable.add(function(c){if(c.changes.pressed){var d=c.changes.pressed.current;a(d)}}))};r.motionController?s(r.motionController):r.onMotionControllerInitObservable.add(s)}else{var l=function(h){e.xrController&&h.inputSource===e.xrController.inputSource&&e.pick&&t._isControllerReadyForNearInteraction(e.id)&&e.meshUnderPointer&&t._nearGrabPredicate(e.meshUnderPointer)&&(e.grabInteraction=!0,e.pickedPointVisualCue.isVisible=!1,t._scene.simulatePointerDown(e.pick,i))},u=function(h){e.xrController&&h.inputSource===e.xrController.inputSource&&e.pick&&t._isControllerReadyForNearInteraction(e.id)&&(t._scene.simulatePointerUp(e.pick,i),e.grabInteraction=!1,e.pickedPointVisualCue.isVisible=!0)};e.eventListeners={selectend:u,selectstart:l},this._xrSessionManager.session.addEventListener("selectstart",l),this._xrSessionManager.session.addEventListener("selectend",u)}},n.prototype._detachController=function(r){var t=this,e=this._controllers[r];if(!!e&&(e.squeezeComponent&&e.onSqueezeButtonChangedObserver&&e.squeezeComponent.onButtonStateChangedObservable.remove(e.onSqueezeButtonChangedObserver),e.selectionComponent&&e.onButtonChangedObserver&&e.selectionComponent.onButtonStateChangedObservable.remove(e.onButtonChangedObserver),e.onFrameObserver&&this._xrSessionManager.onXRFrameObservable.remove(e.onFrameObserver),e.eventListeners&&Object.keys(e.eventListeners).forEach(function(a){var s=e.eventListeners&&e.eventListeners[a];s&&t._xrSessionManager.session.removeEventListener(a,s)}),e.touchCollisionMesh.dispose(),e.pickedPointVisualCue.dispose(),this._xrSessionManager.runInXRFrame(function(){var a={pointerId:e.id,pointerType:"xr"};t._scene.simulatePointerUp(new re,a)}),delete this._controllers[r],this._attachedController===r)){var i=Object.keys(this._controllers);i.length?this._attachedController=i[0]:this._attachedController=""}},n.prototype._generateNewTouchPointMesh=function(){var r=this._options.useUtilityLayer?this._options.customUtilityLayerScene||ee.DefaultUtilityLayer.utilityLayerScene:this._scene,t=le("PickSphere",{diameter:1},r);t.isVisible=!1,this._options.motionControllerOrbMaterial?t.material=this._options.motionControllerOrbMaterial:ze.ParseFromSnippetAsync("8RUNKL#3",r).then(function(b){t.material=b});var e=new vt;e.setEasingMode(Ye.EASINGMODE_EASEINOUT);var i=new _(this._controllerPickRadius,this._controllerPickRadius,this._controllerPickRadius),a=this._controllerPickRadius*(4/3),s=new _(a,a,a),l=this._controllerPickRadius*(7/6),u=new _(l,l,l),h=this._controllerPickRadius*(4/5),c=new _(h,h,h),d=this._controllerPickRadius*(3/2),f=new _(d,d,d),m=[{frame:0,value:i},{frame:10,value:f},{frame:18,value:s}],v=[{frame:0,value:s},{frame:10,value:c},{frame:18,value:i}],x=[{frame:0,value:_.ZeroReadOnly},{frame:12,value:u},{frame:15,value:i}],S=[{frame:0,value:i},{frame:10,value:_.ZeroReadOnly},{frame:15,value:_.ZeroReadOnly}],M=new D("touch","scaling",60,D.ANIMATIONTYPE_VECTOR3,D.ANIMATIONLOOPMODE_CONSTANT),C=new D("release","scaling",60,D.ANIMATIONTYPE_VECTOR3,D.ANIMATIONLOOPMODE_CONSTANT),F=new D("hydrate","scaling",60,D.ANIMATIONTYPE_VECTOR3,D.ANIMATIONLOOPMODE_CONSTANT),U=new D("dehydrate","scaling",60,D.ANIMATIONTYPE_VECTOR3,D.ANIMATIONLOOPMODE_CONSTANT);M.setEasingFunction(e),C.setEasingFunction(e),F.setEasingFunction(e),U.setEasingFunction(e),M.setKeys(m),C.setKeys(v),F.setKeys(x),U.setKeys(S);var te=function(b){var X=b?M:C;r.beginDirectAnimation(t,[X],0,18,!1,1)},Y=function(b){var X=b?F:U;b&&(t.isVisible=!0),r.beginDirectAnimation(t,[X],0,15,!1,1,function(){b||(t.isVisible=!1)})};return{touchCollisionMesh:t,touchCollisionMeshFunction:te,hydrateCollisionMeshFunction:Y}},n.prototype._pickWithSphere=function(r,t,e,i){var a=new re;if(a.distance=1/0,r.touchCollisionMesh&&r.xrController)for(var s=r.touchCollisionMesh.position,l=Ve.CreateFromCenterAndRadius(s,t),u=0;u<e.meshes.length;u++){var h=e.meshes[u];if(!(!i(h)||!this._controllerAvailablePredicate(h,r.xrController.uniqueId))){var c=n.PickMeshWithSphere(h,l);c&&c.hit&&c.distance<a.distance&&(a.hit=c.hit,a.pickedMesh=h,a.pickedPoint=c.pickedPoint,a.aimTransform=r.xrController.pointer,a.gripTransform=r.xrController.grip||null,a.originMesh=r.touchCollisionMesh,a.distance=c.distance)}}return a},n.PickMeshWithSphere=function(r,t,e){e===void 0&&(e=!1);var i=r.subMeshes,a=new re,s=r.getBoundingInfo();if(!r._generatePointsArray()||!r.subMeshes||!s||!e&&!Ve.Intersects(s.boundingSphere,t))return a;var l=T.Vector3[0],u=T.Vector3[1],h=1/0,c,d,f,m=T.Vector3[2],v=T.Matrix[0];v.copyFrom(r.getWorldMatrix()),v.invert(),_.TransformCoordinatesToRef(t.center,v,m);for(var x=0;x<i.length;x++){var S=i[x];S.projectToRef(m,r._positions,r.getIndices(),u),_.TransformCoordinatesToRef(u,r.getWorldMatrix(),u),c=_.Distance(u,t.center),f=_.Distance(u,r.getAbsolutePosition()),d=_.Distance(t.center,r.getAbsolutePosition()),d!==-1&&f!==-1&&f>d&&(c=0,u.copyFrom(t.center)),c!==-1&&c<h&&(h=c,l.copyFrom(u))}return h<t.radius&&(a.hit=!0,a.distance=h,a.pickedMesh=r,a.pickedPoint=l.clone()),a},n._IdCounter=200,n.Name=P.NEAR_INTERACTION,n.Version=1,n}(O);A.AddWebXRFeature(de.Name,function(o,n){return function(){return new de(o,n)}},de.Version,!0);var Xt=function(){function o(n,r,t){this.element=n,this.sessionMode=r,this.referenceSpaceType=t}return o.prototype.update=function(n){},o}(),Dt=function(){function o(n,r){var t=this;if(this._scene=n,this.options=r,this._activeButton=null,this._buttons=[],this.activeButtonChangedObservable=new g,this._onSessionGranted=function(c){t._helper&&t._enterXRWithButtonIndex(0)},this.overlay=document.createElement("div"),this.overlay.classList.add("xr-button-overlay"),!r.ignoreSessionGrantedEvent&&navigator.xr&&navigator.xr.addEventListener("sessiongranted",this._onSessionGranted),typeof window!="undefined"&&window.location&&window.location.protocol==="http:"&&window.location.hostname!=="localhost")throw L.Warn("WebXR can only be served over HTTPS"),new Error("WebXR can only be served over HTTPS");if(r.customButtons)this._buttons=r.customButtons;else{this.overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;";var e=r.sessionMode||"immersive-vr",i=r.referenceSpaceType||"local-floor",a=typeof SVGSVGElement=="undefined"?"https://cdn.babylonjs.com/Assets/vrButton.png":"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A",s=".babylonVRicon { color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+a+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";s+='.babylonVRicon.vrdisplaypresenting { background-image: none;} .vrdisplaypresenting::after { content: "EXIT"} .xr-error::after { content: "ERROR"}';var l=document.createElement("style");l.appendChild(document.createTextNode(s)),document.getElementsByTagName("head")[0].appendChild(l);var u=document.createElement("button");u.className="babylonVRicon",u.title="".concat(e," - ").concat(i),this._buttons.push(new Xt(u,e,i)),this._buttons[this._buttons.length-1].update=function(c){this.element.style.display=c===null||c===this?"":"none",u.className="babylonVRicon"+(c===this?" vrdisplaypresenting":"")},this._updateButtons(null)}var h=n.getEngine().getInputElement();h&&h.parentNode&&(h.parentNode.appendChild(this.overlay),n.onDisposeObservable.addOnce(function(){t.dispose()}))}return o.prototype.setHelperAsync=function(n,r){return V(this,void 0,void 0,function(){var t,e,i=this;return W(this,function(a){switch(a.label){case 0:return this._helper=n,this._renderTarget=r,t=this._buttons.map(function(s){return n.sessionManager.isSessionSupportedAsync(s.sessionMode)}),n.onStateChangedObservable.add(function(s){s==w.NOT_IN_XR&&i._updateButtons(null)}),[4,Promise.all(t)];case 1:return e=a.sent(),e.forEach(function(s,l){s?(i.overlay.appendChild(i._buttons[l].element),i._buttons[l].element.onclick=i._enterXRWithButtonIndex.bind(i,l)):L.Warn('Session mode "'.concat(i._buttons[l].sessionMode,'" not supported in browser'))}),[2]}})})},o.CreateAsync=function(n,r,t){return V(this,void 0,void 0,function(){var e;return W(this,function(i){switch(i.label){case 0:return e=new o(n,t),[4,e.setHelperAsync(r,t.renderTarget||void 0)];case 1:return i.sent(),[2,e]}})})},o.prototype._enterXRWithButtonIndex=function(n){return n===void 0&&(n=0),V(this,void 0,void 0,function(){var r,t,e;return W(this,function(i){switch(i.label){case 0:return this._helper.state!=w.IN_XR?[3,2]:[4,this._helper.exitXRAsync()];case 1:return i.sent(),this._updateButtons(null),[3,6];case 2:if(this._helper.state!=w.NOT_IN_XR)return[3,6];i.label=3;case 3:return i.trys.push([3,5,,6]),[4,this._helper.enterXRAsync(this._buttons[n].sessionMode,this._buttons[n].referenceSpaceType,this._renderTarget,{optionalFeatures:this.options.optionalFeatures,requiredFeatures:this.options.requiredFeatures})];case 4:return i.sent(),this._updateButtons(this._buttons[n]),[3,6];case 5:return r=i.sent(),this._updateButtons(null),t=this._buttons[n].element,e=t.title,t.title="Error entering XR session : "+e,t.classList.add("xr-error"),this.options.onError&&this.options.onError(r),[3,6];case 6:return[2]}})})},o.prototype.dispose=function(){var n=this._scene.getEngine().getInputElement();n&&n.parentNode&&n.parentNode.contains(this.overlay)&&n.parentNode.removeChild(this.overlay),this.activeButtonChangedObservable.clear(),navigator.xr.removeEventListener("sessiongranted",this._onSessionGranted)},o.prototype._updateButtons=function(n){var r=this;this._activeButton=n,this._buttons.forEach(function(t){t.update(r._activeButton)}),this.activeButtonChangedObservable.notifyObservers(this._activeButton)},o}(),pe=function(o){R(n,o);function n(r,t){var e=o.call(this,r)||this;return e._options=t,e._controllers={},e._snappedToPoint=!1,e._tmpRay=new oe(new _,new _),e._tmpVector=new _,e._tmpQuaternion=new y,e.skipNextTeleportation=!1,e.backwardsMovementEnabled=!0,e.backwardsTeleportationDistance=.7,e.parabolicCheckRadius=5,e.parabolicRayEnabled=!0,e.straightRayEnabled=!0,e.rotationAngle=Math.PI/8,e.onTargetMeshPositionUpdatedObservable=new g,e.teleportationEnabled=!0,e._rotationEnabled=!0,e._attachController=function(i){if(!(e._controllers[i.uniqueId]||e._options.forceHandedness&&i.inputSource.handedness!==e._options.forceHandedness)){e._controllers[i.uniqueId]={xrController:i,teleportationState:{forward:!1,backwards:!1,rotating:!1,currentRotation:0,baseRotation:0}};var a=e._controllers[i.uniqueId];if(a.xrController.inputSource.targetRayMode==="tracked-pointer"&&a.xrController.inputSource.gamepad){var s=function(){if(i.motionController){var l=i.motionController.getComponentOfType(Q.THUMBSTICK_TYPE)||i.motionController.getComponentOfType(Q.TOUCHPAD_TYPE);if(!l||e._options.useMainComponentOnly){var u=i.motionController.getMainComponent();if(!u)return;a.teleportationComponent=u,a.onButtonChangedObserver=u.onButtonStateChangedObservable.add(function(){if(!!e.teleportationEnabled&&u.changes.pressed)if(u.changes.pressed.current){a.teleportationState.forward=!0,e._currentTeleportationControllerId=a.xrController.uniqueId,a.teleportationState.baseRotation=e._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,a.teleportationState.currentRotation=0;var h=e._options.timeToTeleport||3e3;De({timeout:h,contextObservable:e._xrSessionManager.onXRFrameObservable,breakCondition:function(){return!u.pressed},onEnded:function(){e._currentTeleportationControllerId===a.xrController.uniqueId&&a.teleportationState.forward&&e._teleportForward(i.uniqueId)}})}else a.teleportationState.forward=!1,e._currentTeleportationControllerId=""})}else a.teleportationComponent=l,a.onAxisChangedObserver=l.onAxisValueChangedObservable.add(function(h){if(h.y<=.7&&a.teleportationState.backwards&&(a.teleportationState.backwards=!1),h.y>.7&&!a.teleportationState.forward&&e.backwardsMovementEnabled&&!e.snapPointsOnly&&!a.teleportationState.backwards){a.teleportationState.backwards=!0,e._tmpQuaternion.copyFrom(e._options.xrInput.xrCamera.rotationQuaternion),e._tmpQuaternion.toEulerAnglesToRef(e._tmpVector),e._tmpVector.x=0,e._tmpVector.z=0,y.FromEulerVectorToRef(e._tmpVector,e._tmpQuaternion),e._tmpVector.set(0,0,e.backwardsTeleportationDistance*(e._xrSessionManager.scene.useRightHandedSystem?1:-1)),e._tmpVector.rotateByQuaternionToRef(e._tmpQuaternion,e._tmpVector),e._tmpVector.addInPlace(e._options.xrInput.xrCamera.position),e._tmpRay.origin.copyFrom(e._tmpVector),e._tmpRay.length=e._options.xrInput.xrCamera.realWorldHeight+.1,e._tmpRay.direction.set(0,-1,0);var c=e._xrSessionManager.scene.pickWithRay(e._tmpRay,function(f){return e._floorMeshes.indexOf(f)!==-1});c&&c.pickedPoint&&(e._options.xrInput.xrCamera.position.x=c.pickedPoint.x,e._options.xrInput.xrCamera.position.z=c.pickedPoint.z)}if(h.y<-.7&&!e._currentTeleportationControllerId&&!a.teleportationState.rotating&&e.teleportationEnabled&&(a.teleportationState.forward=!0,e._currentTeleportationControllerId=a.xrController.uniqueId,a.teleportationState.baseRotation=e._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y),h.x){if(a.teleportationState.forward)e._currentTeleportationControllerId===a.xrController.uniqueId&&(e.rotationEnabled?setTimeout(function(){a.teleportationState.currentRotation=Math.atan2(h.x,h.y*(e._xrSessionManager.scene.useRightHandedSystem?1:-1))}):a.teleportationState.currentRotation=0);else if(!a.teleportationState.rotating&&Math.abs(h.x)>.7){a.teleportationState.rotating=!0;var d=e.rotationAngle*(h.x>0?1:-1)*(e._xrSessionManager.scene.useRightHandedSystem?-1:1);y.FromEulerAngles(0,d,0).multiplyToRef(e._options.xrInput.xrCamera.rotationQuaternion,e._options.xrInput.xrCamera.rotationQuaternion)}}else a.teleportationState.rotating=!1;h.x===0&&h.y===0&&a.teleportationState.forward&&e._teleportForward(i.uniqueId)})}};i.motionController?s():i.onMotionControllerInitObservable.addOnce(function(){s()})}else e._xrSessionManager.scene.onPointerObservable.add(function(l){if(l.type===We.POINTERDOWN){a.teleportationState.forward=!0,e._currentTeleportationControllerId=a.xrController.uniqueId,a.teleportationState.baseRotation=e._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,a.teleportationState.currentRotation=0;var u=e._options.timeToTeleport||3e3;De({timeout:u,contextObservable:e._xrSessionManager.onXRFrameObservable,onEnded:function(){e._currentTeleportationControllerId===a.xrController.uniqueId&&a.teleportationState.forward&&e._teleportForward(i.uniqueId)}})}else l.type===We.POINTERUP&&(a.teleportationState.forward=!1,e._currentTeleportationControllerId="")})}},e._options.teleportationTargetMesh||e._createDefaultTargetMesh(),e._floorMeshes=e._options.floorMeshes||[],e._snapToPositions=e._options.snapPositions||[],e._setTargetMeshVisibility(!1),e}return Object.defineProperty(n.prototype,"rotationEnabled",{get:function(){return this._rotationEnabled},set:function(r){if(this._rotationEnabled=r,this._options.teleportationTargetMesh){var t=this._options.teleportationTargetMesh.getChildMeshes(!1,function(e){return e.name==="rotationCone"});t[0]&&t[0].setEnabled(r)}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"teleportationTargetMesh",{get:function(){return this._options.teleportationTargetMesh||null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"snapPointsOnly",{get:function(){return!!this._options.snapPointsOnly},set:function(r){this._options.snapPointsOnly=r},enumerable:!1,configurable:!0}),n.prototype.addFloorMesh=function(r){this._floorMeshes.push(r)},n.prototype.addBlockerMesh=function(r){this._options.pickBlockerMeshes=this._options.pickBlockerMeshes||[],this._options.pickBlockerMeshes.push(r)},n.prototype.addSnapPoint=function(r){this._snapToPositions.push(r)},n.prototype.attach=function(){var r=this;return o.prototype.attach.call(this)?(this._currentTeleportationControllerId="",this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(t){r._detachController(t.uniqueId)}),!0):!1},n.prototype.detach=function(){var r=this;return o.prototype.detach.call(this)?(Object.keys(this._controllers).forEach(function(t){r._detachController(t)}),this._setTargetMeshVisibility(!1),this._currentTeleportationControllerId="",this._controllers={},!0):!1},n.prototype.dispose=function(){o.prototype.dispose.call(this),this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.dispose(!1,!0)},n.prototype.removeFloorMesh=function(r){var t=this._floorMeshes.indexOf(r);t!==-1&&this._floorMeshes.splice(t,1)},n.prototype.removeBlockerMesh=function(r){this._options.pickBlockerMeshes=this._options.pickBlockerMeshes||[];var t=this._options.pickBlockerMeshes.indexOf(r);t!==-1&&this._options.pickBlockerMeshes.splice(t,1)},n.prototype.removeFloorMeshByName=function(r){var t=this._xrSessionManager.scene.getMeshByName(r);t&&this.removeFloorMesh(t)},n.prototype.removeSnapPoint=function(r){var t=this._snapToPositions.indexOf(r);if(t===-1){for(var e=0;e<this._snapToPositions.length;++e)if(this._snapToPositions[e].equals(r)){t=e;break}}return t!==-1?(this._snapToPositions.splice(t,1),!0):!1},n.prototype.setSelectionFeature=function(r){this._selectionFeature=r},n.prototype._onXRFrame=function(r){var t=this,e=this._xrSessionManager.currentFrame,i=this._xrSessionManager.scene;if(!(!this.attach||!e)){var a=this._options.teleportationTargetMesh;if(this._currentTeleportationControllerId){if(!a)return;a.rotationQuaternion=a.rotationQuaternion||new y;var s=this._controllers[this._currentTeleportationControllerId];if(s&&s.teleportationState.forward){y.RotationYawPitchRollToRef(s.teleportationState.currentRotation+s.teleportationState.baseRotation,0,0,a.rotationQuaternion);var l=!1;if(s.xrController.getWorldPointerRayToRef(this._tmpRay),this.straightRayEnabled){var u=i.pickWithRay(this._tmpRay,function(f){if(t._options.pickBlockerMeshes&&t._options.pickBlockerMeshes.indexOf(f)!==-1)return!0;var m=t._floorMeshes.indexOf(f);return m===-1?!1:t._floorMeshes[m].absolutePosition.y<t._options.xrInput.xrCamera.globalPosition.y});if(u&&u.pickedMesh&&this._options.pickBlockerMeshes&&this._options.pickBlockerMeshes.indexOf(u.pickedMesh)!==-1)return;u&&u.pickedPoint&&(l=!0,this._setTargetMeshPosition(u),this._setTargetMeshVisibility(!0),this._showParabolicPath(u))}if(this.parabolicRayEnabled&&!l){var h=s.xrController.pointer.rotationQuaternion.toEulerAngles().x,c=1+(Math.PI/2-Math.abs(h)),d=this.parabolicCheckRadius*c;this._tmpRay.origin.addToRef(this._tmpRay.direction.scale(d*2),this._tmpVector),this._tmpVector.y=this._tmpRay.origin.y,this._tmpRay.origin.addInPlace(this._tmpRay.direction.scale(d)),this._tmpVector.subtractToRef(this._tmpRay.origin,this._tmpRay.direction),this._tmpRay.direction.normalize();var u=i.pickWithRay(this._tmpRay,function(m){return t._options.pickBlockerMeshes&&t._options.pickBlockerMeshes.indexOf(m)!==-1?!0:t._floorMeshes.indexOf(m)!==-1});if(u&&u.pickedMesh&&this._options.pickBlockerMeshes&&this._options.pickBlockerMeshes.indexOf(u.pickedMesh)!==-1)return;u&&u.pickedPoint&&(l=!0,this._setTargetMeshPosition(u),this._setTargetMeshVisibility(!0),this._showParabolicPath(u))}this._setTargetMeshVisibility(l)}else this._setTargetMeshVisibility(!1)}else this._setTargetMeshVisibility(!1)}},n.prototype._createDefaultTargetMesh=function(){this._options.defaultTargetMeshOptions=this._options.defaultTargetMeshOptions||{};var r=this._options.useUtilityLayer?this._options.customUtilityLayerScene||ee.DefaultUtilityLayer.utilityLayerScene:this._xrSessionManager.scene,t=mt("teleportationTarget",{width:2,height:2,subdivisions:2},r);t.isPickable=!1;var e=512,i=new dt("teleportationPlaneDynamicTexture",e,r,!0);i.hasAlpha=!0;var a=i.getContext(),s=e/2,l=e/2,u=200;a.beginPath(),a.arc(s,l,u,0,2*Math.PI,!1),a.fillStyle=this._options.defaultTargetMeshOptions.teleportationFillColor||"#444444",a.fill(),a.lineWidth=10,a.strokeStyle=this._options.defaultTargetMeshOptions.teleportationBorderColor||"#FFFFFF",a.stroke(),a.closePath(),i.update();var h=new ie("teleportationPlaneMaterial",r);h.diffuseTexture=i,t.material=h;var c=Fe("torusTeleportation",{diameter:.75,thickness:.1,tessellation:20},r);if(c.isPickable=!1,c.parent=t,!this._options.defaultTargetMeshOptions.disableAnimation){var d=new D("animationInnerCircle","position.y",30,D.ANIMATIONTYPE_FLOAT,D.ANIMATIONLOOPMODE_CYCLE),f=[];f.push({frame:0,value:0}),f.push({frame:30,value:.4}),f.push({frame:60,value:0}),d.setKeys(f);var m=new bt;m.setEasingMode(Ye.EASINGMODE_EASEINOUT),d.setEasingFunction(m),c.animations=[],c.animations.push(d),r.beginAnimation(c,0,60,!0)}var v=Qe("rotationCone",{diameterTop:0,tessellation:4},r);if(v.isPickable=!1,v.scaling.set(.5,.12,.2),v.rotate(fe.X,Math.PI/2),v.position.z=.6,v.parent=c,this._options.defaultTargetMeshOptions.torusArrowMaterial)c.material=this._options.defaultTargetMeshOptions.torusArrowMaterial,v.material=this._options.defaultTargetMeshOptions.torusArrowMaterial;else{var x=new ie("torusConsMat",r);x.disableLighting=!!this._options.defaultTargetMeshOptions.disableLighting,x.disableLighting?x.emissiveColor=new k(.3,.3,1):x.diffuseColor=new k(.3,.3,1),x.alpha=.9,c.material=x,v.material=x,this._teleportationRingMaterial=x}this._options.renderingGroupId!==void 0&&(t.renderingGroupId=this._options.renderingGroupId,c.renderingGroupId=this._options.renderingGroupId,v.renderingGroupId=this._options.renderingGroupId),this._options.teleportationTargetMesh=t},n.prototype._detachController=function(r){var t=this._controllers[r];!t||(t.teleportationComponent&&(t.onAxisChangedObserver&&t.teleportationComponent.onAxisValueChangedObservable.remove(t.onAxisChangedObserver),t.onButtonChangedObserver&&t.teleportationComponent.onButtonStateChangedObservable.remove(t.onButtonChangedObserver)),delete this._controllers[r])},n.prototype._findClosestSnapPointWithRadius=function(r,t){t===void 0&&(t=this._options.snapToPositionRadius||.8);var e=null,i=Number.MAX_VALUE;if(this._snapToPositions.length){var a=t*t;this._snapToPositions.forEach(function(s){var l=_.DistanceSquared(s,r);l<=a&&l<i&&(i=l,e=s)})}return e},n.prototype._setTargetMeshPosition=function(r){var t=r.pickedPoint;if(!(!this._options.teleportationTargetMesh||!t)){var e=this._findClosestSnapPointWithRadius(t);this._snappedToPoint=!!e,this.snapPointsOnly&&!this._snappedToPoint&&this._teleportationRingMaterial?this._teleportationRingMaterial.diffuseColor.set(1,.3,.3):this.snapPointsOnly&&this._snappedToPoint&&this._teleportationRingMaterial&&this._teleportationRingMaterial.diffuseColor.set(.3,.3,1),this._options.teleportationTargetMesh.position.copyFrom(e||t),this._options.teleportationTargetMesh.position.y+=.01,this.onTargetMeshPositionUpdatedObservable.notifyObservers(r)}},n.prototype._setTargetMeshVisibility=function(r){!this._options.teleportationTargetMesh||this._options.teleportationTargetMesh.isVisible!==r&&(this._options.teleportationTargetMesh.isVisible=r,this._options.teleportationTargetMesh.getChildren(void 0,!1).forEach(function(t){t.isVisible=r}),r?this._selectionFeature&&this._selectionFeature.detach():(this._quadraticBezierCurve&&(this._quadraticBezierCurve.dispose(),this._quadraticBezierCurve=null),this._selectionFeature&&this._selectionFeature.attach()))},n.prototype._showParabolicPath=function(r){if(!!r.pickedPoint){var t=this._options.useUtilityLayer?this._options.customUtilityLayerScene||ee.DefaultUtilityLayer.utilityLayerScene:this._xrSessionManager.scene,e=this._controllers[this._currentTeleportationControllerId],i=et.CreateQuadraticBezier(e.xrController.pointer.absolutePosition,r.ray.origin,r.pickedPoint,25);this._options.generateRayPathMesh?this._quadraticBezierCurve=this._options.generateRayPathMesh(i.getPoints(),r):this._quadraticBezierCurve=gt("teleportation path line",{points:i.getPoints(),instance:this._quadraticBezierCurve,updatable:!0},t),this._quadraticBezierCurve.isPickable=!1,this._options.renderingGroupId!==void 0&&(this._quadraticBezierCurve.renderingGroupId=this._options.renderingGroupId)}},n.prototype._teleportForward=function(r){var t=this._controllers[r];if(!(!t||!t.teleportationState.forward||!this.teleportationEnabled)&&(t.teleportationState.forward=!1,this._currentTeleportationControllerId="",!(this.snapPointsOnly&&!this._snappedToPoint))){if(this.skipNextTeleportation){this.skipNextTeleportation=!1;return}if(this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible){var e=this._options.xrInput.xrCamera.realWorldHeight;this._options.xrInput.xrCamera.onBeforeCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position),this._options.xrInput.xrCamera.position.copyFrom(this._options.teleportationTargetMesh.position),this._options.xrInput.xrCamera.position.y+=e,y.FromEulerAngles(0,t.teleportationState.currentRotation-(this._xrSessionManager.scene.useRightHandedSystem?Math.PI:0),0).multiplyToRef(this._options.xrInput.xrCamera.rotationQuaternion,this._options.xrInput.xrCamera.rotationQuaternion),this._options.xrInput.xrCamera.onAfterCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position)}}},n.Name=P.TELEPORTATION,n.Version=1,n}(O);A.AddWebXRFeature(pe.Name,function(o,n){return function(){return new pe(o,n)}},pe.Version,!0);var yr=function(){function o(){}return o.CreateAsync=function(n,r){r===void 0&&(r={});var t=new o;if(n.onDisposeObservable.addOnce(function(){t.dispose()}),!r.disableDefaultUI){var e=I({renderTarget:t.renderTarget},r.uiOptions||{});r.optionalFeatures&&(typeof r.optionalFeatures=="boolean"?e.optionalFeatures=["hit-test","anchors","plane-detection","hand-tracking"]:e.optionalFeatures=r.optionalFeatures),t.enterExitUI=new Dt(n,e)}return At.CreateAsync(n).then(function(i){if(t.baseExperience=i,r.ignoreNativeCameraTransformation&&(t.baseExperience.camera.compensateOnFirstFrame=!1),t.input=new kt(i.sessionManager,i.camera,I({controllerOptions:{renderingGroupId:r.renderingGroupId}},r.inputOptions||{})),!r.disablePointerSelection){var a=I(I({},r.pointerSelectionOptions),{xrInput:t.input,renderingGroupId:r.renderingGroupId});t.pointerSelection=t.baseExperience.featuresManager.enableFeature(he.Name,r.useStablePlugins?"stable":"latest",a),r.disableTeleportation||(t.teleportation=t.baseExperience.featuresManager.enableFeature(pe.Name,r.useStablePlugins?"stable":"latest",I({floorMeshes:r.floorMeshes,xrInput:t.input,renderingGroupId:r.renderingGroupId},r.teleportationOptions)),t.teleportation.setSelectionFeature(t.pointerSelection))}if(r.disableNearInteraction||(t.nearInteraction=t.baseExperience.featuresManager.enableFeature(de.Name,r.useStablePlugins?"stable":"latest",I({xrInput:t.input,farInteractionFeature:t.pointerSelection,renderingGroupId:r.renderingGroupId,useUtilityLayer:!0,enableNearInteractionOnAllControllers:!0},r.nearInteractionOptions))),t.renderTarget=t.baseExperience.sessionManager.getWebXRRenderTarget(r.outputCanvasOptions),!r.disableDefaultUI)return t.enterExitUI.setHelperAsync(t.baseExperience,t.renderTarget)}).then(function(){return t}).catch(function(i){return N.Error("Error initializing XR"),N.Error(i),t})},o.prototype.dispose=function(){this.baseExperience&&this.baseExperience.dispose(),this.input&&this.input.dispose(),this.enterExitUI&&this.enterExitUI.dispose(),this.renderTarget&&this.renderTarget.dispose()},o}(),ge=function(o){R(n,o);function n(r,t){t===void 0&&(t={});var e=o.call(this,r)||this;return e.options=t,e._direction=new _(0,0,-1),e._mat=new E,e._onSelectEnabled=!1,e._origin=new _(0,0,0),e.lastNativeXRHitResults=[],e.onHitTestResultObservable=new g,e._onHitTestResults=function(i){var a=i.map(function(s){var l=E.FromArray(s.hitMatrix);return e._xrSessionManager.scene.useRightHandedSystem||l.toggleModelMatrixHandInPlace(),e.options.worldParentNode&&l.multiplyToRef(e.options.worldParentNode.getWorldMatrix(),l),{xrHitResult:s,transformationMatrix:l}});e.lastNativeXRHitResults=i,e.onHitTestResultObservable.notifyObservers(a)},e._onSelect=function(i){!e._onSelectEnabled||n.XRHitTestWithSelectEvent(i,e._xrSessionManager.referenceSpace)},e.xrNativeFeatureName="hit-test",L.Warn("A newer version of this plugin is available"),e}return n.XRHitTestWithRay=function(r,t,e,i){return r.requestHitTest(t,e).then(function(a){var s=i||function(l){return!!l.hitMatrix};return a.filter(s)})},n.XRHitTestWithSelectEvent=function(r,t){var e=r.frame.getPose(r.inputSource.targetRaySpace,t);if(!e)return Promise.resolve([]);var i=new XRRay(e.transform);return this.XRHitTestWithRay(r.frame.session,i,t)},n.prototype.attach=function(){return o.prototype.attach.call(this)?(this.options.testOnPointerDownOnly&&this._xrSessionManager.session.addEventListener("select",this._onSelect,!1),!0):!1},n.prototype.detach=function(){return o.prototype.detach.call(this)?(this._onSelectEnabled=!1,this._xrSessionManager.session.removeEventListener("select",this._onSelect),!0):!1},n.prototype.dispose=function(){o.prototype.dispose.call(this),this.onHitTestResultObservable.clear()},n.prototype._onXRFrame=function(r){if(!(!this.attached||this.options.testOnPointerDownOnly)){var t=r.getViewerPose(this._xrSessionManager.referenceSpace);if(!!t){E.FromArrayToRef(t.transform.matrix,0,this._mat),_.TransformCoordinatesFromFloatsToRef(0,0,0,this._mat,this._origin),_.TransformCoordinatesFromFloatsToRef(0,0,-1,this._mat,this._direction),this._direction.subtractInPlace(this._origin),this._direction.normalize();var e=new XRRay({x:this._origin.x,y:this._origin.y,z:this._origin.z,w:0},{x:this._direction.x,y:this._direction.y,z:this._direction.z,w:0});n.XRHitTestWithRay(this._xrSessionManager.session,e,this._xrSessionManager.referenceSpace).then(this._onHitTestResults)}}},n.Name=P.HIT_TEST,n.Version=1,n}(O);A.AddWebXRFeature(ge.Name,function(o,n){return function(){return new ge(o,n)}},ge.Version,!1);var Ht=0,ve=function(o){R(n,o);function n(r,t){t===void 0&&(t={});var e=o.call(this,r)||this;return e._options=t,e._lastFrameDetected=new Set,e._trackedAnchors=[],e._futureAnchors=[],e.onAnchorAddedObservable=new g,e.onAnchorRemovedObservable=new g,e.onAnchorUpdatedObservable=new g,e._tmpVector=new _,e._tmpQuaternion=new y,e.xrNativeFeatureName="anchors",e}return Object.defineProperty(n.prototype,"referenceSpaceForFrameAnchors",{set:function(r){this._referenceSpaceForFrameAnchors=r},enumerable:!1,configurable:!0}),n.prototype._populateTmpTransformation=function(r,t){return this._tmpVector.copyFrom(r),this._tmpQuaternion.copyFrom(t),this._xrSessionManager.scene.useRightHandedSystem||(this._tmpVector.z*=-1,this._tmpQuaternion.z*=-1,this._tmpQuaternion.w*=-1),{position:this._tmpVector,rotationQuaternion:this._tmpQuaternion}},n.prototype.addAnchorPointUsingHitTestResultAsync=function(r,t,e){return t===void 0&&(t=new _),e===void 0&&(e=new y),V(this,void 0,void 0,function(){var i,a,s,l=this;return W(this,function(u){switch(u.label){case 0:if(this._populateTmpTransformation(t,e),i=new XRRigidTransform({x:this._tmpVector.x,y:this._tmpVector.y,z:this._tmpVector.z},{x:this._tmpQuaternion.x,y:this._tmpQuaternion.y,z:this._tmpQuaternion.z,w:this._tmpQuaternion.w}),r.xrHitResult.createAnchor)return[3,1];throw this.detach(),new Error("Anchors not enabled in this environment/browser");case 1:return u.trys.push([1,3,,4]),[4,r.xrHitResult.createAnchor(i)];case 2:return a=u.sent(),[2,new Promise(function(h,c){l._futureAnchors.push({nativeAnchor:a,resolved:!1,submitted:!0,xrTransformation:i,resolve:h,reject:c})})];case 3:throw s=u.sent(),new Error(s);case 4:return[2]}})})},n.prototype.addAnchorAtPositionAndRotationAsync=function(r,t,e){return t===void 0&&(t=new y),e===void 0&&(e=!1),V(this,void 0,void 0,function(){var i,a,s,l=this;return W(this,function(u){switch(u.label){case 0:return this._populateTmpTransformation(r,t),i=new XRRigidTransform({x:this._tmpVector.x,y:this._tmpVector.y,z:this._tmpVector.z},{x:this._tmpQuaternion.x,y:this._tmpQuaternion.y,z:this._tmpQuaternion.z,w:this._tmpQuaternion.w}),e&&this.attached&&this._xrSessionManager.currentFrame?[4,this._createAnchorAtTransformation(i,this._xrSessionManager.currentFrame)]:[3,2];case 1:return s=u.sent(),[3,3];case 2:s=void 0,u.label=3;case 3:return a=s,[2,new Promise(function(h,c){l._futureAnchors.push({nativeAnchor:a,resolved:!1,submitted:!1,xrTransformation:i,resolve:h,reject:c})})]}})})},Object.defineProperty(n.prototype,"anchors",{get:function(){return this._trackedAnchors},enumerable:!1,configurable:!0}),n.prototype.detach=function(){if(!o.prototype.detach.call(this))return!1;if(!this._options.doNotRemoveAnchorsOnSessionEnded)for(;this._trackedAnchors.length;){var r=this._trackedAnchors.pop();if(r){try{r.remove()}catch{}this.onAnchorRemovedObservable.notifyObservers(r)}}return!0},n.prototype.dispose=function(){this._futureAnchors.length=0,o.prototype.dispose.call(this),this.onAnchorAddedObservable.clear(),this.onAnchorRemovedObservable.clear(),this.onAnchorUpdatedObservable.clear()},n.prototype._onXRFrame=function(r){var t=this;if(!(!this.attached||!r)){var e=r.trackedAnchors;if(e){var i=this._trackedAnchors.filter(function(s){return!e.has(s.xrAnchor)}).map(function(s){var l=t._trackedAnchors.indexOf(s);return l}),a=0;i.forEach(function(s){var l=t._trackedAnchors.splice(s-a,1)[0];t.onAnchorRemovedObservable.notifyObservers(l),a++}),e.forEach(function(s){if(t._lastFrameDetected.has(s)){var d=t._findIndexInAnchorArray(s),u=t._trackedAnchors[d];try{t._updateAnchorWithXRFrame(s,u,r),u.attachedNode&&(u.attachedNode.rotationQuaternion=u.attachedNode.rotationQuaternion||new y,u.transformationMatrix.decompose(u.attachedNode.scaling,u.attachedNode.rotationQuaternion,u.attachedNode.position)),t.onAnchorUpdatedObservable.notifyObservers(u)}catch{L.Warn("Anchor could not be updated")}}else{var l={id:Ht++,xrAnchor:s,remove:function(){return s.delete()}},u=t._updateAnchorWithXRFrame(s,l,r);t._trackedAnchors.push(u),t.onAnchorAddedObservable.notifyObservers(u);var h=t._futureAnchors.filter(function(f){return f.nativeAnchor===s}),c=h[0];c&&(c.resolve(u),c.resolved=!0)}}),this._lastFrameDetected=e}this._futureAnchors.forEach(function(s){!s.resolved&&!s.submitted&&(t._createAnchorAtTransformation(s.xrTransformation,r).then(function(l){s.nativeAnchor=l},function(l){s.resolved=!0,s.reject(l)}),s.submitted=!0)})}},n.prototype._findIndexInAnchorArray=function(r){for(var t=0;t<this._trackedAnchors.length;++t)if(this._trackedAnchors[t].xrAnchor===r)return t;return-1},n.prototype._updateAnchorWithXRFrame=function(r,t,e){var i=e.getPose(r.anchorSpace,this._xrSessionManager.referenceSpace);if(i){var a=t.transformationMatrix||new E;E.FromArrayToRef(i.transform.matrix,0,a),this._xrSessionManager.scene.useRightHandedSystem||a.toggleModelMatrixHandInPlace(),t.transformationMatrix=a,this._options.worldParentNode&&a.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),a)}return t},n.prototype._createAnchorAtTransformation=function(r,t){var e;return V(this,void 0,void 0,function(){return W(this,function(i){if(t.createAnchor)try{return[2,t.createAnchor(r,(e=this._referenceSpaceForFrameAnchors)!==null&&e!==void 0?e:this._xrSessionManager.referenceSpace)]}catch(a){throw new Error(a)}else throw this.detach(),new Error("Anchors are not enabled in your browser");return[2]})})},n.Name=P.ANCHOR_SYSTEM,n.Version=1,n}(O);A.AddWebXRFeature(ve.Name,function(o,n){return function(){return new ve(o,n)}},ve.Version);var Vt=0,be=function(o){R(n,o);function n(r,t){t===void 0&&(t={});var e=o.call(this,r)||this;return e._options=t,e._detectedPlanes=[],e._enabled=!1,e._lastFrameDetected=new Set,e.onPlaneAddedObservable=new g,e.onPlaneRemovedObservable=new g,e.onPlaneUpdatedObservable=new g,e.xrNativeFeatureName="plane-detection",e._xrSessionManager.session?e._init():e._xrSessionManager.onXRSessionInit.addOnce(function(){e._init()}),e}return n.prototype.detach=function(){if(!o.prototype.detach.call(this))return!1;if(!this._options.doNotRemovePlanesOnSessionEnded)for(;this._detectedPlanes.length;){var r=this._detectedPlanes.pop();r&&this.onPlaneRemovedObservable.notifyObservers(r)}return!0},n.prototype.dispose=function(){o.prototype.dispose.call(this),this.onPlaneAddedObservable.clear(),this.onPlaneRemovedObservable.clear(),this.onPlaneUpdatedObservable.clear()},n.prototype.isCompatible=function(){return typeof XRPlane!="undefined"},n.prototype._onXRFrame=function(r){var t=this,e;if(!(!this.attached||!this._enabled||!r)){var i=r.detectedPlanes||((e=r.worldInformation)===null||e===void 0?void 0:e.detectedPlanes);if(i){for(var a=0;a<this._detectedPlanes.length;a++){var s=this._detectedPlanes[a];i.has(s.xrPlane)||(this._detectedPlanes.splice(a--,1),this.onPlaneRemovedObservable.notifyObservers(s))}i.forEach(function(l){if(t._lastFrameDetected.has(l)){if(l.lastChangedTime===t._xrSessionManager.currentTimestamp){var c=t._findIndexInPlaneArray(l),h=t._detectedPlanes[c];t._updatePlaneWithXRPlane(l,h,r),t.onPlaneUpdatedObservable.notifyObservers(h)}}else{var u={id:Vt++,xrPlane:l,polygonDefinition:[]},h=t._updatePlaneWithXRPlane(l,u,r);t._detectedPlanes.push(h),t.onPlaneAddedObservable.notifyObservers(h)}}),this._lastFrameDetected=i}}},n.prototype._init=function(){var r=this,t=function(){r._enabled=!0,r._detectedPlanes.length&&(r._detectedPlanes.length=0)};if(!!this._xrSessionManager.isNative&&!!this._options.preferredDetectorOptions&&!!this._xrSessionManager.session.trySetPreferredPlaneDetectorOptions&&this._xrSessionManager.session.trySetPreferredPlaneDetectorOptions(this._options.preferredDetectorOptions),!this._xrSessionManager.session.updateWorldTrackingState){t();return}this._xrSessionManager.session.updateWorldTrackingState({planeDetectionState:{enabled:!0}}),t()},n.prototype._updatePlaneWithXRPlane=function(r,t,e){var i=this;t.polygonDefinition=r.polygon.map(function(l){var u=i._xrSessionManager.scene.useRightHandedSystem?1:-1;return new _(l.x,l.y,l.z*u)});var a=e.getPose(r.planeSpace,this._xrSessionManager.referenceSpace);if(a){var s=t.transformationMatrix||new E;E.FromArrayToRef(a.transform.matrix,0,s),this._xrSessionManager.scene.useRightHandedSystem||s.toggleModelMatrixHandInPlace(),t.transformationMatrix=s,this._options.worldParentNode&&s.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),s)}return t},n.prototype._findIndexInPlaneArray=function(r){for(var t=0;t<this._detectedPlanes.length;++t)if(this._detectedPlanes[t].xrPlane===r)return t;return-1},n.Name=P.PLANE_DETECTION,n.Version=1,n}(O);A.AddWebXRFeature(be.Name,function(o,n){return function(){return new be(o,n)}},be.Version);var ye=function(o){R(n,o);function n(r,t){t===void 0&&(t={});var e=o.call(this,r)||this;return e.options=t,e.onBackgroundStateChangedObservable=new g,e}return n.prototype.attach=function(){return this._setBackgroundState(!1),o.prototype.attach.call(this)},n.prototype.detach=function(){return this._setBackgroundState(!0),o.prototype.detach.call(this)},n.prototype.dispose=function(){o.prototype.dispose.call(this),this.onBackgroundStateChangedObservable.clear()},n.prototype._onXRFrame=function(r){},n.prototype._setBackgroundState=function(r){var t=this._xrSessionManager.scene;if(!this.options.ignoreEnvironmentHelper)if(this.options.environmentHelperRemovalFlags){if(this.options.environmentHelperRemovalFlags.skyBox){var e=t.getMeshByName("BackgroundSkybox");e&&e.setEnabled(r)}if(this.options.environmentHelperRemovalFlags.ground){var i=t.getMeshByName("BackgroundPlane");i&&i.setEnabled(r)}}else{var a=t.getMeshByName("BackgroundHelper");a&&a.setEnabled(r)}this.options.backgroundMeshes&&this.options.backgroundMeshes.forEach(function(s){return s.setEnabled(r)}),this.onBackgroundStateChangedObservable.notifyObservers(r)},n.Name=P.BACKGROUND_REMOVER,n.Version=1,n}(O);A.AddWebXRFeature(ye.Name,function(o,n){return function(){return new ye(o,n)}},ye.Version,!0);var Re=function(o){R(n,o);function n(r,t){var e=o.call(this,r)||this;return e._options=t,e._attachController=function(i){e._controllers[i.uniqueId]||(e._xrSessionManager.scene.isPhysicsEnabled()||N.Warn("physics engine not enabled, skipped. Please add this controller manually."),e._options.physicsProperties.useControllerMesh&&i.inputSource.gamepad?i.onMotionControllerInitObservable.addOnce(function(a){a._doNotLoadControllerMesh?e._createPhysicsImpostor(i):a.onModelLoadedObservable.addOnce(function(){var s=new Z(a.rootMesh,Z.MeshImpostor,I({mass:0},e._options.physicsProperties)),l=i.grip||i.pointer;e._controllers[i.uniqueId]={xrController:i,impostor:s,oldPos:l.position.clone(),oldRotation:l.rotationQuaternion.clone()}})}):e._createPhysicsImpostor(i))},e._controllers={},e._debugMode=!1,e._delta=0,e._lastTimestamp=0,e._tmpQuaternion=new y,e._tmpVector=new _,e._options.physicsProperties||(e._options.physicsProperties={}),e}return n.prototype._createPhysicsImpostor=function(r){var t=this._options.physicsProperties.impostorType||Z.SphereImpostor,e=this._options.physicsProperties.impostorSize||.1,i=le("impostor-mesh-"+r.uniqueId,{diameterX:typeof e=="number"?e:e.width,diameterY:typeof e=="number"?e:e.height,diameterZ:typeof e=="number"?e:e.depth});i.isVisible=this._debugMode,i.isPickable=!1,i.rotationQuaternion=new y;var a=r.grip||r.pointer;i.position.copyFrom(a.position),i.rotationQuaternion.copyFrom(a.rotationQuaternion);var s=new Z(i,t,I({mass:0},this._options.physicsProperties));this._controllers[r.uniqueId]={xrController:r,impostor:s,impostorMesh:i}},n.prototype._enablePhysicsDebug=function(){var r=this;this._debugMode=!0,Object.keys(this._controllers).forEach(function(t){var e=r._controllers[t];e.impostorMesh&&(e.impostorMesh.isVisible=!0)})},n.prototype.addController=function(r){this._attachController(r)},n.prototype.attach=function(){var r=this;if(!o.prototype.attach.call(this))return!1;if(!this._options.xrInput)return!0;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(i){r._detachController(i.uniqueId)}),this._options.enableHeadsetImpostor){var t=this._options.headsetImpostorParams||{impostorType:Z.SphereImpostor,restitution:.8,impostorSize:.3},e=t.impostorSize||.3;this._headsetMesh=le("headset-mesh",{diameterX:typeof e=="number"?e:e.width,diameterY:typeof e=="number"?e:e.height,diameterZ:typeof e=="number"?e:e.depth}),this._headsetMesh.rotationQuaternion=new y,this._headsetMesh.isVisible=!1,this._headsetImpostor=new Z(this._headsetMesh,t.impostorType,I({mass:0},t))}return!0},n.prototype.detach=function(){var r=this;return o.prototype.detach.call(this)?(Object.keys(this._controllers).forEach(function(t){r._detachController(t)}),this._headsetMesh&&this._headsetMesh.dispose(),!0):!1},n.prototype.getHeadsetImpostor=function(){return this._headsetImpostor},n.prototype.getImpostorForController=function(r){var t=typeof r=="string"?r:r.uniqueId;return this._controllers[t]?this._controllers[t].impostor:null},n.prototype.setPhysicsProperties=function(r){this._options.physicsProperties=I(I({},this._options.physicsProperties),r)},n.prototype._onXRFrame=function(r){var t=this,e,i;if(this._delta=this._xrSessionManager.currentTimestamp-this._lastTimestamp,this._lastTimestamp=this._xrSessionManager.currentTimestamp,this._headsetMesh&&this._headsetImpostor){if(this._headsetMesh.position.copyFrom(this._options.xrInput.xrCamera.globalPosition),this._headsetMesh.rotationQuaternion.copyFrom(this._options.xrInput.xrCamera.absoluteRotation),!((e=this._options.xrInput.xrCamera._lastXRViewerPose)===null||e===void 0)&&e.linearVelocity){var a=this._options.xrInput.xrCamera._lastXRViewerPose.linearVelocity;this._tmpVector.set(a.x,a.y,a.z),this._headsetImpostor.setLinearVelocity(this._tmpVector)}if(!((i=this._options.xrInput.xrCamera._lastXRViewerPose)===null||i===void 0)&&i.angularVelocity){var s=this._options.xrInput.xrCamera._lastXRViewerPose.angularVelocity;this._tmpVector.set(s.x,s.y,s.z),this._headsetImpostor.setAngularVelocity(this._tmpVector)}}Object.keys(this._controllers).forEach(function(l){var u,h,c=t._controllers[l],d=c.xrController.grip||c.xrController.pointer,f=c.oldPos||c.impostorMesh.position;if(!((u=c.xrController._lastXRPose)===null||u===void 0)&&u.linearVelocity){var m=c.xrController._lastXRPose.linearVelocity;t._tmpVector.set(m.x,m.y,m.z),c.impostor.setLinearVelocity(t._tmpVector)}else d.position.subtractToRef(f,t._tmpVector),t._tmpVector.scaleInPlace(1e3/t._delta),c.impostor.setLinearVelocity(t._tmpVector);f.copyFrom(d.position),t._debugMode&&console.log(t._tmpVector,"linear");var v=c.oldRotation||c.impostorMesh.rotationQuaternion;if(!((h=c.xrController._lastXRPose)===null||h===void 0)&&h.angularVelocity){var x=c.xrController._lastXRPose.angularVelocity;t._tmpVector.set(x.x,x.y,x.z),c.impostor.setAngularVelocity(t._tmpVector)}else if(!v.equalsWithEpsilon(d.rotationQuaternion)){v.conjugateInPlace().multiplyToRef(d.rotationQuaternion,t._tmpQuaternion);var S=Math.sqrt(t._tmpQuaternion.x*t._tmpQuaternion.x+t._tmpQuaternion.y*t._tmpQuaternion.y+t._tmpQuaternion.z*t._tmpQuaternion.z);if(t._tmpVector.set(t._tmpQuaternion.x,t._tmpQuaternion.y,t._tmpQuaternion.z),S<.001)t._tmpVector.scaleInPlace(2);else{var M=2*Math.atan2(S,t._tmpQuaternion.w);t._tmpVector.scaleInPlace(M/(S*(t._delta/1e3)))}c.impostor.setAngularVelocity(t._tmpVector)}v.copyFrom(d.rotationQuaternion),t._debugMode&&console.log(t._tmpVector,t._tmpQuaternion,"angular")})},n.prototype._detachController=function(r){var t=this._controllers[r];!t||(t.impostorMesh&&t.impostorMesh.dispose(),delete this._controllers[r])},n.Name=P.PHYSICS_CONTROLLERS,n.Version=1,n}(O);A.AddWebXRFeature(Re.Name,function(o,n){return function(){return new Re(o,n)}},Re.Version,!0);var xe=function(o){R(n,o);function n(r,t){t===void 0&&(t={});var e=o.call(this,r)||this;return e.options=t,e._tmpMat=new E,e._tmpPos=new _,e._tmpQuat=new y,e._initHitTestSource=function(i){if(!!i){var a=new XRRay(e.options.offsetRay||{}),s={space:e.options.useReferenceSpace?i:e._xrSessionManager.viewerReferenceSpace,offsetRay:a};if(e.options.entityTypes&&(s.entityTypes=e.options.entityTypes),!s.space){L.Warn("waiting for viewer reference space to initialize");return}e._xrSessionManager.session.requestHitTestSource(s).then(function(l){e._xrHitTestSource&&e._xrHitTestSource.cancel(),e._xrHitTestSource=l})}},e.autoCloneTransformation=!1,e.onHitTestResultObservable=new g,e.paused=!1,e.xrNativeFeatureName="hit-test",L.Warn("Hit test is an experimental and unstable feature."),e}return n.prototype.attach=function(){var r=this;if(!o.prototype.attach.call(this)||!this._xrSessionManager.session.requestHitTestSource)return!1;if(this.options.disablePermanentHitTest||(this._xrSessionManager.referenceSpace&&this._initHitTestSource(this._xrSessionManager.referenceSpace),this._xrSessionManager.onXRReferenceSpaceChanged.add(this._initHitTestSource)),this.options.enableTransientHitTest){var t=new XRRay(this.options.transientOffsetRay||{});this._xrSessionManager.session.requestHitTestSourceForTransientInput({profile:this.options.transientHitTestProfile||"generic-touchscreen",offsetRay:t,entityTypes:this.options.entityTypes}).then(function(e){r._transientXrHitTestSource=e})}return!0},n.prototype.detach=function(){return o.prototype.detach.call(this)?(this._xrHitTestSource&&(this._xrHitTestSource.cancel(),this._xrHitTestSource=null),this._xrSessionManager.onXRReferenceSpaceChanged.removeCallback(this._initHitTestSource),this._transientXrHitTestSource&&(this._transientXrHitTestSource.cancel(),this._transientXrHitTestSource=null),!0):!1},n.prototype.dispose=function(){o.prototype.dispose.call(this),this.onHitTestResultObservable.clear()},n.prototype._onXRFrame=function(r){var t=this;if(!(!this.attached||this.paused)){if(this._xrHitTestSource){var e=r.getHitTestResults(this._xrHitTestSource);this._processWebXRHitTestResult(e)}if(this._transientXrHitTestSource){var i=r.getHitTestResultsForTransientInput(this._transientXrHitTestSource);i.forEach(function(a){t._processWebXRHitTestResult(a.results,a.inputSource)})}}},n.prototype._processWebXRHitTestResult=function(r,t){var e=this,i=[];r.forEach(function(a){var s=a.getPose(e._xrSessionManager.referenceSpace);if(!!s){var l=s.transform.position,u=s.transform.orientation;e._tmpPos.set(l.x,l.y,l.z),e._tmpQuat.set(u.x,u.y,u.z,u.w),E.FromFloat32ArrayToRefScaled(s.transform.matrix,0,1,e._tmpMat),e._xrSessionManager.scene.useRightHandedSystem||(e._tmpPos.z*=-1,e._tmpQuat.z*=-1,e._tmpQuat.w*=-1,e._tmpMat.toggleModelMatrixHandInPlace());var h={position:e.autoCloneTransformation?e._tmpPos.clone():e._tmpPos,rotationQuaternion:e.autoCloneTransformation?e._tmpQuat.clone():e._tmpQuat,transformationMatrix:e.autoCloneTransformation?e._tmpMat.clone():e._tmpMat,inputSource:t,isTransient:!!t,xrHitResult:a};i.push(h)}}),this.onHitTestResultObservable.notifyObservers(i)},n.Name=P.HIT_TEST,n.Version=2,n}(O);A.AddWebXRFeature(xe.Name,function(o,n){return function(){return new xe(o,n)}},xe.Version,!1);var Me=function(o){R(n,o);function n(r){var t=o.call(this,r)||this;return t._enabled=!1,t._featurePointCloud=[],t.onFeaturePointsAddedObservable=new g,t.onFeaturePointsUpdatedObservable=new g,t.xrNativeFeatureName="bjsfeature-points",t._xrSessionManager.session?t._init():t._xrSessionManager.onXRSessionInit.addOnce(function(){t._init()}),t}return Object.defineProperty(n.prototype,"featurePointCloud",{get:function(){return this._featurePointCloud},enumerable:!1,configurable:!0}),n.prototype.detach=function(){return o.prototype.detach.call(this)?(this.featurePointCloud.length=0,!0):!1},n.prototype.dispose=function(){o.prototype.dispose.call(this),this._featurePointCloud.length=0,this.onFeaturePointsUpdatedObservable.clear(),this.onFeaturePointsAddedObservable.clear()},n.prototype._onXRFrame=function(r){if(!(!this.attached||!this._enabled||!r)){var t=r.featurePointCloud;if(!(!t||t.length===0)){if(t.length%5!==0)throw new Error("Received malformed feature point cloud of length: "+t.length);for(var e=t.length/5,i=new Array,a=new Array,s=0;s<e;s++){var l=s*5,u=t[l+4];this._featurePointCloud[u]?i.push(u):(this._featurePointCloud[u]={position:new _,confidenceValue:0},a.push(u)),this._featurePointCloud[u].position.x=t[l],this._featurePointCloud[u].position.y=t[l+1],this._featurePointCloud[u].position.z=t[l+2],this._featurePointCloud[u].confidenceValue=t[l+3]}a.length>0&&this.onFeaturePointsAddedObservable.notifyObservers(a),i.length>0&&this.onFeaturePointsUpdatedObservable.notifyObservers(i)}}},n.prototype._init=function(){!this._xrSessionManager.session.trySetFeaturePointCloudEnabled||!this._xrSessionManager.session.trySetFeaturePointCloudEnabled(!0)||(this._enabled=!0)},n.Name=P.FEATURE_POINTS,n.Version=1,n}(O);A.AddWebXRFeature(Me.Name,function(o){return function(){return new Me(o)}},Me.Version);var Wt=0,Ce=function(o){R(n,o);function n(r,t){t===void 0&&(t={});var e=o.call(this,r)||this;return e._options=t,e._detectedMeshes=new Map,e.onMeshAddedObservable=new g,e.onMeshRemovedObservable=new g,e.onMeshUpdatedObservable=new g,e.xrNativeFeatureName="mesh-detection",e._xrSessionManager.session?e._init():e._xrSessionManager.onXRSessionInit.addOnce(function(){e._init()}),e}return n.prototype.detach=function(){var r=this;return o.prototype.detach.call(this)?(!!this._xrSessionManager.isNative&&!!this._xrSessionManager.session.trySetMeshDetectorEnabled&&this._xrSessionManager.session.trySetMeshDetectorEnabled(!1),this._options.doNotRemoveMeshesOnSessionEnded||(this._detectedMeshes.forEach(function(t){r.onMeshRemovedObservable.notifyObservers(t)}),this._detectedMeshes.clear()),!0):!1},n.prototype.dispose=function(){o.prototype.dispose.call(this),this.onMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onMeshUpdatedObservable.clear()},n.prototype._onXRFrame=function(r){var t=this,e;try{if(!this.attached||!r)return;var i=(e=r.worldInformation)===null||e===void 0?void 0:e.detectedMeshes;if(i){var a=new Set;this._detectedMeshes.forEach(function(s,l){i.has(l)||a.add(l)}),a.forEach(function(s){var l=t._detectedMeshes.get(s);l&&(t.onMeshRemovedObservable.notifyObservers(l),t._detectedMeshes.delete(s))}),i.forEach(function(s){if(t._detectedMeshes.has(s)){if(s.lastChangedTime===t._xrSessionManager.currentTimestamp){var u=t._detectedMeshes.get(s);u&&(t._updateVertexDataWithXRMesh(s,u,r),t.onMeshUpdatedObservable.notifyObservers(u))}}else{var l={id:Wt++,xrMesh:s},u=t._updateVertexDataWithXRMesh(s,l,r);t._detectedMeshes.set(s,u),t.onMeshAddedObservable.notifyObservers(u)}})}}catch(s){console.log(s.stack)}},n.prototype._init=function(){this._xrSessionManager.isNative&&(this._xrSessionManager.session.trySetMeshDetectorEnabled&&this._xrSessionManager.session.trySetMeshDetectorEnabled(!0),!!this._options.preferredDetectorOptions&&!!this._xrSessionManager.session.trySetPreferredMeshDetectorOptions&&this._xrSessionManager.session.trySetPreferredMeshDetectorOptions(this._options.preferredDetectorOptions))},n.prototype._updateVertexDataWithXRMesh=function(r,t,e){if(t.xrMesh=r,t.worldParentNode=this._options.worldParentNode,this._options.convertCoordinateSystems){if(this._xrSessionManager.scene.useRightHandedSystem)t.positions=r.positions,t.normals=r.normals;else{t.positions=new Float32Array(r.positions.length);for(var i=0;i<r.positions.length;i+=3)t.positions[i]=r.positions[i],t.positions[i+1]=r.positions[i+1],t.positions[i+2]=-1*r.positions[i+2];if(r.normals){t.normals=new Float32Array(r.normals.length);for(var i=0;i<r.normals.length;i+=3)t.normals[i]=r.normals[i],t.normals[i+1]=r.normals[i+1],t.normals[i+2]=-1*r.normals[i+2]}}t.indices=r.indices;var a=e.getPose(r.meshSpace,this._xrSessionManager.referenceSpace);if(a){var s=t.transformationMatrix||new E;E.FromArrayToRef(a.transform.matrix,0,s),this._xrSessionManager.scene.useRightHandedSystem||s.toggleModelMatrixHandInPlace(),t.transformationMatrix=s,this._options.worldParentNode&&s.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),s)}}return t},n.Name=P.MESH_DETECTION,n.Version=1,n}(O);A.AddWebXRFeature(Ce.Name,function(o,n){return function(){return new Ce(o,n)}},Ce.Version,!1);var j;(function(o){o[o.NotReceived=0]="NotReceived",o[o.Waiting=1]="Waiting",o[o.Received=2]="Received"})(j||(j={}));var Pe=function(o){R(n,o);function n(r,t){var e=o.call(this,r)||this;return e.options=t,e.onUntrackableImageFoundObservable=new g,e.onTrackableImageFoundObservable=new g,e.onTrackedImageUpdatedObservable=new g,e._trackableScoreStatus=j.NotReceived,e._trackedImages=[],e.xrNativeFeatureName="image-tracking",e}return n.prototype.attach=function(){return o.prototype.attach.call(this)},n.prototype.detach=function(){return o.prototype.detach.call(this)},n.prototype.getTrackedImageById=function(r){return this._trackedImages[r]||null},n.prototype.dispose=function(){o.prototype.dispose.call(this),this._trackedImages.forEach(function(r){r.originalBitmap.close()}),this._trackedImages.length=0,this.onTrackableImageFoundObservable.clear(),this.onUntrackableImageFoundObservable.clear(),this.onTrackedImageUpdatedObservable.clear()},n.prototype.getXRSessionInitExtension=function(){return V(this,void 0,void 0,function(){var r,t,e=this;return W(this,function(i){switch(i.label){case 0:if(!this.options.images||!this.options.images.length)return[2,{}];r=this.options.images.map(function(a){return typeof a.src=="string"?e._xrSessionManager.scene.getEngine()._createImageBitmapFromSource(a.src):Promise.resolve(a.src)}),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Promise.all(r)];case 2:return t=i.sent(),this._originalTrackingRequest=t.map(function(a,s){return{image:a,widthInMeters:e.options.images[s].estimatedRealWorldWidth}}),[2,{trackedImages:this._originalTrackingRequest}];case 3:return i.sent(),L.Error("Error loading images for tracking, WebXRImageTracking disabled for this session."),[2,{}];case 4:return[2]}})})},n.prototype._onXRFrame=function(r){if(!(!r.getImageTrackingResults||this._trackableScoreStatus===j.Waiting)){if(this._trackableScoreStatus===j.NotReceived){this._checkScoresAsync();return}for(var t=r.getImageTrackingResults(),e=0,i=t;e<i.length;e++){var a=i[e],s=!1,l=a.index,u=this._trackedImages[l];if(!!u){u.xrTrackingResult=a,u.realWorldWidth!==a.measuredWidthInMeters&&(u.realWorldWidth=a.measuredWidthInMeters,s=!0);var h=r.getPose(a.imageSpace,this._xrSessionManager.referenceSpace);if(h){var c=u.transformationMatrix;E.FromArrayToRef(h.transform.matrix,0,c),this._xrSessionManager.scene.useRightHandedSystem||c.toggleModelMatrixHandInPlace(),s=!0}var d=a.trackingState,f=d==="emulated";u.emulated!==f&&(u.emulated=f,s=!0),s&&this.onTrackedImageUpdatedObservable.notifyObservers(u)}}}},n.prototype._checkScoresAsync=function(){return V(this,void 0,void 0,function(){var r,t,e,i;return W(this,function(a){switch(a.label){case 0:return!this._xrSessionManager.session.getTrackedImageScores||this._trackableScoreStatus!==j.NotReceived?[2]:(this._trackableScoreStatus=j.Waiting,[4,this._xrSessionManager.session.getTrackedImageScores()]);case 1:if(r=a.sent(),!r||r.length===0)return this._trackableScoreStatus=j.NotReceived,[2];for(t=0;t<r.length;++t)r[t]=="untrackable"?this.onUntrackableImageFoundObservable.notifyObservers(t):(e=this._originalTrackingRequest[t].image,i={id:t,originalBitmap:e,transformationMatrix:new E,ratio:e.width/e.height},this._trackedImages[t]=i,this.onTrackableImageFoundObservable.notifyObservers(i));return this._trackableScoreStatus=r.length>0?j.Received:j.NotReceived,[2]}})})},n.Name=P.IMAGE_TRACKING,n.Version=1,n}(O);A.AddWebXRFeature(Pe.Name,function(o,n){return function(){return new Pe(o,n)}},Pe.Version,!1);var Te=function(o){R(n,o);function n(r,t){var e=o.call(this,r)||this;return e.options=t,e._domOverlayType=null,e._beforeXRSelectListener=null,e._element=null,e.xrNativeFeatureName="dom-overlay",L.Warn("dom-overlay is an experimental and unstable feature."),e}return n.prototype.attach=function(){return!o.prototype.attach.call(this)||!this._xrSessionManager.session.domOverlayState||this._xrSessionManager.session.domOverlayState.type===null?!1:(this._domOverlayType=this._xrSessionManager.session.domOverlayState.type,this._element!==null&&this.options.supressXRSelectEvents===!0&&(this._beforeXRSelectListener=function(r){r.preventDefault()},this._element.addEventListener("beforexrselect",this._beforeXRSelectListener)),!0)},Object.defineProperty(n.prototype,"domOverlayType",{get:function(){return this._domOverlayType},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){o.prototype.dispose.call(this),this._element!==null&&this._beforeXRSelectListener&&this._element.removeEventListener("beforexrselect",this._beforeXRSelectListener)},n.prototype._onXRFrame=function(r){},n.prototype.getXRSessionInitExtension=function(){return V(this,void 0,void 0,function(){var r;return W(this,function(t){if(this.options.element===void 0)return L.Warn('"element" option must be provided to attach xr-dom-overlay feature.'),[2,{}];if(typeof this.options.element=="string"){if(r=document.querySelector(this.options.element),r===null)return L.Warn("element not found '".concat(this.options.element,"' (not requesting xr-dom-overlay)")),[2,{}];this._element=r}else this._element=this.options.element;return[2,{domOverlay:{root:this._element}}]})})},n.Name=P.DOM_OVERLAY,n.Version=1,n}(O);A.AddWebXRFeature(Te.Name,function(o,n){return function(){return new Te(o,n)}},Te.Version,!1);var Ie=function(o){R(n,o);function n(r,t){var e=this,i,a,s,l,u,h;return e=o.call(this,r)||this,e._controllers={},e._currentRegistrationConfigurations=[],e._movementDirection=null,e._tmpRotationMatrix=E.Identity(),e._tmpTranslationDirection=new _,e._tmpMovementTranslation=new _,e._attachController=function(c){if(!e._controllers[c.uniqueId]){e._controllers[c.uniqueId]={xrController:c,registeredComponents:[]};var d=e._controllers[c.uniqueId];if(d.xrController.inputSource.targetRayMode==="tracked-pointer"&&d.xrController.inputSource.gamepad){var f=function(){if(c.motionController)for(var m=function(M){var C=null;if(M.allowedComponentTypes)for(var F=0,U=M.allowedComponentTypes;F<U.length;F++){var te=U[F],Y=c.motionController.getComponentOfType(te);if(Y!==null){C=Y;break}}if(M.mainComponentOnly){var b=c.motionController.getMainComponent();if(b===null)return"continue";C=b}if(typeof M.componentSelectionPredicate=="function"&&(C=M.componentSelectionPredicate(c)),C&&M.forceHandedness&&c.inputSource.handedness!==M.forceHandedness||C===null)return"continue";var X={registrationConfiguration:M,component:C};d.registeredComponents.push(X),"axisChangedHandler"in M&&(X.onAxisChangedObserver=C.onAxisValueChangedObservable.add(function(q){M.axisChangedHandler(q,e._movementState,e._featureContext,e._xrInput)})),"buttonChangedhandler"in M&&(X.onButtonChangedObserver=C.onButtonStateChangedObservable.add(function(){C.changes.pressed&&M.buttonChangedhandler(C.changes.pressed,e._movementState,e._featureContext,e._xrInput)}))},v=0,x=e._currentRegistrationConfigurations;v<x.length;v++){var S=x[v];m(S)}};c.motionController?f():c.onMotionControllerInitObservable.addOnce(function(){f()})}}},!t||t.xrInput===void 0?(L.Error('WebXRControllerMovement feature requires "xrInput" option.'),e):(Array.isArray(t.customRegistrationConfigurations)?e._currentRegistrationConfigurations=t.customRegistrationConfigurations:e._currentRegistrationConfigurations=n.REGISTRATIONS.default,e._featureContext={movementEnabled:t.movementEnabled||!0,movementOrientationFollowsViewerPose:(i=t.movementOrientationFollowsViewerPose)!==null&&i!==void 0?i:!0,movementSpeed:(a=t.movementSpeed)!==null&&a!==void 0?a:1,movementThreshold:(s=t.movementThreshold)!==null&&s!==void 0?s:.25,rotationEnabled:(l=t.rotationEnabled)!==null&&l!==void 0?l:!0,rotationSpeed:(u=t.rotationSpeed)!==null&&u!==void 0?u:1,rotationThreshold:(h=t.rotationThreshold)!==null&&h!==void 0?h:.25},e._movementState={moveX:0,moveY:0,rotateX:0,rotateY:0},e._xrInput=t.xrInput,e)}return Object.defineProperty(n.prototype,"movementDirection",{get:function(){return this._movementDirection},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"movementEnabled",{get:function(){return this._featureContext.movementEnabled},set:function(r){this._featureContext.movementEnabled=r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"movementOrientationFollowsViewerPose",{get:function(){return this._featureContext.movementOrientationFollowsViewerPose},set:function(r){this._featureContext.movementOrientationFollowsViewerPose=r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"movementSpeed",{get:function(){return this._featureContext.movementSpeed},set:function(r){this._featureContext.movementSpeed=r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"movementThreshold",{get:function(){return this._featureContext.movementThreshold},set:function(r){this._featureContext.movementThreshold=r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rotationEnabled",{get:function(){return this._featureContext.rotationEnabled},set:function(r){this._featureContext.rotationEnabled=r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rotationSpeed",{get:function(){return this._featureContext.rotationSpeed},set:function(r){this._featureContext.rotationSpeed=r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rotationThreshold",{get:function(){return this._featureContext.rotationThreshold},set:function(r){this._featureContext.rotationThreshold=r},enumerable:!1,configurable:!0}),n.prototype.attach=function(){var r=this;return o.prototype.attach.call(this)?(this._xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._xrInput.onControllerRemovedObservable,function(t){r._detachController(t.uniqueId)}),!0):!1},n.prototype.detach=function(){var r=this;return o.prototype.detach.call(this)?(Object.keys(this._controllers).forEach(function(t){r._detachController(t)}),this._controllers={},!0):!1},n.prototype._onXRFrame=function(r){if(!!this.attach){if(this._movementDirection===null&&(this._movementDirection=this._xrInput.xrCamera.rotationQuaternion.clone()),this._movementState.rotateX!==0&&this._featureContext.rotationEnabled){var t=this._xrSessionManager.scene.getEngine().getDeltaTime(),e=t*.001*this._featureContext.rotationSpeed*this._movementState.rotateX*(this._xrSessionManager.scene.useRightHandedSystem?-1:1);this._featureContext.movementOrientationFollowsViewerPose===!0?(this._xrInput.xrCamera.cameraRotation.y+=e,this._movementDirection=this._xrInput.xrCamera.rotationQuaternion.multiply(y.RotationYawPitchRoll(e,0,0))):this._movementDirection.multiplyInPlace(y.RotationYawPitchRoll(e*3,0,0))}else this._featureContext.movementOrientationFollowsViewerPose===!0&&this._movementDirection.copyFrom(this._xrInput.xrCamera.rotationQuaternion);(this._movementState.moveX!==0||this._movementState.moveY!==0)&&this._featureContext.movementEnabled&&(E.FromQuaternionToRef(this._movementDirection,this._tmpRotationMatrix),this._tmpTranslationDirection.set(this._movementState.moveX,0,this._movementState.moveY*(this._xrSessionManager.scene.useRightHandedSystem?1:-1)),_.TransformCoordinatesToRef(this._tmpTranslationDirection,this._tmpRotationMatrix,this._tmpMovementTranslation),this._tmpMovementTranslation.scaleInPlace(this._xrInput.xrCamera._computeLocalCameraSpeed()*this._featureContext.movementSpeed),this._xrInput.xrCamera.cameraDirection.addInPlace(this._tmpMovementTranslation))}},n.prototype._detachController=function(r){var t=this._controllers[r];if(!!t){for(var e=0,i=t.registeredComponents;e<i.length;e++){var a=i[e];a.onAxisChangedObserver&&a.component.onAxisValueChangedObservable.remove(a.onAxisChangedObserver),a.onButtonChangedObserver&&a.component.onButtonStateChangedObservable.remove(a.onButtonChangedObserver)}delete this._controllers[r]}},n.Name=P.MOVEMENT,n.REGISTRATIONS={default:[{allowedComponentTypes:[Q.THUMBSTICK_TYPE,Q.TOUCHPAD_TYPE],forceHandedness:"left",axisChangedHandler:function(r,t,e){t.rotateX=Math.abs(r.x)>e.rotationThreshold?r.x:0,t.rotateY=Math.abs(r.y)>e.rotationThreshold?r.y:0}},{allowedComponentTypes:[Q.THUMBSTICK_TYPE,Q.TOUCHPAD_TYPE],forceHandedness:"right",axisChangedHandler:function(r,t,e){t.moveX=Math.abs(r.x)>e.movementThreshold?r.x:0,t.moveY=Math.abs(r.y)>e.movementThreshold?r.y:0}}]},n.Version=1,n}(O);A.AddWebXRFeature(Ie.Name,function(o,n){return function(){return new Ie(o,n)}},Ie.Version,!0);var Ne=function(o){R(n,o);function n(r,t){var e=o.call(this,r)||this;return e.options=t,e._canvasContext=null,e._reflectionCubeMap=null,e._xrLightEstimate=null,e._xrLightProbe=null,e._xrWebGLBinding=null,e._lightDirection=_.Up().negateInPlace(),e._lightColor=k.White(),e._intensity=1,e._sphericalHarmonics=new rt,e._cubeMapPollTime=Date.now(),e._lightEstimationPollTime=Date.now(),e._reflectionCubeMapTextureSize=16,e.directionalLight=null,e.onReflectionCubeMapUpdatedObservable=new g,e._updateReflectionCubeMap=function(){var i;if(!!e._xrLightProbe){if(e.options.cubeMapPollInterval){var a=Date.now();if(a-e._cubeMapPollTime<e.options.cubeMapPollInterval)return;e._cubeMapPollTime=a}var s=e._getXRGLBinding().getReflectionCubeMap(e._xrLightProbe);if(s&&e._reflectionCubeMap){if(e._reflectionCubeMap._texture)(i=e._reflectionCubeMap._texture._hardwareTexture)===null||i===void 0||i.set(s),e._reflectionCubeMap._texture.getEngine().resetTextureCache();else{var l=new qe(e._xrSessionManager.scene.getEngine(),je.Unknown);l.isCube=!0,l.invertY=!1,l._useSRGBBuffer=e.options.reflectionFormat==="srgba8",l.format=5,l.generateMipMaps=!0,l.type=e.options.reflectionFormat!=="srgba8"?2:0,l.samplingMode=3,l.width=e._reflectionCubeMapTextureSize,l.height=e._reflectionCubeMapTextureSize,l._cachedWrapU=1,l._cachedWrapV=1,l._hardwareTexture=new Ue(s,e._getCanvasContext()),e._reflectionCubeMap._texture=l}e._reflectionCubeMap._texture.isReady=!0,e._xrSessionManager.scene.markAllMaterialsAsDirty(1),e.onReflectionCubeMapUpdatedObservable.notifyObservers(e._reflectionCubeMap)}}},e.xrNativeFeatureName="light-estimation",e.options.createDirectionalLightSource&&(e.directionalLight=new yt("light estimation directional",e._lightDirection,e._xrSessionManager.scene),e.directionalLight.position=new _(0,8,0),e.directionalLight.intensity=0,e.directionalLight.falloffType=Rt.FALLOFF_GLTF),L.Warn("light-estimation is an experimental and unstable feature."),e}return Object.defineProperty(n.prototype,"reflectionCubeMapTexture",{get:function(){return this._reflectionCubeMap},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"xrLightingEstimate",{get:function(){return this._xrLightEstimate?{lightColor:this._lightColor,lightDirection:this._lightDirection,lightIntensity:this._intensity,sphericalHarmonics:this._sphericalHarmonics}:this._xrLightEstimate},enumerable:!1,configurable:!0}),n.prototype._getCanvasContext=function(){return this._canvasContext===null&&(this._canvasContext=this._xrSessionManager.scene.getEngine()._gl),this._canvasContext},n.prototype._getXRGLBinding=function(){if(this._xrWebGLBinding===null){var r=this._getCanvasContext();this._xrWebGLBinding=new XRWebGLBinding(this._xrSessionManager.session,r)}return this._xrWebGLBinding},n.prototype.attach=function(){var r=this,t;if(!o.prototype.attach.call(this))return!1;var e=(t=this.options.reflectionFormat)!==null&&t!==void 0?t:this._xrSessionManager.session.preferredReflectionFormat||"srgba8";return this.options.reflectionFormat=e,this._xrSessionManager.session.requestLightProbe({reflectionFormat:e}).then(function(i){r._xrLightProbe=i,r.options.disableCubeMapReflection||(r._reflectionCubeMap||(r._reflectionCubeMap=new pt(r._xrSessionManager.scene),r._reflectionCubeMap.isCube=!0,r._reflectionCubeMap.coordinatesMode=3,r.options.setSceneEnvironmentTexture&&(r._xrSessionManager.scene.environmentTexture=r._reflectionCubeMap)),r._xrLightProbe.addEventListener("reflectionchange",r._updateReflectionCubeMap))}),!0},n.prototype.detach=function(){var r=o.prototype.detach.call(this);return this._xrLightProbe!==null&&!this.options.disableCubeMapReflection&&(this._xrLightProbe.removeEventListener("reflectionchange",this._updateReflectionCubeMap),this._xrLightProbe=null),this._canvasContext=null,this._xrLightEstimate=null,this._xrWebGLBinding=null,r},n.prototype.dispose=function(){o.prototype.dispose.call(this),this.onReflectionCubeMapUpdatedObservable.clear(),this.directionalLight&&(this.directionalLight.dispose(),this.directionalLight=null),this._reflectionCubeMap!==null&&(this._reflectionCubeMap._texture&&this._reflectionCubeMap._texture.dispose(),this._reflectionCubeMap.dispose(),this._reflectionCubeMap=null)},n.prototype._onXRFrame=function(r){var t;if(this._xrLightProbe!==null){if(this.options.lightEstimationPollInterval){var e=Date.now();if(e-this._lightEstimationPollTime<this.options.lightEstimationPollInterval)return;this._lightEstimationPollTime=e}if(this._xrLightEstimate=r.getLightEstimate(this._xrLightProbe),this._xrLightEstimate){this._intensity=Math.max(1,this._xrLightEstimate.primaryLightIntensity.x,this._xrLightEstimate.primaryLightIntensity.y,this._xrLightEstimate.primaryLightIntensity.z);var i=this._xrSessionManager.scene.useRightHandedSystem?1:-1;this.options.disableVectorReuse&&(this._lightDirection=new _,this._lightColor=new k,this.directionalLight&&(this.directionalLight.direction=this._lightDirection,this.directionalLight.diffuse=this._lightColor)),this._lightDirection.copyFromFloats(this._xrLightEstimate.primaryLightDirection.x,this._xrLightEstimate.primaryLightDirection.y,this._xrLightEstimate.primaryLightDirection.z*i),this._lightColor.copyFromFloats(this._xrLightEstimate.primaryLightIntensity.x/this._intensity,this._xrLightEstimate.primaryLightIntensity.y/this._intensity,this._xrLightEstimate.primaryLightIntensity.z/this._intensity),this._sphericalHarmonics.updateFromFloatsArray(this._xrLightEstimate.sphericalHarmonicsCoefficients),this._reflectionCubeMap&&!this.options.disableSphericalPolynomial&&(this._reflectionCubeMap.sphericalPolynomial=this._reflectionCubeMap.sphericalPolynomial||new tt,(t=this._reflectionCubeMap.sphericalPolynomial)===null||t===void 0||t.updateFromHarmonics(this._sphericalHarmonics)),this._lightDirection.negateInPlace(),this.directionalLight&&(this.directionalLight.direction.copyFrom(this._lightDirection),this.directionalLight.intensity=Math.min(this._intensity,1),this.directionalLight.diffuse.copyFrom(this._lightColor))}}},n.Name=P.LIGHT_ESTIMATION,n.Version=1,n}(O);A.AddWebXRFeature(Ne.Name,function(o,n){return function(){return new Ne(o,n)}},Ne.Version,!1);var Ee=function(o){R(n,o);function n(r){var t=o.call(this,r)||this;return t.onEyeTrackingStartedObservable=new g,t.onEyeTrackingEndedObservable=new g,t.onEyeTrackingFrameUpdateObservable=new g,t._eyeTrackingStartListener=function(e){t._latestEyeSpace=e.gazeSpace,t._gazeRay=new oe(_.Zero(),_.Forward()),t.onEyeTrackingStartedObservable.notifyObservers(t._gazeRay)},t._eyeTrackingEndListener=function(){t._latestEyeSpace=null,t._gazeRay=null,t.onEyeTrackingEndedObservable.notifyObservers()},t.xrNativeFeatureName="eye-tracking",t._xrSessionManager.session?t._init():t._xrSessionManager.onXRSessionInit.addOnce(function(){t._init()}),t}return n.prototype.dispose=function(){o.prototype.dispose.call(this),this._xrSessionManager.session.removeEventListener("eyetrackingstart",this._eyeTrackingStartListener),this._xrSessionManager.session.removeEventListener("eyetrackingend",this._eyeTrackingEndListener),this.onEyeTrackingStartedObservable.clear(),this.onEyeTrackingEndedObservable.clear(),this.onEyeTrackingFrameUpdateObservable.clear()},Object.defineProperty(n.prototype,"isEyeGazeValid",{get:function(){return!!this._gazeRay},enumerable:!1,configurable:!0}),n.prototype.getEyeGaze=function(){return this._gazeRay},n.prototype._onXRFrame=function(r){if(!(!this.attached||!r)&&this._latestEyeSpace&&this._gazeRay){var t=r.getPose(this._latestEyeSpace,this._xrSessionManager.referenceSpace);if(t){this._gazeRay.origin.set(t.transform.position.x,t.transform.position.y,t.transform.position.z);var e=t.transform.orientation;T.Quaternion[0].set(e.x,e.y,e.z,e.w),this._xrSessionManager.scene.useRightHandedSystem?_.RightHandedForwardReadOnly.rotateByQuaternionToRef(T.Quaternion[0],this._gazeRay.direction):(this._gazeRay.origin.z*=-1,T.Quaternion[0].z*=-1,T.Quaternion[0].w*=-1,_.LeftHandedForwardReadOnly.rotateByQuaternionToRef(T.Quaternion[0],this._gazeRay.direction)),this.onEyeTrackingFrameUpdateObservable.notifyObservers(this._gazeRay)}}},n.prototype._init=function(){this._xrSessionManager.isNative&&(this._xrSessionManager.session.addEventListener("eyetrackingstart",this._eyeTrackingStartListener),this._xrSessionManager.session.addEventListener("eyetrackingend",this._eyeTrackingEndListener))},n.Name=P.EYE_TRACKING,n.Version=1,n}(O);A.AddWebXRFeature(Ee.Name,function(o){return function(){return new Ee(o)}},Ee.Version,!1);var Gt=function(){function o(n,r){this._samples=[],this._idx=0;for(var t=0;t<n;++t)this._samples.push(r?r():B.Zero())}return Object.defineProperty(o.prototype,"length",{get:function(){return this._samples.length},enumerable:!1,configurable:!0}),o.prototype.push=function(n,r){this._idx=(this._idx+this._samples.length-1)%this._samples.length,this.at(0).copyFromFloats(n,r)},o.prototype.at=function(n){if(n>=this._samples.length)throw new Error("Index out of bounds");return this._samples[(this._idx+n)%this._samples.length]},o}(),Bt=function(){function o(){this._samples=new Gt(20),this._entropy=0,this.onFirstStepDetected=new g}return o.prototype.update=function(n,r,t,e){this._samples.push(n,r);var i=this._samples.at(0);if(this._entropy*=this._entropyDecayFactor,this._entropy+=B.Distance(i,this._samples.at(1)),!(this._entropy>this._entropyThreshold)){var a;for(a=this._samePointCheckStartIdx;a<this._samples.length&&!(B.DistanceSquared(i,this._samples.at(a))<this._samePointSquaredDistanceThreshold);++a);if(a!==this._samples.length){for(var s=-1,l=0,u=void 0,h=1;h<a;++h)u=B.DistanceSquared(i,this._samples.at(h)),u>s&&(l=h,s=u);if(!(s<this._apexSquaredDistanceThreshold)){var c=this._samples.at(l),d=c.subtract(i);d.normalize();for(var f=T.Vector2[0],m,v,x=0,h=1;h<a;++h)v=this._samples.at(h),v.subtractToRef(i,f),m=B.Dot(d,f),x+=f.lengthSquared()-m*m;if(!(x>a*this._squaredProjectionDistanceThreshold)){var S=T.Vector3[0];S.set(t,e,0);var M=T.Vector3[1];M.set(d.x,d.y,0);var C=_.Cross(S,M).z>0,F=i.clone(),U=i.clone();c.subtractToRef(i,d),C?(d.scaleAndAddToRef(this._axisToApexShrinkFactor,F),d.scaleAndAddToRef(this._axisToApexExtendFactor,U)):(d.scaleAndAddToRef(this._axisToApexExtendFactor,F),d.scaleAndAddToRef(this._axisToApexShrinkFactor,U)),this.onFirstStepDetected.notifyObservers({leftApex:F,rightApex:U,currentPosition:i,currentStepDirection:C?"right":"left"})}}}}},o.prototype.reset=function(){for(var n=0;n<this._samples.length;++n)this._samples.at(n).copyFromFloats(0,0)},Object.defineProperty(o.prototype,"_samePointCheckStartIdx",{get:function(){return Math.floor(this._samples.length/3)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"_samePointSquaredDistanceThreshold",{get:function(){return .03*.03},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"_apexSquaredDistanceThreshold",{get:function(){return .09*.09},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"_squaredProjectionDistanceThreshold",{get:function(){return .03*.03},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"_axisToApexShrinkFactor",{get:function(){return .8},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"_axisToApexExtendFactor",{get:function(){return-1.6},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"_entropyDecayFactor",{get:function(){return .93},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"_entropyThreshold",{get:function(){return .4},enumerable:!1,configurable:!0}),o}(),Ut=function(){function o(n,r,t,e){this._leftApex=new B,this._rightApex=new B,this._currentPosition=new B,this._axis=new B,this._axisLength=-1,this._forward=new B,this._steppingLeft=!1,this._t=-1,this._maxT=-1,this._maxTPosition=new B,this._vitality=0,this.onMovement=new g,this.onFootfall=new g,this._reset(n,r,t,e==="left")}return o.prototype._reset=function(n,r,t,e){this._leftApex.copyFrom(n),this._rightApex.copyFrom(r),this._steppingLeft=e,this._steppingLeft?(this._leftApex.subtractToRef(this._rightApex,this._axis),this._forward.copyFromFloats(-this._axis.y,this._axis.x)):(this._rightApex.subtractToRef(this._leftApex,this._axis),this._forward.copyFromFloats(this._axis.y,-this._axis.x)),this._axisLength=this._axis.length(),this._forward.scaleInPlace(1/this._axisLength),this._updateTAndVitality(t.x,t.y),this._maxT=this._t,this._maxTPosition.copyFrom(t),this._vitality=1},o.prototype._updateTAndVitality=function(n,r){this._currentPosition.copyFromFloats(n,r),this._steppingLeft?this._currentPosition.subtractInPlace(this._rightApex):this._currentPosition.subtractInPlace(this._leftApex);var t=this._t,e=B.Dot(this._currentPosition,this._axis);this._t=e/(this._axisLength*this._axisLength);var i=this._currentPosition.lengthSquared()-e/this._axisLength*(e/this._axisLength);this._vitality*=.92-100*Math.max(i-.0016,0)+Math.max(this._t-t,0)},o.prototype.update=function(n,r){if(this._vitality<this._vitalityThreshold)return!1;var t=this._t;return this._updateTAndVitality(n,r),this._t>this._maxT&&(this._maxT=this._t,this._maxTPosition.copyFromFloats(n,r)),!(this._vitality<this._vitalityThreshold||(this._t>t&&(this.onMovement.notifyObservers({deltaT:this._t-t}),t<.5&&this._t>=.5&&this.onFootfall.notifyObservers({foot:this._steppingLeft?"left":"right"})),this._t<.95*this._maxT&&(this._currentPosition.copyFromFloats(n,r),this._steppingLeft?this._leftApex.copyFrom(this._maxTPosition):this._rightApex.copyFrom(this._maxTPosition),this._reset(this._leftApex,this._rightApex,this._currentPosition,!this._steppingLeft)),this._axisLength<.03))},Object.defineProperty(o.prototype,"_vitalityThreshold",{get:function(){return .1},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"forward",{get:function(){return this._forward},enumerable:!1,configurable:!0}),o}(),zt=function(){function o(n){var r=this;this._detector=new Bt,this._walker=null,this._movement=new B,this._millisecondsSinceLastUpdate=o._MillisecondsPerUpdate,this.movementThisFrame=_.Zero(),this._engine=n,this._detector.onFirstStepDetected.add(function(t){r._walker||(r._walker=new Ut(t.leftApex,t.rightApex,t.currentPosition,t.currentStepDirection),r._walker.onFootfall.add(function(){console.log("Footfall!")}),r._walker.onMovement.add(function(e){r._walker.forward.scaleAndAddToRef(.024*e.deltaT,r._movement)}))})}return Object.defineProperty(o,"_MillisecondsPerUpdate",{get:function(){return 1e3/15},enumerable:!1,configurable:!0}),o.prototype.update=function(n,r){if(r.y=0,r.normalize(),this._millisecondsSinceLastUpdate+=this._engine.getDeltaTime(),this._millisecondsSinceLastUpdate>=o._MillisecondsPerUpdate){if(this._millisecondsSinceLastUpdate-=o._MillisecondsPerUpdate,this._detector.update(n.x,n.z,r.x,r.z),this._walker){var t=this._walker.update(n.x,n.z);t||(this._walker=null)}this._movement.scaleInPlace(.85)}this.movementThisFrame.set(this._movement.x,0,this._movement.y)},o}(),Se=function(o){R(n,o);function n(r,t){var e=o.call(this,r)||this;return e._up=new _,e._forward=new _,e._position=new _,e._movement=new _,e._sessionManager=r,e.locomotionTarget=t.locomotionTarget,e._isLocomotionTargetWebXRCamera&&N.Warn("Using walking locomotion directly on a WebXRCamera may have unintended interactions with other XR techniques. Using an XR space parent is highly recommended"),e}return Object.defineProperty(n,"Name",{get:function(){return P.WALKING_LOCOMOTION},enumerable:!1,configurable:!0}),Object.defineProperty(n,"Version",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"locomotionTarget",{get:function(){return this._locomotionTarget},set:function(r){this._locomotionTarget=r,this._isLocomotionTargetWebXRCamera=this._locomotionTarget.getClassName()==="WebXRCamera"},enumerable:!1,configurable:!0}),n.prototype.isCompatible=function(){return this._sessionManager.sessionMode===void 0||this._sessionManager.sessionMode==="immersive-vr"},n.prototype.attach=function(){return!this.isCompatible||!o.prototype.attach.call(this)?!1:(this._walker=new zt(this._sessionManager.scene.getEngine()),!0)},n.prototype.detach=function(){return o.prototype.detach.call(this)?(this._walker=null,!0):!1},n.prototype._onXRFrame=function(r){var t=r.getViewerPose(this._sessionManager.baseReferenceSpace);if(!!t){var e=this.locomotionTarget.getScene().useRightHandedSystem?1:-1,i=t.transform.matrix;this._up.copyFromFloats(i[4],i[5],e*i[6]),this._forward.copyFromFloats(i[8],i[9],e*i[10]),this._position.copyFromFloats(i[12],i[13],e*i[14]),this._forward.scaleAndAddToRef(.05,this._position),this._up.scaleAndAddToRef(-.05,this._position),this._walker.update(this._position,this._forward),this._movement.copyFrom(this._walker.movementThisFrame),this._isLocomotionTargetWebXRCamera||_.TransformNormalToRef(this._movement,this.locomotionTarget.getWorldMatrix(),this._movement),this.locomotionTarget.position.addInPlace(this._movement)}},n}(O);A.AddWebXRFeature(Se.Name,function(o,n){return function(){return new Se(o,n)}},Se.Version,!1);var qt=function(o){R(n,o);function n(r,t,e,i,a,s){var l=o.call(this,r,t,e,i,s)||this;return l.getWidth=r,l.getHeight=t,l.layer=e,l.layerType=i,l.isMultiview=a,l.createRTTProvider=s,l}return n}(Le),jt=function(o){R(n,o);function n(r,t,e){var i=o.call(this,r.scene,e)||this;return i._xrSessionManager=r,i._xrWebGLBinding=t,i.layerWrapper=e,i._lastSubImages=new Map,i._compositionLayer=e.layer,i}return n.prototype._getRenderTargetForSubImage=function(r,t){var e=this._lastSubImages.get(t),i=t=="left"?0:1;return(!this._renderTargetTextures[i]||(e==null?void 0:e.textureWidth)!==r.textureWidth||(e==null?void 0:e.textureHeight)!=r.textureHeight)&&(this._renderTargetTextures[i]=this._createRenderTargetTexture(r.textureWidth,r.textureHeight,null,r.colorTexture,r.depthStencilTexture,this.layerWrapper.isMultiview),this._framebufferDimensions={framebufferWidth:r.textureWidth,framebufferHeight:r.textureHeight}),this._lastSubImages.set(t,r),this._renderTargetTextures[i]},n.prototype._getSubImageForEye=function(r){var t=this._xrSessionManager.currentFrame;return t?this._xrWebGLBinding.getSubImage(this._compositionLayer,t,r):null},n.prototype.getRenderTargetTextureForEye=function(r){var t=this._getSubImageForEye(r);return t?this._getRenderTargetForSubImage(t,r):null},n.prototype.getRenderTargetTextureForView=function(r){return this.getRenderTargetTextureForEye(r.eye)},n.prototype._setViewportForSubImage=function(r,t){var e=t.textureWidth,i=t.textureHeight,a=t.viewport;r.x=a.x/e,r.y=a.y/i,r.width=a.width/e,r.height=a.height/i},n.prototype.trySetViewportForView=function(r,t){var e=this._lastSubImages.get(t.eye)||this._getSubImageForEye(t.eye);return e?(this._setViewportForSubImage(r,e),!0):!1},n}(we),Qt=function(o){R(n,o);function n(r,t,e){var i=o.call(this,function(){return r.textureWidth},function(){return r.textureHeight},r,"XRProjectionLayer",t,function(a){return new Yt(a,e,i)})||this;return i.layer=r,i}return n}(qt),Yt=function(o){R(n,o);function n(r,t,e){var i=o.call(this,r,t,e)||this;return i.layerWrapper=e,i._projectionLayer=e.layer,i}return n.prototype._getSubImageForView=function(r){return this._xrWebGLBinding.getViewSubImage(this._projectionLayer,r)},n.prototype.getRenderTargetTextureForView=function(r){return this._getRenderTargetForSubImage(this._getSubImageForView(r),r.eye)},n.prototype.getRenderTargetTextureForEye=function(r){var t=this._lastSubImages.get(r);return t?this._getRenderTargetForSubImage(t,r):null},n.prototype.trySetViewportForView=function(r,t){var e=this._lastSubImages.get(t.eye)||this._getSubImageForView(t);return e?(this._setViewportForSubImage(r,e),!0):!1},n}(jt),Kt={},Be={textureType:"texture",colorFormat:6408,depthFormat:35056,scaleFactor:1},Ae=function(o){R(n,o);function n(r,t){t===void 0&&(t={});var e=o.call(this,r)||this;return e._options=t,e._existingLayers=[],e.xrNativeFeatureName="layers",e}return n.prototype.attach=function(){if(!o.prototype.attach.call(this))return!1;var r=this._xrSessionManager.scene.getEngine();this._glContext=r._gl,this._xrWebGLBinding=new XRWebGLBinding(this._xrSessionManager.session,this._glContext),this._existingLayers.length=0;var t=I({},Be),e=this._options.preferMultiviewOnInit&&r.getCaps().multiview;return e&&(t.textureType="texture-array"),this.addXRSessionLayer(this.createProjectionLayer(t,e)),!0},n.prototype.detach=function(){return o.prototype.detach.call(this)?(this._existingLayers.length=0,!0):!1},n.prototype.createXRWebGLLayer=function(r){r===void 0&&(r=Kt);var t=new XRWebGLLayer(this._xrSessionManager.session,this._glContext,r);return new ke(t)},n.prototype.createProjectionLayer=function(r,t){if(r===void 0&&(r=Be),t===void 0&&(t=!1),t&&r.textureType!=="texture-array")throw new Error("Projection layers can only be made multiview if they use texture arrays. Set the textureType parameter to 'texture-array'.");if(!t&&r.textureType==="texture-array")throw new Error("We currently only support multiview rendering when the textureType parameter is set to 'texture-array'.");var e=this._xrWebGLBinding.createProjectionLayer(r);return new Qt(e,t,this._xrWebGLBinding)},n.prototype.addXRSessionLayer=function(r){this.setXRSessionLayers(Xe(Xe([],this._existingLayers,!0),[r],!1))},n.prototype.setXRSessionLayers=function(r){this._existingLayers=r;var t=I({},this._xrSessionManager.session.renderState);t.baseLayer=void 0,t.layers=r.map(function(e){return e.layer}),this._xrSessionManager.updateRenderState(t),this._xrSessionManager._setBaseLayerWrapper(r.length>0?r[0]:null)},n.prototype.isCompatible=function(){return!this._xrSessionManager.isNative&&typeof XRWebGLBinding!="undefined"&&!!XRWebGLBinding.prototype.createProjectionLayer},n.prototype.dispose=function(){o.prototype.dispose.call(this)},n.prototype._onXRFrame=function(r){},n.Name=P.LAYERS,n.Version=1,n}(O);A.AddWebXRFeature(Ae.Name,function(o,n){return function(){return new Ae(o,n)}},Ae.Version,!1);var Zt=function(o){R(n,o);function n(r,t,e){var i=o.call(this,r,$t[e],t,e,!0)||this;return i.profileId="generic-hand-select-grasp",i}return n.prototype._getFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},n.prototype._getModelLoadingConstraints=function(){return!0},n.prototype._processLoadedModel=function(r){},n.prototype._setRootMesh=function(r){},n.prototype._updateModel=function(){},n}(se);H.RegisterController("generic-hand-select-grasp",function(o,n){return new Zt(n,o.gamepad,o.handedness)});var $t={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr-standard-trigger",visualResponses:{}},grasp:{type:"trigger",gamepadIndices:{button:4},rootNodeName:"grasp",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-hand-select-grasp-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr-standard-trigger",visualResponses:{}},grasp:{type:"trigger",gamepadIndices:{button:4},rootNodeName:"grasp",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-hand-select-grasp-right",assetPath:"right.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr-standard-trigger",visualResponses:{}},grasp:{type:"trigger",gamepadIndices:{button:4},rootNodeName:"grasp",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-hand-select-grasp-none",assetPath:"none.glb"}},Jt=function(o){R(n,o);function n(r,t,e){var i=o.call(this,r,er["left-right"],t,e)||this;return i._mapping={defaultButton:{valueNodeName:"VALUE",unpressedNodeName:"UNPRESSED",pressedNodeName:"PRESSED"},defaultAxis:{valueNodeName:"VALUE",minNodeName:"MIN",maxNodeName:"MAX"},buttons:{"xr-standard-trigger":{rootNodeName:"SELECT",componentProperty:"button",states:["default","touched","pressed"]},"xr-standard-squeeze":{rootNodeName:"GRASP",componentProperty:"state",states:["pressed"]},"xr-standard-touchpad":{rootNodeName:"TOUCHPAD_PRESS",labelAnchorNodeName:"squeeze-label",touchPointNodeName:"TOUCH"},"xr-standard-thumbstick":{rootNodeName:"THUMBSTICK_PRESS",componentProperty:"state",states:["pressed"]}},axes:{"xr-standard-touchpad":{"x-axis":{rootNodeName:"TOUCHPAD_TOUCH_X"},"y-axis":{rootNodeName:"TOUCHPAD_TOUCH_Y"}},"xr-standard-thumbstick":{"x-axis":{rootNodeName:"THUMBSTICK_X"},"y-axis":{rootNodeName:"THUMBSTICK_Y"}}}},i.profileId="microsoft-mixed-reality",i}return n.prototype._getFilenameAndPath=function(){var r="";this.handedness==="left"?r=n.MODEL_LEFT_FILENAME:r=n.MODEL_RIGHT_FILENAME;var t="default",e=n.MODEL_BASE_URL+t+"/";return{filename:r,path:e}},n.prototype._getModelLoadingConstraints=function(){var r=ue.IsPluginForExtensionAvailable(".glb");return r||N.Warn("glTF / glb loaded was not registered, using generic controller instead"),r},n.prototype._processLoadedModel=function(r){var t=this;!this.rootMesh||(this.getComponentIds().forEach(function(e,i){if(!t.disableAnimation&&e&&t.rootMesh){var a=t._mapping.buttons[e],s=a.rootNodeName;if(!s){N.Log("Skipping unknown button at index: "+i+" with mapped name: "+e);return}var l=t._getChildByName(t.rootMesh,s);if(!l){N.Warn("Missing button mesh with name: "+s);return}if(a.valueMesh=t._getImmediateChildByName(l,t._mapping.defaultButton.valueNodeName),a.pressedMesh=t._getImmediateChildByName(l,t._mapping.defaultButton.pressedNodeName),a.unpressedMesh=t._getImmediateChildByName(l,t._mapping.defaultButton.unpressedNodeName),a.valueMesh&&a.pressedMesh&&a.unpressedMesh){var u=t.getComponent(e);u&&u.onButtonStateChangedObservable.add(function(h){t._lerpTransform(a,h.value)},void 0,!0)}else N.Warn("Missing button submesh under mesh with name: "+s)}}),this.getComponentIds().forEach(function(e){var i=t.getComponent(e);!i.isAxes()||["x-axis","y-axis"].forEach(function(a){if(!!t.rootMesh){var s=t._mapping.axes[e][a],l=t._getChildByName(t.rootMesh,s.rootNodeName);if(!l){N.Warn("Missing axis mesh with name: "+s.rootNodeName);return}s.valueMesh=t._getImmediateChildByName(l,t._mapping.defaultAxis.valueNodeName),s.minMesh=t._getImmediateChildByName(l,t._mapping.defaultAxis.minNodeName),s.maxMesh=t._getImmediateChildByName(l,t._mapping.defaultAxis.maxNodeName),s.valueMesh&&s.minMesh&&s.maxMesh?i&&i.onAxisValueChangedObservable.add(function(u){var h=a==="x-axis"?u.x:u.y;t._lerpTransform(s,h,!0)},void 0,!0):N.Warn("Missing axis submesh under mesh with name: "+s.rootNodeName)}})}))},n.prototype._setRootMesh=function(r){this.rootMesh=new ae(this.profileId+" "+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(var t,e=0;e<r.length;e++){var i=r[e];i.isPickable=!1,i.parent||(t=i)}t&&t.setParent(this.rootMesh),this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=y.FromEulerAngles(0,Math.PI,0))},n.prototype._updateModel=function(){},n.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",n.MODEL_LEFT_FILENAME="left.glb",n.MODEL_RIGHT_FILENAME="right.glb",n}(se);H.RegisterController("windows-mixed-reality",function(o,n){return new Jt(n,o.gamepad,o.handedness)});var er={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-right",assetPath:"right.glb"}},Ze=function(o){R(n,o);function n(r,t,e,i,a){a===void 0&&(a=!1);var s=o.call(this,r,tr[e],t,e)||this;return s._forceLegacyControllers=a,s.profileId="oculus-touch",s}return n.prototype._getFilenameAndPath=function(){var r="";this.handedness==="left"?r=n.MODEL_LEFT_FILENAME:r=n.MODEL_RIGHT_FILENAME;var t=this._isQuest()?n.QUEST_MODEL_BASE_URL:n.MODEL_BASE_URL;return{filename:r,path:t}},n.prototype._getModelLoadingConstraints=function(){return!0},n.prototype._processLoadedModel=function(r){var t=this,e=this._isQuest(),i=this.handedness==="right"?-1:1;this.getComponentIds().forEach(function(a){var s=a&&t.getComponent(a);s&&s.onButtonStateChangedObservable.add(function(l){if(!(!t.rootMesh||t.disableAnimation))switch(a){case"xr-standard-trigger":e||(t._modelRootNode.getChildren()[3].rotation.x=-l.value*.2,t._modelRootNode.getChildren()[3].position.y=-l.value*.005,t._modelRootNode.getChildren()[3].position.z=-l.value*.005);return;case"xr-standard-squeeze":e||(t._modelRootNode.getChildren()[4].position.x=i*l.value*.0035);return;case"xr-standard-thumbstick":return;case"a-button":case"x-button":e||(l.pressed?t._modelRootNode.getChildren()[1].position.y=-.001:t._modelRootNode.getChildren()[1].position.y=0);return;case"b-button":case"y-button":e||(l.pressed?t._modelRootNode.getChildren()[2].position.y=-.001:t._modelRootNode.getChildren()[2].position.y=0);return}},void 0,!0)})},n.prototype._setRootMesh=function(r){this.rootMesh=new ae(this.profileId+" "+this.handedness,this.scene),this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=y.FromEulerAngles(0,Math.PI,0)),r.forEach(function(t){t.isPickable=!1}),this._isQuest()?this._modelRootNode=r[0]:(this._modelRootNode=r[1],this.rootMesh.position.y=.034,this.rootMesh.position.z=.052),this._modelRootNode.parent=this.rootMesh},n.prototype._updateModel=function(){},n.prototype._isQuest=function(){return!!navigator.userAgent.match(/Quest/gi)&&!this._forceLegacyControllers},n.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",n.MODEL_LEFT_FILENAME="left.babylon",n.MODEL_RIGHT_FILENAME="right.babylon",n.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",n}(se);H.RegisterController("oculus-touch",function(o,n){return new Ze(n,o.gamepad,o.handedness)});H.RegisterController("oculus-touch-legacy",function(o,n){return new Ze(n,o.gamepad,o.handedness,!0)});var tr={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"x-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"x_button",visualResponses:{}},"y-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"y_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"a-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"a_button",visualResponses:{}},"b-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"b_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-right",assetPath:"right.glb"}},rr=function(o){R(n,o);function n(r,t,e){var i=o.call(this,r,nr[e],t,e)||this;return i.profileId="htc-vive",i}return n.prototype._getFilenameAndPath=function(){var r=n.MODEL_FILENAME,t=n.MODEL_BASE_URL;return{filename:r,path:t}},n.prototype._getModelLoadingConstraints=function(){return!0},n.prototype._processLoadedModel=function(r){var t=this;this.getComponentIds().forEach(function(e){var i=e&&t.getComponent(e);i&&i.onButtonStateChangedObservable.add(function(a){if(!(!t.rootMesh||t.disableAnimation))switch(e){case"xr-standard-trigger":t._modelRootNode.getChildren()[6].rotation.x=-a.value*.15;return;case"xr-standard-touchpad":return;case"xr-standard-squeeze":return}},void 0,!0)})},n.prototype._setRootMesh=function(r){this.rootMesh=new ae(this.profileId+" "+this.handedness,this.scene),r.forEach(function(t){t.isPickable=!1}),this._modelRootNode=r[1],this._modelRootNode.parent=this.rootMesh,this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=y.FromEulerAngles(0,Math.PI,0))},n.prototype._updateModel=function(){},n.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",n.MODEL_FILENAME="wand.babylon",n}(se);H.RegisterController("htc-vive",function(o,n){return new rr(n,o.gamepad,o.handedness)});var nr={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc-vive-none",assetPath:"none.glb"}},ir=function(){function o(n){var r=this;this._nativeImpl=n,this._xrTransform=new XRRigidTransform,this._xrPose={transform:this._xrTransform,emulatedPosition:!1},this._xrPoseVectorData=new Float32Array(4+4),this.fillPoses=this._nativeImpl.fillPoses.bind(this._nativeImpl),this.getViewerPose=this._nativeImpl.getViewerPose.bind(this._nativeImpl),this.getHitTestResults=this._nativeImpl.getHitTestResults.bind(this._nativeImpl),this.getHitTestResultsForTransientInput=function(){throw new Error("XRFrame.getHitTestResultsForTransientInput not supported on native.")},this.createAnchor=this._nativeImpl.createAnchor.bind(this._nativeImpl),this.getJointPose=this._nativeImpl.getJointPose.bind(this._nativeImpl),this.fillJointRadii=this._nativeImpl.fillJointRadii.bind(this._nativeImpl),this.getLightEstimate=function(){throw new Error("XRFrame.getLightEstimate not supported on native.")},this.getImageTrackingResults=function(){var t;return(t=r._nativeImpl._imageTrackingResults)!==null&&t!==void 0?t:[]}}return Object.defineProperty(o.prototype,"session",{get:function(){return this._nativeImpl.session},enumerable:!1,configurable:!0}),o.prototype.getPose=function(n,r){if(!!this._nativeImpl.getPoseData(n,r,this._xrPoseVectorData.buffer,this._xrTransform.matrix.buffer)){var t=this._xrTransform.position;t.x=this._xrPoseVectorData[0],t.y=this._xrPoseVectorData[1],t.z=this._xrPoseVectorData[2],t.w=this._xrPoseVectorData[3];var e=this._xrTransform.orientation;return e.x=this._xrPoseVectorData[4],e.y=this._xrPoseVectorData[5],e.z=this._xrPoseVectorData[6],e.w=this._xrPoseVectorData[7],this._xrPose}},Object.defineProperty(o.prototype,"trackedAnchors",{get:function(){return this._nativeImpl.trackedAnchors},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"worldInformation",{get:function(){return this._nativeImpl.worldInformation},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"detectedPlanes",{get:function(){return this._nativeImpl.detectedPlanes},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"featurePointCloud",{get:function(){return this._nativeImpl.featurePointCloud},enumerable:!1,configurable:!0}),o}();lt("NativeXRFrame",ir);export{P as W,p as X,w as a,Et as b,yr as c};
