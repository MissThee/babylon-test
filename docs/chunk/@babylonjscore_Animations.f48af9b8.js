import{Q as N,a as S,V as Y,C as w,b as R,S as D,T as y,M as P,d as W,B as H}from"./@babylonjscore_Maths.4b8bfdd1.js";import{S as U,W as Q,R as z,P as k,O as C,T as V}from"./@babylonjscore_Misc.5aaba58d.js";import{N as J}from"./@babylonjscore_node.47978260.js";import{S as E}from"./@babylonjscore_scene.c0faa314.js";import{B as Z}from"./@babylonjscore_Bones.ba22abaa.js";import{_ as M}from"./tslibtslib.b6e59fa7.js";import{E as X}from"./@babylonjscore_Engines.77a493e8.js";var B;(function(i){i[i.NONE=0]="NONE",i[i.STEP=1]="STEP"})(B||(B={}));var j=function(){function i(e,t,n){this.name=e,this.from=t,this.to=n}return i.prototype.clone=function(){return new i(this.name,this.from,this.to)},i}(),O=function(){function i(e,t,n,a,r,s){this.name=e,this.targetProperty=t,this.framePerSecond=n,this.dataType=a,this.loopMode=r,this.enableBlending=s,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=a,this.loopMode=r===void 0?i.ANIMATIONLOOPMODE_CYCLE:r,this.uniqueId=i._UniqueIdGenerator++}return i._PrepareAnimation=function(e,t,n,a,r,s,o,u){var h=void 0;if(!isNaN(parseFloat(r))&&isFinite(r)?h=i.ANIMATIONTYPE_FLOAT:r instanceof N?h=i.ANIMATIONTYPE_QUATERNION:r instanceof S?h=i.ANIMATIONTYPE_VECTOR3:r instanceof Y?h=i.ANIMATIONTYPE_VECTOR2:r instanceof w?h=i.ANIMATIONTYPE_COLOR3:r instanceof R?h=i.ANIMATIONTYPE_COLOR4:r instanceof D&&(h=i.ANIMATIONTYPE_SIZE),h==null)return null;var c=new i(e,t,n,h,o),l=[{frame:0,value:r},{frame:a,value:s}];return c.setKeys(l),u!==void 0&&c.setEasingFunction(u),c},i.CreateAnimation=function(e,t,n,a){var r=new i(e+"Animation",e,n,t,i.ANIMATIONLOOPMODE_CONSTANT);return r.setEasingFunction(a),r},i.CreateAndStartAnimation=function(e,t,n,a,r,s,o,u,h,c,l){var f=i._PrepareAnimation(e,n,a,r,s,o,u,h);return!f||(t.getScene&&(l=t.getScene()),!l)?null:l.beginDirectAnimation(t,[f],0,r,f.loopMode===1,1,c)},i.CreateAndStartHierarchyAnimation=function(e,t,n,a,r,s,o,u,h,c,l){var f=i._PrepareAnimation(e,a,r,s,o,u,h,c);if(!f)return null;var p=t.getScene();return p.beginDirectHierarchyAnimation(t,n,[f],0,s,f.loopMode===1,1,l)},i.CreateMergeAndStartAnimation=function(e,t,n,a,r,s,o,u,h,c){var l=i._PrepareAnimation(e,n,a,r,s,o,u,h);return l?(t.animations.push(l),t.getScene().beginAnimation(t,0,r,l.loopMode===1,1,c)):null},i.MakeAnimationAdditive=function(e,t,n,a,r){t===void 0&&(t=0),a===void 0&&(a=!1);var s=e;if(a&&(s=e.clone(),s.name=r||s.name),!s._keys.length)return s;t=t>=0?t:0;var o=0,u=s._keys[0],h=s._keys.length-1,c=s._keys[h],l={referenceValue:u.value,referencePosition:y.Vector3[0],referenceQuaternion:y.Quaternion[0],referenceScaling:y.Vector3[1],keyPosition:y.Vector3[2],keyQuaternion:y.Quaternion[1],keyScaling:y.Vector3[3]},f=!1,p=u.frame,_=c.frame;if(n){var A=s.getRange(n);A&&(p=A.from,_=A.to)}var m=u.frame===p,T=c.frame===_;if(s._keys.length===1){var v=s._getKeyValue(s._keys[0]);l.referenceValue=v.clone?v.clone():v,f=!0}else if(t<=u.frame){var v=s._getKeyValue(u.value);l.referenceValue=v.clone?v.clone():v,f=!0}else if(t>=c.frame){var v=s._getKeyValue(c.value);l.referenceValue=v.clone?v.clone():v,f=!0}for(var g=0;!f||!m||!T&&g<s._keys.length-1;){var d=s._keys[g],I=s._keys[g+1];if(!f&&t>=d.frame&&t<=I.frame){var v=void 0;if(t===d.frame)v=s._getKeyValue(d.value);else if(t===I.frame)v=s._getKeyValue(I.value);else{var F={key:g,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};v=s._interpolate(t,F)}l.referenceValue=v.clone?v.clone():v,f=!0}if(!m&&p>=d.frame&&p<=I.frame){if(p===d.frame)o=g;else if(p===I.frame)o=g+1;else{var F={key:g,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},v=s._interpolate(p,F),b={frame:p,value:v.clone?v.clone():v};s._keys.splice(g+1,0,b),o=g+1}m=!0}if(!T&&_>=d.frame&&_<=I.frame){if(_===d.frame)h=g;else if(_===I.frame)h=g+1;else{var F={key:g,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},v=s._interpolate(_,F),b={frame:_,value:v.clone?v.clone():v};s._keys.splice(g+1,0,b),h=g+1}T=!0}g++}for(s.dataType===i.ANIMATIONTYPE_QUATERNION?l.referenceValue.normalize().conjugateInPlace():s.dataType===i.ANIMATIONTYPE_MATRIX&&(l.referenceValue.decompose(l.referenceScaling,l.referenceQuaternion,l.referencePosition),l.referenceQuaternion.normalize().conjugateInPlace()),g=o;g<=h;g++){var b=s._keys[g];if(!(g&&s.dataType!==i.ANIMATIONTYPE_FLOAT&&b.value===u.value))switch(s.dataType){case i.ANIMATIONTYPE_MATRIX:b.value.decompose(l.keyScaling,l.keyQuaternion,l.keyPosition),l.keyPosition.subtractInPlace(l.referencePosition),l.keyScaling.divideInPlace(l.referenceScaling),l.referenceQuaternion.multiplyToRef(l.keyQuaternion,l.keyQuaternion),P.ComposeToRef(l.keyScaling,l.keyQuaternion,l.keyPosition,b.value);break;case i.ANIMATIONTYPE_QUATERNION:l.referenceValue.multiplyToRef(b.value,b.value);break;case i.ANIMATIONTYPE_VECTOR2:case i.ANIMATIONTYPE_VECTOR3:case i.ANIMATIONTYPE_COLOR3:case i.ANIMATIONTYPE_COLOR4:b.value.subtractToRef(l.referenceValue,b.value);break;case i.ANIMATIONTYPE_SIZE:b.value.width-=l.referenceValue.width,b.value.height-=l.referenceValue.height;break;default:b.value-=l.referenceValue}}return s},i.TransitionTo=function(e,t,n,a,r,s,o,u){if(u===void 0&&(u=null),o<=0)return n[e]=t,u&&u(),null;var h=r*(o/1e3);s.setKeys([{frame:0,value:n[e].clone?n[e].clone():n[e]},{frame:h,value:t}]),n.animations||(n.animations=[]),n.animations.push(s);var c=a.beginAnimation(n,0,h,!1);return c.onAnimationEnd=u,c},Object.defineProperty(i.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var e=0,t=this._runtimeAnimations;e<t.length;e++){var n=t[e];if(!n.isStopped())return!0}return!1},enumerable:!1,configurable:!0}),i.prototype.toString=function(e){var t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var n=!0;for(var a in this._ranges)n&&(t+=", ",n=!1),t+=a;t+="}"}return t},i.prototype.addEvent=function(e){this._events.push(e),this._events.sort(function(t,n){return t.frame-n.frame})},i.prototype.removeEvents=function(e){for(var t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)},i.prototype.getEvents=function(){return this._events},i.prototype.createRange=function(e,t,n){this._ranges[e]||(this._ranges[e]=new j(e,t,n))},i.prototype.deleteRange=function(e,t){t===void 0&&(t=!0);var n=this._ranges[e];if(!!n){if(t)for(var a=n.from,r=n.to,s=this._keys.length-1;s>=0;s--)this._keys[s].frame>=a&&this._keys[s].frame<=r&&this._keys.splice(s,1);this._ranges[e]=null}},i.prototype.getRange=function(e){return this._ranges[e]},i.prototype.getKeys=function(){return this._keys},i.prototype.getHighestFrame=function(){for(var e=0,t=0,n=this._keys.length;t<n;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e},i.prototype.getEasingFunction=function(){return this._easingFunction},i.prototype.setEasingFunction=function(e){this._easingFunction=e},i.prototype.floatInterpolateFunction=function(e,t,n){return W.Lerp(e,t,n)},i.prototype.floatInterpolateFunctionWithTangents=function(e,t,n,a,r){return W.Hermite(e,t,n,a,r)},i.prototype.quaternionInterpolateFunction=function(e,t,n){return N.Slerp(e,t,n)},i.prototype.quaternionInterpolateFunctionWithTangents=function(e,t,n,a,r){return N.Hermite(e,t,n,a,r).normalize()},i.prototype.vector3InterpolateFunction=function(e,t,n){return S.Lerp(e,t,n)},i.prototype.vector3InterpolateFunctionWithTangents=function(e,t,n,a,r){return S.Hermite(e,t,n,a,r)},i.prototype.vector2InterpolateFunction=function(e,t,n){return Y.Lerp(e,t,n)},i.prototype.vector2InterpolateFunctionWithTangents=function(e,t,n,a,r){return Y.Hermite(e,t,n,a,r)},i.prototype.sizeInterpolateFunction=function(e,t,n){return D.Lerp(e,t,n)},i.prototype.color3InterpolateFunction=function(e,t,n){return w.Lerp(e,t,n)},i.prototype.color3InterpolateFunctionWithTangents=function(e,t,n,a,r){return w.Hermite(e,t,n,a,r)},i.prototype.color4InterpolateFunction=function(e,t,n){return R.Lerp(e,t,n)},i.prototype.color4InterpolateFunctionWithTangents=function(e,t,n,a,r){return R.Hermite(e,t,n,a,r)},i.prototype._getKeyValue=function(e){return typeof e=="function"?e():e},i.prototype.evaluate=function(e){return this._interpolate(e,{key:0,repeatCount:0,loopMode:i.ANIMATIONLOOPMODE_CONSTANT})},i.prototype._interpolate=function(e,t){if(t.loopMode===i.ANIMATIONLOOPMODE_CONSTANT&&t.repeatCount>0)return t.highLimitValue.clone?t.highLimitValue.clone():t.highLimitValue;var n=this._keys;if(n.length===1)return this._getKeyValue(n[0].value);var a=t.key;if(n[a].frame>=e)for(;a-1>=0&&n[a].frame>=e;)a--;for(var r=a;r<n.length-1;r++){var s=n[r+1];if(s.frame>=e){t.key=r;var o=n[r],u=this._getKeyValue(o.value),h=this._getKeyValue(s.value);if(o.interpolation===B.STEP)return s.frame>e?u:h;var c=o.outTangent!==void 0&&s.inTangent!==void 0,l=s.frame-o.frame,f=(e-o.frame)/l,p=this.getEasingFunction();switch(p!==null&&(f=p.ease(f)),this.dataType){case i.ANIMATIONTYPE_FLOAT:{var _=c?this.floatInterpolateFunctionWithTangents(u,o.outTangent*l,h,s.inTangent*l,f):this.floatInterpolateFunction(u,h,f);switch(t.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return _;case i.ANIMATIONLOOPMODE_RELATIVE:return t.offsetValue*t.repeatCount+_}break}case i.ANIMATIONTYPE_QUATERNION:{var A=c?this.quaternionInterpolateFunctionWithTangents(u,o.outTangent.scale(l),h,s.inTangent.scale(l),f):this.quaternionInterpolateFunction(u,h,f);switch(t.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return A;case i.ANIMATIONLOOPMODE_RELATIVE:return A.addInPlace(t.offsetValue.scale(t.repeatCount))}return A}case i.ANIMATIONTYPE_VECTOR3:{var m=c?this.vector3InterpolateFunctionWithTangents(u,o.outTangent.scale(l),h,s.inTangent.scale(l),f):this.vector3InterpolateFunction(u,h,f);switch(t.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return m;case i.ANIMATIONLOOPMODE_RELATIVE:return m.add(t.offsetValue.scale(t.repeatCount))}break}case i.ANIMATIONTYPE_VECTOR2:{var T=c?this.vector2InterpolateFunctionWithTangents(u,o.outTangent.scale(l),h,s.inTangent.scale(l),f):this.vector2InterpolateFunction(u,h,f);switch(t.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return T;case i.ANIMATIONLOOPMODE_RELATIVE:return T.add(t.offsetValue.scale(t.repeatCount))}break}case i.ANIMATIONTYPE_SIZE:{switch(t.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(u,h,f);case i.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(u,h,f).add(t.offsetValue.scale(t.repeatCount))}break}case i.ANIMATIONTYPE_COLOR3:{var v=c?this.color3InterpolateFunctionWithTangents(u,o.outTangent.scale(l),h,s.inTangent.scale(l),f):this.color3InterpolateFunction(u,h,f);switch(t.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return v;case i.ANIMATIONLOOPMODE_RELATIVE:return v.add(t.offsetValue.scale(t.repeatCount))}break}case i.ANIMATIONTYPE_COLOR4:{var g=c?this.color4InterpolateFunctionWithTangents(u,o.outTangent.scale(l),h,s.inTangent.scale(l),f):this.color4InterpolateFunction(u,h,f);switch(t.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return g;case i.ANIMATIONLOOPMODE_RELATIVE:return g.add(t.offsetValue.scale(t.repeatCount))}break}case i.ANIMATIONTYPE_MATRIX:{switch(t.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return i.AllowMatricesInterpolation?this.matrixInterpolateFunction(u,h,f,t.workValue):u;case i.ANIMATIONLOOPMODE_RELATIVE:return u}break}}break}}return this._getKeyValue(n[n.length-1].value)},i.prototype.matrixInterpolateFunction=function(e,t,n,a){return i.AllowMatrixDecomposeForInterpolation?a?(P.DecomposeLerpToRef(e,t,n,a),a):P.DecomposeLerp(e,t,n):a?(P.LerpToRef(e,t,n,a),a):P.Lerp(e,t,n)},i.prototype.clone=function(){var e=new i(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges){e._ranges={};for(var t in this._ranges){var n=this._ranges[t];!n||(e._ranges[t]=n.clone())}}return e},i.prototype.setKeys=function(e){this._keys=e.slice(0)},i.prototype.serialize=function(){var e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;var t=this.dataType;e.keys=[];for(var n=this.getKeys(),a=0;a<n.length;a++){var r=n[a],s={};switch(s.frame=r.frame,t){case i.ANIMATIONTYPE_FLOAT:s.values=[r.value],r.inTangent!==void 0&&s.values.push(r.inTangent),r.outTangent!==void 0&&(r.inTangent===void 0&&s.values.push(void 0),s.values.push(r.outTangent)),r.interpolation!==void 0&&(r.inTangent===void 0&&s.values.push(void 0),r.outTangent===void 0&&s.values.push(void 0),s.values.push(r.interpolation));break;case i.ANIMATIONTYPE_QUATERNION:case i.ANIMATIONTYPE_MATRIX:case i.ANIMATIONTYPE_VECTOR3:case i.ANIMATIONTYPE_COLOR3:case i.ANIMATIONTYPE_COLOR4:s.values=r.value.asArray(),r.inTangent!=null&&s.values.push(r.inTangent.asArray()),r.outTangent!=null&&(r.inTangent===void 0&&s.values.push(void 0),s.values.push(r.outTangent.asArray())),r.interpolation!==void 0&&(r.inTangent===void 0&&s.values.push(void 0),r.outTangent===void 0&&s.values.push(void 0),s.values.push(r.interpolation));break}e.keys.push(s)}e.ranges=[];for(var o in this._ranges){var u=this._ranges[o];if(!!u){var h={};h.name=o,h.from=u.from,h.to=u.to,e.ranges.push(h)}}return e},i._UniversalLerp=function(e,t,n){var a=e.constructor;return a.Lerp?a.Lerp(e,t,n):a.Slerp?a.Slerp(e,t,n):e.toFixed?e*(1-n)+n*t:t},i.Parse=function(e){var t=new i(e.name,e.property,e.framePerSecond,e.dataType,e.loopBehavior),n=e.dataType,a=[],r,s;for(e.enableBlending&&(t.enableBlending=e.enableBlending),e.blendingSpeed&&(t.blendingSpeed=e.blendingSpeed),s=0;s<e.keys.length;s++){var o=e.keys[s],u=void 0,h=void 0,c=void 0;switch(n){case i.ANIMATIONTYPE_FLOAT:r=o.values[0],o.values.length>=2&&(u=o.values[1]),o.values.length>=3&&(h=o.values[2]),o.values.length>=4&&(c=o.values[3]);break;case i.ANIMATIONTYPE_QUATERNION:if(r=N.FromArray(o.values),o.values.length>=8){var l=N.FromArray(o.values.slice(4,8));l.equals(N.Zero())||(u=l)}if(o.values.length>=12){var f=N.FromArray(o.values.slice(8,12));f.equals(N.Zero())||(h=f)}o.values.length>=13&&(c=o.values[12]);break;case i.ANIMATIONTYPE_MATRIX:r=P.FromArray(o.values),o.values.length>=17&&(c=o.values[16]);break;case i.ANIMATIONTYPE_COLOR3:r=w.FromArray(o.values),o.values[3]&&(u=w.FromArray(o.values[3])),o.values[4]&&(h=w.FromArray(o.values[4])),o.values[5]&&(c=o.values[5]);break;case i.ANIMATIONTYPE_COLOR4:r=R.FromArray(o.values),o.values[4]&&(u=R.FromArray(o.values[4])),o.values[5]&&(h=R.FromArray(o.values[5])),o.values[6]&&(c=R.FromArray(o.values[6]));break;case i.ANIMATIONTYPE_VECTOR3:default:r=S.FromArray(o.values),o.values[3]&&(u=S.FromArray(o.values[3])),o.values[4]&&(h=S.FromArray(o.values[4])),o.values[5]&&(c=o.values[5]);break}var p={};p.frame=o.frame,p.value=r,u!=null&&(p.inTangent=u),h!=null&&(p.outTangent=h),c!=null&&(p.interpolation=c),a.push(p)}if(t.setKeys(a),e.ranges)for(s=0;s<e.ranges.length;s++)r=e.ranges[s],t.createRange(r.name,r.from,r.to);return t},i.AppendSerializedAnimations=function(e,t){U.AppendSerializedAnimations(e,t)},i.ParseFromFileAsync=function(e,t){var n=this;return new Promise(function(a,r){var s=new Q;s.addEventListener("readystatechange",function(){if(s.readyState==4)if(s.status==200){var o=JSON.parse(s.responseText);if(o.animations&&(o=o.animations),o.length){for(var u=new Array,h=0,c=o;h<c.length;h++){var l=c[h];u.push(n.Parse(l))}a(u)}else{var u=n.Parse(o);e&&(u.name=e),a(u)}}else r("Unable to load the animation")}),s.open("GET",t),s.send()})},i.ParseFromSnippetAsync=function(e){var t=this;return new Promise(function(n,a){var r=new Q;r.addEventListener("readystatechange",function(){if(r.readyState==4)if(r.status==200){var s=JSON.parse(JSON.parse(r.responseText).jsonPayload);if(s.animations){for(var o=JSON.parse(s.animations),u=new Array,h=0,c=o.animations;h<c.length;h++){var l=c[h],f=t.Parse(l);f.snippetId=e,u.push(f)}n(u)}else{var o=JSON.parse(s.animation),f=t.Parse(o);f.snippetId=e,n(f)}}else a("Unable to load the snippet "+e)}),r.open("GET",t.SnippetUrl+"/"+e.replace(/#/g,"/")),r.send()})},i._UniqueIdGenerator=0,i.AllowMatricesInterpolation=!1,i.AllowMatrixDecomposeForInterpolation=!0,i.SnippetUrl="https://snippet.babylonjs.com",i.ANIMATIONTYPE_FLOAT=0,i.ANIMATIONTYPE_VECTOR3=1,i.ANIMATIONTYPE_QUATERNION=2,i.ANIMATIONTYPE_MATRIX=3,i.ANIMATIONTYPE_COLOR3=4,i.ANIMATIONTYPE_COLOR4=7,i.ANIMATIONTYPE_VECTOR2=5,i.ANIMATIONTYPE_SIZE=6,i.ANIMATIONLOOPMODE_RELATIVE=0,i.ANIMATIONLOOPMODE_CYCLE=1,i.ANIMATIONLOOPMODE_CONSTANT=2,i.CreateFromSnippetAsync=i.ParseFromSnippetAsync,i}();z("BABYLON.Animation",O);J._AnimationRangeFactory=function(i,e,t){return new j(i,e,t)};var q=Object.freeze(new N(0,0,0,0)),$=Object.freeze(S.Zero()),K=Object.freeze(Y.Zero()),x=Object.freeze(D.Zero()),tt=Object.freeze(w.Black()),et=function(){function i(e,t,n,a){var r=this;if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._targetIsArray=!1,this._animation=t,this._target=e,this._scene=n,this._host=a,this._activeTargets=[],t._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===O.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=P.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,this._minFrame!==0){var s={frame:0,value:this._minValue};this._keys.splice(0,0,s)}if(this._target instanceof Array){for(var o=0,u=0,h=this._target;u<h.length;u++){var c=h[u];this._preparePath(c,o),this._getOriginalValues(o),o++}this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];var l=t.getEvents();l&&l.length>0&&l.forEach(function(f){r._events.push(f._clone())}),this._enableBlending=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.enableBlending:this._animation.enableBlending}return Object.defineProperty(i.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"weight",{get:function(){return this._weight},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"target",{get:function(){return this._currentActiveTarget},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isAdditive",{get:function(){return this._host&&this._host.isAdditive},enumerable:!1,configurable:!0}),i.prototype._preparePath=function(e,t){t===void 0&&(t=0);var n=this._animation.targetPropertyPath;if(n.length>1){for(var a=e[n[0]],r=1;r<n.length-1;r++)a=a[n[r]];this._targetPath=n[n.length-1],this._activeTargets[t]=a}else this._targetPath=n[0],this._activeTargets[t]=e},Object.defineProperty(i.prototype,"animation",{get:function(){return this._animation},enumerable:!1,configurable:!0}),i.prototype.reset=function(e){if(e===void 0&&(e=!1),e)if(this._target instanceof Array)for(var t=0,n=0,a=this._target;n<a.length;n++){var r=a[n];this._originalValue[t]!==void 0&&this._setValue(r,this._activeTargets[t],this._originalValue[t],-1,t),t++}else this._originalValue[0]!==void 0&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(var t=0;t<this._events.length;t++)this._events[t].isDone=!1},i.prototype.isStopped=function(){return this._stopped},i.prototype.dispose=function(){var e=this._animation.runtimeAnimations.indexOf(this);e>-1&&this._animation.runtimeAnimations.splice(e,1)},i.prototype.setValue=function(e,t){if(this._targetIsArray){for(var n=0;n<this._target.length;n++){var a=this._target[n];this._setValue(a,this._activeTargets[n],e,t,n)}return}this._setValue(this._target,this._directTarget,e,t,0)},i.prototype._getOriginalValues=function(e){e===void 0&&(e=0);var t,n=this._activeTargets[e];n.getRestPose&&this._targetPath==="_matrix"?t=n.getRestPose():t=n[this._targetPath],t&&t.clone?this._originalValue[e]=t.clone():this._originalValue[e]=t},i.prototype._setValue=function(e,t,n,a,r){if(this._currentActiveTarget=t,this._weight=a,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){var s=t[this._targetPath];s.clone?this._originalBlendValue=s.clone():this._originalBlendValue=s}this._originalBlendValue.m?O.AllowMatrixDecomposeForInterpolation?this._currentValue?P.DecomposeLerpToRef(this._originalBlendValue,n,this._blendingFactor,this._currentValue):this._currentValue=P.DecomposeLerp(this._originalBlendValue,n,this._blendingFactor):this._currentValue?P.LerpToRef(this._originalBlendValue,n,this._blendingFactor,this._currentValue):this._currentValue=P.Lerp(this._originalBlendValue,n,this._blendingFactor):this._currentValue=O._UniversalLerp(this._originalBlendValue,n,this._blendingFactor);var o=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=o}else this._currentValue?this._currentValue.copyFrom?this._currentValue.copyFrom(n):this._currentValue=n:n!=null&&n.clone?this._currentValue=n.clone():this._currentValue=n;a!==-1?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[r]):t[this._targetPath]=this._currentValue,e.markAsDirty&&e.markAsDirty(this._animation.targetProperty)},i.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},i.prototype.goToFrame=function(e){var t=this._animation.getKeys();e<t[0].frame?e=t[0].frame:e>t[t.length-1].frame&&(e=t[t.length-1].frame);var n=this._events;if(n.length)for(var a=0;a<n.length;a++)n[a].onlyOnce||(n[a].isDone=n[a].frame<e);this._currentFrame=e;var r=this._animation._interpolate(e,this._animationState);this.setValue(r,-1)},i.prototype._prepareForSpeedRatioChange=function(e){var t=this._previousDelay*(this._animation.framePerSecond*e)/1e3;this._ratioOffset=this._previousRatio-t},i.prototype.animate=function(e,t,n,a,r,s){s===void 0&&(s=-1);var o=this._animation,u=o.targetPropertyPath;if(!u||u.length<1)return this._stopped=!0,!1;var h=!0;(t<this._minFrame||t>this._maxFrame)&&(t=this._minFrame),(n<this._minFrame||n>this._maxFrame)&&(n=this._maxFrame);var c=n-t,l,f=e*(o.framePerSecond*r)/1e3+this._ratioOffset,p=0;if(this._previousDelay=e,this._previousRatio=f,!a&&n>=t&&f>=c)h=!1,p=o._getKeyValue(this._maxValue);else if(!a&&t>=n&&f<=c)h=!1,p=o._getKeyValue(this._minValue);else if(this._animationState.loopMode!==O.ANIMATIONLOOPMODE_CYCLE){var _=n.toString()+t.toString();if(!this._offsetsCache[_]){this._animationState.repeatCount=0,this._animationState.loopMode=O.ANIMATIONLOOPMODE_CYCLE;var A=o._interpolate(t,this._animationState),m=o._interpolate(n,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),o.dataType){case O.ANIMATIONTYPE_FLOAT:this._offsetsCache[_]=m-A;break;case O.ANIMATIONTYPE_QUATERNION:this._offsetsCache[_]=m.subtract(A);break;case O.ANIMATIONTYPE_VECTOR3:this._offsetsCache[_]=m.subtract(A);break;case O.ANIMATIONTYPE_VECTOR2:this._offsetsCache[_]=m.subtract(A);break;case O.ANIMATIONTYPE_SIZE:this._offsetsCache[_]=m.subtract(A);break;case O.ANIMATIONTYPE_COLOR3:this._offsetsCache[_]=m.subtract(A);break}this._highLimitsCache[_]=m}p=this._highLimitsCache[_],l=this._offsetsCache[_]}if(l===void 0)switch(o.dataType){case O.ANIMATIONTYPE_FLOAT:l=0;break;case O.ANIMATIONTYPE_QUATERNION:l=q;break;case O.ANIMATIONTYPE_VECTOR3:l=$;break;case O.ANIMATIONTYPE_VECTOR2:l=K;break;case O.ANIMATIONTYPE_SIZE:l=x;break;case O.ANIMATIONTYPE_COLOR3:l=tt}var T;if(this._host&&this._host.syncRoot){var v=this._host.syncRoot,g=(v.masterFrame-v.fromFrame)/(v.toFrame-v.fromFrame);T=t+(n-t)*g}else f>0&&t>n||f<0&&t<n?T=h&&c!==0?n+f%c:t:T=h&&c!==0?t+f%c:n;var d=this._events;if((r>0&&this.currentFrame>T||r<0&&this.currentFrame<T)&&(this._onLoop(),d.length))for(var I=0;I<d.length;I++)d[I].onlyOnce||(d[I].isDone=!1);this._currentFrame=T,this._animationState.repeatCount=c===0?0:f/c>>0,this._animationState.highLimitValue=p,this._animationState.offsetValue=l;var F=o._interpolate(T,this._animationState);if(this.setValue(F,s),d.length){for(var I=0;I<d.length;I++)if(c>0&&T>=d[I].frame&&d[I].frame>=t||c<0&&T<=d[I].frame&&d[I].frame<=t){var b=d[I];b.isDone||(b.onlyOnce&&(d.splice(I,1),I--),b.isDone=!0,b.action(T))}}return h||(this._stopped=!0),h},i}(),G=function(){function i(e,t,n,a,r,s,o,u,h,c){n===void 0&&(n=0),a===void 0&&(a=100),r===void 0&&(r=!1),s===void 0&&(s=1),c===void 0&&(c=!1),this.target=t,this.fromFrame=n,this.toFrame=a,this.loopAnimation=r,this.onAnimationEnd=o,this.onAnimationLoop=h,this.isAdditive=c,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new C,this.onAnimationLoopObservable=new C,this._scene=e,u&&this.appendAnimations(t,u),this._speedRatio=s,e._activeAnimatables.push(this)}return Object.defineProperty(i.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"masterFrame",{get:function(){return this._runtimeAnimations.length===0?0:this._runtimeAnimations[0].currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"weight",{get:function(){return this._weight},set:function(e){if(e===-1){this._weight=-1;return}this._weight=Math.min(Math.max(e,0),1)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(e){for(var t=0;t<this._runtimeAnimations.length;t++){var n=this._runtimeAnimations[t];n._prepareForSpeedRatioChange(e)}this._speedRatio=e},enumerable:!1,configurable:!0}),i.prototype.syncWith=function(e){if(this._syncRoot=e,e){var t=this._scene._activeAnimatables.indexOf(this);t>-1&&(this._scene._activeAnimatables.splice(t,1),this._scene._activeAnimatables.push(this))}return this},i.prototype.getAnimations=function(){return this._runtimeAnimations},i.prototype.appendAnimations=function(e,t){for(var n=this,a=0;a<t.length;a++){var r=t[a],s=new et(e,r,this._scene,this);s._onLoop=function(){n.onAnimationLoopObservable.notifyObservers(n),n.onAnimationLoop&&n.onAnimationLoop()},this._runtimeAnimations.push(s)}},i.prototype.getAnimationByTargetProperty=function(e){for(var t=this._runtimeAnimations,n=0;n<t.length;n++)if(t[n].animation.targetProperty===e)return t[n].animation;return null},i.prototype.getRuntimeAnimationByTargetProperty=function(e){for(var t=this._runtimeAnimations,n=0;n<t.length;n++)if(t[n].animation.targetProperty===e)return t[n];return null},i.prototype.reset=function(){for(var e=this._runtimeAnimations,t=0;t<e.length;t++)e[t].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},i.prototype.enableBlending=function(e){for(var t=this._runtimeAnimations,n=0;n<t.length;n++)t[n].animation.enableBlending=!0,t[n].animation.blendingSpeed=e},i.prototype.disableBlending=function(){for(var e=this._runtimeAnimations,t=0;t<e.length;t++)e[t].animation.enableBlending=!1},i.prototype.goToFrame=function(e){var t,n=this._runtimeAnimations;if(n[0]){var a=n[0].animation.framePerSecond;this._frameToSyncFromJump=(t=this._frameToSyncFromJump)!==null&&t!==void 0?t:n[0].currentFrame;var r=this.speedRatio===0?0:(e-this._frameToSyncFromJump)/a*1e3/this.speedRatio;this._manualJumpDelay=-r}for(var s=0;s<n.length;s++)n[s].goToFrame(e)},i.prototype.pause=function(){this._paused||(this._paused=!0)},i.prototype.restart=function(){this._paused=!1},i.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},i.prototype.stop=function(e,t){if(e||t){var n=this._scene._activeAnimatables.indexOf(this);if(n>-1){for(var a=this._runtimeAnimations,r=a.length-1;r>=0;r--){var s=a[r];e&&s.animation.name!=e||t&&!t(s.target)||(s.dispose(),a.splice(r,1))}a.length==0&&(this._scene._activeAnimatables.splice(n,1),this._raiseOnAnimationEnd())}}else{var r=this._scene._activeAnimatables.indexOf(this);if(r>-1){this._scene._activeAnimatables.splice(r,1);for(var a=this._runtimeAnimations,o=0;o<a.length;o++)a[o].dispose();this._raiseOnAnimationEnd()}}},i.prototype.waitAsync=function(){var e=this;return new Promise(function(t){e.onAnimationEndObservable.add(function(){t(e)},void 0,void 0,e,!0)})},i.prototype._animate=function(e){if(this._paused)return this.animationStarted=!1,this._pausedDelay===null&&(this._pausedDelay=e),!0;if(this._localDelayOffset===null?(this._localDelayOffset=e,this._pausedDelay=null):this._pausedDelay!==null&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null),this._manualJumpDelay!==null&&(this._localDelayOffset+=this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._weight===0)return!0;var t=!1,n=this._runtimeAnimations,a;for(a=0;a<n.length;a++){var r=n[a],s=r.animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);t=t||s}if(this.animationStarted=t,!t){if(this.disposeOnEnd)for(a=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(a,1),a=0;a<n.length;a++)n[a].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return t},i}();E.prototype._animate=function(){if(!!this.animationsEnabled){var i=k.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=i}this.deltaTime=this.useConstantAnimationDeltaTime?16:(i-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=i;var e=this._activeAnimatables;if(e.length!==0){this._animationTime+=this.deltaTime;for(var t=this._animationTime,n=0;n<e.length;n++){var a=e[n];!a._animate(t)&&a.disposeOnEnd&&n--}this._processLateAnimationBindings()}}};E.prototype.beginWeightedAnimation=function(i,e,t,n,a,r,s,o,u,h,c){n===void 0&&(n=1),r===void 0&&(r=1),c===void 0&&(c=!1);var l=this.beginAnimation(i,e,t,a,r,s,o,!1,u,h,c);return l.weight=n,l};E.prototype.beginAnimation=function(i,e,t,n,a,r,s,o,u,h,c){a===void 0&&(a=1),o===void 0&&(o=!0),c===void 0&&(c=!1),e>t&&a>0&&(a*=-1),o&&this.stopAnimation(i,void 0,u),s||(s=new G(this,i,e,t,n,a,r,void 0,h,c));var l=u?u(i):!0;if(i.animations&&l&&s.appendAnimations(i,i.animations),i.getAnimatables)for(var f=i.getAnimatables(),p=0;p<f.length;p++)this.beginAnimation(f[p],e,t,n,a,r,s,o,u,h);return s.reset(),s};E.prototype.beginHierarchyAnimation=function(i,e,t,n,a,r,s,o,u,h,c,l){r===void 0&&(r=1),u===void 0&&(u=!0),l===void 0&&(l=!1);var f=i.getDescendants(e),p=[];p.push(this.beginAnimation(i,t,n,a,r,s,o,u,h,void 0,l));for(var _=0,A=f;_<A.length;_++){var m=A[_];p.push(this.beginAnimation(m,t,n,a,r,s,o,u,h,void 0,l))}return p};E.prototype.beginDirectAnimation=function(i,e,t,n,a,r,s,o,u){if(u===void 0&&(u=!1),r===void 0&&(r=1),t>n&&r>0)r*=-1;else if(n>t&&r<0){var h=n;n=t,t=h}var c=new G(this,i,t,n,a,r,s,e,o,u);return c};E.prototype.beginDirectHierarchyAnimation=function(i,e,t,n,a,r,s,o,u,h){h===void 0&&(h=!1);var c=i.getDescendants(e),l=[];l.push(this.beginDirectAnimation(i,t,n,a,r,s,o,u,h));for(var f=0,p=c;f<p.length;f++){var _=p[f];l.push(this.beginDirectAnimation(_,t,n,a,r,s,o,u,h))}return l};E.prototype.getAnimatableByTarget=function(i){for(var e=0;e<this._activeAnimatables.length;e++)if(this._activeAnimatables[e].target===i)return this._activeAnimatables[e];return null};E.prototype.getAllAnimatablesByTarget=function(i){for(var e=[],t=0;t<this._activeAnimatables.length;t++)this._activeAnimatables[t].target===i&&e.push(this._activeAnimatables[t]);return e};E.prototype.stopAnimation=function(i,e,t){for(var n=this.getAllAnimatablesByTarget(i),a=0,r=n;a<r.length;a++){var s=r[a];s.stop(e,t)}};E.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i].stop();this._activeAnimatables.length=0}for(var e=0,t=this.animationGroups;e<t.length;e++){var n=t[e];n.stop()}};E.prototype._registerTargetForLateAnimationBinding=function(i,e){var t=i.target;this._registeredForLateAnimationBindings.pushNoDuplicate(t),t._lateAnimationHolders||(t._lateAnimationHolders={}),t._lateAnimationHolders[i.targetPath]||(t._lateAnimationHolders[i.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:e}),i.isAdditive?(t._lateAnimationHolders[i.targetPath].additiveAnimations.push(i),t._lateAnimationHolders[i.targetPath].totalAdditiveWeight+=i.weight):(t._lateAnimationHolders[i.targetPath].animations.push(i),t._lateAnimationHolders[i.targetPath].totalWeight+=i.weight)};E.prototype._processLateAnimationBindingsForMatrices=function(i){if(i.totalWeight===0&&i.totalAdditiveWeight===0)return i.originalValue;var e=1,t=y.Vector3[0],n=y.Vector3[1],a=y.Quaternion[0],r=0,s=i.animations[0],o=i.originalValue,u=1,h=!1;if(i.totalWeight<1)u=1-i.totalWeight,o.decompose(n,a,t);else{if(r=1,e=i.totalWeight,u=s.weight/e,u==1)if(i.totalAdditiveWeight)h=!0;else return s.currentValue;s.currentValue.decompose(n,a,t)}if(!h){n.scaleInPlace(u),t.scaleInPlace(u),a.scaleInPlace(u);for(var c=r;c<i.animations.length;c++){var l=i.animations[c];if(l.weight!==0){u=l.weight/e;var f=y.Vector3[2],p=y.Vector3[3],_=y.Quaternion[1];l.currentValue.decompose(p,_,f),p.scaleAndAddToRef(u,n),_.scaleAndAddToRef(u,a),f.scaleAndAddToRef(u,t)}}}for(var c=0;c<i.additiveAnimations.length;c++){var l=i.additiveAnimations[c];if(l.weight!==0){var f=y.Vector3[2],p=y.Vector3[3],_=y.Quaternion[1];l.currentValue.decompose(p,_,f),p.multiplyToRef(n,p),S.LerpToRef(n,p,l.weight,n),a.multiplyToRef(_,_),N.SlerpToRef(a,_,l.weight,a),f.scaleAndAddToRef(l.weight,t)}}var A=s?s._animationState.workValue:y.Matrix[0].clone();return P.ComposeToRef(n,a,t,A),A};E.prototype._processLateAnimationBindingsForQuaternions=function(i,e){if(i.totalWeight===0&&i.totalAdditiveWeight===0)return e;var t=i.animations[0],n=i.originalValue,a=e;if(i.totalWeight===0&&i.totalAdditiveWeight>0)a.copyFrom(n);else if(i.animations.length===1){if(N.SlerpToRef(n,t.currentValue,Math.min(1,i.totalWeight),a),i.totalAdditiveWeight===0)return a}else if(i.animations.length>1){var r=1,s=void 0,o=void 0;if(i.totalWeight<1){var u=1-i.totalWeight;s=[],o=[],s.push(n),o.push(u)}else{if(i.animations.length===2&&(N.SlerpToRef(i.animations[0].currentValue,i.animations[1].currentValue,i.animations[1].weight/i.totalWeight,e),i.totalAdditiveWeight===0))return e;s=[],o=[],r=i.totalWeight}for(var h=0;h<i.animations.length;h++){var c=i.animations[h];s.push(c.currentValue),o.push(c.weight/r)}for(var l=0,f=0;f<s.length;){if(!f){N.SlerpToRef(s[f],s[f+1],o[f+1]/(o[f]+o[f+1]),e),a=e,l=o[f]+o[f+1],f+=2;continue}l+=o[f],N.SlerpToRef(a,s[f],o[f]/l,a),f++}}for(var h=0;h<i.additiveAnimations.length;h++){var c=i.additiveAnimations[h];c.weight!==0&&(a.multiplyToRef(c.currentValue,y.Quaternion[0]),N.SlerpToRef(a,y.Quaternion[0],c.weight,a))}return a};E.prototype._processLateAnimationBindings=function(){if(!!this._registeredForLateAnimationBindings.length){for(var i=0;i<this._registeredForLateAnimationBindings.length;i++){var e=this._registeredForLateAnimationBindings.data[i];for(var t in e._lateAnimationHolders){var n=e._lateAnimationHolders[t],a=n.animations[0],r=n.originalValue,s=O.AllowMatrixDecomposeForInterpolation&&r.m,o=e[t];if(s)o=this._processLateAnimationBindingsForMatrices(n);else{var u=r.w!==void 0;if(u)o=this._processLateAnimationBindingsForQuaternions(n,o||N.Identity());else{var h=0,c=1;if(n.totalWeight<1)a&&r.scale?o=r.scale(1-n.totalWeight):a?o=r*(1-n.totalWeight):r.clone?o=r.clone():o=r;else if(a){c=n.totalWeight;var l=a.weight/c;l!==1?a.currentValue.scale?o=a.currentValue.scale(l):o=a.currentValue*l:o=a.currentValue,h=1}for(var f=h;f<n.animations.length;f++){var p=n.animations[f],l=p.weight/c;if(l)p.currentValue.scaleAndAddToRef?p.currentValue.scaleAndAddToRef(l,o):o+=p.currentValue*l;else continue}for(var f=0;f<n.additiveAnimations.length;f++){var p=n.additiveAnimations[f],l=p.weight;if(l)p.currentValue.scaleAndAddToRef?p.currentValue.scaleAndAddToRef(l,o):o+=p.currentValue*l;else continue}}}e[t]=o}e._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}};Z.prototype.copyAnimationRange=function(i,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=null),this.animations.length===0&&(this.animations.push(new O(this.name,"_matrix",i.animations[0].framePerSecond,O.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var r=i.animations[0].getRange(e);if(!r)return!1;for(var s=r.from,o=r.to,u=i.animations[0].getKeys(),h=i.length,c=i.getParent(),l=this.getParent(),f=n&&c&&h&&this.length&&h!==this.length,p=f&&l&&c?l.length/c.length:1,_=n&&!l&&a&&(a.x!==1||a.y!==1||a.z!==1),A=this.animations[0].getKeys(),m,T,v,g=0,d=u.length;g<d;g++)m=u[g],m.frame>=s&&m.frame<=o&&(n?(v=m.value.clone(),f?(T=v.getTranslation(),v.setTranslation(T.scaleInPlace(p))):_&&a?(T=v.getTranslation(),v.setTranslation(T.multiplyInPlace(a))):v=m.value):v=m.value,A.push({frame:m.frame+t,value:v}));return this.animations[0].createRange(e,s+t,o+t),!0};var L=function(){function i(){this._easingMode=i.EASINGMODE_EASEIN}return i.prototype.setEasingMode=function(e){var t=Math.min(Math.max(e,0),2);this._easingMode=t},i.prototype.getEasingMode=function(){return this._easingMode},i.prototype.easeInCore=function(e){throw new Error("You must implement this method")},i.prototype.ease=function(e){switch(this._easingMode){case i.EASINGMODE_EASEIN:return this.easeInCore(e);case i.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-e)}return e>=.5?(1-this.easeInCore((1-e)*2))*.5+.5:this.easeInCore(e*2)*.5},i.EASINGMODE_EASEIN=0,i.EASINGMODE_EASEOUT=1,i.EASINGMODE_EASEINOUT=2,i}(),ht=function(i){M(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.easeInCore=function(t){return t=Math.max(0,Math.min(1,t)),1-Math.sqrt(1-t*t)},e}(L),ft=function(i){M(e,i);function e(t){t===void 0&&(t=1);var n=i.call(this)||this;return n.amplitude=t,n}return e.prototype.easeInCore=function(t){var n=Math.max(0,this.amplitude);return Math.pow(t,3)-t*n*Math.sin(3.141592653589793*t)},e}(L);(function(i){M(e,i);function e(t,n){t===void 0&&(t=3),n===void 0&&(n=2);var a=i.call(this)||this;return a.bounces=t,a.bounciness=n,a}return e.prototype.easeInCore=function(t){var n=Math.max(0,this.bounces),a=this.bounciness;a<=1&&(a=1.001);var r=Math.pow(a,n),s=1-a,o=(1-r)/s+r*.5,u=t*o,h=Math.log(-u*(1-a)+1)/Math.log(a),c=Math.floor(h),l=c+1,f=(1-Math.pow(a,c))/(s*o),p=(1-Math.pow(a,l))/(s*o),_=(f+p)*.5,A=t-_,m=_-f;return-Math.pow(1/a,n-c)/(m*m)*(A-m)*(A+m)},e})(L);var ct=function(i){M(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.easeInCore=function(t){return t*t*t},e}(L);(function(i){M(e,i);function e(t,n){t===void 0&&(t=3),n===void 0&&(n=3);var a=i.call(this)||this;return a.oscillations=t,a.springiness=n,a}return e.prototype.easeInCore=function(t){var n,a=Math.max(0,this.oscillations),r=Math.max(0,this.springiness);return r==0?n=t:n=(Math.exp(r*t)-1)/(Math.exp(r)-1),n*Math.sin((6.283185307179586*a+1.5707963267948966)*t)},e})(L);var pt=function(i){M(e,i);function e(t){t===void 0&&(t=2);var n=i.call(this)||this;return n.exponent=t,n}return e.prototype.easeInCore=function(t){return this.exponent<=0?t:(Math.exp(this.exponent*t)-1)/(Math.exp(this.exponent)-1)},e}(L);(function(i){M(e,i);function e(t){t===void 0&&(t=2);var n=i.call(this)||this;return n.power=t,n}return e.prototype.easeInCore=function(t){var n=Math.max(0,this.power);return Math.pow(t,n)},e})(L);var vt=function(i){M(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.easeInCore=function(t){return t*t},e}(L);(function(i){M(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.easeInCore=function(t){return t*t*t*t},e})(L);(function(i){M(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.easeInCore=function(t){return t*t*t*t*t},e})(L);var _t=function(i){M(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.easeInCore=function(t){return 1-Math.sin(1.5707963267948966*(1-t))},e}(L);(function(i){M(e,i);function e(t,n,a,r){t===void 0&&(t=0),n===void 0&&(n=0),a===void 0&&(a=1),r===void 0&&(r=1);var s=i.call(this)||this;return s.x1=t,s.y1=n,s.x2=a,s.y2=r,s}return e.prototype.easeInCore=function(t){return H.Interpolate(t,this.x1,this.y1,this.x2,this.y2)},e})(L);var mt=function(){function i(e,t,n){this.frame=e,this.action=t,this.onlyOnce=n,this.isDone=!1}return i.prototype._clone=function(){return new i(this.frame,this.action,this.onlyOnce)},i}(),it=function(){function i(){}return i.prototype.getClassName=function(){return"TargetedAnimation"},i.prototype.serialize=function(){var e={};return e.animation=this.animation.serialize(),e.targetId=this.target.id,e},i}(),gt=function(){function i(e,t){t===void 0&&(t=null),this.name=e,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._parentContainer=null,this.onAnimationEndObservable=new C,this.onAnimationLoopObservable=new C,this.onAnimationGroupLoopObservable=new C,this.onAnimationGroupEndObservable=new C,this.onAnimationGroupPauseObservable=new C,this.onAnimationGroupPlayObservable=new C,this.metadata=null,this._animationLoopFlags=[],this._scene=t||X.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}return Object.defineProperty(i.prototype,"from",{get:function(){return this._from},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"to",{get:function(){return this._to},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(e){if(this._speedRatio!==e){this._speedRatio=e;for(var t=0;t<this._animatables.length;t++){var n=this._animatables[t];n.speedRatio=this._speedRatio}}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(e){if(this._loopAnimation!==e){this._loopAnimation=e;for(var t=0;t<this._animatables.length;t++){var n=this._animatables[t];n.loopAnimation=this._loopAnimation}}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isAdditive",{get:function(){return this._isAdditive},set:function(e){if(this._isAdditive!==e){this._isAdditive=e;for(var t=0;t<this._animatables.length;t++){var n=this._animatables[t];n.isAdditive=this._isAdditive}}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animatables",{get:function(){return this._animatables},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"children",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),i.prototype.addTargetedAnimation=function(e,t){var n=new it;n.animation=e,n.target=t;var a=e.getKeys();return this._from>a[0].frame&&(this._from=a[0].frame),this._to<a[a.length-1].frame&&(this._to=a[a.length-1].frame),this._targetedAnimations.push(n),n},i.prototype.normalize=function(e,t){e===void 0&&(e=null),t===void 0&&(t=null),e==null&&(e=this._from),t==null&&(t=this._to);for(var n=0;n<this._targetedAnimations.length;n++){var a=this._targetedAnimations[n],r=a.animation.getKeys(),s=r[0],o=r[r.length-1];if(s.frame>e){var u={frame:e,value:s.value,inTangent:s.inTangent,outTangent:s.outTangent,interpolation:s.interpolation};r.splice(0,0,u)}if(o.frame<t){var u={frame:t,value:o.value,inTangent:o.inTangent,outTangent:o.outTangent,interpolation:o.interpolation};r.push(u)}}return this._from=e,this._to=t,this},i.prototype._processLoop=function(e,t,n){var a=this;e.onAnimationLoop=function(){a.onAnimationLoopObservable.notifyObservers(t),!a._animationLoopFlags[n]&&(a._animationLoopFlags[n]=!0,a._animationLoopCount++,a._animationLoopCount===a._targetedAnimations.length&&(a.onAnimationGroupLoopObservable.notifyObservers(a),a._animationLoopCount=0,a._animationLoopFlags.length=0))}},i.prototype.start=function(e,t,n,a,r){var s=this;if(e===void 0&&(e=!1),t===void 0&&(t=1),this._isStarted||this._targetedAnimations.length===0)return this;this._loopAnimation=e,this._animationLoopCount=0,this._animationLoopFlags.length=0;for(var o=function(c){var l=u._targetedAnimations[c],f=u._scene.beginDirectAnimation(l.target,[l.animation],n!==void 0?n:u._from,a!==void 0?a:u._to,e,t,void 0,void 0,r!==void 0?r:u._isAdditive);f.onAnimationEnd=function(){s.onAnimationEndObservable.notifyObservers(l),s._checkAnimationGroupEnded(f)},u._processLoop(f,l,c),u._animatables.push(f)},u=this,h=0;h<this._targetedAnimations.length;h++)o(h);return this._speedRatio=t,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},i.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var e=0;e<this._animatables.length;e++){var t=this._animatables[e];t.pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this},i.prototype.play=function(e){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(e!==void 0&&(this.loopAnimation=e),this.restart()):(this.stop(),this.start(e,this._speedRatio)),this._isPaused=!1,this},i.prototype.reset=function(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(),this;for(var e=0;e<this._animatables.length;e++){var t=this._animatables[e];t.reset()}return this},i.prototype.restart=function(){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++){var t=this._animatables[e];t.restart()}return this.onAnimationGroupPlayObservable.notifyObservers(this),this},i.prototype.stop=function(){if(!this._isStarted)return this;for(var e=this._animatables.slice(),t=0;t<e.length;t++)e[t].stop();return this._isStarted=!1,this},i.prototype.setWeightForAllAnimatables=function(e){for(var t=0;t<this._animatables.length;t++){var n=this._animatables[t];n.weight=e}return this},i.prototype.syncAllAnimationsWith=function(e){for(var t=0;t<this._animatables.length;t++){var n=this._animatables[t];n.syncWith(e)}return this},i.prototype.goToFrame=function(e){if(!this._isStarted)return this;for(var t=0;t<this._animatables.length;t++){var n=this._animatables[t];n.goToFrame(e)}return this},i.prototype.dispose=function(){this._targetedAnimations.length=0,this._animatables.length=0;var e=this._scene.animationGroups.indexOf(this);if(e>-1&&this._scene.animationGroups.splice(e,1),this._parentContainer){var t=this._parentContainer.animationGroups.indexOf(this);t>-1&&this._parentContainer.animationGroups.splice(t,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()},i.prototype._checkAnimationGroupEnded=function(e){var t=this._animatables.indexOf(e);t>-1&&this._animatables.splice(t,1),this._animatables.length===0&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},i.prototype.clone=function(e,t,n){n===void 0&&(n=!1);for(var a=new i(e||this.name,this._scene),r=0,s=this._targetedAnimations;r<s.length;r++){var o=s[r];a.addTargetedAnimation(n?o.animation.clone():o.animation,t?t(o.target):o.target)}return a},i.prototype.serialize=function(){var e={};e.name=this.name,e.from=this.from,e.to=this.to,e.targetedAnimations=[];for(var t=0;t<this.targetedAnimations.length;t++){var n=this.targetedAnimations[t];e.targetedAnimations[t]=n.serialize()}return V&&V.HasTags(this)&&(e.tags=V.GetTags(this)),this.metadata&&(e.metadata=this.metadata),e},i.Parse=function(e,t){for(var n=new i(e.name,t),a=0;a<e.targetedAnimations.length;a++){var r=e.targetedAnimations[a],s=O.Parse(r.animation),o=r.targetId;if(r.animation.property==="influence"){var u=t.getMorphTargetById(o);u&&n.addTargetedAnimation(s,u)}else{var h=t.getNodeById(o);h!=null&&n.addTargetedAnimation(s,h)}}return e.from!==null&&e.to!==null&&n.normalize(e.from,e.to),V&&V.AddTagsTo(n,e.tags),e.metadata!==void 0&&(n.metadata=e.metadata),n},i.MakeAnimationAdditive=function(e,t,n,a,r){t===void 0&&(t=0),a===void 0&&(a=!1);var s=e;a&&(s=e.clone(r||s.name));for(var o=s.targetedAnimations,u=0;u<o.length;u++){var h=o[u];O.MakeAnimationAdditive(h.animation,t,n)}return s.isAdditive=!0,s},i.prototype.getClassName=function(){return"AnimationGroup"},i.prototype.toString=function(e){var t="Name: "+this.name;return t+=", type: "+this.getClassName(),e&&(t+=", from: "+this._from,t+=", to: "+this._to,t+=", isStarted: "+this._isStarted,t+=", speedRatio: "+this._speedRatio,t+=", targetedAnimations length: "+this._targetedAnimations.length,t+=", animatables length: "+this._animatables),t},i}();export{O as A,ft as B,ht as C,L as E,vt as Q,_t as S,pt as a,j as b,gt as c,B as d,mt as e,ct as f};
