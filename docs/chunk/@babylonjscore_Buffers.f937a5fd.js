var b=function(){function e(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=e._Counter++}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),e._Counter=0,e}(),g=function(){function e(t,r,i,f,n,s,u,h){f===void 0&&(f=0),n===void 0&&(n=!1),s===void 0&&(s=!1),u===void 0&&(u=!1),this._isAlreadyOwned=!1,t.getScene?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=i,this._instanced=s,this._divisor=h||1,r instanceof b?(this._data=null,this._buffer=r):(this._data=r,this._buffer=null),this.byteStride=u?f:f*Float32Array.BYTES_PER_ELEMENT,n||this.create()}return e.prototype.createVertexBuffer=function(t,r,i,f,n,s,u){s===void 0&&(s=!1);var h=s?r:r*Float32Array.BYTES_PER_ELEMENT,c=f?s?f:f*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new v(this._engine,this,t,this._updatable,!0,c,n===void 0?this._instanced:n,h,i,void 0,void 0,!0,this._divisor||u)},e.prototype.isUpdatable=function(){return this._updatable},e.prototype.getData=function(){return this._data},e.prototype.getBuffer=function(){return this._buffer},e.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},e.prototype.create=function(t){t===void 0&&(t=null),!(!t&&this._buffer)&&(t=t||this._data,t&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t),this._data=t):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(t),this._data=t):this._buffer=this._engine.createVertexBuffer(t)))},e.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},e.prototype.update=function(t){this.create(t)},e.prototype.updateDirectly=function(t,r,i,f){f===void 0&&(f=!1),!!this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t,f?r:r*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),r===0&&i===void 0?this._data=t:this._data=null)},e.prototype._increaseReferences=function(){if(!!this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}},e.prototype.dispose=function(){!this._buffer||this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)},e}(),v=function(){function e(t,r,i,f,n,s,u,h,c,p,o,a,d,y){if(o===void 0&&(o=!1),a===void 0&&(a=!1),d===void 0&&(d=1),y===void 0&&(y=!1),r instanceof g?(this._buffer=r,this._ownsBuffer=y):(this._buffer=new g(t,r,f,s,n,u,a),this._ownsBuffer=!0),this.uniqueId=e._Counter++,this._kind=i,p==null){var _=this.getData();this.type=e.FLOAT,_ instanceof Int8Array?this.type=e.BYTE:_ instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:_ instanceof Int16Array?this.type=e.SHORT:_ instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:_ instanceof Int32Array?this.type=e.INT:_ instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)}else this.type=p;var l=e.GetTypeByteLength(this.type);a?(this._size=c||(s?s/l:e.DeduceStride(i)),this.byteStride=s||this._buffer.byteStride||this._size*l,this.byteOffset=h||0):(this._size=c||s||e.DeduceStride(i),this.byteStride=s?s*l:this._buffer.byteStride||this._size*l,this.byteOffset=(h||0)*l),this.normalized=o,this._instanced=u!==void 0?u:!1,this._instanceDivisor=u?d:0,this._computeHashCode()}return Object.defineProperty(e.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(t){this._instanceDivisor=t,t==0?this._instanced=!1:this._instanced=!0,this._computeHashCode()},enumerable:!1,configurable:!0}),e.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},e.prototype._rebuild=function(){!this._buffer||this._buffer._rebuild()},e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getFloatData=function(t,r){var i=this.getData();if(!i)return null;var f=this.getSize()*e.GetTypeByteLength(this.type),n=t*this.getSize();if(this.type!==e.FLOAT||this.byteStride!==f){var s=new Float32Array(n);return this.forEach(n,function(o,a){return s[a]=o}),s}if(!(i instanceof Array||i instanceof Float32Array)||this.byteOffset!==0||i.length!==n)if(i instanceof Array){var u=this.byteOffset/4;return i.slice(u,u+n)}else{if(i instanceof ArrayBuffer)return new Float32Array(i,this.byteOffset,n);var u=i.byteOffset+this.byteOffset;if(r){var h=new Float32Array(n),c=new Float32Array(i.buffer,u,n);return h.set(c),h}var p=u%4;return p&&(u=Math.max(0,u-p)),new Float32Array(i.buffer,u,n)}return r?i.slice():i},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this.byteStride/e.GetTypeByteLength(this.type)},e.prototype.getOffset=function(){return this.byteOffset/e.GetTypeByteLength(this.type)},e.prototype.getSize=function(t){return t===void 0&&(t=!1),t?this._size*e.GetTypeByteLength(this.type):this._size},e.prototype.getIsInstanced=function(){return this._instanced},e.prototype.getInstanceDivisor=function(){return this._instanceDivisor},e.prototype.create=function(t){this._buffer.create(t)},e.prototype.update=function(t){this._buffer.update(t)},e.prototype.updateDirectly=function(t,r,i){i===void 0&&(i=!1),this._buffer.updateDirectly(t,r,void 0,i)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},e.prototype.forEach=function(t,r){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,r)},e.DeduceStride=function(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}},e.GetTypeByteLength=function(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.UNSIGNED_INT:case e.FLOAT:return 4;default:throw new Error("Invalid type '".concat(t,"'"))}},e.ForEach=function(t,r,i,f,n,s,u,h){if(t instanceof Array)for(var c=r/4,p=i/4,o=0;o<s;o+=f){for(var a=0;a<f;a++)h(t[c+a],o+a);c+=p}else for(var d=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),y=e.GetTypeByteLength(n),o=0;o<s;o+=f){for(var _=r,a=0;a<f;a++){var l=e._GetFloatValue(d,n,_,u);h(l,o+a),_+=y}r+=i}},e._GetFloatValue=function(t,r,i,f){switch(r){case e.BYTE:{var n=t.getInt8(i);return f&&(n=Math.max(n/127,-1)),n}case e.UNSIGNED_BYTE:{var n=t.getUint8(i);return f&&(n=n/255),n}case e.SHORT:{var n=t.getInt16(i,!0);return f&&(n=Math.max(n/32767,-1)),n}case e.UNSIGNED_SHORT:{var n=t.getUint16(i,!0);return f&&(n=n/65535),n}case e.INT:return t.getInt32(i,!0);case e.UNSIGNED_INT:return t.getUint32(i,!0);case e.FLOAT:return t.getFloat32(i,!0);default:throw new Error("Invalid component type ".concat(r))}},e._Counter=0,e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.ColorInstanceKind="instanceColor",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e}(),E=function(){function e(t,r,i){i===void 0&&(i=3),this._engine=t,this._engine._storageBuffers.push(this),this._create(r,i)}return e.prototype._create=function(t,r){this._bufferSize=t,this._creationFlags=r,this._buffer=this._engine.createStorageBuffer(t,r)},e.prototype._rebuild=function(){this._create(this._bufferSize,this._creationFlags)},e.prototype.getBuffer=function(){return this._buffer},e.prototype.update=function(t,r,i){!this._buffer||this._engine.updateStorageBuffer(this._buffer,t,r,i)},e.prototype.read=function(t,r,i){return this._engine.readFromStorageBuffer(this._buffer,t,r,i)},e.prototype.dispose=function(){var t=this._engine._storageBuffers,r=t.indexOf(this);r!==-1&&(t[r]=t[t.length-1],t.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null},e}();export{g as B,b as D,E as S,v as V};
